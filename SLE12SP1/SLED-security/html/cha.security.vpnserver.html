<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang=""><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Configuring a VPN Server | Security Guide | SUSE Linux Enterprise Desktop 12 SP1</title><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" /><link rel="stylesheet" type="text/css" href="static/css/style.css" /><link rel="stylesheet" type="text/css" href="static/css/highlight.css" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><meta name="product-name" content="SUSE Linux Enterprise Desktop" /><meta name="product-number" content="12 SP1" /><meta name="book-title" content="Security Guide" /><meta name="chapter-title" content="Chapter 16. Configuring a VPN Server" /><meta name="description" content="Nowadays, the Internet connection is cheap and available almost everywhere. It is important that the connection is as secure as possible. Virtual Private Network (VPN) is a secure network within a second, insecure network such as the Internet or Wi-Fi. It can be implemented in different ways and serves several purposes. In this chapter, we focus on the OpenVPN implementation to link branch offices via secure wide area networks (WANs)." /><meta name="tracker-url" content="https://bugzilla.suse.com/enter_bug.cgi" /><meta name="tracker-type" content="bsc" /><meta name="tracker-bsc-assignee" content="fs@suse.com" /><meta name="tracker-bsc-component" content="Documentation" /><meta name="tracker-bsc-product" content="SUSE Linux Enterprise Desktop 12 SP1 (SLED 12 SP1)" /><link rel="home" href="index.html" title="SUSE Linux Enterprise Desktop Documentation" /><link rel="up" href="part.network_security.html" title="Part III. Network Security" /><link rel="prev" href="cha.security.firewall.html" title="Chapter 15. Masquerading and Firewalls" /><link rel="next" href="cha.security.yast_ca.html" title="Chapter 17. Managing X.509 Certification" /><script type="text/javascript">

var protocol = window.location.protocol.toLowerCase();
if ( protocol != 'file:' ) {
  var agent = navigator.userAgent.toLowerCase();
  var wanted = ( protocol == 'https:') ? 'https' : 'http';
  var file = 'fonts.css';
  document.write('<link rel="stylesheet" type="text/css" href="' + wanted + '://static.opensuse.org/fonts/'+ file +'"></link>');
}
else {
   document.write('<link rel="stylesheet" type="text/css" href="static/css/fonts-onlylocal.css"></link>');
}

</script><noscript><link rel="stylesheet" type="text/css" href="http://static.opensuse.org/fonts/fonts.css" /></noscript><script src="static/js/jquery-1.10.2.min.js" type="text/javascript"></script><script src="static/js/script.js" type="text/javascript"></script><script src="static/js/highlight.min.js" type="text/javascript"></script><script>

$(document).ready(function() {
  $('.verbatim-wrap.highlight').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});
hljs.configure({
  useBR: false
});

</script></head><body class="draft offline js-off"><div id="_outer-wrap"><div id="_white-bg"><div id="_header"><div id="_logo"><img src="static/images/logo.png" alt="Logo" /></div><div class="crumbs"><a class="book-link" href="index.html" title="SUSE Linux Enterprise Desktop Documentation"><span class="book-icon">SUSE Linux Enterprise Desktop Documentation</span></a><span> › </span><a class="crumb" href="book.security.html">Security Guide</a><span> › </span><a class="crumb" href="part.network_security.html">Network Security</a><span> › </span><a class="crumb" href="cha.security.vpnserver.html">Configuring a VPN Server</a></div><div class="clearme"></div></div></div><div id="_toolbar-wrap"><div id="_toolbar"><div id="_toc-area" class="inactive"><a id="_toc-area-button" class="tool" title="Contents" accesskey="c" href="index.html"><span class="tool-spacer"><span class="toc-icon">Contents</span><span class="clearme"></span></span><span class="tool-label">Contents</span></a><div class="active-contents bubble-corner"></div><div class="active-contents bubble"><div class="bubble-container"><h6>Security Guide</h6><div id="_bubble-toc"><ol><li class="inactive"><a href="preface.security.html"><span class="number"> </span><span class="name">About This Guide</span></a></li><li class="inactive"><a href="cha.security.html"><span class="number">1 </span><span class="name">Security and Confidentiality</span></a></li><li class="inactive"><a href="part.auth.html"><span class="number">I </span><span class="name">Authentication</span></a><ol><li class="inactive"><a href="cha.pam.html"><span class="number">2 </span><span class="name">Authentication with PAM</span></a></li><li class="inactive"><a href="cha.nis.html"><span class="number">3 </span><span class="name">Using NIS</span></a></li><li class="inactive"><a href="cha.security.auth.html"><span class="number">4 </span><span class="name">Authentication Server and Client</span></a></li><li class="inactive"><a href="cha.security.ldap.html"><span class="number">5 </span><span class="name">LDAP—A Directory Service</span></a></li><li class="inactive"><a href="cha.security.ad.html"><span class="number">6 </span><span class="name">Active Directory Support</span></a></li><li class="inactive"><a href="cha.security.kerberos.html"><span class="number">7 </span><span class="name">Network Authentication with Kerberos</span></a></li></ol></li><li class="inactive"><a href="part.local_security.html"><span class="number">II </span><span class="name">Local Security</span></a><ol><li class="inactive"><a href="cha.security.yast_security.html"><span class="number">8 </span><span class="name">Configuring Security Settings with YaST</span></a></li><li class="inactive"><a href="cha.security.policykit.html"><span class="number">9 </span><span class="name">Authorization with PolKit</span></a></li><li class="inactive"><a href="cha.security.acls.html"><span class="number">10 </span><span class="name">Access Control Lists in Linux</span></a></li><li class="inactive"><a href="cha.security.cryptofs.html"><span class="number">11 </span><span class="name">Encrypting Partitions and Files</span></a></li><li class="inactive"><a href="cha.certstore.html"><span class="number">12 </span><span class="name">Certificate Store</span></a></li><li class="inactive"><a href="cha.aide.html"><span class="number">13 </span><span class="name">Intrusion Detection with AIDE</span></a></li></ol></li><li class="inactive"><a href="part.network_security.html"><span class="number">III </span><span class="name">Network Security</span></a><ol><li class="inactive"><a href="cha.ssh.html"><span class="number">14 </span><span class="name">SSH: Secure Network Operations</span></a></li><li class="inactive"><a href="cha.security.firewall.html"><span class="number">15 </span><span class="name">Masquerading and Firewalls</span></a></li><li class="inactive"><a href="cha.security.vpnserver.html"><span class="number">16 </span><span class="name">Configuring a VPN Server</span></a></li><li class="inactive"><a href="cha.security.yast_ca.html"><span class="number">17 </span><span class="name">Managing X.509 Certification</span></a></li></ol></li><li class="inactive"><a href="part.apparmor.html"><span class="number">IV </span><span class="name">Confining Privileges with <span class="phrase">AppArmor</span></span></a><ol><li class="inactive"><a href="cha.apparmor.intro.html"><span class="number">18 </span><span class="name">Introducing <span class="phrase">AppArmor</span></span></a></li><li class="inactive"><a href="cha.apparmor.start.html"><span class="number">19 </span><span class="name">Getting Started</span></a></li><li class="inactive"><a href="cha.apparmor.concept.html"><span class="number">20 </span><span class="name">Immunizing Programs</span></a></li><li class="inactive"><a href="cha.apparmor.profiles.html"><span class="number">21 </span><span class="name">Profile Components and Syntax</span></a></li><li class="inactive"><a href="cha.apparmor.repos.html"><span class="number">22 </span><span class="name"><span class="phrase">AppArmor</span> Profile Repositories</span></a></li><li class="inactive"><a href="cha.apparmor.yast.html"><span class="number">23 </span><span class="name">Building and Managing Profiles with YaST</span></a></li><li class="inactive"><a href="cha.apparmor.commandline.html"><span class="number">24 </span><span class="name">Building Profiles from the Command Line</span></a></li><li class="inactive"><a href="cha.apparmor.hat.html"><span class="number">25 </span><span class="name">Profiling Your Web Applications Using ChangeHat</span></a></li><li class="inactive"><a href="cha.apparmor.pam.html"><span class="number">26 </span><span class="name">Confining Users with <code class="systemitem">pam_apparmor</code></span></a></li><li class="inactive"><a href="cha.apparmor.managing.html"><span class="number">27 </span><span class="name">Managing Profiled Applications</span></a></li><li class="inactive"><a href="cha.apparmor.support.html"><span class="number">28 </span><span class="name">Support</span></a></li><li class="inactive"><a href="cha.apparmor.glossary.html"><span class="number">29 </span><span class="name"><span class="phrase">AppArmor</span> Glossary</span></a></li></ol></li><li class="inactive"><a href="part.audit.html"><span class="number">V </span><span class="name"><em class="citetitle ">The Linux Audit Framework</em></span></a><ol><li class="inactive"><a href="cha.audit.comp.html"><span class="number">30 </span><span class="name">Understanding Linux Audit</span></a></li><li class="inactive"><a href="cha.audit.setup.html"><span class="number">31 </span><span class="name">Setting Up the Linux Audit Framework</span></a></li><li class="inactive"><a href="cha.audit.scenarios.html"><span class="number">32 </span><span class="name">Introducing an Audit Rule Set</span></a></li><li class="inactive"><a href="cha.audit.moreinfo.html"><span class="number">33 </span><span class="name">Useful Resources</span></a></li></ol></li><li class="inactive"><a href="app.security.docupdates.html"><span class="number">A </span><span class="name">Documentation Updates</span></a></li><li class="inactive"><a href="bk04apb.html"><span class="number">B </span><span class="name">GNU Licenses</span></a></li></ol></div><div class="clearme"></div></div></div></div><div id="_nav-area" class="inactive"><div class="tool"><span class="nav-inner"><span class="tool-label">Navigation</span><a accesskey="p" class="tool-spacer" title="Chapter 15. Masquerading and Firewalls" href="cha.security.firewall.html"><span class="prev-icon">←</span></a><a accesskey="n" class="tool-spacer" title="Chapter 17. Managing X.509 Certification" href="cha.security.yast_ca.html"><span class="next-icon">→</span></a></span></div></div></div></div><div id="_fixed-header-wrap" class="inactive"><div id="_fixed-header"><div class="crumbs"><a class="book-link" href="index.html" title="SUSE Linux Enterprise Desktop Documentation"><span class="book-icon">SUSE Linux Enterprise Desktop Documentation</span></a><span> › </span><a class="crumb" href="book.security.html">Security Guide</a><span> › </span><a class="crumb" href="part.network_security.html">Network Security</a><span> › </span><a class="crumb" href="cha.security.vpnserver.html">Configuring a VPN Server</a></div><div class="buttons"><a class="top-button button" href="#">Top</a><div class="button"><a accesskey="p" class="tool-spacer" title="Chapter 15. Masquerading and Firewalls" href="cha.security.firewall.html"><span class="prev-icon">←</span></a><a accesskey="n" class="tool-spacer" title="Chapter 17. Managing X.509 Certification" href="cha.security.yast_ca.html"><span class="next-icon">→</span></a></div><div class="clearme"></div></div><div class="clearme"></div></div></div><div id="_content" class="draft "><div class="documentation"><div class="chapter " id="cha.security.vpnserver"><div class="titlepage"><div><div class="version-info">Applies to  <span class="productname"><span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span></span> <span class="productnumber"><span class="productnumber"><span class="phrase">12 SP1</span></span></span></div><div><h2 class="title"><span class="number">16 </span><span class="name">Configuring a VPN Server</span> </h2><div class="doc-status"><ul><li><span class="ds-label">Filename: </span>security_vpnserver.xml</li><li><span class="ds-label">ID: </span>cha.security.vpnserver</li></ul></div></div><div><div class="abstract"><div class="abstract-title-wrap"><h6 class="abstract-title">Abstract<a title="Permalink" class="permalink" href="cha.security.vpnserver.html#idm139898549645392">#</a></h6></div><p>
    Nowadays, the Internet connection is cheap and available almost
    everywhere. It is important that the connection is as secure as
    possible. Virtual Private Network (VPN) is a secure network within a
    second, insecure network such as the Internet or Wi-Fi. It can be
    implemented in different ways and serves several purposes. In this
    chapter, we focus on the
    <a class="link" href="http://www.openvpn.net" target="_blank">OpenVPN</a> implementation
    to link branch offices via secure wide area networks (WANs).

        </p></div></div></div></div><div class="line"><div class="toc"><dl><dt><span class="sect1"><a href="cha.security.vpnserver.html#sec.security.vpn.overview"><span class="number">16.1 </span><span class="name">Conceptual Overview</span></a></span></dt><dt><span class="sect1"><a href="cha.security.vpnserver.html#sec.security.vpn.simplest"><span class="number">16.2 </span><span class="name">Setting Up a Simple Test Scenario</span></a></span></dt><dt><span class="sect1"><a href="cha.security.vpnserver.html#sec.security.vpn.ca"><span class="number">16.3 </span><span class="name">Setting Up Your VPN Server Using Certificate Authority</span></a></span></dt><dt><span class="sect1"><a href="cha.security.vpnserver.html#sec.security.vpn.nameserver"><span class="number">16.4 </span><span class="name">Changing Name Servers in VPN</span></a></span></dt><dt><span class="sect1"><a href="cha.security.vpnserver.html#sec.security.vpn.tools-client"><span class="number">16.5 </span><span class="name">The GNOME Applet</span></a></span></dt><dt><span class="sect1"><a href="cha.security.vpnserver.html#sec.security.vpn.moreinfo"><span class="number">16.6 </span><span class="name">For More Information</span></a></span></dt></dl></div></div><a id="idm139898549642128" class="indexterm"></a><a id="idm139898549641552" class="indexterm"></a><div class="sect1 " id="sec.security.vpn.overview"><div class="titlepage"><div><div><h2 class="title" id="sec.security.vpn.overview"><span class="number">16.1 </span><span class="name">Conceptual Overview</span> <a title="Permalink" class="permalink" href="cha.security.vpnserver.html#sec.security.vpn.overview">#</a></h2></div></div></div><p>
   This section defines some terms regarding VPN and gives a brief overview
   of some scenarios.
  </p><div class="sect2 " id="sec.security.vpn.terminology"><div class="titlepage"><div><div><h3 class="title" id="sec.security.vpn.terminology"><span class="number">16.1.1 </span><span class="name">Terminology</span> <a title="Permalink" class="permalink" href="cha.security.vpnserver.html#sec.security.vpn.terminology">#</a></h3></div></div></div><div class="variablelist "><dl class="variablelist"><dt id="idm139898549637616"><span class="term ">Endpoint</span></dt><dd><p>
       The two <span class="quote">“<span class="quote">ends</span>”</span> of a tunnel, the source or destination
       client.
      </p></dd><dt id="idm139898549635328"><span class="term ">Tap Device</span></dt><dd><p>
       A tap device simulates an Ethernet device (layer 2 packets in the OSI
       model such as IP packets). A tap device is used for creating a
       network bridge. It works with Ethernet frames.
      </p></dd><dt id="idm139898549633344"><span class="term ">Tun Device</span></dt><dd><p>
       A tun device simulates a point-to-point network (layer 3 packets in
       the OSI model such as Ethernet frames). A tun device is used with
       routing and works with IP frames.
      </p></dd><dt id="idm139898549631376"><span class="term ">Tunnel</span></dt><dd><p>
       Linking two locations through a primarily public network. From a more
       technical viewpoint, it is a connection between the client's device
       and the server's device. Usually a tunnel is encrypted, but it does
       need to be by definition.
      </p></dd></dl></div></div><div class="sect2 " id="sec.security.vpn.scenarios"><div class="titlepage"><div><div><h3 class="title" id="sec.security.vpn.scenarios"><span class="number">16.1.2 </span><span class="name">VPN Scenarios</span> <a title="Permalink" class="permalink" href="cha.security.vpnserver.html#sec.security.vpn.scenarios">#</a></h3></div></div></div><p>
    Whenever you set up a VPN connection, your IP packets are transferred
    over a secured <span class="emphasis"><em>tunnel</em></span>. A tunnel can use a so-called
    <span class="emphasis"><em>tun</em></span> or <span class="emphasis"><em>tap</em></span> device. They are
    virtual network kernel drivers which implement the transmission of
    Ethernet frames or IP frames/packets.
   </p><p>
    Any userspace program OpenVPN can attach itself to a tun or tap device
    to receive packets sent by your operating system. The program is also
    able to write packets to the device.
   </p><p>
    There are many solutions to set up and build a VPN connection. This
    section focuses on the OpenVPN package. Compared to other VPN software,
    OpenVPN can be operated in two modes:
   </p><div class="variablelist "><dl class="variablelist"><dt id="idm139898549624320"><span class="term ">Routed VPN</span></dt><dd><p>
       Routing is an easy solution to set up. It is more efficient and
       scales better than bridged VPN. Furthermore, it allows the user to
       tune MTU (Maximum Transfer Unit) to raise efficiency. However, in a
       heterogeneous environment NetBIOS broadcasts do not work if you do
       not have a Samba server on the gateway. If you need IPv6, each tun
       drivers on both ends must support this protocol explicitly. This
       scenario is depicted in <a class="xref" href="cha.security.vpnserver.html#fig.vpn.scenario-routed-1" title="Routed VPN">Figure 16.1, “Routed VPN”</a>.
      </p><div class="figure" id="fig.vpn.scenario-routed-1"><div class="figure-contents"><div class="mediaobject"><a xmlns="" href="images/vpn_routed1.png"><img src="images/vpn_routed1.png" width="" alt="Routed VPN" /></a></div></div><div class="figure-title-wrap"><h6 class="figure-title"><span class="number">Figure 16.1: </span><span class="name">Routed VPN </span><a title="Permalink" class="permalink" href="cha.security.vpnserver.html#fig.vpn.scenario-routed-1">#</a></h6></div></div></dd><dt id="idm139898549616528"><span class="term ">Bridged VPN</span></dt><dd><p>
       Bridging is a more complex solution. It is recommended when you need
       to browse Windows file shares across the VPN without setting up a
       Samba or WINS server. Bridged VPN is also needed if you want to use
       non-IP protocols (such as IPX) or applications relying on network
       broadcasts. However, it is less efficient than routed VPN. Another
       disadvantage is that it does not scale well. This scenario is
       depicted in the following figures.
      </p><div class="figure" id="fig.vpn.scenario-briged-1"><div class="figure-contents"><div class="mediaobject"><a xmlns="" href="images/vpn_bridged1.png"><img src="images/vpn_bridged1.png" width="" alt="Bridged VPN - Scenario 1" /></a></div></div><div class="figure-title-wrap"><h6 class="figure-title"><span class="number">Figure 16.2: </span><span class="name">Bridged VPN - Scenario 1 </span><a title="Permalink" class="permalink" href="cha.security.vpnserver.html#fig.vpn.scenario-briged-1">#</a></h6></div></div><div class="figure" id="fig.vpn.scenario-briged-2"><div class="figure-contents"><div class="mediaobject"><a xmlns="" href="images/vpn_bridged2.png"><img src="images/vpn_bridged2.png" width="" alt="Bridged VPN - Scenario 2" /></a></div></div><div class="figure-title-wrap"><h6 class="figure-title"><span class="number">Figure 16.3: </span><span class="name">Bridged VPN - Scenario 2 </span><a title="Permalink" class="permalink" href="cha.security.vpnserver.html#fig.vpn.scenario-briged-2">#</a></h6></div></div><div class="figure" id="fig.vpn.scenario-briged-3"><div class="figure-contents"><div class="mediaobject"><a xmlns="" href="images/vpn_bridged3.png"><img src="images/vpn_bridged3.png" width="" alt="Bridged VPN - Scenario 3" /></a></div></div><div class="figure-title-wrap"><h6 class="figure-title"><span class="number">Figure 16.4: </span><span class="name">Bridged VPN - Scenario 3 </span><a title="Permalink" class="permalink" href="cha.security.vpnserver.html#fig.vpn.scenario-briged-3">#</a></h6></div></div></dd></dl></div><p>
    The major difference between bridging and routing is that a routed VPN
    cannot IP-broadcast while a bridged VPN can.
   </p></div></div><div class="sect1 " id="sec.security.vpn.simplest"><div class="titlepage"><div><div><h2 class="title" id="sec.security.vpn.simplest"><span class="number">16.2 </span><span class="name">Setting Up a Simple Test Scenario</span> <a title="Permalink" class="permalink" href="cha.security.vpnserver.html#sec.security.vpn.simplest">#</a></h2></div></div></div><p>
   In the following example we will create a point-to-point VPN tunnel. The
   example demonstrates how to create a VPN tunnel between one client and a
   server. It is assumed that your VPN server will use private IP addresses
   like <code class="systemitem"><em class="replaceable ">IP_OF_SERVER</em></code> and your
   client the IP address
   <code class="systemitem"><em class="replaceable ">IP_OF_CLIENT</em></code>. You can
   modify these private IP addresses to your needs but make sure you select
   addresses which do not conflict with other IP addresses.
  </p><div id="idm139898549594944" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.png" /><h6>Warning: Use Only For Testing</h6><p>
    This scenario is only useful for testing and is considered as an example
    to get familiar with VPN. <span class="emphasis"><em>Do not use</em></span> this as a real
    world scenario as it can compromise security and safety of your IT
    infrastructure!
   </p></div><p> It is recommended to use configuration file names structured as
          <code class="filename">/etc/openvpn/<em class="replaceable ">XXX</em>.conf</code>.
      If you need to store more files, create a configuration directory
          <code class="filename">/etc/openvpn/<em class="replaceable ">XXX</em>/</code>.
      This makes life a bit easier as you know exactly which file
      belongs to which configuration file. </p><div class="sect2 " id="sec.security.vpn.simplest.vpnserv"><div class="titlepage"><div><div><h3 class="title" id="sec.security.vpn.simplest.vpnserv"><span class="number">16.2.1 </span><span class="name">Configuring the VPN Server</span> <a title="Permalink" class="permalink" href="cha.security.vpnserver.html#sec.security.vpn.simplest.vpnserv">#</a></h3></div></div></div><p>
    To configure a VPN server, proceed as follows:
   </p><div class="procedure " id="pro.security.vpn.simplest.vpnserv"><div class="procedure-title-wrap"><h6 class="procedure-title"><span class="number">Procedure 16.1: </span><span class="name">VPN Server Configuration </span><a title="Permalink" class="permalink" href="cha.security.vpnserver.html#pro.security.vpn.simplest.vpnserv">#</a></h6></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
      Install the package <code class="systemitem">openvpn</code>
      on the machine that will later become your VPN server.
     </p></li><li class="step "><p>
      Open a shell, become <code class="systemitem">root</code> and create the VPN secret key:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">root # </code>openvpn --genkey --secret /etc/openvpn/secret.key</pre></div></li><li class="step "><p>
      Copy the secret key to your client:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">root # </code>scp /etc/openvpn/secret.key root@<em class="replaceable ">IP_OF_CLIENT</em>:/etc/openvpn/</pre></div></li><li class="step "><p>
      Create the file <code class="filename">/etc/openvpn/server.conf</code> with the
      following content:
     </p><div class="verbatim-wrap"><pre class="screen">dev tun
ifconfig <em class="replaceable ">IP_OF_SERVER</em> <em class="replaceable ">IP_OF_CLIENT</em>
secret secret.key</pre></div></li><li class="step " id="st.security.vpn.simplest.vpnserv.yast"><p>
      If you use a firewall, start YaST and open UDP port 1194
      (<span class="guimenu">Security and
      Users</span> › <span class="guimenu">Firewall</span> › <span class="guimenu">Allowed
      Services</span>).
     </p></li><li class="step "><p>
      Start the OpenVPN server service:
     </p><div class="verbatim-wrap"><pre class="screen">sudo systemctl start openvpn@server</pre></div><p> This notation points to the OpenVPN server configuration
            file located at <code class="filename">/etc/openvpn/server.conf
            </code>. See
              <code class="filename">/usr/share/doc/packages/openvpn/README.SUSE</code>
            for details. </p></li></ol></div></div></div><div class="sect2 " id="sec.security.vpn.simplest.vpnclient"><div class="titlepage"><div><div><h3 class="title" id="sec.security.vpn.simplest.vpnclient"><span class="number">16.2.2 </span><span class="name">Configuring the VPN Client</span> <a title="Permalink" class="permalink" href="cha.security.vpnserver.html#sec.security.vpn.simplest.vpnclient">#</a></h3></div></div></div><p>
    To configure the VPN client, do the following:
   </p><div class="procedure " id="idm139898549571168"><div class="procedure-title-wrap"><h6 class="procedure-title"><span class="number">Procedure 16.2: </span><span class="name">VPN Client Configuration </span><a title="Permalink" class="permalink" href="cha.security.vpnserver.html#idm139898549571168">#</a></h6></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
      Install the package <code class="systemitem">openvpn</code>
      on your client VPN machine.
     </p></li><li class="step "><p>
      Create <code class="filename">/etc/openvpn/client.conf</code> with the
      following content:
     </p><div class="verbatim-wrap"><pre class="screen">remote <em class="replaceable ">DOMAIN_OR_PUBLIC_IP_OF_SERVER</em>
dev tun
ifconfig <em class="replaceable ">IP_OF_CLIENT</em> <em class="replaceable ">IP_OF_SERVER</em>
secret secret.key</pre></div><p>
      Replace the placeholder <em class="replaceable ">IP_OF_CLIENT</em> in the
      first line with either the domain name, or the public IP address of
      your server.
     </p></li><li class="step "><p>
      If you use a firewall, start YaST and open UDP port 1194 as
      described in <a class="xref" href="cha.security.vpnserver.html#st.security.vpn.simplest.vpnserv.yast" title="Step 5">Step 5</a>
      of <a class="xref" href="cha.security.vpnserver.html#pro.security.vpn.simplest.vpnserv" title="VPN Server Configuration">Procedure 16.1, “VPN Server Configuration”</a>.
     </p></li><li class="step "><p>
      Start the OpenVPN service:
     </p><div class="verbatim-wrap"><pre class="screen">sudo systemctl start openvpn@client</pre></div></li></ol></div></div></div><div class="sect2 " id="sec.security.vpn.simplest.use"><div class="titlepage"><div><div><h3 class="title" id="sec.security.vpn.simplest.use"><span class="number">16.2.3 </span><span class="name">Testing the VPN Example Scenario</span> <a title="Permalink" class="permalink" href="cha.security.vpnserver.html#sec.security.vpn.simplest.use">#</a></h3></div></div></div><p>
    After OpenVPN has successfully started, test the availability of the tun
    device with the following command:
   </p><div class="verbatim-wrap"><pre class="screen">ip addr show tun0</pre></div><p>
    To verify the VPN connection, use <code class="command">ping</code> on both client
    and server side to see if they can reach each other. Ping the server
    from the client:
   </p><div class="verbatim-wrap"><pre class="screen">ping -I tun0 <em class="replaceable ">IP_OF_SERVER</em></pre></div><p>
    Ping the client from the server:
   </p><div class="verbatim-wrap"><pre class="screen">ping -I tun0 <em class="replaceable ">IP_OF_CLIENT</em></pre></div></div></div><div class="sect1 " id="sec.security.vpn.ca"><div class="titlepage"><div><div><h2 class="title" id="sec.security.vpn.ca"><span class="number">16.3 </span><span class="name">Setting Up Your VPN Server Using Certificate Authority</span> <a title="Permalink" class="permalink" href="cha.security.vpnserver.html#sec.security.vpn.ca">#</a></h2></div></div></div><p>
   The example in
   <a class="xref" href="cha.security.vpnserver.html#sec.security.vpn.simplest" title="16.2. Setting Up a Simple Test Scenario">Section 16.2</a>
   is useful for testing, but not for daily work. This section explains how
   to build a VPN server that allows more than one connection at the same
   time. This is done with a public key infrastructure (PKI). A PKI consists
   of a pair of public and private keys for the server and each client, and
   a master certificate authority (CA), which is used to sign every server
   and client certificate.
  </p><p>
   This setup involves the following basic steps:
  </p><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
     <a class="xref" href="cha.security.vpnserver.html#sec.security.vpn.certs" title="16.3.1. Creating Certificates">Section 16.3.1, “Creating Certificates”</a>
    </p></li><li class="step "><p>
     <a class="xref" href="cha.security.vpnserver.html#sec.security.vpn.config-server" title="16.3.2. Configuring the Server">Section 16.3.2, “Configuring the Server”</a>
    </p></li><li class="step "><p>
     <a class="xref" href="cha.security.vpnserver.html#sec.security.vpn.config-clients" title="16.3.3. Configuring the Clients">Section 16.3.3, “Configuring the Clients”</a>
    </p></li></ol></div></div><div class="sect2 " id="sec.security.vpn.certs"><div class="titlepage"><div><div><h3 class="title" id="sec.security.vpn.certs"><span class="number">16.3.1 </span><span class="name">Creating Certificates</span> <a title="Permalink" class="permalink" href="cha.security.vpnserver.html#sec.security.vpn.certs">#</a></h3></div></div></div><p>
    Before a VPN connection gets established, the client must authenticate
    the server certificate. Conversely, the server must also authenticate
    the client certificate. This is called <span class="emphasis"><em>mutual
    authentication</em></span>. To create such certificates, use the
    YaST CA module. See <a class="xref" href="cha.security.yast_ca.html" title="Chapter 17. Managing X.509 Certification">Chapter 17, <em>Managing X.509 Certification</em></a> for more
    details.
   </p><p>
    To create a VPN root, server, and client CA, proceed as follows:
   </p><div class="procedure " id="pro.security.vpn.serverca"><div class="procedure-title-wrap"><h6 class="procedure-title"><span class="number">Procedure 16.3: </span><span class="name">Creating a VPN Server Certificate </span><a title="Permalink" class="permalink" href="cha.security.vpnserver.html#pro.security.vpn.serverca">#</a></h6></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step " id="st.security.vpn.serverca.vpnrootca"><p>
      Prepare a common VPN Certificate Authority (CA):
     </p><ol type="a" class="substeps "><li class="step "><p>
        Start the YaST CA module.
       </p></li><li class="step "><p>
        Click <span class="guimenu">Create Root CA</span>.
       </p></li><li class="step "><p>
        Enter a <span class="guimenu">CA Name</span> and a <span class="guimenu">Common
        Name</span>, for example <code class="literal">VPN-Server-CA</code>.
       </p></li><li class="step "><p>
        Fill out the other boxes like e-mail addresses, organization, etc.
        and proceed with <span class="guimenu">Next</span>.
       </p></li><li class="step "><p>
        Enter your password twice and proceed with <span class="guimenu">Next</span>.
       </p></li><li class="step "><p>
        Review the summary. YaST displays the current settings for
        confirmation. Click <span class="guimenu">Create</span>. The root CA is
        created and displayed in the overview.
       </p></li></ol></li><li class="step " id="st.security.vpn.serverca.vpnserverca"><p>
      Create a VPN server certificate:
     </p><ol type="a" class="substeps "><li class="step "><p>
        Select the root CA you created in
        <a class="xref" href="cha.security.vpnserver.html#st.security.vpn.serverca.vpnrootca" title="Step 1">Step 1</a> and click
        <span class="guimenu">Enter CA</span>.
       </p></li><li class="step "><p>
        When prompted, enter the <span class="guimenu">CA Password</span>.
       </p></li><li class="step "><p>
        Click the <span class="guimenu">Certificate</span> tab and click <span class="guimenu">Add</span> › <span class="guimenu">Add Server Certificate</span>.
       </p></li><li class="step "><p>
        Enter a <span class="guimenu">Common Name</span>, for example,
        <code class="systemitem">openvpn.example.com</code>
        and proceed with <span class="guimenu">Next</span>.
       </p></li><li class="step "><p>
        Enter your password twice and click <span class="guimenu">Advanced
        options</span>.
       </p><p>
        Switch to the <span class="guimenu">Advanced Settings</span> › <span class="guimenu">Key Usage</span> list and check one of the
        following sets:
       </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
          <code class="option">digitalSignature</code> and
          <code class="option">keyEncipherment</code>, or,
         </p></li><li class="listitem "><p>
          <code class="option">digitalSignature</code> and
          <code class="option">keyAgreement</code>
         </p></li></ul></div><p>
        Switch to the <span class="guimenu">Advanced Settings</span> › <span class="guimenu">extendedKeyUsage</span> and type
        <code class="option">serverAuth</code> for a server certificate.
       </p><p> When using the method <code class="option">remote-cert-tls
                  server</code> or <code class="option">remote-cert-tls
                  client</code> to verify the certificates, then the
                certificates can only have a certain number of key
                usages set. The reason for this is to prevent or at
                least mitigate the possibility of a man-in-the-middle
                attack. For further background information, see <a class="link" href="http://openvpn.net/index.php/open-source/documentation/howto.html#mitm" target="_blank">http://openvpn.net/index.php/open-source/documentation/howto.html#mitm</a>. Finish with <span class="guimenu">Ok</span> and then proceed
                with <span class="guimenu">Next</span>. </p></li><li class="step "><p>
        Review the summary. YaST displays the current settings for
        confirmation. Click <span class="guimenu">Create</span>. The VPN server
        certificate is created and displayed in the
        <span class="guimenu">Certificates</span> tab.
       </p></li></ol></li><li class="step " id="st.security.vpn.serverca.vpnclientca"><p>
      Create VPN client certificates:
     </p><ol type="a" class="substeps "><li class="step "><p>
        Make sure you are on the <span class="guimenu">Certificates</span> tab.
       </p></li><li class="step "><p>
        Click <span class="guimenu">Add</span> › <span class="guimenu">Add Client
        Certificate</span>.
       </p></li><li class="step "><p>
        Enter a <span class="guimenu">Common Name</span>, for example,
        <code class="systemitem">client1.example.com</code>.
       </p></li><li class="step "><p>
        Enter the e-mail addresses for your client, for example,
        <code class="systemitem">user1@client1.example.com</code>,
        and click <span class="guimenu">Add</span>. Proceed with
        <span class="guimenu">Next</span>.
       </p></li><li class="step "><p>
        Enter your password twice and click <span class="guimenu">Advanced
        options</span>.
       </p><p> Switch to <span class="guimenu">Advanced Settings</span> › <span class="guimenu">Key Usage</span> list and check one of the following flags: </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
          <code class="option">digitalSignature</code> or,
         </p></li><li class="listitem "><p>
          <code class="option">keyAgreement</code> or,
         </p></li><li class="listitem "><p>
          <code class="option">digitalSignature</code> and
          <code class="option">keyAgreement</code>.
         </p></li></ul></div><p>
        Switch to the <span class="guimenu">Advanced Settings</span> › <span class="guimenu">extendedKeyUsage</span> and type
        <code class="option">clientAuth</code> for a server certificate.
       </p></li><li class="step "><p>
        Review the summary. YaST displays the current settings for
        confirmation. Click <span class="guimenu">Create</span>. The VPN client
        certificate is created and is displayed in the
        <span class="guimenu">Certificates</span> tab.
       </p></li><li class="step "><p>
        Repeat <a class="xref" href="cha.security.vpnserver.html#st.security.vpn.serverca.vpnclientca" title="Step 3">Step 3</a> if you
        need certificates for more clients.
       </p></li></ol></li></ol></div></div><p>
    After you have successfully finished
    <a class="xref" href="cha.security.vpnserver.html#pro.security.vpn.serverca" title="Creating a VPN Server Certificate">Procedure 16.3, “Creating a VPN Server Certificate”</a> you have a VPN root CA, a
    VPN server CA, and one or more VPN client CAs. To finish the task,
    proceed with the following procedure:
   </p><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
      Choose the <span class="guimenu">Certificates</span> tab.
     </p></li><li class="step "><p>
      Export the VPN server certificate in two formats: PEM and unencrypted
      key in PEM.
     </p><ol type="a" class="substeps "><li class="step " id="st.security.vpn.selectserverca"><p>
        Select your VPN server CA
        (<code class="systemitem">openvpn.example.com</code>
        in our example) and choose <span class="guimenu">Export</span> › <span class="guimenu">Export to File</span>.
       </p></li><li class="step " id="st.security.vpn.selectsaveca"><p>
        Select <span class="guimenu">Only the Certificate in PEM Format</span>, enter
        your VPN server certificate password and save the file to
        <code class="filename">/etc/openvpn/server_crt.pem</code>.
       </p></li><li class="step "><p>
        Repeat <a class="xref" href="cha.security.vpnserver.html#st.security.vpn.selectserverca" title="Step 2.a">Step 2.a</a> and
        <a class="xref" href="cha.security.vpnserver.html#st.security.vpn.selectsaveca" title="Step 2.b">Step 2.b</a>, but choose the
        format <span class="guimenu">Only the Key Unencrypted in PEM Format</span>.

        Save the file to <code class="filename">/etc/openvpn/server_key.pem</code>.
       </p></li></ol></li><li class="step "><p>
      Export the VPN client certificates and choose an export format, PEM or
      PKCS12 (preferred). For each client:
     </p><ol type="a" class="substeps "><li class="step " id="st.security.vpn.selectclient.ca"><p>
        Select your VPN client certificate
        (<code class="systemitem">client1.example.com</code>
        in our example) and choose <span class="guimenu">Export</span> › <span class="guimenu">Export to File</span>.
       </p></li><li class="step "><p> Select <span class="guimenu">Like PKCS12 and Include the CA
                  Chain</span>, enter your VPN client certificate key
                password and provide a PKCS12 password. Enter a
                  <span class="guimenu">File Name</span>, click
                  <span class="guimenu">Browse</span> and save the file to
                  <code class="filename">/etc/openvpn/client1.p12</code>. </p></li></ol></li><li class="step "><p>
      Copy the files to your client (in our example,
      <code class="systemitem">client1.example.com</code>).
     </p></li><li class="step "><p>
      Export the VPN CA (in our example
      <code class="systemitem">VPN-Server-CA</code>):
     </p><ol type="a" class="substeps "><li class="step "><p>
        Switch to the <span class="guimenu">Description</span> tab and select
        <span class="guimenu">Export to File</span>.
       </p></li><li class="step "><p>
        Select <span class="guimenu">Advanced</span> › <span class="guimenu">Export to
        File</span>.
       </p></li><li class="step "><p>
        Mark <span class="guimenu">Only the Certificate in PEM Format</span> and save
        the file to <code class="filename">/etc/openvpn/vpn_ca.pem</code>.
       </p></li></ol></li></ol></div></div><p>
    If desired, the client PKCS12 file can be converted into the PEM format
    using this command:
   </p><div class="verbatim-wrap"><pre class="screen">openssl pkcs12 -in client1.p12 -out client1.pem</pre></div><p>
    Enter your client password to create the
    <code class="filename">client1.pem</code> file. The PEM file contains the client
    certificate, client key, and the CA certificate. You can split this
    combined file using a text editor and create three separate files. The
    file names can be used for the <code class="option">ca</code>,
    <code class="option">cert</code>, and <code class="option">key</code> options in the OpenVPN
    configuration file (see <a class="xref" href="cha.security.vpnserver.html#ex.vpn.serv-config" title="VPN Server Configuration File">Example 16.1, “VPN Server Configuration File”</a>).
   </p></div><div class="sect2 " id="sec.security.vpn.config-server"><div class="titlepage"><div><div><h3 class="title" id="sec.security.vpn.config-server"><span class="number">16.3.2 </span><span class="name">Configuring the Server</span> <a title="Permalink" class="permalink" href="cha.security.vpnserver.html#sec.security.vpn.config-server">#</a></h3></div></div></div><p>
    For your configuration, copy to <code class="filename">/etc/openvpn/</code> and
    modify the example configuration file that is provided with
    <code class="filename">/usr/share/doc/packages/openvpn/sample-config-files/server.conf</code>.
    You need to adjust some paths.
   </p><div class="example" id="ex.vpn.serv-config"><div class="example-title-wrap"><h6 class="example-title"><span class="number">Example 16.1: </span><span class="name">VPN Server Configuration File </span><a title="Permalink" class="permalink" href="cha.security.vpnserver.html#ex.vpn.serv-config">#</a></h6></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen"># /etc/openvpn/server.conf
port 1194 <span id="co.vpn.servconfig.port"></span><span class="callout">1</span>
proto udp <span id="co.vpn.servconfig.proto"></span><span class="callout">2</span>
dev tun0 <span id="co.vpn.servconfig.dev"></span><span class="callout">3</span>

# Security <span id="co.vpn.servconfig.security"></span><span class="callout">4</span>

ca    vpn_ca.pem
cert  server_crt.pem
key   server_key.pem

# ns-cert-type server 
remote-cert-tls client <span id="co.vpn.servconfig.remote-cert-tls"></span><span class="callout">5</span>
dh   server/dh2048.pem <span id="co.vpn.servconfig.dh"></span><span class="callout">6</span>

server 192.168.1.0 255.255.255.0 <span id="co.vpn.servconfig.server"></span><span class="callout">7</span>
ifconfig-pool-persist /var/run/openvpn/ipp.txt <span id="co.vpn.servconfig.pool"></span><span class="callout">8</span>

# Privileges <span id="co.vpn.serverconf.privilege"></span><span class="callout">9</span>
user nobody
group nobody

# Other configuration <span id="co.vpn.servconfig.misc"></span><span class="callout">10</span>
keepalive 10 120
comp-lzo
persist-key
persist-tun
# status      /var/log/openvpn-status.tun0.log <span id="co.vpn.serverconfig.status"></span><span class="callout">11</span>
# log-append  /var/log/openvpn-server.log <span id="co.vpn.serverconfig.log-append"></span><span class="callout">12</span>
verb 4</pre></div></div></div><div class="calloutlist "><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#co.vpn.servconfig.port"><span class="callout">1</span></a> </p></td><td valign="top" align="left"><p>
      The TCP/UDP port which OpenVPN listens to. You need to open the port
      in the Firewall, see <a class="xref" href="cha.security.firewall.html" title="Chapter 15. Masquerading and Firewalls">Chapter 15, <em>Masquerading and Firewalls</em></a>. The
      standard port for VPN is 1194, so you can usually leave that as
      it is.
     </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co.vpn.servconfig.proto"><span class="callout">2</span></a> </p></td><td valign="top" align="left"><p>
      The protocol, either UDP or TCP.
     </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co.vpn.servconfig.dev"><span class="callout">3</span></a> </p></td><td valign="top" align="left"><p>
      The tun or tap device, see
      <a class="xref" href="cha.security.vpnserver.html#sec.security.vpn.terminology" title="16.1.1. Terminology">Section 16.1.1, “Terminology”</a> for the differences.
     </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co.vpn.servconfig.security"><span class="callout">4</span></a> </p></td><td valign="top" align="left"><p>
      The following lines contain the relative or absolute path to the root
      server CA certificate (<code class="literal">ca</code>), the root CA key
      (<code class="literal">cert</code>), and the private server key
      (<code class="literal">key</code>). These were generated in
      <a class="xref" href="cha.security.vpnserver.html#sec.security.vpn.certs" title="16.3.1. Creating Certificates">Section 16.3.1, “Creating Certificates”</a>.
     </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co.vpn.servconfig.remote-cert-tls"><span class="callout">5</span></a> </p></td><td valign="top" align="left"><p> Require that peer certificate to have been signed with an
            explicit key usage and extended key usage based on RFC3280
            TLS rules. There is a description of how to make a server
            use this explicit key in <a class="xref" href="cha.security.vpnserver.html#pro.security.vpn.serverca" title="Creating a VPN Server Certificate">Procedure 16.3, “Creating a VPN Server Certificate”</a>. </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co.vpn.servconfig.dh"><span class="callout">6</span></a> </p></td><td valign="top" align="left"><p> The Diffie-Hellman parameters. Create the required file with
            the following command: </p><div class="verbatim-wrap"><pre class="screen">openssl dhparam -out /etc/openvpn/dh2048.pem 2048</pre></div></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co.vpn.servconfig.server"><span class="callout">7</span></a> </p></td><td valign="top" align="left"><p>
      Supplies a VPN subnet. The server can be reached by
      <code class="systemitem">192.168.1.1</code>.
     </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co.vpn.servconfig.pool"><span class="callout">8</span></a> </p></td><td valign="top" align="left"><p>
      Records a mapping of clients and its virtual IP address in the given
      file. Useful when the server goes down and (after the restart) the
      clients get their previously assigned IP address.
     </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co.vpn.serverconf.privilege"><span class="callout">9</span></a> </p></td><td valign="top" align="left"><p>
      For security reasons it is a good idea to run the OpenVPN daemon with
      reduced privileges. For this reason the group and user
      <code class="systemitem">nobody</code> is used.
     </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co.vpn.servconfig.misc"><span class="callout">10</span></a> </p></td><td valign="top" align="left"><p> Several other configuration options—see the comment in the
            example configuration file:
              <code class="filename">/usr/share/doc/packages/openvpn/sample-config-files</code>. </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co.vpn.serverconfig.status"><span class="callout">11</span></a> </p></td><td valign="top" align="left"><p>
      Enable this option, if you prefer a short status with statistical data
      (<span class="quote">“<span class="quote">operational status dump</span>”</span>). By default, it is not set;
      all output is written to syslog. If you have more than one
      configuration file (for example, one for home and another for work), it
      is recommended to include the device name into the file name. This
      avoids overwriting each other's output files accidentally. In this case
      it is <code class="systemitem">tun0</code>, taken from the
      <code class="option">dev</code> directive—see
      <a class="xref" href="cha.security.vpnserver.html#co.vpn.servconfig.dev"><span class="callout">3</span></a>.
     </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co.vpn.serverconfig.log-append"><span class="callout">12</span></a> </p></td><td valign="top" align="left"><p>
      By default, log messages go to syslog. Overwrite this behavior by
      removing the hash character. In that case, all messages go to
      <code class="filename">/var/log/openvpn-server.log</code>. Do not forget to
      configure a logrotate service. See <code class="command">man 8 logrotate</code>
      for further details.
     </p></td></tr></table></div><p>
    After having completed this configuration, you can see log messages of
    your OpenVPN server under <code class="filename">/var/log/openvpn.log</code>.
    After having started it for the first time, it should finish with:
   </p><div class="verbatim-wrap"><pre class="screen">... Initialization Sequence Completed</pre></div><p>
    If you do not see this message, check the log carefully for any hints of
    what is wrong in your configuration file.
   </p></div><div class="sect2 " id="sec.security.vpn.config-clients"><div class="titlepage"><div><div><h3 class="title" id="sec.security.vpn.config-clients"><span class="number">16.3.3 </span><span class="name">Configuring the Clients</span> <a title="Permalink" class="permalink" href="cha.security.vpnserver.html#sec.security.vpn.config-clients">#</a></h3></div></div></div><p>
    For your configuration, copy and modify the example configuration file
    that is provided with
    <code class="filename">/usr/share/doc/packages/openvpn/sample-config-files/client.conf</code>.
    You need to adjust some paths.
   </p><div class="example" id="idm139898549402896"><div class="example-title-wrap"><h6 class="example-title"><span class="number">Example 16.2: </span><span class="name">VPN Client Configuration File </span><a title="Permalink" class="permalink" href="cha.security.vpnserver.html#idm139898549402896">#</a></h6></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen"># /etc/openvpn/client.conf
client <span id="co.vpn.clientconf.client"></span><span class="callout">1</span>
dev tun <span id="co.vpn.clientconf.dev"></span><span class="callout">2</span>
proto udp <span id="co.vpn.clientconf.proto"></span><span class="callout">3</span>
remote <em class="replaceable ">IP_OR_HOST_NAME</em> 1194 <span id="co.vpn.clientconf.remote"></span><span class="callout">4</span>
resolv-retry infinite
nobind

remote-cert-tls server <span id="co.vpn.clientconf.remote-cert-tls"></span><span class="callout">5</span>

# Privileges <span id="co.vpn.clientconf.privileges"></span><span class="callout">6</span>
user nobody
group nobody

# Try to preserve some state across restarts.
persist-key
persist-tun

# Security <span id="co.vpn.clientconf.security"></span><span class="callout">7</span>
pkcs12 client1.p12

comp-lzo <span id="co.vpn.clientconf.compr"></span><span class="callout">8</span></pre></div><div class="calloutlist "><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#co.vpn.clientconf.client"><span class="callout">1</span></a> </p></td><td valign="top" align="left"><p>
       You need to specify that this machine is a client.
      </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co.vpn.clientconf.dev"><span class="callout">2</span></a> </p></td><td valign="top" align="left"><p>
       The network device. Both clients and server must use the same device.
      </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co.vpn.clientconf.proto"><span class="callout">3</span></a> </p></td><td valign="top" align="left"><p>
       The protocol. Use the same settings as on the server.
      </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co.vpn.clientconf.remote-cert-tls"><span class="callout">5</span></a> </p></td><td valign="top" align="left"><p>
       This is a useful security option for clients, to ensure that the host
       they connect to is a designated server.
      </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co.vpn.clientconf.remote"><span class="callout">4</span></a> </p></td><td valign="top" align="left"><p>
       Replace the placeholder <em class="replaceable ">IP_OR_HOST_NAME</em>
       with the respective host name or IP address of your VPN server. After
       the host name, the port of the server is given. You can have multiple
       lines of <code class="literal">remote</code> entries pointing to different VPN
       servers. This is useful for load balancing between different VPN
       servers.
      </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co.vpn.clientconf.privileges"><span class="callout">6</span></a> </p></td><td valign="top" align="left"><p>
       For security reasons it is a good idea to run the OpenVPN daemon with
       reduced privileges. For this reason the group and user
       <code class="systemitem">nobody</code> is used.
      </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co.vpn.clientconf.security"><span class="callout">7</span></a> </p></td><td valign="top" align="left"><p>
       Contains the client files. For security reasons, it is better to have
       a separate file pair for each client.
      </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co.vpn.clientconf.compr"><span class="callout">8</span></a> </p></td><td valign="top" align="left"><p>
       Turns compression on. Use only when the server has this parameter
       switched on as well.
      </p></td></tr></table></div></div></div></div></div><div class="sect1 " id="sec.security.vpn.nameserver"><div class="titlepage"><div><div><h2 class="title" id="sec.security.vpn.nameserver"><span class="number">16.4 </span><span class="name">Changing Name Servers in VPN</span> <a title="Permalink" class="permalink" href="cha.security.vpnserver.html#sec.security.vpn.nameserver">#</a></h2></div></div></div><p>
   If you need to change name servers before or during a VPN session, use
   <code class="command">netconfig</code>.
  </p><div id="idm139898549380736" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.png" /><h6>Important: Differences between SUSE Linux Enterprise Desktop and SUSE Linux Enterprise Server</h6><p>
    The following procedure is for SUSE Linux Enterprise Server only without NetworkManager (with
    <code class="command">ifup</code>). SUSE Linux Enterprise Desktop installations use NetworkManager and must
    install the <code class="systemitem">NetworkManager-openvpn</code> plug-in.
   </p></div><p>
   Use the following procedure to change a name server:
  </p><div class="procedure " id="pro.security.vpn.nameserver"><div class="procedure-title-wrap"><h6 class="procedure-title"><span class="number">Procedure 16.4: </span><span class="name">Changing Name Servers </span><a title="Permalink" class="permalink" href="cha.security.vpnserver.html#pro.security.vpn.nameserver">#</a></h6></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
     Copy the following scripts and make them executable:
    </p><div class="verbatim-wrap"><pre class="screen">cp /usr/share/doc/packages/openvpn/sample-scripts/client-netconfig.* \
  /etc/openvpn/
chmod +x /etc/openvpn/client-netconfig.*</pre></div></li><li class="step "><p>
     Add the following lines to
     <code class="filename">/etc/openvpn/client.conf</code>:
    </p><div class="verbatim-wrap"><pre class="screen">pull dhcp-options
up   /etc/openvpn/client-netconfig.up
down /etc/openvpn/client-netconfig.down</pre></div></li></ol></div></div><p>
   If you need to specify a ranking list of fallback services, use the
   <code class="envar">NETCONFIG_DNS_RANKING</code> variable in
   <code class="filename">/etc/sysconfig/network/config</code>. The default value is
   <code class="literal">auto</code> which resolves to (documented in <code class="command">man 8
   netconfig</code>):
  </p><div class="verbatim-wrap"><pre class="screen">+/vpn/ -/auto/ +strongswan +openswan +racoon -avahi</pre></div><p>
   Preferred service names have the <code class="literal">+</code> prefix, fallback
   services the <code class="literal">-</code> prefix.
  </p></div><div class="sect1 " id="sec.security.vpn.tools-client"><div class="titlepage"><div><div><h2 class="title" id="sec.security.vpn.tools-client"><span class="number">16.5 </span><span class="name">The GNOME Applet</span> <a title="Permalink" class="permalink" href="cha.security.vpnserver.html#sec.security.vpn.tools-client">#</a></h2></div></div></div><p>
   The following sections describe the setup of OpenVPN connections with the
   GNOME tool.
  </p><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
     Make sure the package
     <code class="systemitem">NetworkManager-openvpn-gnome</code>
     is installed and all dependencies have been resolved.
    </p></li><li class="step "><p>
     Press <span class="keycap">Alt</span><span class="key-connector">–</span><span class="keycap">F2</span> and enter <code class="command">nm-connection-editor</code> into the
     text box to start the <span class="guimenu">Network Connection Editor</span>. A
     new window appears.
    </p></li><li class="step "><p>
     Select the <span class="guimenu">VPN</span> tab and click <span class="guimenu">Add</span>.
    </p></li><li class="step "><p>
     Choose the VPN connection type, in this case
     <span class="guimenu">OpenVPN</span>.
    </p></li><li class="step "><p>
     Choose the <span class="guimenu">Authentication</span> type. Depending on the
     setup of your OpenVPN server, choose between <span class="guimenu">Certificates
     (TLS)</span> or <span class="guimenu">Password with Certificates (TLS)</span>.
    </p></li><li class="step "><p>
     Insert the necessary values into the respective text boxes. For our
     example configuration, these are:
    </p><div class="informaltable"><table border="1"><colgroup><col /><col /></colgroup><tbody><tr><td>
         <p>
          <span class="guimenu">Username</span>
         </p>
        </td><td>
         <p>
          The user (only available when you have selected <span class="guimenu">Password
          with Certificates (TLS)</span>)
         </p>
        </td></tr><tr><td>
         <p>
          <span class="guimenu">Password</span>
         </p>
        </td><td>
         <p>
          The password for the user (only available when you have selected
          <span class="guimenu">Password with Certificates (TLS)</span>)
         </p>
        </td></tr><tr><td>
         <p>
          <span class="guimenu">User Certificate</span>
         </p>
        </td><td>
         <p>
          <code class="filename">/etc/openvpn/client1.crt</code>
         </p>
        </td></tr><tr><td>
         <p>
          <span class="guimenu">CA Certificate</span>
         </p>
        </td><td>
         <p>
          <code class="filename">/etc/openvpn/ca.crt</code>
         </p>
        </td></tr><tr><td>
         <p>
          <span class="guimenu">Private Key</span>
         </p>
        </td><td>
         <p>
          <code class="filename">/etc/openvpn/client1.key</code>
         </p>
        </td></tr></tbody></table></div></li><li class="step "><p>
     Finish with <span class="guimenu">Apply</span> and <span class="guimenu">Close</span>.
    </p></li><li class="step "><p>
     Enable the connection with your Network Manager applet.
    </p></li></ol></div></div></div><div class="sect1 " id="sec.security.vpn.moreinfo"><div class="titlepage"><div><div><h2 class="title" id="sec.security.vpn.moreinfo"><span class="number">16.6 </span><span class="name">For More Information</span> <a title="Permalink" class="permalink" href="cha.security.vpnserver.html#sec.security.vpn.moreinfo">#</a></h2></div></div></div><p>
   For more information about VPN, see:
  </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
     <a class="link" href="http://www.openvpn.net" target="_blank">http://www.openvpn.net</a>: the OpenVPN home page
    </p></li><li class="listitem "><p>
     <code class="command">man</code> <code class="option">openvpn</code>
    </p></li><li class="listitem "><p>
     <code class="filename">/usr/share/doc/packages/openvpn/sample-config-files/</code>:
     example configuration files for different scenarios.
    </p></li><li class="listitem "><p>
     <code class="filename">/usr/src/linux/Documentation/networking/tuntap.txt</code>,
     to install the <code class="systemitem">kernel-source</code>
     package.
    </p></li></ul></div></div></div></div><div class="page-bottom"><div id="_bottom-navigation"><a class="nav-link" href="cha.security.yast_ca.html"><span class="next-icon">→</span><span class="nav-label"><span class="number">Chapter 17 </span>Managing X.509 Certification</span></a><a class="nav-link" href="cha.security.firewall.html"><span class="prev-icon">←</span><span class="nav-label"><span class="number">Chapter 15 </span>Masquerading and Firewalls</span></a></div><div id="_share-print"><div class="online-contents share"><strong>Share this page: </strong><span class="share-buttons"><span id="_share-fb" class="bottom-button">Facebook</span><span class="spacer"> • </span><span id="_share-gp" class="bottom-button">Google+</span><span class="spacer"> • </span><span id="_share-tw" class="bottom-button">Twitter</span><span class="spacer"> • </span><span id="_share-mail" class="bottom-button">E-Mail</span></span></div><div class="print"><span id="_print-button" class="bottom-button">Print this page</span></div><div class="clearme"></div></div></div></div><div id="_inward"></div></div><div id="_footer-wrap"><div id="_footer"><p>©
        2018 
        SUSE</p><ul><li><a href="http://www.suse.com/company/careers/" target="_top">Careers</a></li><li><a href="http://www.suse.com/company/legal/" target="_top">Legal</a></li><li><a href="http://www.suse.com/company/" target="_top">About</a></li><li><a href="http://www.suse.com/ContactsOffices/contacts_offices.jsp" target="_top">Contact Us</a></li></ul></div></div></body></html>