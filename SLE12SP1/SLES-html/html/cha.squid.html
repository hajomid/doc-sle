<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang=""><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>The Proxy Server Squid | Administration Guide | SUSE Linux Enterprise Server 12 SP1</title><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" /><link rel="stylesheet" type="text/css" href="static/css/style.css" /><link rel="stylesheet" type="text/css" href="static/css/highlight.css" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><meta name="product-name" content="SUSE Linux Enterprise Server" /><meta name="product-number" content="12 SP1" /><meta name="book-title" content="Administration Guide" /><meta name="chapter-title" content="Chapter 31. The Proxy Server Squid" /><meta name="description" content="Squid is a widely-used proxy cache for Linux and Unix platforms. This means that it stores requested Internet objects, such as data on a Web or FTP server, on a machine that is closer to the requesting workstation than the server. It may be set up in multiple hierarchies to assure optimal response times and low bandwidth usage, even in modes that are transparent for the end user. Additional software like squidGuard may be used to filter Web contents." /><meta name="tracker-url" content="https://bugzilla.suse.com/enter_bug.cgi" /><meta name="tracker-type" content="bsc" /><meta name="tracker-bsc-assignee" content="fs@suse.com" /><meta name="tracker-bsc-component" content="Documentation" /><meta name="tracker-bsc-product" content="SUSE Linux Enterprise Server 12 SP1" /><link rel="home" href="index.html" title="SUSE Linux Enterprise Server Documentation" /><link rel="up" href="part.services.html" title="Part III. Services" /><link rel="prev" href="cha.ftp.html" title="Chapter 30. Setting up an FTP Server with YaST" /><link rel="next" href="cha.wbem.html" title="Chapter 32. Web Based Enterprise Management Using SFCB" /><script type="text/javascript">

var protocol = window.location.protocol.toLowerCase();
if ( protocol != 'file:' ) {
  var agent = navigator.userAgent.toLowerCase();
  var wanted = ( protocol == 'https:') ? 'https' : 'http';
  var file = 'fonts.css';
  document.write('<link rel="stylesheet" type="text/css" href="' + wanted + '://static.opensuse.org/fonts/'+ file +'"></link>');
}
else {
   document.write('<link rel="stylesheet" type="text/css" href="static/css/fonts-onlylocal.css"></link>');
}

</script><noscript><link rel="stylesheet" type="text/css" href="http://static.opensuse.org/fonts/fonts.css" /></noscript><script src="static/js/jquery-1.10.2.min.js" type="text/javascript"></script><script src="static/js/script.js" type="text/javascript"></script><script src="static/js/highlight.min.js" type="text/javascript"></script><script>

$(document).ready(function() {
  $('.verbatim-wrap.highlight').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});
hljs.configure({
  useBR: false
});

</script></head><body class="draft offline js-off"><div id="_outer-wrap"><div id="_white-bg"><div id="_header"><div id="_logo"><img src="static/images/logo.png" alt="Logo" /></div><div class="crumbs"><a class="book-link" href="index.html" title="SUSE Linux Enterprise Server Documentation"><span class="book-icon">SUSE Linux Enterprise Server Documentation</span></a><span> › </span><a class="crumb" href="book.sle.admin.html">Administration Guide</a><span> › </span><a class="crumb" href="part.services.html">Services</a><span> › </span><a class="crumb" href="cha.squid.html">The Proxy Server Squid</a></div><div class="clearme"></div></div></div><div id="_toolbar-wrap"><div id="_toolbar"><div id="_toc-area" class="inactive"><a id="_toc-area-button" class="tool" title="Contents" accesskey="c" href="index.html"><span class="tool-spacer"><span class="toc-icon">Contents</span><span class="clearme"></span></span><span class="tool-label">Contents</span></a><div class="active-contents bubble-corner"></div><div class="active-contents bubble"><div class="bubble-container"><h6>Administration Guide</h6><div id="_bubble-toc"><ol><li class="inactive"><a href="pre.sle.html"><span class="number"> </span><span class="name">About This Guide</span></a></li><li class="inactive"><a href="part.administration.html"><span class="number">I </span><span class="name">Common Tasks</span></a><ol><li class="inactive"><a href="cha.onlineupdate.you.html"><span class="number">1 </span><span class="name">YaST Online Update</span></a></li><li class="inactive"><a href="cha.yast.text.html"><span class="number">2 </span><span class="name">YaST in Text Mode</span></a></li><li class="inactive"><a href="cha.snapper.html"><span class="number">3 </span><span class="name">System Recovery and Snapshot Management with Snapper</span></a></li><li class="inactive"><a href="cha.sw_cl.html"><span class="number">4 </span><span class="name">Managing Software with Command Line Tools</span></a></li><li class="inactive"><a href="cha.vnc.html"><span class="number">5 </span><span class="name">Remote Access with VNC</span></a></li><li class="inactive"><a href="cha.adm.shell.html"><span class="number">6 </span><span class="name">Bash and Bash Scripts</span></a></li></ol></li><li class="inactive"><a href="part.system.html"><span class="number">II </span><span class="name">System</span></a><ol><li class="inactive"><a href="cha.64bit.html"><span class="number">7 </span><span class="name">32-Bit and 64-Bit Applications in a 64-Bit System Environment</span></a></li><li class="inactive"><a href="cha.boot.html"><span class="number">8 </span><span class="name">Booting a Linux System</span></a></li><li class="inactive"><a href="cha.systemd.html"><span class="number">9 </span><span class="name">The <code class="systemitem">systemd</code> Daemon</span></a></li><li class="inactive"><a href="cha.journalctl.html"><span class="number">10 </span><span class="name"><code class="command">journalctl</code>: Query the <code class="systemitem">systemd</code> Journal</span></a></li><li class="inactive"><a href="cha.grub2.html"><span class="number">11 </span><span class="name">The Boot Loader GRUB 2</span></a></li><li class="inactive"><a href="cha.uefi.html"><span class="number">12 </span><span class="name">UEFI (Unified Extensible Firmware Interface)</span></a></li><li class="inactive"><a href="cha.suse.html"><span class="number">13 </span><span class="name">Special System Features</span></a></li><li class="inactive"><a href="cha.p.html"><span class="number">14 </span><span class="name">Printer Operation</span></a></li><li class="inactive"><a href="cha.udev.html"><span class="number">15 </span><span class="name">Dynamic Kernel Device Management with <code class="systemitem">udev</code></span></a></li><li class="inactive"><a href="cha.kgraft.html"><span class="number">16 </span><span class="name">Live Patching the Linux Kernel Using kGraft</span></a></li><li class="inactive"><a href="cha.x11.html"><span class="number">17 </span><span class="name">The X Window System</span></a></li><li class="inactive"><a href="cha.fuse.html"><span class="number">18 </span><span class="name">Accessing File Systems with FUSE</span></a></li></ol></li><li class="inactive"><a href="part.services.html"><span class="number">III </span><span class="name">Services</span></a><ol><li class="inactive"><a href="cha.basicnet.html"><span class="number">19 </span><span class="name">Basic Networking</span></a></li><li class="inactive"><a href="cha.slp.html"><span class="number">20 </span><span class="name">SLP</span></a></li><li class="inactive"><a href="cha.netz.xntp.html"><span class="number">21 </span><span class="name">Time Synchronization with NTP</span></a></li><li class="inactive"><a href="cha.dns.html"><span class="number">22 </span><span class="name">The Domain Name System</span></a></li><li class="inactive"><a href="cha.dhcp.html"><span class="number">23 </span><span class="name">DHCP</span></a></li><li class="inactive"><a href="cha.nm.html"><span class="number">24 </span><span class="name">Using NetworkManager</span></a></li><li class="inactive"><a href="cha.samba.html"><span class="number">25 </span><span class="name">Samba</span></a></li><li class="inactive"><a href="cha.nfs.html"><span class="number">26 </span><span class="name">Sharing File Systems with NFS</span></a></li><li class="inactive"><a href="cha.autofs.html"><span class="number">27 </span><span class="name">On-Demand Mounting with Autofs</span></a></li><li class="inactive"><a href="cha.net.sync.html"><span class="number">28 </span><span class="name">File Synchronization</span></a></li><li class="inactive"><a href="cha.apache2.html"><span class="number">29 </span><span class="name">The Apache HTTP Server</span></a></li><li class="inactive"><a href="cha.ftp.html"><span class="number">30 </span><span class="name">Setting up an FTP Server with YaST</span></a></li><li class="inactive"><a href="cha.squid.html"><span class="number">31 </span><span class="name">The Proxy Server Squid</span></a></li><li class="inactive"><a href="cha.wbem.html"><span class="number">32 </span><span class="name">Web Based Enterprise Management Using SFCB</span></a></li></ol></li><li class="inactive"><a href="part.mobile.html"><span class="number">IV </span><span class="name">Mobile Computers</span></a><ol><li class="inactive"><a href="cha.mobile.html"><span class="number">33 </span><span class="name">Mobile Computing with Linux</span></a></li><li class="inactive"><a href="cha.pmanage.html"><span class="number">34 </span><span class="name">Power Management</span></a></li></ol></li><li class="inactive"><a href="part.trouble.html"><span class="number">V </span><span class="name">Troubleshooting</span></a><ol><li class="inactive"><a href="cha.adminhelp.html"><span class="number">35 </span><span class="name">Help and Documentation</span></a></li><li class="inactive"><a href="cha.adm.support.html"><span class="number">36 </span><span class="name">Gathering System Information for Support</span></a></li><li class="inactive"><a href="cha.trouble.html"><span class="number">37 </span><span class="name">Common Problems and Their Solutions</span></a></li></ol></li><li class="inactive"><a href="app.admin.docupdates.html"><span class="number">A </span><span class="name">Documentation Updates</span></a></li><li class="inactive"><a href="app.nwscheme.html"><span class="number">B </span><span class="name">An Example Network</span></a></li><li class="inactive"><a href="bk01apc.html"><span class="number">C </span><span class="name">GNU Licenses</span></a></li></ol></div><div class="clearme"></div></div></div></div><div id="_nav-area" class="inactive"><div class="tool"><span class="nav-inner"><span class="tool-label">Navigation</span><a accesskey="p" class="tool-spacer" title="Chapter 30. Setting up an FTP Server with YaST" href="cha.ftp.html"><span class="prev-icon">←</span></a><a accesskey="n" class="tool-spacer" title="Chapter 32. Web Based Enterprise Management Using SFCB" href="cha.wbem.html"><span class="next-icon">→</span></a></span></div></div></div></div><div id="_fixed-header-wrap" class="inactive"><div id="_fixed-header"><div class="crumbs"><a class="book-link" href="index.html" title="SUSE Linux Enterprise Server Documentation"><span class="book-icon">SUSE Linux Enterprise Server Documentation</span></a><span> › </span><a class="crumb" href="book.sle.admin.html">Administration Guide</a><span> › </span><a class="crumb" href="part.services.html">Services</a><span> › </span><a class="crumb" href="cha.squid.html">The Proxy Server Squid</a></div><div class="buttons"><a class="top-button button" href="#">Top</a><div class="button"><a accesskey="p" class="tool-spacer" title="Chapter 30. Setting up an FTP Server with YaST" href="cha.ftp.html"><span class="prev-icon">←</span></a><a accesskey="n" class="tool-spacer" title="Chapter 32. Web Based Enterprise Management Using SFCB" href="cha.wbem.html"><span class="next-icon">→</span></a></div><div class="clearme"></div></div><div class="clearme"></div></div></div><div id="_content" class="draft "><div class="documentation"><div class="chapter " id="cha.squid"><div class="titlepage"><div><div class="version-info">Applies to  <span class="productname"><span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span></span> <span class="productnumber"><span class="productnumber"><span class="phrase">12 SP1</span></span></span></div><div><h2 class="title"><span class="number">31 </span><span class="name">The Proxy Server Squid</span> </h2><div class="doc-status"><ul><li><span class="ds-label">Filename: </span>net_proxy.xml</li><li><span class="ds-label">ID: </span>cha.squid</li></ul></div></div><div><div class="abstract"><div class="abstract-title-wrap"><h6 class="abstract-title">Abstract<a title="Permalink" class="permalink" href="cha.squid.html#idm140016703359280">#</a></h6></div><p>
    Squid is a widely-used proxy cache for Linux and Unix platforms. This
    means that it stores requested Internet objects, such as data on a Web
    or FTP server, on a machine that is closer to the requesting workstation
    than the server. It may be set up in multiple hierarchies to assure
    optimal response times and low bandwidth usage, even in modes that are
    transparent for the end user. Additional software like squidGuard may be
    used to filter Web contents.
   </p></div></div></div></div><div class="line"><div class="toc"><dl><dt><span class="sect1"><a href="cha.squid.html#sec.squid.cacheinfos"><span class="number">31.1 </span><span class="name">Some Facts about Proxy Caches</span></a></span></dt><dt><span class="sect1"><a href="cha.squid.html#sec.squid.sysneeds"><span class="number">31.2 </span><span class="name">System Requirements</span></a></span></dt><dt><span class="sect1"><a href="cha.squid.html#sec.squid.start"><span class="number">31.3 </span><span class="name">Starting Squid</span></a></span></dt><dt><span class="sect1"><a href="cha.squid.html#sec.squid.configfile"><span class="number">31.4 </span><span class="name">The /etc/squid/squid.conf Configuration File</span></a></span></dt><dt><span class="sect1"><a href="cha.squid.html#sec.squid.proxyconfigtrans"><span class="number">31.5 </span><span class="name">Configuring a Transparent Proxy</span></a></span></dt><dt><span class="sect1"><a href="cha.squid.html#sec.squid.cachemgr"><span class="number">31.6 </span><span class="name">cachemgr.cgi</span></a></span></dt><dt><span class="sect1"><a href="cha.squid.html#sec.squid.squidguard"><span class="number">31.7 </span><span class="name">squidGuard</span></a></span></dt><dt><span class="sect1"><a href="cha.squid.html#sec.squid.calamaris"><span class="number">31.8 </span><span class="name">Cache Report Generation with Calamaris</span></a></span></dt><dt><span class="sect1"><a href="cha.squid.html#sec.squid.moreinfo"><span class="number">31.9 </span><span class="name">For More Information</span></a></span></dt></dl></div></div><a id="idm140016703356272" class="indexterm"></a><a id="idm140016703355696" class="indexterm"></a><a id="idm140016703354672" class="indexterm"></a><a id="idm140016703353648" class="indexterm"></a><p>
  Squid acts as a proxy cache. It redirects object requests from clients (in
  this case, from Web browsers) to the server. When the requested objects
  arrive from the server, it delivers the objects to the client and keeps a
  copy of them in the hard disk cache. One of the advantages of caching is
  that several clients requesting the same object can be served from the
  hard disk cache. This enables clients to receive the data much faster than
  from the Internet. This procedure also reduces the network traffic.
  <a id="idm140016703351664" class="indexterm"></a>
 </p><p>
  <a id="idm140016703349872" class="indexterm"></a> Along with the actual caching, Squid offers a wide range of
  features such as distributing the load over intercommunicating hierarchies
  of proxy servers, defining strict access control lists for all clients
  accessing the proxy, allowing or denying access to specific Web pages with
  the help of other applications, and generating statistics about
  frequently-visited Web pages for the assessment of the users' surfing
  habits. Squid is not a generic proxy. It normally proxies only HTTP
  connections. It supports the protocols FTP, Gopher, SSL, and WAIS, but it
  does not support other Internet protocols, such as Real Audio, news, or
  video conferencing. Because Squid only supports the UDP protocol to
  provide communication between different caches, many other multimedia
  programs are not supported.
 </p><div class="sect1 " id="sec.squid.cacheinfos"><div class="titlepage"><div><div><h2 class="title" id="sec.squid.cacheinfos"><span class="number">31.1 </span><span class="name">Some Facts about Proxy Caches</span> <a title="Permalink" class="permalink" href="cha.squid.html#sec.squid.cacheinfos">#</a></h2></div></div></div><p>
   As a proxy cache, Squid can be used in several ways. When combined with a
   firewall, it can help with security. Multiple proxies can be used
   together. It can also determine what types of objects should be cached
   and for how long.
  </p><div class="sect2 " id="sec.squid.security"><div class="titlepage"><div><div><h3 class="title" id="sec.squid.security"><span class="number">31.1.1 </span><span class="name">Squid and Security</span> <a title="Permalink" class="permalink" href="cha.squid.html#sec.squid.security">#</a></h3></div></div></div><a id="idm140016703344768" class="indexterm"></a><a id="idm140016703343744" class="indexterm"></a><p>
    It is possible to use Squid together with a firewall to secure internal
    networks from the outside using a proxy cache. The firewall denies all
    clients access to external services except Squid. All Web connections
    must be established by the proxy. With this configuration, Squid
    completely controls Web access.
   </p><p>
    <a id="idm140016703341504" class="indexterm"></a> If the firewall configuration includes a DMZ, the proxy
    should operate within this zone.
    <a class="xref" href="cha.squid.html#sec.squid.proxyconfigtrans" title="31.5. Configuring a Transparent Proxy">Section 31.5, “Configuring a Transparent Proxy”</a> describes how to implement
    a <span class="emphasis"><em>transparent</em></span> proxy. This simplifies the
    configuration of the clients, because in this case they do not need any
    information about the proxy.
   </p></div><div class="sect2 " id="sec.squid.morecaches"><div class="titlepage"><div><div><h3 class="title" id="sec.squid.morecaches"><span class="number">31.1.2 </span><span class="name">Multiple Caches</span> <a title="Permalink" class="permalink" href="cha.squid.html#sec.squid.morecaches">#</a></h3></div></div></div><a id="idm140016703337584" class="indexterm"></a><p>
    Several instances of Squid can be configured to exchange objects between
    them. This reduces the total system load and increases the chances of
    finding an object already existing in the local network. It is also
    possible to configure cache hierarchies, so a cache can forward
    object requests to sibling caches or to a parent cache—causing
    it to get objects from another cache in the local network or directly
    from the source.
   </p><p>
    Choosing the appropriate topology for the cache hierarchy is very
    important, because it is not desirable to increase the overall traffic
    on the network. For a very large network, it would make sense to
    configure a proxy server for every subnet and connect them to a parent
    proxy, which in turn is connected to the proxy cache of the ISP.
   </p><p>
    All this communication is handled by ICP (Internet cache protocol)
    running on top of the UDP protocol. Data transfers between caches are
    handled using HTTP (hypertext transmission protocol) based on TCP.
   </p><p>
    To find the most appropriate server from which to get the objects, one
    cache sends an ICP request to all sibling proxies. These answer the
    requests via ICP responses with a HIT code if the object was detected or
    a MISS if it was not. If multiple HIT responses were found, the proxy
    server decides from which server to download, depending on factors such
    as which cache sent the fastest answer or which one is closer. If no
    satisfactory responses are received, the request is sent to the parent
    cache.
   </p><div id="idm140016703333072" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.png" /><h6>Tip: Avoiding Duplication of Objects</h6><p>
     To avoid duplication of objects in different caches in the network,
     other ICP protocols are used, such as CARP (cache array routing
     protocol) or HTCP (hypertext cache protocol). The more objects
     maintained in the network, the greater the possibility of finding the
     desired one.
    </p></div></div><div class="sect2 " id="sec.squid.latching"><div class="titlepage"><div><div><h3 class="title" id="sec.squid.latching"><span class="number">31.1.3 </span><span class="name">Caching Internet Objects</span> <a title="Permalink" class="permalink" href="cha.squid.html#sec.squid.latching">#</a></h3></div></div></div><a id="idm140016703330240" class="indexterm"></a><p>
    Not all objects available in the network are static. There are a lot of
    dynamically generated CGI pages, visitor counters, and encrypted SSL
    content documents. Objects like this are not cached because they change
    each time they are accessed.
   </p><p>
    The question remains as to how long all the other objects stored in the
    cache should stay there. To determine this, all objects in the cache are
    assigned one of various possible states. Web and proxy servers find out
    the status of an object by adding headers to these objects, such as
    <span class="quote">“<span class="quote">Last modified</span>”</span> or <span class="quote">“<span class="quote">Expires</span>”</span> and the
    corresponding date. Other headers specifying that objects must not be
    cached are used as well.
   </p><p>
    Objects in the cache are normally replaced, because of a lack of free
    hard disk space, using algorithms such as LRU (last recently used). This
    means that the proxy expunges the objects that have not been requested
    for the longest time.
   </p></div></div><div class="sect1 " id="sec.squid.sysneeds"><div class="titlepage"><div><div><h2 class="title" id="sec.squid.sysneeds"><span class="number">31.2 </span><span class="name">System Requirements</span> <a title="Permalink" class="permalink" href="cha.squid.html#sec.squid.sysneeds">#</a></h2></div></div></div><a id="idm140016703324624" class="indexterm"></a><p>
   The most important thing is to determine the maximum network load the
   system must bear. Therefore, it is important to pay more attention to the
   load peaks, because these might be more than four times the day's
   average. When in doubt, it would be better to overestimate the system's
   requirements, because having Squid working close to the limit of its
   capabilities could lead to a severe loss in the quality of the service.
   The following sections point to the system factors in order of
   significance.
  </p><div class="sect2 " id="sec.squid.sysneeds.disk"><div class="titlepage"><div><div><h3 class="title" id="sec.squid.sysneeds.disk"><span class="number">31.2.1 </span><span class="name">Hard Disks</span> <a title="Permalink" class="permalink" href="cha.squid.html#sec.squid.sysneeds.disk">#</a></h3></div></div></div><p>
    Speed plays an important role in the caching process, so this factor
    deserves special attention. For hard disks, this parameter is described
    as <span class="emphasis"><em>random seek time</em></span>, measured in milliseconds.
    Because the data blocks that Squid reads from or writes to the hard disk
    tend to be rather small, the seek time of the hard disk is more
    important than its data throughput. For the purposes of a proxy, hard
    disks with high rotation speeds are probably the better choice, because
    they allow the read-write head to be positioned in the required spot
    more quickly. One possibility to speed up the system is to use a number
    of disks concurrently or to employ striping RAID arrays.
   </p></div><div class="sect2 " id="sec.squid.sysneeds.cache_size"><div class="titlepage"><div><div><h3 class="title" id="sec.squid.sysneeds.cache_size"><span class="number">31.2.2 </span><span class="name">Size of the Disk Cache</span> <a title="Permalink" class="permalink" href="cha.squid.html#sec.squid.sysneeds.cache_size">#</a></h3></div></div></div><a id="idm140016703318496" class="indexterm"></a><p>
    In a small cache, the probability of a HIT (finding the requested object
    already located there) is small, because the cache is easily filled and
    the less requested objects are replaced by newer ones. If, for example,
    one GB is available for the cache and the users only surf ten MB per
    day, it would take more than one hundred days to fill the cache.
   </p><p>
    The easiest way to determine the needed cache size is to consider the
    maximum transfer rate of the connection. With a 1 Mbit/s connection, the
    maximum transfer rate is 125 KB/s. If all this traffic ends up in the
    cache, in one hour it would add up to 450 MB and, assuming that all this
    traffic is generated in only eight working hours, it would reach
    3.6 GB in one day. Because the connection is normally not used
    to its upper volume limit, it can be assumed that the total data volume
    handled by the cache is approximately 2 GB. This is why
    2 GB of disk space is required in the example for Squid to keep
    one day's worth of browsed data cached.
   </p></div><div class="sect2 " id="sec.squid.ram"><div class="titlepage"><div><div><h3 class="title" id="sec.squid.ram"><span class="number">31.2.3 </span><span class="name">RAM</span> <a title="Permalink" class="permalink" href="cha.squid.html#sec.squid.ram">#</a></h3></div></div></div><a id="idm140016703313776" class="indexterm"></a><p>
    The amount of memory (RAM) required by Squid directly correlates to the
    number of objects in the cache. Squid also stores cache object
    references and frequently requested objects in the main memory to speed
    up retrieval of this data. Random access memory is much faster than a
    hard disk.
   </p><p>
    In addition to that, there is other data that Squid needs to keep in
    memory, such as a table with all the IP addresses handled, an exact
    domain name cache, the most frequently requested objects, access control
    lists, buffers, and more.
   </p><p>
    It is very important to have sufficient memory for the Squid process,
    because system performance is dramatically reduced if it must be swapped
    to disk. The cachemgr.cgi tool can be used for the cache memory
    management. This tool is introduced in
    <a class="xref" href="cha.squid.html#sec.squid.cachemgr" title="31.6. cachemgr.cgi">Section 31.6, “cachemgr.cgi”</a>.

   </p></div><div class="sect2 " id="sec.squid.cpu"><div class="titlepage"><div><div><h3 class="title" id="sec.squid.cpu"><span class="number">31.2.4 </span><span class="name">CPU</span> <a title="Permalink" class="permalink" href="cha.squid.html#sec.squid.cpu">#</a></h3></div></div></div><a id="idm140016703308720" class="indexterm"></a><p>
    Squid is not a program that requires intensive CPU usage. The load of
    the processor is only increased while the contents of the cache are
    loaded or checked. Using a multiprocessor machine does not increase the
    performance of the system. To increase efficiency, it is better to buy
    faster disks or add more memory.
   </p></div></div><div class="sect1 " id="sec.squid.start"><div class="titlepage"><div><div><h2 class="title" id="sec.squid.start"><span class="number">31.3 </span><span class="name">Starting Squid</span> <a title="Permalink" class="permalink" href="cha.squid.html#sec.squid.start">#</a></h2></div></div></div><a id="idm140016703305440" class="indexterm"></a><p>
   If not already installed, install the <code class="systemitem">squid</code>
   package. <code class="systemitem">squid</code> does not belong to the default
   <span class="productname"><span class="phrase">SUSE® Linux Enterprise Server</span></span> installation scope.
  </p><p>
   Squid is already preconfigured in SUSE® Linux Enterprise Server, you can start it right
   after the installation. To ensure a smooth start-up, the network should
   be configured in a way that at least one name server and the Internet can
   be reached. Problems can arise if a dial-up connection is used with a
   dynamic DNS configuration. In this case, at least the name server should
   be entered, because Squid does not start if it does not detect a DNS
   server in <code class="filename">/etc/resolv.conf</code>.
  </p><a id="idm140016703300576" class="indexterm"></a><div class="sect2 " id="sec.squid.start.commands"><div class="titlepage"><div><div><h3 class="title" id="sec.squid.start.commands"><span class="number">31.3.1 </span><span class="name">Commands for Starting and Stopping Squid</span> <a title="Permalink" class="permalink" href="cha.squid.html#sec.squid.start.commands">#</a></h3></div></div></div><a id="idm140016703298272" class="indexterm"></a><a id="idm140016703297248" class="indexterm"></a><a id="idm140016703295776" class="indexterm"></a><a id="idm140016703294752" class="indexterm"></a><p>
    To start Squid, enter <code class="command">systemctl start squid</code>
    at the command line as <code class="systemitem">root</code>.
    In the initial start-up, the directory structure of the cache must first
    be defined in <code class="filename">/var/cache/squid</code>. This is done
    automatically by the start script

    and can take a few seconds or even minutes. If <code class="literal">done</code>
    appears to the right in green, Squid has been successfully loaded. To
    test the functionality of Squid on the local system, enter
    <code class="option">localhost</code> as the proxy and <code class="option">3128</code> as the
    port in the browser.
   </p><p>
    To allow users from the local system and other systems to access Squid
    and the Internet, change the entry in the configuration files
    <code class="filename">/etc/squid/squid.conf</code> from <code class="option">http_access deny
    all</code> to <code class="option">http_access allow all</code>. However, in
    doing so, consider that Squid is made completely accessible to anyone by
    this action. Therefore, define ACLs that control access to the proxy.
    More information about this is available in
    <a class="xref" href="cha.squid.html#sec.squid.acl" title="31.4.2. Options for Access Controls">Section 31.4.2, “Options for Access Controls”</a>.
   </p><a id="idm140016703287312" class="indexterm"></a><p>
    After modifying the configuration file
    <code class="filename">/etc/squid/squid.conf</code>, Squid must reload the
    configuration file. Do this with <code class="command">systemctl reload
    squid</code>. Alternatively, completely restart Squid with
    <code class="command">systemctl restart squid</code>.
   </p><p>
    The command <code class="command">systemctl status squid</code> can be
    used to check if the proxy is running. The command <code class="command">systemctl
    stop squid</code> causes Squid to shut down. This can take a
    while, because Squid waits up to half a minute
    (<code class="option">shutdown_lifetime</code> option in
    <code class="filename">/etc/squid/squid.conf</code>) before dropping the
    connections to the clients and writing its data to the disk.
   </p><div id="idm140016703281744" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.png" /><h6>Warning: Terminating Squid</h6><p>
     <a id="idm140016703280720" class="indexterm"></a> Terminating Squid with <code class="command">kill</code> or
     <code class="command">killall</code> can damage the cache. To be able to restart
     Squid, a damaged cache must be deleted.
    </p></div><a id="idm140016703277776" class="indexterm"></a><a id="idm140016703276752" class="indexterm"></a><a id="idm140016703275728" class="indexterm"></a><p>
    If Squid dies after a short period of time even though it was started
    successfully, check whether there is a faulty name server entry or
    whether the <code class="filename">/etc/resolv.conf</code> file is missing. Squid
    logs the cause of a start-up failure in the file
    <code class="filename">/var/log/squid/cache.log</code>. If Squid should be loaded
    automatically when the system boots, enable the service with
    <code class="command">systemctl enable squid</code>.
   </p><a id="idm140016703272608" class="indexterm"></a><p>
    An uninstall of Squid does not remove the cache hierarchy or the log
    files. To remove these, delete the <code class="filename">/var/cache/squid</code>
    directory manually.
   </p></div><div class="sect2 " id="sec.squid.start.local_dns"><div class="titlepage"><div><div><h3 class="title" id="sec.squid.start.local_dns"><span class="number">31.3.2 </span><span class="name">Local DNS Server</span> <a title="Permalink" class="permalink" href="cha.squid.html#sec.squid.start.local_dns">#</a></h3></div></div></div><a id="idm140016703269168" class="indexterm"></a><a id="idm140016703268144" class="indexterm"></a><a id="idm140016703267120" class="indexterm"></a><p>
    Setting up a local DNS server makes sense even if it does not manage its
    own domain. It then simply acts as a caching-only name server and is
    also able to resolve DNS requests via the root name servers without
    requiring any special configuration (see
    <a class="xref" href="cha.dns.html#sec.dns.bind" title="22.4. Starting the BIND Name Server">Section 22.4, “Starting the BIND Name Server”</a>). How this can be done depends on whether
    you chose dynamic DNS during the configuration of the Internet
    connection.
   </p><div class="variablelist "><dl class="variablelist"><dt id="idm140016703264272"><span class="term ">Dynamic DNS</span></dt><dd><p>
       Normally, with dynamic DNS, the DNS server is set by the provider
       during the establishment of the Internet connection and the local
       <code class="filename">/etc/resolv.conf</code> file is adjusted automatically.
       This behavior is controlled in the
       <code class="filename">/etc/sysconfig/network/config</code> file with the
       <code class="constant">NETCONFIG_DNS_POLICY</code> sysconfig variable. Set
       <code class="constant">NETCONFIG_DNS_POLICY</code> to <code class="constant">""</code>
       with the YaST sysconfig editor.

       Then enter the local DNS server in the
       <code class="filename">/etc/resolv.conf</code> file with the IP address
       <code class="systemitem">127.0.0.1</code> for
       <code class="systemitem">localhost</code>. This way Squid
       can always find the local name server when it starts.
      </p><p>
       To make the provider's name server accessible, enter it in the
       configuration file <code class="filename">/etc/named.conf</code> under
       <code class="systemitem">forwarders</code> along with its IP address. With
       dynamic DNS, this can be achieved automatically during connection
       establishment by setting the sysconfig variable
       <code class="constant">NETCONFIG_DNS_POLICY</code> to
       <code class="constant">auto</code>.
      </p></dd><dt id="idm140016703255040"><span class="term ">Static DNS</span></dt><dd><p>
       With static DNS, no automatic DNS adjustments take place while
       establishing a connection, so there is no need to change any
       sysconfig variables. You must, however, enter the local DNS server in
       the file <code class="filename">/etc/resolv.conf</code> as described above.
       Additionally, the providers static name server must be entered
       manually in the <code class="filename">/etc/named.conf</code> file under
       <code class="systemitem">forwarders</code> along with its IP address.
      </p></dd></dl></div><div id="idm140016703251408" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.png" /><h6>Tip: DNS and Firewall</h6><p>
     If you have a firewall running, make sure DNS requests can pass it.
    </p></div></div></div><div class="sect1 " id="sec.squid.configfile"><div class="titlepage"><div><div><h2 class="title" id="sec.squid.configfile"><span class="number">31.4 </span><span class="name">The /etc/squid/squid.conf Configuration File</span> <a title="Permalink" class="permalink" href="cha.squid.html#sec.squid.configfile">#</a></h2></div></div></div><a id="idm140016703248640" class="indexterm"></a><a id="idm140016703247616" class="indexterm"></a><a id="idm140016703246592" class="indexterm"></a><p>
   All Squid proxy server settings are made in the
   <code class="filename">/etc/squid/squid.conf</code> file. To start Squid for the
   first time, no changes are necessary in this file, but external clients are
   initially denied access. The proxy is available for <code class="systemitem">localhost</code>. The default port is
   <code class="option">3128</code>. The preinstalled configuration file
   <code class="filename">/etc/squid/squid.conf</code> provides detailed information
   about the options and many examples. Nearly all entries begin with
   <code class="literal">#</code> (the lines are commented) and the relevant
   specifications can be found at the end of the line. The given values almost
   always correlate with the default values, so removing the comment signs
   without changing any of the parameters usually has little effect. If
   possible, leave the sample as it is and insert the options along with the
   modified parameters in the line below. This way, the default values may
   easily be recovered and compared with the changes.
  </p><div id="idm140016703241664" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.png" /><h6>Tip: Adapting the Configuration File after an Update</h6><p>
    If you have updated from an earlier Squid version, it is recommended to
    edit the new <code class="filename">/etc/squid/squid.conf</code> and only apply
    the changes made in the previous file. If you try to use the old
    <code class="filename">squid.conf</code>, you risk that the configuration no
    longer works, because options are sometimes modified and new changes
    added.
   </p></div><div class="sect2 " id="sec.squid.configfile.general"><div class="titlepage"><div><div><h3 class="title" id="sec.squid.configfile.general"><span class="number">31.4.1 </span><span class="name">General Configuration Options (Selection)</span> <a title="Permalink" class="permalink" href="cha.squid.html#sec.squid.configfile.general">#</a></h3></div></div></div><div class="variablelist "><dl class="variablelist"><dt id="idm140016703237552"><span class="term ">http_port 3128</span></dt><dd><p>
       This is the port on which Squid listens for client requests. The
       default port is <code class="option">3128</code>, but <code class="option">8080</code> is
       also common. If desired, specify several port numbers separated by
       blank spaces.
      </p></dd><dt id="idm140016703234688"><span class="term ">
      cache_peer <em class="replaceable ">hostname</em><em class="replaceable ">type</em><em class="replaceable ">proxy-port</em><em class="replaceable ">icp-port</em>
     </span></dt><dd><p>
       Here, enter a parent proxy, for example, if you want to use the proxy
       of your ISP. As <em class="replaceable ">hostname</em>, enter the name
       or IP address of the proxy to use and, as
       <em class="replaceable ">type</em>, enter <code class="option">parent</code>. For
       <em class="replaceable ">proxy-port</em>, enter the port number that is
       also given by the operator of the parent for use in the browser
       (usually <code class="option">8080</code>). Set the
       <em class="replaceable ">icp-port</em> to <code class="option">7</code> or
       <code class="option">0</code> if the ICP port of the parent is not known and its
       use is irrelevant to the provider. In addition,
       <code class="option">default</code> and <code class="option">no-query</code> may be
       specified after the port numbers to prohibit the use of the ICP
       protocol. Squid then behaves like a normal browser as far as the
       provider's proxy is concerned.
       
      </p></dd><dt id="idm140016703225968"><span class="term ">cache_mem 8 MB</span></dt><dd><p>
       This entry defines the amount of memory Squid can use for very
       popular replies. The default is <code class="option">8 MB</code>. This does not
       specify the memory usage of Squid and may be exceeded.
      </p></dd><dt id="idm140016703223568"><span class="term ">cache_dir ufs /var/cache/squid/ 100 16 256</span></dt><dd><p>
       The entry <span class="emphasis"><em>cache_dir</em></span> defines the directory where
       all the objects are stored on disk. The numbers at the end indicate
       the maximum disk space in MB to use and the number of directories in
       the first and second level. The <code class="option">ufs</code> parameter should
       be left alone. The default is 100 MB occupied disk space in the
       <code class="filename">/var/cache/squid</code> directory and creation of 16
       subdirectories inside it, each containing 256 more subdirectories.
       When specifying the disk space to use, leave sufficient reserve disk
       space. Values from a minimum of 50% to a maximum of 80% of the
       available disk space make the most sense here. The last two numbers
       for the directories should only be increased with caution, because
       too many directories can also lead to performance problems. If you
       have several disks that share the cache, enter several
       <span class="emphasis"><em>cache_dir</em></span> lines.
      </p></dd><dt id="idm140016703219136"><span class="term ">cache_access_log /var/log/squid/access.log, </span><span class="term ">cache_log  /var/log/squid/cache.log, </span><span class="term ">cache_store_log  /var/log/squid/store.log</span></dt><dd><p>
       <a id="idm140016703216848" class="indexterm"></a> <a id="idm140016703215504" class="indexterm"></a> These three entries specify the paths where Squid log
       files all its actions. Normally, nothing is changed here. If Squid is
       experiencing a heavy usage burden, it might make sense to distribute
       the cache and the log files over several disks.
      </p></dd><dt id="idm140016703213424"><span class="term ">emulate_httpd_log off</span></dt><dd><p>
       If the entry is set to <span class="emphasis"><em>on</em></span>, obtain readable log
       files. Some evaluation programs cannot interpret this, however.
      </p></dd><dt id="idm140016703211088"><span class="term ">client_netmask 255.255.255.255</span></dt><dd><p>
       With this entry, mask IP addresses of clients in the log files. The
       last digit of the IP address is set to zero if you enter
       <code class="systemitem">255.255.255.0</code> here. You may
       protect the privacy of your clients this way.
      </p></dd><dt id="idm140016703208368"><span class="term ">ftp_user Squid@</span></dt><dd><p>
       With this, set the password Squid should use for the anonymous FTP
       login. It can make sense to specify a valid e-mail address here,
       because some FTP servers check these for validity.
      </p></dd><dt id="idm140016703206384"><span class="term ">cache_mgr webmaster</span></dt><dd><p>
       An e-mail address to which Squid sends a message if it unexpectedly
       crashes. The default is <span class="emphasis"><em>webmaster</em></span>.
      </p></dd><dt id="idm140016703204048"><span class="term ">logfile_rotate 0</span></dt><dd><p>
       If you run <code class="command">squid</code> <code class="option">-k
       rotate</code>, <code class="command">Squid</code> can rotate secured log
       files. The files are numbered in this process and, after reaching the
       specified value, the oldest file is overwritten. The default value is
       <code class="option">0</code> because archiving and deleting log files in
       <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> is carried out by a cron job set in the
       configuration file <code class="filename">/etc/logrotate/squid</code>.
      </p></dd><dt id="idm140016703198624"><span class="term ">append_domain &lt;domain&gt;</span></dt><dd><p>
       With <span class="emphasis"><em>append_domain</em></span>, specify which domain to
       append automatically when none is given. Usually, your own domain is
       entered here, so entering <span class="emphasis"><em>www</em></span> in the browser
       accesses your own Web server.
      </p></dd><dt id="idm140016703195776"><span class="term ">forwarded_for on</span></dt><dd><p>
       If you set the entry to <span class="emphasis"><em>off</em></span>, Squid removes the
       IP address and the system name of the client from HTTP requests.
       Otherwise it adds a line to the header like
      </p><div class="verbatim-wrap"><pre class="screen">X-Forwarded-For: 192.168.0.1</pre></div></dd><dt id="idm140016703192928"><span class="term ">negative_ttl 5 minutes; negative_dns_ttl 5 minutes</span></dt><dd><p>
       Normally, you do not need to change these values. If you have a
       dial-up connection, however, the Internet may, at times, not be
       accessible. Squid makes a note of the failed requests then refuses to
       issue new ones, although the Internet connection has been
       reestablished. In a case such as this, change the
       <span class="emphasis"><em>minutes</em></span> to <span class="emphasis"><em>seconds</em></span>. Then,
       after clicking <span class="emphasis"><em>Reload</em></span> in the browser, the
       dial-up process should be reengaged after a few seconds.
      </p></dd><dt id="idm140016703189328"><span class="term ">never_direct allow <em class="replaceable ">acl_name</em>
     </span></dt><dd><p>
       To prevent Squid from taking requests directly from the Internet, use
       the above command to force connection to another proxy. This must
       have previously been entered in <span class="emphasis"><em>cache_peer</em></span>. If
       <code class="option">all</code> is specified as the
       <em class="replaceable ">acl_name</em>, force all requests to be
       forwarded directly to the <span class="emphasis"><em>parent</em></span>. This might be
       necessary, for example, if you are using a provider that strictly
       stipulates the use of its proxies or denies its firewall direct
       Internet access.
      </p></dd></dl></div></div><div class="sect2 " id="sec.squid.acl"><div class="titlepage"><div><div><h3 class="title" id="sec.squid.acl"><span class="number">31.4.2 </span><span class="name">Options for Access Controls</span> <a title="Permalink" class="permalink" href="cha.squid.html#sec.squid.acl">#</a></h3></div></div></div><a id="idm140016703183536" class="indexterm"></a><a id="idm140016703182512" class="indexterm"></a><p>
    Squid provides a detailed system for controlling the access to the
    proxy. By implementing ACLs, it can be configured easily and
    comprehensively. This involves lists with rules that are processed
    sequentially. ACLs must be defined before they can be used. Some default
    ACLs, such as <span class="emphasis"><em>all</em></span> and
    <span class="emphasis"><em>localhost</em></span>, already exist. However, the mere
    definition of an ACL does not mean that it is actually applied. This
    only happens with <span class="emphasis"><em>http_access</em></span> rules.
   </p><div class="variablelist "><dl class="variablelist"><dt id="idm140016703178848"><span class="term ">acl &lt;acl_name&gt; &lt;type&gt; &lt;data&gt;</span></dt><dd><p>
       <a id="idm140016703177520" class="indexterm"></a> An ACL requires at least three specifications to define
       it. The name <span class="emphasis"><em>&lt;acl_name&gt;</em></span> can be
       chosen arbitrarily. For <span class="emphasis"><em>&lt;type&gt;</em></span>,
       select from a variety of different options, which can be found in the
       <span class="emphasis"><em>ACCESS CONTROLS</em></span> section in the
       <code class="filename">/etc/squid/squid.conf</code> file. The specification
       for <span class="emphasis"><em>&lt;data&gt;</em></span> depends on the individual
       ACL type and can also be read from a file, for example, via host
       names, IP addresses, or URLs. The following are some simple examples:
      </p><div class="verbatim-wrap"><pre class="screen">acl mysurfers srcdomain .my-domain.com
acl teachers src 192.168.1.0/255.255.255.0
acl students src 192.168.7.0-192.168.9.0/255.255.255.0
acl lunch time MTWHF 12:00-15:00</pre></div></dd><dt id="idm140016703172528"><span class="term ">http_access allow &lt;acl_name&gt;</span></dt><dd><p>
       <span class="emphasis"><em>http_access</em></span> defines who is allowed to use the
       proxy and who can access what on the Internet. For this, ACLs must be
       given. <span class="emphasis"><em>localhost</em></span> and <span class="emphasis"><em>all</em></span>
       have already been defined above, which can deny or allow access via
       <span class="emphasis"><em>deny</em></span> or <span class="emphasis"><em>allow</em></span>. A list
       containing any number of <span class="emphasis"><em>http_access</em></span> entries can
       be created, processed from top to bottom, and, depending on which
       occurs first, access is allowed or denied to the respective URL. The
       last entry should always be <span class="emphasis"><em>http_access deny
       all</em></span>. In the following example, the
       <span class="emphasis"><em>localhost</em></span> has free access to everything while
       all other hosts are denied access completely.
      </p><div class="verbatim-wrap"><pre class="screen">http_access allow localhost
http_access deny all</pre></div><p>
       In another example using these rules, the group
       <code class="systemitem">teachers</code> always has access
       to the Internet. The group
       <code class="systemitem">students</code> only gets access
       Monday to Friday during lunch time.
      </p><div class="verbatim-wrap"><pre class="screen">http_access deny localhost
http_access allow teachers
http_access allow students lunch time
http_access deny all</pre></div><p>
       The list with the <span class="emphasis"><em>http_access</em></span> entries should
       only be entered, for the sake of readability, at the designated
       position in the <code class="filename">/etc/squid/squid.conf</code> file. That
       is, between the text
      </p><div class="verbatim-wrap"><pre class="screen"># INSERT YOUR OWN RULE(S) HERE TO ALLOW ACCESS FROM YOUR
# CLIENTS</pre></div><p>
       and the last
      </p><div class="verbatim-wrap"><pre class="screen">http_access deny all</pre></div></dd><dt id="idm140016703160688"><span class="term ">redirect_program /usr/bin/squidGuard</span></dt><dd><p>
       With this option, specify a redirector such as squidGuard, which
       allows the blocking of unwanted URLs. Internet access can be
       individually controlled for various user groups with the help of
       proxy authentication and the appropriate ACLs. squidGuard is a
       separate package that can be installed and configured.
      </p></dd><dt id="idm140016703158544"><span class="term ">auth_param basic program /usr/sbin/pam_auth</span></dt><dd><p>
       If users must be authenticated on the proxy, set a corresponding
       program, such as pam_auth. When accessing pam_auth for the first
       time, the user sees a login window in which to enter the user name
       and password. In addition, an ACL is still required, so only clients
       with a valid login can use the Internet:
      </p><div class="verbatim-wrap"><pre class="screen">acl password proxy_auth REQUIRED

http_access allow password
http_access deny all</pre></div><p>
       The <span class="emphasis"><em>REQUIRED</em></span> after
       <span class="emphasis"><em>proxy_auth</em></span> can be replaced with a list of
       permitted user names or with the path to such a list.
      </p></dd><dt id="idm140016703154448"><span class="term ">ident_lookup_access allow &lt;acl_name&gt;</span></dt><dd><p>
       With this, have an ident request run for all ACL-defined clients to
       find each user's identity. If you apply <span class="emphasis"><em>all</em></span> to
       the <span class="emphasis"><em>&lt;acl_name&gt;</em></span>, this is valid for
       all clients. Also, an ident daemon must be running on all clients.
       For Linux, install the pidentd package for this purpose. For
       Microsoft Windows, free software is available for download from the
       Internet. To ensure that only clients with a successful ident lookup
       are permitted, define a corresponding ACL here:
      </p><div class="verbatim-wrap"><pre class="screen">acl identhosts ident REQUIRED

http_access allow identhosts
http_access deny all</pre></div><p>
       Here, too, replace <span class="emphasis"><em>REQUIRED</em></span> with a list of
       permitted user names. Using <span class="emphasis"><em>ident</em></span> can slow down
       the access time quite a bit, because ident lookups are repeated for
       each request.
      </p></dd></dl></div></div></div><div class="sect1 " id="sec.squid.proxyconfigtrans"><div class="titlepage"><div><div><h2 class="title" id="sec.squid.proxyconfigtrans"><span class="number">31.5 </span><span class="name">Configuring a Transparent Proxy</span> <a title="Permalink" class="permalink" href="cha.squid.html#sec.squid.proxyconfigtrans">#</a></h2></div></div></div><a id="idm140016703147744" class="indexterm"></a><a id="idm140016703146720" class="indexterm"></a><p>
   The usual way of working with proxy servers is the following: the Web
   browser sends requests to a certain port in the proxy server and the
   proxy provides these required objects, whether they are in its cache or
   not. When working in a network, several situations may arise:
  </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
     For security reasons, it is recommended that all clients use a proxy to
     surf the Internet.
    </p></li><li class="listitem "><p>
     All clients must use a proxy, regardless of whether they are aware of
     it.
    </p></li><li class="listitem "><p>
     The proxy in a network is moved, but the existing clients need to
     retain their old configuration.
    </p></li></ul></div><p>
   In all these cases, a transparent proxy may be used. The principle is
   very easy: the proxy intercepts and answers the requests of the Web
   browser, so the Web browser receives the requested pages without knowing
   from where they are coming. As the name indicates, the entire process is
   done transparently.
  </p><div class="sect2 " id="sec.squid.proxyconfigtrans.squid_conf"><div class="titlepage"><div><div><h3 class="title" id="sec.squid.proxyconfigtrans.squid_conf"><span class="number">31.5.1 </span><span class="name">Configuration Options in /etc/squid/squid.conf</span> <a title="Permalink" class="permalink" href="cha.squid.html#sec.squid.proxyconfigtrans.squid_conf">#</a></h3></div></div></div><a id="idm140016703138992" class="indexterm"></a><p>
    To inform squid that it should act as a transparent proxy, use the
    option <code class="systemitem">transparent</code> at the tag
    <code class="systemitem">http_port</code> in the main configuration file
    <code class="filename">/etc/squid/squid.conf</code>. After restarting squid, the
    only other thing that must be done is to reconfigure the firewall to
    redirect the HTTP port to the port given in
    <code class="systemitem">http_port</code>. In the following squid configuration
    line, this would be the port 3128.
   </p><div class="verbatim-wrap"><pre class="screen">http_port 3128 transparent</pre></div></div><div class="sect2 " id="sec.squid.proxyconfigtrans.firewall"><div class="titlepage"><div><div><h3 class="title" id="sec.squid.proxyconfigtrans.firewall"><span class="number">31.5.2 </span><span class="name">Firewall Configuration with SuSEFirewall2</span> <a title="Permalink" class="permalink" href="cha.squid.html#sec.squid.proxyconfigtrans.firewall">#</a></h3></div></div></div><a id="idm140016703133584" class="indexterm"></a><a id="idm140016703132560" class="indexterm"></a><p>
    Now redirect all incoming requests via the firewall with help of a port
    forwarding rule to the Squid port. To do this, use the enclosed tool
    SuSEFirewall2, described in
    <a class="xref" href="cha.security.firewall.html#sec.security.firewall.SuSE.yast" title="15.4.1. Configuring the Firewall with YaST">Section 15.4.1, “Configuring the Firewall with YaST”</a>. Its configuration
    file can be found in
    <code class="filename">/etc/sysconfig/SuSEfirewall2</code>. The
    configuration file consists of well-documented entries. To set a
    transparent proxy, you must configure several firewall options:
   </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
      Device pointing to the Internet:
      <code class="systemitem">FW_DEV_EXT</code>="eth1"
     </p></li><li class="listitem "><p>
      Device pointing to the network:
      <code class="systemitem">FW_DEV_INT</code>="eth0"
     </p></li></ul></div><p>
    <a id="idm140016703125568" class="indexterm"></a> Define ports and services (see
    <code class="filename">/etc/services</code>) on the firewall that are accessed
    from untrusted (external) networks such as the Internet. In this
    example, only Web services are offered to the outside:
   </p><div class="verbatim-wrap"><pre class="screen">FW_SERVICES_EXT_TCP="www"</pre></div><p>
    Define ports or services (see <code class="filename">/etc/services</code>) on the
    firewall that are accessed from the secure (internal) network, both via
    TCP and UDP:
   </p><div class="verbatim-wrap"><pre class="screen">FW_SERVICES_INT_TCP="domain www 3128"
FW_SERVICES_INT_UDP="domain"</pre></div><p>
    This allows accessing Web services and Squid (whose default port is
    <code class="option">3128</code>).

    The service <span class="quote">“<span class="quote">domain</span>”</span> stands for DNS (domain name service).
    This service is commonly used. Otherwise, simply take it out of the
    above entries and set the following option to <code class="literal">no</code>:
   </p><div class="verbatim-wrap"><pre class="screen">FW_SERVICE_DNS="yes"</pre></div><p>
    The most important option is option number <code class="option">15</code>:
   </p><div class="example" id="dat.fw.opt15"><div class="example-title-wrap"><h6 class="example-title"><span class="number">Example 31.1: </span><span class="name">Firewall Configuration: Option 15 </span><a title="Permalink" class="permalink" href="cha.squid.html#dat.fw.opt15">#</a></h6></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen"># 15.)
# Which accesses to services should be redirected to a local port on
# the firewall machine?
#
# This option can be used to force all internal users to surf via
# your squid proxy, or transparently redirect incoming webtraffic to
# a secure webserver.
#
# Format: 
# list of &lt;source network&gt;[,&lt;destination network&gt;,&lt;protocol&gt;[,dport[:lport]]
# Where protocol is either tcp or udp. dport is the original
# destination port and lport the port on the local machine to
# redirect the traffic to
#
# An exclamation mark in front of source or destination network
# means everything EXCEPT the specified network
#
# Example: "10.0.0.0/8,0/0,tcp,80,3128 0/0,172.20.1.1,tcp,80,8080"</pre></div></div></div><p>
    The comments above show the syntax to follow. First, enter the IP
    address and the netmask of the internal networks accessing the proxy
    firewall. Second, enter the IP address and the netmask to which these
    clients send their requests. In the case of Web browsers, specify the
    networks <code class="systemitem">0/0</code>, a wild card that means <span class="quote">“<span class="quote">to
    everywhere.</span>”</span> After that, enter the original port to which these
    requests are sent and, finally, the port to which all these requests are
    redirected. Because Squid supports protocols other than HTTP, redirect
    requests from other ports to the proxy, such as FTP (port 21), HTTPS, or
    SSL (port 443). In this example, Web services (port <code class="option">80</code>)
    are redirected to the proxy port (port <code class="option">3128</code>). If there
    are more networks or services to add, they must be separated by a blank
    space in the respective entry.
   </p><div class="verbatim-wrap"><pre class="screen">FW_REDIRECT="192.168.0.0/16,0/0,tcp,80,3128"</pre></div><p>
    To start the firewall and the new configuration with it, change an entry
    in the <code class="filename">/etc/sysconfig/SuSEfirewall2</code> file.
    The entry <code class="systemitem">START_FW</code> must be set to
    <code class="literal">"yes"</code>.
   </p><p>
    <a id="idm140016703109984" class="indexterm"></a> <a id="idm140016703108640" class="indexterm"></a> Start Squid as shown in <a class="xref" href="cha.squid.html#sec.squid.start" title="31.3. Starting Squid">Section 31.3, “Starting Squid”</a>.
    To verify that everything is working properly, check the Squid log files
    in <code class="filename">/var/log/squid/access.log</code>. <a id="idm140016703106192" class="indexterm"></a> <a id="idm140016703104848" class="indexterm"></a> To verify that all ports are correctly configured, perform
    a port scan on the machine from any computer outside your network. Only
    the Web services (port 80) should be open. To scan the ports with nmap,
    the command syntax is <code class="command">nmap</code> <code class="option">-O
    IP_address</code>.
   </p></div></div><div class="sect1 " id="sec.squid.cachemgr"><div class="titlepage"><div><div><h2 class="title" id="sec.squid.cachemgr"><span class="number">31.6 </span><span class="name">cachemgr.cgi</span> <a title="Permalink" class="permalink" href="cha.squid.html#sec.squid.cachemgr">#</a></h2></div></div></div><a id="idm140016703100896" class="indexterm"></a><a id="idm140016703099872" class="indexterm"></a><p>
   The cache manager (cachemgr.cgi) is a CGI utility for displaying
   statistics about the memory usage of a running Squid process. It is also
   a more convenient way to manage the cache and view statistics without
   logging the server.
  </p><div class="sect2 " id="sec.squid.cachemgr.setup"><div class="titlepage"><div><div><h3 class="title" id="sec.squid.cachemgr.setup"><span class="number">31.6.1 </span><span class="name">Setup</span> <a title="Permalink" class="permalink" href="cha.squid.html#sec.squid.cachemgr.setup">#</a></h3></div></div></div><a id="idm140016703096928" class="indexterm"></a><a id="idm140016703095904" class="indexterm"></a><p>
    First, a running Web server on your system is required. Configure Apache
    as described in <a class="xref" href="cha.apache2.html" title="Chapter 29. The Apache HTTP Server">Chapter 29, <em>The Apache HTTP Server</em></a>. To check if Apache is
    already running, as <code class="systemitem">root</code> enter
    the command <code class="command">systemctl status apache2</code>.

    Otherwise, enter <code class="command">systemctl start apache2</code> to
    start Apache with the <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> default settings. The last step
    to set it up is to copy the file <code class="filename">cachemgr.cgi</code> to
    the Apache directory <code class="filename">cgi-bin</code>. For 32-bit, this
    works as follows:
   </p><div class="verbatim-wrap"><pre class="screen">cp /usr/lib/squid/cachemgr.cgi /srv/www/cgi-bin/</pre></div><p>
    In a 64-bit environment, the file <code class="filename">cachemgr.cgi</code> is
    located below <code class="filename">/usr/lib64/squid/</code> and the command to
    copy it to the Apache directory is the following:
   </p><div class="verbatim-wrap"><pre class="screen">cp /usr/lib64/squid/cachemgr.cgi /srv/www/cgi-bin/</pre></div></div><div class="sect2 " id="sec.squid.cachemgr.acls"><div class="titlepage"><div><div><h3 class="title" id="sec.squid.cachemgr.acls"><span class="number">31.6.2 </span><span class="name">Cache Manager ACLs in /etc/squid/squid.conf</span> <a title="Permalink" class="permalink" href="cha.squid.html#sec.squid.cachemgr.acls">#</a></h3></div></div></div><a id="idm140016703086272" class="indexterm"></a><a id="idm140016703085248" class="indexterm"></a><p>
    There are some default settings in the original file required for the
    cache manager. First, two ACLs are defined, then http_access options use
    these ACLs to grant access from the CGI script to Squid. The first ACL
    is the most important, because the cache manager tries to communicate
    with Squid over the cache_object protocol.
   </p><div class="verbatim-wrap"><pre class="screen">acl manager proto cache_object
acl localhost src 127.0.0.1/255.255.255.255</pre></div><p>
    The following rules give Apache the access rights to Squid:
   </p><div class="verbatim-wrap"><pre class="screen">http_access allow manager localhost
http_access deny manager</pre></div><p>
    These rules assume that the Web server and Squid are running on the same
    machine. If the communication between the cache manager and Squid
    originates at the Web server on another computer, include an extra ACL
    as in <a class="xref" href="cha.squid.html#dat.acl" title="Access Rules">Example 31.2, “Access Rules”</a>.
   </p><div class="example" id="dat.acl"><div class="example-title-wrap"><h6 class="example-title"><span class="number">Example 31.2: </span><span class="name">Access Rules </span><a title="Permalink" class="permalink" href="cha.squid.html#dat.acl">#</a></h6></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen">acl manager proto cache_object
acl localhost src 127.0.0.1/255.255.255.255
acl webserver src 192.168.1.7/255.255.255.255 # webserver IP</pre></div></div></div><p>
    Then add the rules in <a class="xref" href="cha.squid.html#dat.access" title="Access Rules">Example 31.3, “Access Rules”</a> to permit access from
    the Web server.
   </p><div class="example" id="dat.access"><div class="example-title-wrap"><h6 class="example-title"><span class="number">Example 31.3: </span><span class="name">Access Rules </span><a title="Permalink" class="permalink" href="cha.squid.html#dat.access">#</a></h6></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen">http_access allow manager localhost
http_access allow manager webserver
http_access deny manager</pre></div></div></div><p>
    Configure a password for the manager for access to more options, like
    closing the cache remotely or viewing more information about the cache.
    For this, configure the entry <code class="systemitem">cachemgr_passwd</code>
    with a password for the manager and the list of options to view. This
    list appears as a part of the entry comments in
    <code class="filename">/etc/squid/squid.conf</code>.
   </p><p>
    Restart Squid every time the configuration file is changed. Do this
    easily with <code class="command">systemctl reload squid</code>.
   </p></div><div class="sect2 " id="sec.squid.cachemgr.statistics"><div class="titlepage"><div><div><h3 class="title" id="sec.squid.cachemgr.statistics"><span class="number">31.6.3 </span><span class="name">Viewing the Statistics</span> <a title="Permalink" class="permalink" href="cha.squid.html#sec.squid.cachemgr.statistics">#</a></h3></div></div></div><p>
    Go to the corresponding Web
    site—<a class="link" href="http://webserver.example.org/cgi-bin/cachemgr.cgi" target="_blank">http://webserver.example.org/cgi-bin/cachemgr.cgi</a>.
    Press <span class="guimenu">continue</span> and browse through the different
    statistics.

    <a id="idm140016703070320" class="indexterm"></a> <a id="idm140016703068976" class="indexterm"></a>
   </p></div></div><div class="sect1 " id="sec.squid.squidguard"><div class="titlepage"><div><div><h2 class="title" id="sec.squid.squidguard"><span class="number">31.7 </span><span class="name">squidGuard</span> <a title="Permalink" class="permalink" href="cha.squid.html#sec.squid.squidguard">#</a></h2></div></div></div><a id="idm140016703066144" class="indexterm"></a><p>
   This section is not intended to explain an extensive configuration of
   squidGuard, only to introduce it and give some advice for using it. For
   more in-depth configuration issues, refer to the squidGuard Web site at
   <a class="link" href="http://www.squidguard.org" target="_blank">http://www.squidguard.org</a>.
  </p><p>
   squidGuard is a free (GPL), flexible, and fast filter, redirector, and
   access controller plug-in for Squid. It lets you define multiple access
   rules with different restrictions for different user groups on a Squid
   cache. squidGuard uses Squid's standard redirector interface. squidGuard
   can do the following:
  </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
     Limit Web access for some users to a list of accepted or well-known Web
     servers or URLs.
    </p></li><li class="listitem "><p>
     Block access to some listed or blacklisted Web servers or URLs for some
     users.
    </p></li><li class="listitem "><p>
     Block access to URLs matching a list of regular expressions or words
     for some users.
    </p></li><li class="listitem "><p>
     Redirect blocked URLs to an <span class="quote">“<span class="quote">intelligent</span>”</span> CGI-based
     information page.
    </p></li><li class="listitem "><p>
     Redirect unregistered users to a registration form.
    </p></li><li class="listitem "><p>
     Redirect banners to an empty GIF.
    </p></li><li class="listitem "><p>
     Use different access rules based on time of day, day of the week, date,
     etc.
    </p></li><li class="listitem "><p>
     Use different rules for different user groups.
    </p></li></ul></div><p>
   squidGuard and Squid cannot be used to:
  </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
     Edit, filter, or censor text inside documents.
    </p></li><li class="listitem "><p>
     Edit, filter, or censor HTML-embedded script languages, such as
     JavaScript or VBscript.
    </p></li></ul></div><a id="idm140016703050688" class="indexterm"></a><a id="idm140016703049664" class="indexterm"></a><p>
   Before it can be used, install
   <code class="systemitem">squidGuard</code>. Provide a minimal
   configuration file as <code class="filename">/etc/squidguard.conf</code>. Find
   configuration examples in
   <a class="link" href="http://www.squidguard.org/Doc/examples.html" target="_blank">http://www.squidguard.org/Doc/examples.html</a>.
   Experiment later with more complicated configuration settings.
  </p><p>
   Next, create a dummy <span class="quote">“<span class="quote">access denied</span>”</span> page or a more or less
   complex CGI page to redirect Squid if the client requests a blacklisted
   Web site. Using Apache is strongly recommended.
  </p><p>
   Now, configure Squid to use squidGuard. Use the following entry in the
   <code class="filename">/etc/squid/squid.conf</code> file:
  </p><div class="verbatim-wrap"><pre class="screen">redirect_program /usr/bin/squidGuard</pre></div><p>
   Another option called <code class="systemitem">redirect_children</code>
   configures the number of <span class="quote">“<span class="quote">redirect</span>”</span> (in this case
   squidGuard) processes running on the machine. The more processes you set,
   the more RAM is required. Try low numbers first, for example
   <code class="literal">4</code>.
  </p><div class="verbatim-wrap"><pre class="screen">redirect_children 4</pre></div><p>
   Last, have Squid load the new configuration by running <code class="command">systemctl
   reload squid</code>. Now, test your settings with a browser.
  </p></div><div class="sect1 " id="sec.squid.calamaris"><div class="titlepage"><div><div><h2 class="title" id="sec.squid.calamaris"><span class="number">31.8 </span><span class="name">Cache Report Generation with Calamaris</span> <a title="Permalink" class="permalink" href="cha.squid.html#sec.squid.calamaris">#</a></h2></div></div></div><a id="idm140016703039152" class="indexterm"></a><a id="idm140016703038128" class="indexterm"></a><p>
   Calamaris is a Perl script used to generate reports of cache activity in
   ASCII or HTML format. It works with native Squid access log files. The
   Calamaris home page is located at
   <a class="link" href="http://Calamaris.Cord.de/" target="_blank">http://Calamaris.Cord.de/</a>. This tool does not belong
   to the <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> default installation scope—to use it,
   install the <code class="systemitem">calamaris</code> package.
  </p><p>
   Log in as <code class="systemitem">root</code> then enter
  </p><div class="verbatim-wrap"><pre class="screen">cat access1.log [access2.log access3.log] | calamaris <em class="replaceable ">options</em> &gt; reportfile</pre></div><p>
   When using more than one log file, make sure they are chronologically
   ordered, with older files listed first. This can be achieved by either
   listing the files one after the other as in the example above, or by using
   <code class="filename">access{1..3}.log</code>.
  </p><p>
   <code class="command">calamaris</code> takes the following options:
  </p><div class="variablelist "><dl class="variablelist"><dt id="idm140016703029696"><span class="term ">-a</span></dt><dd><p>
      output all available reports
     </p></dd><dt id="idm140016703027872"><span class="term ">-w</span></dt><dd><p>
      output as HTML report
     </p></dd><dt id="idm140016703026064"><span class="term ">-l</span></dt><dd><p>
      include a message or logo in report header
     </p></dd></dl></div><p>
   More information about the various options can be found in the program's
   manual page with
   <code class="command">man</code> <code class="option">calamaris</code>.
  </p><p>
   A typical example is:
  </p><div class="verbatim-wrap"><pre class="screen">cat access.log.{10..1} access.log | calamaris -a -w \ 
&gt; /usr/local/httpd/htdocs/Squid/squidreport.html</pre></div><p>
   This puts the report in the directory of the Web server. Apache is
   required to view the reports.
  </p></div><div class="sect1 " id="sec.squid.moreinfo"><div class="titlepage"><div><div><h2 class="title" id="sec.squid.moreinfo"><span class="number">31.9 </span><span class="name">For More Information</span> <a title="Permalink" class="permalink" href="cha.squid.html#sec.squid.moreinfo">#</a></h2></div></div></div><p>
   Visit the home page of Squid at
   <a class="link" href="http://www.squid-cache.org/" target="_blank">http://www.squid-cache.org/</a>. Here, find the
   <span class="quote">“<span class="quote">Squid User Guide</span>”</span> and a very extensive collection of FAQs
   on Squid.
  </p><p>
   Following the installation, a small HOWTO about transparent proxies is
   available in <code class="systemitem">howtoenh</code> as
   <code class="filename">/usr/share/doc/howto/en/txt/TransparentProxy.gz</code>. In
   addition, mailing lists are available for Squid at
   <a class="link" href="http://www.squid-cache.org/Support/mailing-lists.html" target="_blank">http://www.squid-cache.org/Support/mailing-lists.html</a>.
  </p></div></div></div><div class="page-bottom"><div id="_bottom-navigation"><a class="nav-link" href="cha.wbem.html"><span class="next-icon">→</span><span class="nav-label"><span class="number">Chapter 32 </span>Web Based Enterprise Management Using SFCB</span></a><a class="nav-link" href="cha.ftp.html"><span class="prev-icon">←</span><span class="nav-label"><span class="number">Chapter 30 </span>Setting up an FTP Server with YaST</span></a></div><div id="_share-print"><div class="online-contents share"><strong>Share this page: </strong><span class="share-buttons"><span id="_share-fb" class="bottom-button">Facebook</span><span class="spacer"> • </span><span id="_share-gp" class="bottom-button">Google+</span><span class="spacer"> • </span><span id="_share-tw" class="bottom-button">Twitter</span><span class="spacer"> • </span><span id="_share-mail" class="bottom-button">E-Mail</span></span></div><div class="print"><span id="_print-button" class="bottom-button">Print this page</span></div><div class="clearme"></div></div></div></div><div id="_inward"></div></div><div id="_footer-wrap"><div id="_footer"><p>©
        2018 
        SUSE</p><ul><li><a href="http://www.suse.com/company/careers/" target="_top">Careers</a></li><li><a href="http://www.suse.com/company/legal/" target="_top">Legal</a></li><li><a href="http://www.suse.com/company/" target="_top">About</a></li><li><a href="http://www.suse.com/ContactsOffices/contacts_offices.jsp" target="_top">Contact Us</a></li></ul></div></div></body></html>