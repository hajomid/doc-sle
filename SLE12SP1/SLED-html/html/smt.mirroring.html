<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang=""><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Mirroring Repositories on the SMT Server | Subscription Management Tool for SLES 12 SP1 | SUSE Linux Enterprise Desktop 12 SP1</title><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" /><link rel="stylesheet" type="text/css" href="static/css/style.css" /><link rel="stylesheet" type="text/css" href="static/css/highlight.css" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><meta name="product-name" content="SUSE Linux Enterprise Desktop" /><meta name="product-number" content="12 SP1" /><meta name="book-title" content="Subscription Management Tool for SLES 12 SP1" /><meta name="chapter-title" content="Chapter 3. Mirroring Repositories on the SMT Server" /><meta name="tracker-url" content="https://bugzilla.suse.com/enter_bug.cgi" /><meta name="tracker-type" content="bsc" /><meta name="tracker-bsc-assignee" content="taroth@suse.com" /><meta name="tracker-bsc-component" content="Documentation" /><meta name="tracker-bsc-product" content="SUSE Linux Enterprise Desktop 12 SP1 (SLED 12 SP1)" /><link rel="home" href="index.html" title="SUSE Linux Enterprise Desktop Documentation" /><link rel="up" href="index.html" title="Subscription Management Tool for SLES 12 SP1" /><link rel="prev" href="smt.server.html" title="Chapter 2. SMT Server Configuration" /><link rel="next" href="smt.management.html" title="Chapter 4. Managing Repositories with YaST SMT Server Management" /><script type="text/javascript">

var protocol = window.location.protocol.toLowerCase();
if ( protocol != 'file:' ) {
  var agent = navigator.userAgent.toLowerCase();
  var wanted = ( protocol == 'https:') ? 'https' : 'http';
  var file = 'fonts.css';
  document.write('<link rel="stylesheet" type="text/css" href="' + wanted + '://static.opensuse.org/fonts/'+ file +'"></link>');
}
else {
   document.write('<link rel="stylesheet" type="text/css" href="static/css/fonts-onlylocal.css"></link>');
}

</script><noscript><link rel="stylesheet" type="text/css" href="http://static.opensuse.org/fonts/fonts.css" /></noscript><script src="static/js/jquery-1.10.2.min.js" type="text/javascript"></script><script src="static/js/script.js" type="text/javascript"></script><script src="static/js/highlight.min.js" type="text/javascript"></script><script>

$(document).ready(function() {
  $('.verbatim-wrap.highlight').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});
hljs.configure({
  useBR: false
});

</script></head><body class="draft offline js-off"><div id="_outer-wrap"><div id="_white-bg"><div id="_header"><div id="_logo"><img src="static/images/logo.png" alt="Logo" /></div><div class="crumbs"><a class="book-link" href="index.html" title="SUSE Linux Enterprise Desktop Documentation"><span class="book-icon">SUSE Linux Enterprise Desktop Documentation</span></a><span> › </span><a class="crumb" href="index.html">SMT Guide</a><span> › </span><a class="crumb" href="smt.mirroring.html">Mirroring Repositories on the SMT Server</a></div><div class="clearme"></div></div></div><div id="_toolbar-wrap"><div id="_toolbar"><div id="_toc-area" class="inactive"><a id="_toc-area-button" class="tool" title="Contents" accesskey="c" href="index.html"><span class="tool-spacer"><span class="toc-icon">Contents</span><span class="clearme"></span></span><span class="tool-label">Contents</span></a><div class="active-contents bubble-corner"></div><div class="active-contents bubble"><div class="bubble-container"><h6>Subscription Management Tool for SLES 12 SP1</h6><div id="_bubble-toc"><ol><li class="inactive"><a href="pre_smt.html"><span class="number"> </span><span class="name">About This Guide</span></a></li><li class="inactive"><a href="smt.installation.html"><span class="number">1 </span><span class="name">SMT Installation</span></a></li><li class="inactive"><a href="smt.server.html"><span class="number">2 </span><span class="name">SMT Server Configuration</span></a></li><li class="inactive"><a href="smt.mirroring.html"><span class="number">3 </span><span class="name">Mirroring Repositories on the SMT Server</span></a></li><li class="inactive"><a href="smt.management.html"><span class="number">4 </span><span class="name">Managing Repositories with YaST SMT Server Management</span></a></li><li class="inactive"><a href="smt.registration.html"><span class="number">5 </span><span class="name">Managing Client Machines with SMT</span></a></li><li class="inactive"><a href="smt.reporting.html"><span class="number">6 </span><span class="name">SMT Reports</span></a></li><li class="inactive"><a href="smt.tools.html"><span class="number">7 </span><span class="name">SMT Tools and Configuration Files</span></a></li><li class="inactive"><a href="smt.client.html"><span class="number">8 </span><span class="name">Configuring Clients to Use SMT</span></a></li><li class="inactive"><a href="smt.backup.html"><span class="number">9 </span><span class="name">Backup of the SMT Server</span></a></li><li class="inactive"><a href="smt.app.api.html"><span class="number">A </span><span class="name">SMT REST API</span></a></li><li class="inactive"><a href="app.smt.docupdates.html"><span class="number">B </span><span class="name">Documentation Updates</span></a></li></ol></div><div class="clearme"></div></div></div></div><div id="_nav-area" class="inactive"><div class="tool"><span class="nav-inner"><span class="tool-label">Navigation</span><a accesskey="p" class="tool-spacer" title="Chapter 2. SMT Server Configuration" href="smt.server.html"><span class="prev-icon">←</span></a><a accesskey="n" class="tool-spacer" title="Chapter 4. Managing Repositories with YaST SMT Server Management" href="smt.management.html"><span class="next-icon">→</span></a></span></div></div></div></div><div id="_fixed-header-wrap" class="inactive"><div id="_fixed-header"><div class="crumbs"><a class="book-link" href="index.html" title="SUSE Linux Enterprise Desktop Documentation"><span class="book-icon">SUSE Linux Enterprise Desktop Documentation</span></a><span> › </span><a class="crumb" href="index.html">SMT Guide</a><span> › </span><a class="crumb" href="smt.mirroring.html">Mirroring Repositories on the SMT Server</a></div><div class="buttons"><a class="top-button button" href="#">Top</a><div class="button"><a accesskey="p" class="tool-spacer" title="Chapter 2. SMT Server Configuration" href="smt.server.html"><span class="prev-icon">←</span></a><a accesskey="n" class="tool-spacer" title="Chapter 4. Managing Repositories with YaST SMT Server Management" href="smt.management.html"><span class="next-icon">→</span></a></div><div class="clearme"></div></div><div class="clearme"></div></div></div><div id="_content" class="draft "><div class="documentation"><div class="chapter " id="smt.mirroring"><div class="titlepage"><div><div class="version-info">Applies to  <span class="productname"><span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span></span> <span class="productnumber"><span class="productnumber"><span class="phrase">12 SP1</span></span></span></div><div><h1 class="title"><span class="number">3 </span><span class="name">Mirroring Repositories on the SMT Server</span> </h1><div class="doc-status"><ul><li><span class="ds-label">Filename: </span>smt_mirroring.xml</li><li><span class="ds-label">ID: </span>smt.mirroring</li></ul></div></div></div></div><div class="line"><div class="toc"><dl><dt><span class="sect1"><a href="smt.mirroring.html#smt.mirroring.getcredentials"><span class="number">3.1 </span><span class="name">Mirroring Credentials</span></a></span></dt><dt><span class="sect1"><a href="smt.mirroring.html#smt.mirroring.manage"><span class="number">3.2 </span><span class="name">Managing Software Repositories with SMT Command Line Tools</span></a></span></dt><dt><span class="sect1"><a href="smt.mirroring.html#idm140318370255552"><span class="number">3.3 </span><span class="name">The /srv/www/htdocs Structure for SLE 11</span></a></span></dt><dt><span class="sect1"><a href="smt.mirroring.html#idm140318376975104"><span class="number">3.4 </span><span class="name">The /srv/www/htdocs Structure for SLE 12</span></a></span></dt><dt><span class="sect1"><a href="smt.mirroring.html#smt.mirroring.testenv"><span class="number">3.5 </span><span class="name">Using the Test Environment</span></a></span></dt><dt><span class="sect1"><a href="smt.mirroring.html#smt.staging"><span class="number">3.6 </span><span class="name">Testing and Filtering Update Repositories with Staging</span></a></span></dt></dl></div></div><p>
  On the SMT server you can mirror the installation and update
  repositories locally. This allows you to bypass per-machine downloads and
  the bandwidth use that goes with it.
 </p><div id="idm140318369279568" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.png" /><h6>Important: SUSE Linux Enterprise Server 9 Repositories</h6><p>
   As SUSE Linux Enterprise Server 9 is no longer supported, SMT does not mirror SUSE Linux Enterprise Server 9
   repositories.
  </p></div><div class="sect1 " id="smt.mirroring.getcredentials"><div class="titlepage"><div><div><h2 class="title" id="smt.mirroring.getcredentials"><span class="number">3.1 </span><span class="name">Mirroring Credentials</span> <a title="Permalink" class="permalink" href="smt.mirroring.html#smt.mirroring.getcredentials">#</a></h2></div></div></div><p>
   Before you create a local mirror of the repositories, you need
   appropriate organization credentials. You can get the credentials from
   SUSE Customer Center.
  </p><p>
   To get the credentials from SUSE Customer Center, follow these steps:
  </p><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
     Visit SUSE Customer Center at <a class="link" href="http://scc.suse.com" target="_blank">http://scc.suse.com</a> and log in.
    </p></li><li class="step "><p>
     If you are member of multiple organizations, chose the organization you want to work with
     from the drop-down box on the top right.
    </p></li><li class="step "><p>
     Click <span class="guimenu">Organization</span> in the top menu.
    </p></li><li class="step "><p>
     Click the <span class="guimenu">Organizational credentials</span> tab.
    </p></li><li class="step "><p>
     To show the password, click <span class="guimenu">Show password</span>.
    </p></li></ol></div></div><p> The obtained credentials should be set with the YaST SMT
      Server Configuration module or manually written to the
        <code class="filename">/etc/smt.conf</code> file. For more information
      about the <code class="filename">/etc/smt.conf</code> file, see <a class="xref" href="smt.tools.html#smt.config.smtconf" title="7.2.1. /etc/smt.conf">Section 7.2.1, “/etc/smt.conf”</a>.</p><div id="smt.mirror.credential.merge" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.png" /><h6>Tip: Merging Multiple Organization Site Credentials</h6><p> SMT can only work with one mirror credential at a time;
        multiple credentials are not supported. If a customer creates a
        new company, it results in a new mirror credential. This is not
        convenient as some products are available via the first set and
        other products via the second set. To request a merge of
        credentials, the customer is advised to send an e-mail to
          &lt;<a class="email" href="mailto:Customer_CenterEMEA@novell.com">Customer_CenterEMEA@novell.com</a>&gt; (for EMEA-based
        customers only—Europe, the Middle East and Africa) with
        the applicable customer and site IDs. The EMEA PIC team will
        verify the records. The contact for NALAAP is
          &lt;<a class="email" href="mailto:CustomerResolution@novell.com">CustomerResolution@novell.com</a>&gt; (North America,
        Latin America, and Asia Pacific). </p></div></div><div class="sect1 " id="smt.mirroring.manage"><div class="titlepage"><div><div><h2 class="title" id="smt.mirroring.manage"><span class="number">3.2 </span><span class="name">Managing Software Repositories with SMT Command Line Tools</span> <a title="Permalink" class="permalink" href="smt.mirroring.html#smt.mirroring.manage">#</a></h2></div></div></div><p>
   This section describes tools and procedures for viewing information about
   software repositories available through SMT, configuring these
   repositories and setting up custom repositories on the command line. For
   details on the YaST SMT Server Management module, see
   <a class="xref" href="smt.management.html" title="Chapter 4. Managing Repositories with YaST SMT Server Management">Chapter 4, <em>Managing Repositories with YaST SMT Server Management</em></a>.
  </p><div class="sect2 " id="idm140318369242608"><div class="titlepage"><div><div><h3 class="title" id="idm140318369242608"><span class="number">3.2.1 </span><span class="name">Updating the Local SMT database</span> <a title="Permalink" class="permalink" href="smt.mirroring.html#idm140318369242608">#</a></h3></div></div></div><p> The local SMT database needs to be updated periodic with the
        information downloaded from SUSE Customer Center. These periodical updates can
        be configured with the SMT Management module, as described in
          <a class="xref" href="smt.server.html#smt.yast.scheduling" title="2.5. Setting the SMT Job Schedule with YaST">Section 2.5, “Setting the SMT Job Schedule with YaST”</a>. </p><p>
    To update the SMT database manually, use the
    <code class="command">smt-sync</code> command. For more information about the
    <code class="command">smt-sync</code> command, see
    <a class="xref" href="smt.tools.html#smt.scripts.smtsync" title="7.1.2.7. smt-sync">Section 7.1.2.7, “smt-sync”</a>.
   </p></div><div class="sect2 " id="idm140318369238512"><div class="titlepage"><div><div><h3 class="title" id="idm140318369238512"><span class="number">3.2.2 </span><span class="name">Enabled Repositories and Repositories That Can Be
        Mirrored</span> <a title="Permalink" class="permalink" href="smt.mirroring.html#idm140318369238512">#</a></h3></div></div></div><p>
    The database installed with SMT contains information about all
    software repositories available on SUSE Customer Center. However, the used mirror
    credentials determine which repositories can really be mirrored. For
    more information about getting and setting organization credentials, see
    <a class="xref" href="smt.mirroring.html#smt.mirroring.getcredentials" title="3.1. Mirroring Credentials">Section 3.1, “Mirroring Credentials”</a>.
   </p><p> Repositories that can be mirrored have the
          <code class="literal">MIRRORABLE</code> flag set in the repositories
        table in the SMT database. The fact that a repository can be
        mirrored does not mean that it needs to be mirrored. Only
        repositories with the <code class="literal">DOMIRROR</code> flag set in
        the SMT database will be mirrored. For more information about
        configuring, which repositories should be mirrored, see <a class="xref" href="smt.mirroring.html#smt.mirroring.manage.domirror" title="3.2.4. Selecting Repositories to Be Mirrored">Section 3.2.4, “Selecting Repositories to Be Mirrored”</a>. </p></div><div class="sect2 " id="idm140318369234080"><div class="titlepage"><div><div><h3 class="title" id="idm140318369234080"><span class="number">3.2.3 </span><span class="name">Getting Information about Repositories</span> <a title="Permalink" class="permalink" href="smt.mirroring.html#idm140318369234080">#</a></h3></div></div></div><p>
    Use the <code class="command">smt-repos</code> command to list available software
    repositories and additional information. Using this command without any
    options lists all available repositories, including repositories that
    cannot be mirrored. In the first column, the enabled repositories
    (repositories set to be mirrored) are marked with
    <code class="literal">Yes</code>. Disabled repositories are marked with
    <code class="literal">No</code>. The other columns show ID, type, name, target,
    and description of the listed repositories. The last columns show
    whether the repository can be mirrored and staging is enabled.
   </p><p>
    Use the <code class="option">--verbose</code> option, to get additional information
    about the URL of the repository and the path it will be mirrored to.

   </p><p>
    The repository listing can be limited to only repositories that can be
    mirrored or to enabled repositories. To list only repositories that can
    be mirrored, use the <code class="option">-m</code> or
    <code class="option">--only-mirrorable</code> option: <code class="command">smt-repos
    -m</code>.
   </p><p>
    To list only enabled repositories, use the <code class="option">-o</code> or
    <code class="option">--only-enabled</code> option: <code class="command">smt-repos -o</code>
    (see <a class="xref" href="smt.mirroring.html#ex.smt.mirroring.repos.o" title="Listing All Enabled Repositories">Example 3.1, “Listing All Enabled Repositories”</a>).
   </p><div class="example" id="ex.smt.mirroring.repos.o"><div class="example-title-wrap"><h6 class="example-title"><span class="number">Example 3.1: </span><span class="name">Listing All Enabled Repositories </span><a title="Permalink" class="permalink" href="smt.mirroring.html#ex.smt.mirroring.repos.o">#</a></h6></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen">tux:~ # smt-repos -o
.---------------------------------------------------------------------------------------------------------------------.
| Mirr| ID | Type | Name                    | Target        | Description                             | Can be M| Stag|
+-----+----+------+-------------------------+---------------+-----------------------------------------+---------+-----+
| Yes |  1 | zypp | ATI-Driver-SLE11-SP2    | --            | ATI-Driver-SLE11-SP2                    | Yes     | Yes |
| Yes |  2 | zypp | nVidia-Driver-SLE11-SP2 | --            | nVidia-Driver-SLE11-SP2                 | Yes     | No  |
| Yes |  3 | nu   | SLED11-SP2-Updates      | sle-11-x86_64 | SLED11-SP2-Updates for sle-11-x86_64    | Yes     | No  |
| Yes |  4 | nu   | SLES11-SP1-Updates      | sle-11-x86_64 | SLES11-SP1-Updates for sle-11-x86_64    | Yes     | Yes |
| Yes |  5 | nu   | SLES11-SP2-Core         | sle-11-x86_64 | SLES11-SP2-Core for sle-11-x86_64       | Yes     | No  |
| Yes |  6 | nu   | SLES11-SP2-Updates      | sle-11-i586   | SLES11-SP2-Updates for sle-11-i586      | Yes     | No  |
| Yes |  7 | nu   | WebYaST-Testing-Updates | sle-11-i586   | WebYaST-Testing-Updates for sle-11-i586 | Yes     | No  |
'-----+----+------+-------------------------+---------------+-----------------------------------------+---------+-----'</pre></div></div></div><p>
    You can also list only repositories with a particular name or show
    information about a repository with a particular name and target. To
    list repositories with a particular name, use the
    <code class="command">smt-repos</code> <em class="replaceable ">repository_name</em>
    command. To show information about a repository with a particular name
    and target, use the <code class="command">smt-repos</code>
    <em class="replaceable ">repository_name</em>
    <em class="replaceable ">target</em> command.
   </p><p>
    To get a list of installation repositories from remote, see
    <a class="xref" href="smt.client.html#smt.clients.repolist" title="8.7. Listing Accessible Repositories">Section 8.7, “Listing Accessible Repositories”</a>.
   </p></div><div class="sect2 " id="smt.mirroring.manage.domirror"><div class="titlepage"><div><div><h3 class="title" id="smt.mirroring.manage.domirror"><span class="number">3.2.4 </span><span class="name">Selecting Repositories to Be Mirrored</span> <a title="Permalink" class="permalink" href="smt.mirroring.html#smt.mirroring.manage.domirror">#</a></h3></div></div></div><p>
    Only enabled repositories can be mirrored. In the database, the enabled
    repositories have the <code class="literal">DOMIRROR</code> flag set. Repositories
    can be enabled or disabled using the <code class="command">smt-repos</code>
    command.
   </p><p>
    To enable one or more repositories, follow these steps:
   </p><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
      If you want to enable all repositories that can be mirrored or just
      choose one repository from the list of all repositories, run the
      <code class="command">smt-repos -e</code> command.
     </p><p>
      You can limit the list of repositories by using the relevant
      options. To limit the list to only repositories that can be mirrored,
      use the <code class="option">-m</code> option: <code class="command">smt-repos -m
      -e</code>. To limit the list to only repositories with a particular
      name, use the <code class="command">smt-repos -e</code>
      <em class="replaceable ">repository_name</em> command. To list only a
      repository with a particular name and target, use the command
      <code class="command">smt-repos -e</code>
      <em class="replaceable ">repository_name</em>
      <em class="replaceable ">target</em>.
     </p><p>
      If you want to enable all repositories belonging to a certain product,
      use the <code class="option">--enable-by-prod</code> or <code class="option">-p</code>
      option followed by the name of the product and, optionally, its
      version, architecture, and release:
     </p><div class="verbatim-wrap"><pre class="screen">smt-repos -p <em class="replaceable ">product</em>[,<em class="replaceable ">version</em>[,<em class="replaceable ">architecture</em>[,<em class="replaceable ">release</em>]]]</pre></div><p>
      For example, to enable all repositories belonging to SUSE Linux Enterprise Server 10 SP3 for
      PowerPC architecture, use the <code class="command">smt-repos -p
      SUSE-Linux-Enterprise-Server-SP3,10,ppc</code> command. The list of
      known products can be obtained with the
      <code class="command">smt-list-products</code> command.
     </p></li><li class="step "><p>
      If more than one repository is listed, choose the one you want to
      enable by specifying its ID listed in the repository table and
      pressing <span class="keycap">Enter</span>. If you want to enable all the
      listed repositories, use <code class="literal">a</code> and press
      <span class="keycap">Enter</span>.
     </p></li></ol></div></div><p>
    To disable one or more repositories, follow these steps:
   </p><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
      If you want to disable all enabled repositories or just choose one
      repository from the list of all repositories, run the
      <code class="command">smt-repos -d</code> command.
     </p><p> If you want to choose the repository to be disabled from a
            shorter list, or if you want to disable all repositories
            from a limited group, you can use any of the available
            options to limit the list of repositories. To limit the list
            to only enabled repositories, use the <code class="option">-o</code>
            option: <code class="command">smt-repos -o -d</code>. To limit the
            list to only repositories with a particular name, use the
              <code class="command">smt-repos -d</code>
            <em class="replaceable ">repository_name</em> command. To list
            only a repository with a particular name and target, use the
              <code class="command">smt-repos -d</code>
            <em class="replaceable ">repository_name</em>
            <em class="replaceable ">target</em> command. </p></li><li class="step "><p>
      If more than one repository is listed, choose which one you want to
      disable by specifying its ID listed in the repository table shown and
      pressing <span class="keycap">Enter</span>. If you want to disable all the
      listed repositories, use <code class="literal">a</code> and press
      <span class="keycap">Enter</span>.
     </p></li></ol></div></div></div><div class="sect2 " id="idm140318372085120"><div class="titlepage"><div><div><h3 class="title" id="idm140318372085120"><span class="number">3.2.5 </span><span class="name">Deleting Mirrored Repositories</span> <a title="Permalink" class="permalink" href="smt.mirroring.html#idm140318372085120">#</a></h3></div></div></div><p>
    You can delete mirrored repositories that are no longer used. If you
    delete a repository, it will be physically removed from the SMT storage
    area.
   </p><p>
    To delete a repository with a particular name, use the
    <code class="command">smt-repos --delete</code> command. To delete the repository
    in a namespace, specify the <code class="option">--namespace
    <em class="replaceable ">dirname</em></code> option.
   </p><p>
    <code class="option">--delete</code> lists all repositories, and by entering the ID
    number or by entering the name and target you can delete the specified
    repositories. If you want to delete all repositories, enter
    <span class="guimenu">a</span>.
   </p><div id="idm140318353929376" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.png" /><h6>Note: Detecting Repository IDs</h6><p>
     Every repository has a sha1sum that you can use as an ID. You can get
     the repository's sha1sum by calling <code class="command">smt-repos -v</code>.
    </p></div></div><div class="sect2 " id="idm140318353927312"><div class="titlepage"><div><div><h3 class="title" id="idm140318353927312"><span class="number">3.2.6 </span><span class="name">Mirroring Custom Repositories</span> <a title="Permalink" class="permalink" href="smt.mirroring.html#idm140318353927312">#</a></h3></div></div></div><p>
    Using SMT you can also mirror repositories that are not available at
    the SUSE Customer Center. Those repositories are called <span class="quote">“<span class="quote">custom
    repositories</span>”</span>. Use the <code class="command">smt-setup-custom-repos</code>
    command for this purpose. Custom repositories can also be deleted.
   </p><p>
    When adding a new custom repository,
    <code class="command">smt-setup-custom-repos</code> adds a new record in the
    database, and sets the <span class="emphasis"><em>mirror</em></span> flag to
    <em class="replaceable ">true</em> by default. If needed, you can disable
    mirroring later.
   </p><p>
    To set up a custom repository to be available through SMT, follow
    these steps:
   </p><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
      If you do not know the ID of the product the new repositories should
      belong to, use <code class="command">smt-list-products</code> to get the ID. For
      the description of the <code class="command">smt-list-products</code>, see
      <a class="xref" href="smt.tools.html#smt.scripts.listproducts" title="7.1.2.4. smt-list-products">Section 7.1.2.4, “smt-list-products”</a>.
     </p></li><li class="step "><p>
      Run
     </p><div class="verbatim-wrap"><pre class="screen">smt-setup-custom-repos --productid <em class="replaceable ">product_id</em> \
--name <em class="replaceable ">repository_name</em> --exturl <em class="replaceable ">repository_url</em></pre></div><p>
      In this command <em class="replaceable ">product_id</em> is the ID of the
      product the repository belongs to,
      <em class="replaceable ">repository_name</em> represents the name of the
      repository and <em class="replaceable ">repository_url</em> is the URL
      the repository is available at. In case the added repository needs to
      be available for more than one product, specify the IDs of all
      products that should use the added repository.
     </p><p>
      For example, to set <code class="literal">My repository</code> available at
      <code class="literal">http://example.com/My_repository</code> to the products
      with the IDs <code class="literal">423</code>, <code class="literal">424</code>, and
      <code class="literal">425</code>, use the following command:
     </p><div class="verbatim-wrap"><pre class="screen">smt-setup-custom-repositories --productid 423 --productid 424 \
--productid 425 --name 'My_repository' \
--exturl 'http://example.com/My_repository'</pre></div></li></ol></div></div><div id="idm140318370259728" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.png" /><h6>Note: Mirroring Unsigned Repositories</h6><p>
     In its default configuration, SUSE Linux Enterprise 10 does not allow the use of
     unsigned repositories. Therefore, if you want to mirror unsigned
     repositories and use them on client machines, be aware that the package
     installation tool—YaST or <code class="command">zypper</code>—will
     ask you whether to use repositories that are not signed.
    </p></div><p>
    To remove an already-set custom repository from the SMT database, use
    <code class="command">smt-setup-custom-repositories --delete</code>
    <em class="replaceable ">ID</em>, where <em class="replaceable ">ID</em>
    represents the ID of the repository to be removed.
   </p></div></div><div class="sect1 " id="idm140318370255552"><div class="titlepage"><div><div><h2 class="title" id="idm140318370255552"><span class="number">3.3 </span><span class="name">The /srv/www/htdocs Structure for SLE 11</span> <a title="Permalink" class="permalink" href="smt.mirroring.html#idm140318370255552">#</a></h2></div></div></div><p> The path to the directory containing the mirror is set by the
        <code class="option">MirrorTo</code> option in the
        <code class="filename">/etc/smt.conf</code> configuration file. For more
      information about <code class="filename">/etc/smt.conf</code>, see <a class="xref" href="smt.tools.html#smt.config.smtconf" title="7.2.1. /etc/smt.conf">Section 7.2.1, “/etc/smt.conf”</a>. If the <code class="option">MirrorTo</code>
      option is not set to the Apache htdocs directory
        <code class="filename">/srv/www/htdocs/</code>, the following links need
      to be created. In case the directories already exist, they need to
      be removed prior to creating the link (the data from those
      directories will be lost!): </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
     <code class="filename">/srv/www/htdocs/repo/$RCE</code> should point to
     <code class="filename"><em class="replaceable ">/MirrorTo</em>/repo/$RCE/</code>
    </p></li><li class="listitem "><p>
     <code class="filename">/srv/www/htdocs/repo/RPMMD</code> to
     <code class="filename"><em class="replaceable ">/MirrorTo</em>/repo/RPMMD/</code>
    </p></li><li class="listitem "><p>
     <code class="filename">/srv/www/htdocs/repo/testing</code> to
     <code class="filename"><em class="replaceable ">/MirrorTo</em>/repo/testing/</code>
     and
    </p></li><li class="listitem "><p>
     <code class="filename">/srv/www/htdocs/repo/full</code> to
     <code class="filename"><em class="replaceable ">/MirrorTo</em>/repo/full/</code>
    </p></li></ul></div><p>
   The directory specified by the option <code class="option">MirrorTo</code> and the
   subdirectories listed above must exist. Files, directories and links in
   <em class="replaceable ">/MirrorTo</em> need to belong to the user <code class="systemitem">smt</code> and the group <code class="systemitem">www</code>.
  </p><p>
   For example, if the <code class="option">MirrorTo</code> is set to
   <code class="literal">/mirror/data</code>:
  </p><div class="verbatim-wrap"><pre class="screen">l /srv/www/htdocs/repo/
total 16
lrwxrwxrwx 1 smt  www    22 Feb  9 14:23 $RCE -&gt; /mirror/data/repo/$RCE/
drwxr-xr-x 4 smt  www  4096 Feb  9 14:23 ./
drwxr-xr-x 4 root root 4096 Feb  8 15:44 ../
lrwxrwxrwx 1 smt  www    23 Feb  9 14:23 RPMMD -&gt; /mirror/data/repo/RPMMD/
lrwxrwxrwx 1 smt  www    22 Feb  9 14:23 full -&gt; /mirror/data/repo/full/
drwxr-xr-x 2 smt  www  4096 Feb  8 11:12 keys/
lrwxrwxrwx 1 smt  www    25 Feb  9 14:23 testing -&gt; /mirror/data/repo/testing/
drwxr-xr-x 2 smt  www  4096 Feb  8 14:14 tools/</pre></div><p>
   The links can be created using the <code class="command">ln -s</code> commands. For
   example:
  </p><div class="verbatim-wrap"><pre class="screen">for LINK in \$RCE RPMMD full testing; do
ln -s /mirror/data/repo/${LINK}/ &amp;&amp; chown -h smt.www ${LINK}   
done</pre></div><div id="idm140318376977536" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.png" /><h6>Note: The <code class="filename">/srv/www/htdocs/repo</code> Directory</h6><p>
    The <code class="filename">/srv/www/htdocs/repo</code> directory must not be a
    symbolic link.
   </p></div></div><div class="sect1 " id="idm140318376975104"><div class="titlepage"><div><div><h2 class="title" id="idm140318376975104"><span class="number">3.4 </span><span class="name">The /srv/www/htdocs Structure for SLE 12</span> <a title="Permalink" class="permalink" href="smt.mirroring.html#idm140318376975104">#</a></h2></div></div></div><p>
   The repository structure in the <code class="filename">/srv/www/htdocs</code>
   directory matches the structure as it comes from SUSE Customer Center. There are the
   following directories in the structure (selected examples, similar for
   other products and architectures):
  </p><div class="verbatim-wrap"><pre class="screen">repo/SUSE/Products/SLE-SDK/12/x86_64/product/</pre></div><p> contains the -POOL repository of SDK (the GA version of all
      packages):</p><div class="verbatim-wrap"><pre class="screen">repo/SUSE/Products/SLE-SDK/12/x86_64/product.license/</pre></div><p> contains EULA associated with the product:</p><div class="verbatim-wrap"><pre class="screen">repo/SUSE/Updates/SLE-SDK/12/x86_64/update/
repo/SUSE/Updates/SLE-SDK/12/s390x/update/
repo/SUSE/Updates/SLE-SERVER/12/x86_64/update/</pre></div><p> contain update repositories for respective products:</p><div class="verbatim-wrap"><pre class="screen">repo/full/SUSE/Updates/SLE-SERVER/12/x86_64/update/
repo/testing/SUSE/Updates/SLE-SERVER/12/x86_64/update/</pre></div><p>
   contain repositories optionally created for staging of respective
   repositories.
  </p></div><div class="sect1 " id="smt.mirroring.testenv"><div class="titlepage"><div><div><h2 class="title" id="smt.mirroring.testenv"><span class="number">3.5 </span><span class="name">Using the Test Environment</span> <a title="Permalink" class="permalink" href="smt.mirroring.html#smt.mirroring.testenv">#</a></h2></div></div></div><p>
   You can mirror repositories to a test environment instead of the
   production environment. The test environment can be used with a limited
   number of client machines before the tested repositories are moved to the
   production environment. The test environment can be run on the main SMT
   server.
  </p><p>
   The testing environment uses the same structure as the production
   environment, but it is located in the
   <code class="filename">/srv/www/htdocs/repos/testing/</code> subdirectory.
  </p><p>
   To mirror a repository to the testing environment, you can use the
   <span class="guimenu">Staging</span> tab in the YaST SMT Management module, or
   the command <code class="command">smt-staging</code>.
  </p><p>
   To register a client in the testing environment, modify 
   <code class="filename">/etc/SUSEConnect</code> on the client machine by
   setting:
  </p><div class="verbatim-wrap"><pre class="screen">namespace: testing</pre></div><p>
   To move the testing environment to the production environment, manually
   copy or move it using the <code class="command">cp -a</code> or
   <code class="command">mv</code> command.
  </p><p>
   You can enable <span class="quote">“<span class="quote">staging</span>”</span> for a repository in the
   <span class="guimenu">Repositories</span> tab of the SMT Management module or
   with the <code class="command">smt-repos</code> command. The mirroring happens
   automatically to <code class="filename">repo/full/</code>.
  </p><p> If you have an SLE11-based Update repository with patches,
      SMT tools can help you with the management. With these tools you
      can select patches and create a snapshot and copy it into
        <code class="filename">repo/testing/</code>. After tests are finished you
      can copy the contents of <code class="filename">repo/testing</code> into
      the production area <code class="filename">/repo</code>. </p><p>
   SLE10-based Update repositories are not supported by SMT tools. Not all
   of these repositories support selective staging. In this case you must
   mirror the complete package.
  </p><p>
   Recommended work flow:
  </p><div class="verbatim-wrap"><pre class="screen">repo =&gt; repo/full,
repo/full =&gt; repo/testing,
repo/testing =&gt; repo</pre></div></div><div class="sect1 " id="smt.staging"><div class="titlepage"><div><div><h2 class="title" id="smt.staging"><span class="number">3.6 </span><span class="name">Testing and Filtering Update Repositories with Staging</span> <a title="Permalink" class="permalink" href="smt.mirroring.html#smt.staging">#</a></h2></div></div></div><p>
   You can test repositories on any clients with
   <code class="command">smt-staging</code> before moving them to the production
   environment. You can select new update repositories manually to be
   installed on clients.
  </p><p>
   For staging, you can either use the <code class="command">smt-staging</code>
   command, or use the YaST SMT Management module. For more details, see
   <a class="xref" href="smt.management.html#smt.yast.staging.stage" title="4.3. Staging Repositories">Section 4.3, “Staging Repositories”</a>.
  </p><p>
   Repositories with staging enabled are mirrored to the
   <code class="filename">/<em class="replaceable ">MirrorTo</em>/repo/full</code>
   subdirectory. This subdirectory is usually not used by your clients.
   Incoming new updates are not automatically visible to the clients before
   you get a chance to test them. Later you can generate a testing
   environment of this repository, which goes to
   <code class="filename">/<em class="replaceable ">MirrorTo</em>/repo</code> directory.
  </p><p> If you have an SLE 11-based update repository with patches,
      SMT tools can help you with the management. With these tools you
      can select patches and create a snapshot and put it into
        <code class="filename">repo/testing/</code>. After tests are finished you
      can put the content of <code class="filename">repo/testing</code> into the
      production area <code class="filename">/repo</code>.
        <code class="filename">repo/testing/</code> and
        <code class="filename">/repo</code> is called the <span class="quote">“<span class="quote">default</span>”</span>
      staging group. You can create additional staging groups as needed
      with the <code class="command">smt-staging creategroup</code> command.
      
    </p><div id="idm140318371307104" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.png" /><h6>Note: SLE 10-based Update Repositories</h6><p> SLE 10-based Update repositories are not supported by SMT
        tools. Not all of these repositories support selective staging.
        In this case you need to mirror the complete package. </p></div><div class="variablelist "><dl class="variablelist"><dt id="idm140318371305280"><span class="term ">Enabling Staging</span></dt><dd><p> To enable or disable staging, use the
              <code class="command">smt-repos</code> command with
              <code class="option">--enable-staging</code> or <code class="option">-s</code>: </p><div class="verbatim-wrap"><pre class="screen">smt-repos --enable-staging</pre></div><p>
      You can enable the required repositories by entering the ID number or
      by entering the name and target. If you want to enable all
      repositories enter <span class="guimenu">a</span>.
     </p></dd><dt id="idm140318371300592"><span class="term ">Generating Testing and Production Snapshots</span></dt><dd><p>
      To create the testing repository in the <span class="quote">“<span class="quote">default</span>”</span> staging
      group enter:
     </p><div class="verbatim-wrap"><pre class="screen">smt-staging createrepo <em class="replaceable ">Repository_ID</em> -–testing</pre></div><p> Now you can test the installation and functionality of the
            patches in testing clients. If no problems are discovered
            during testing, create the production repository by
            entering: </p><div class="verbatim-wrap"><pre class="screen">smt-staging createrepo <em class="replaceable ">Repository_ID</em> --production</pre></div><p>
      To create testing and production repositories in a named staging group
      first create the group and then the repositories in this group:
     </p><div class="verbatim-wrap"><pre class="screen">smt-staging creategroup <em class="replaceable ">Groupname</em> <em class="replaceable ">Testingdir</em> <em class="replaceable ">Productiondir</em>
smt-staging createrepo --group <em class="replaceable ">Groupname</em> <em class="replaceable ">Repository_ID</em> -–testing
smt-staging createrepo --group <em class="replaceable ">Groupname</em> <em class="replaceable ">Repository_ID</em> -–production</pre></div><p> This can help you if you, for example, want to combine
            SLES11-SP1-Updates and SLES11-SP2-Updates of the
              <code class="literal">sle-11-x86_64</code> architecture into one
            repository of a group: </p><div class="verbatim-wrap"><pre class="screen">smt-staging creategroup SLES11SP1-SP2-Up test-sp1-sp2 prod-sp1-sp2
smt-staging createrepo --group SLES11SP1-SP2-Up \
  SLES11-SP1-Updates sle-11-x86_64 --testing
smt-staging createrepo --group SLES11SP1-SP2-Up \
  SLES11-SP2-Updates sle-11-x86_64 --testing
smt-staging createrepo --group SLES11SP1-SP2-Up \
  SLES11-SP1-Updates sle-11-x86_64 --production
smt-staging createrepo --group SLES11SP1-SP2-Up \
  SLES11-SP2-Updates sle-11-x86_64 --production</pre></div><p>
      For group names, these characters are allowed: <code class="literal">-_</code>,
      <code class="literal">a-zA-Z</code>, and <code class="literal">0-9</code>.
     </p></dd></dl></div><div class="variablelist "><dl class="variablelist"><dt id="idm140318372548512"><span class="term ">Filtering Patches</span></dt><dd><p>
      You can allow or forbid all or selected patches with the
      <code class="command">allow</code> or <code class="command">forbid</code> commands by
      their ID or Category:
     </p><div class="verbatim-wrap"><pre class="screen">smt-staging forbid --patch <em class="replaceable ">ID</em>
smt-staging forbid --category <em class="replaceable ">Categoryname</em></pre></div></dd><dt id="idm140318372544528"><span class="term ">Signing Changed Repositories</span></dt><dd><p> If you filter one or more patches from a repository, the
            original signature becomes invalid. The repository needs to
            be signed again. The <code class="command">smt-staging
              createrepo</code> command takes care of that
            automatically if you configure the SMT server. </p><p>
      To enable signing of changed metadata, the admin needs to
      generate a new signing key. This can be done with GPG like this:
     </p><div class="verbatim-wrap"><pre class="screen">mkdir <em class="replaceable ">some_dir</em>
gpg --gen-key --homedir <em class="replaceable ">some_dir</em>
sudo mv <em class="replaceable ">some_dir</em> /var/lib/smt/.gnupg
sudo chown smt:users -R /var/lib/smt/.gnupg
sudo chmod go-rwx -R /var/lib/smt/.gnupg</pre></div><p> Then the ID of the newly generated key, as seen in the
              <code class="command">gpg --gen-key</code> command output, must be
            written into <code class="filename">/etc/smt.conf</code>, option
              <code class="option">signingKeyID</code>. </p><p>
      At this point the clients do not know about this new key. To
      import the new key to clients during their registration, the following
      can be done:
     </p><div class="verbatim-wrap"><pre class="screen">sudo -u smt gpg --homedir /var/lib/smt/.gnupg \
  --export -a <em class="replaceable ">signingKeyID</em> \
  &gt; /<em class="replaceable ">MirrorTo</em>/repo/keys/smt-signing-key.key</pre></div><p>
      In this example, <em class="replaceable ">MirrorTo</em> stands for the
      base directory where repositories will be mirrored. Once done, clients
      can import this key during the registration process.
     </p></dd><dt id="idm140318376379808"><span class="term ">Registering Clients in the Testing Environment</span></dt><dd><p>
      To register a client in the testing environment, modify the
      <code class="filename">/etc/SUSEConnect</code> on the client machine by
      setting:
     </p><div class="verbatim-wrap"><pre class="screen">namespace: testing</pre></div></dd></dl></div></div></div></div><div class="page-bottom"><div id="_bottom-navigation"><a class="nav-link" href="smt.management.html"><span class="next-icon">→</span><span class="nav-label"><span class="number">Chapter 4 </span>Managing Repositories with YaST SMT Server Management</span></a><a class="nav-link" href="smt.server.html"><span class="prev-icon">←</span><span class="nav-label"><span class="number">Chapter 2 </span>SMT Server Configuration</span></a></div><div id="_share-print"><div class="online-contents share"><strong>Share this page: </strong><span class="share-buttons"><span id="_share-fb" class="bottom-button">Facebook</span><span class="spacer"> • </span><span id="_share-gp" class="bottom-button">Google+</span><span class="spacer"> • </span><span id="_share-tw" class="bottom-button">Twitter</span><span class="spacer"> • </span><span id="_share-mail" class="bottom-button">E-Mail</span></span></div><div class="print"><span id="_print-button" class="bottom-button">Print this page</span></div><div class="clearme"></div></div></div></div><div id="_inward"></div></div><div id="_footer-wrap"><div id="_footer"><p>©
        2018 
        SUSE</p><ul><li><a href="http://www.suse.com/company/careers/" target="_top">Careers</a></li><li><a href="http://www.suse.com/company/legal/" target="_top">Legal</a></li><li><a href="http://www.suse.com/company/" target="_top">About</a></li><li><a href="http://www.suse.com/ContactsOffices/contacts_offices.jsp" target="_top">Contact Us</a></li></ul></div></div></body></html>