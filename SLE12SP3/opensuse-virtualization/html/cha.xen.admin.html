<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang=""><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Administrative Tasks | Virtualization Guide | openSUSE Leap 42.3</title><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" /><link rel="stylesheet" type="text/css" href="static/css/style.css" /><link rel="stylesheet" type="text/css" href="static/css/highlight.css" /><link rel="stylesheet" type="text/css" href="static/css/brand.css" /><meta name="generator" content="DAPS 2.4.0 using openSUSE XSL Stylesheets 2.0.8 (based on DocBook XSL Stylesheets 1.78.1) - chunked" /><meta name="product-name" content="openSUSE Leap" /><meta name="product-number" content="42.3" /><meta name="book-title" content="Virtualization Guide" /><meta name="chapter-title" content="Chapter 22. Administrative Tasks" /><meta name="tracker-url" content="https://bugzilla.opensuse.org/enter_bug.cgi" /><meta name="tracker-type" content="bsc" /><meta name="tracker-bsc-assignee" content="fs@suse.com" /><meta name="tracker-bsc-component" content="Documentation" /><meta name="tracker-bsc-product" content="openSUSE Distribution" /><meta name="tracker-bsc-version" content="Leap 42.2" /><link rel="home" href="index.html" title="openSUSE Leap Documentation" /><link rel="up" href="part.virt.xen.html" title="Part IV. Managing Virtual Machines with Xen" /><link rel="prev" href="cha.xen.config.html" title="Chapter 21. Virtualization: Configuration Options and Settings" /><link rel="next" href="cha.xen.xenstore.html" title="Chapter 23. XenStore: Configuration Database Shared between Domains" /><script type="text/javascript">

var protocol = window.location.protocol.toLowerCase();
if ( protocol != 'file:' ) {
  var agent = navigator.userAgent.toLowerCase();
  var wanted = ( protocol == 'https:') ? 'https' : 'http';
  var file = 'fonts.css';
  document.write('<link rel="stylesheet" type="text/css" href="' + wanted + '://static.opensuse.org/fonts/'+ file +'"></link>');
}
else {
   document.write('<link rel="stylesheet" type="text/css" href="static/css/fonts-onlylocal.css"></link>');
}

</script><noscript><link rel="stylesheet" type="text/css" href="http://static.opensuse.org/fonts/fonts.css" /></noscript><script src="static/js/jquery-1.10.2.min.js" type="text/javascript"></script><script src="static/js/script.js" type="text/javascript"></script><script src="static/js/highlight.min.js" type="text/javascript"></script><script>

$(document).ready(function() {
  $('.verbatim-wrap.highlight').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});
hljs.configure({
  useBR: false
});

</script></head><body class="draft offline js-off"><div id="_outer-wrap"><div id="_white-bg"><div id="_header"><div id="_logo"><img src="static/images/logo.png" alt="Logo" /></div><div class="crumbs"><a class="book-link" href="index.html" title="openSUSE Leap Documentation"><span class="book-icon">openSUSE Leap Documentation</span></a><span> › </span><a class="crumb" href="book.virt.html">Virtualization Guide</a><span> › </span><a class="crumb" href="part.virt.xen.html">Managing Virtual Machines with Xen</a><span> › </span><a class="crumb" href="cha.xen.admin.html">Administrative Tasks</a></div><div class="clearme"></div></div></div><div id="_toolbar-wrap"><div id="_toolbar"><div id="_toc-area" class="inactive"><a id="_toc-area-button" class="tool" title="Contents" accesskey="c" href="index.html"><span class="tool-spacer"><span class="toc-icon">Contents</span><span class="clearme"></span></span><span class="tool-label">Contents</span></a><div class="active-contents bubble-corner"></div><div class="active-contents bubble"><div class="bubble-container"><h6>Virtualization Guide</h6><div id="_bubble-toc"><ol><li class="inactive"><a href="cha.kvm.html"><span class="number"> </span><span class="name">About This Manual</span></a></li><li class="inactive"><a href="part.virt.intro.html"><span class="number">I </span><span class="name">Introduction</span></a><ol><li class="inactive"><a href="chap.virtualization.introduction.html"><span class="number">1 </span><span class="name">Virtualization Technology</span></a></li><li class="inactive"><a href="cha.xen.basics.html"><span class="number">2 </span><span class="name">Introduction to Xen Virtualization</span></a></li><li class="inactive"><a href="cha.kvm.intro.html"><span class="number">3 </span><span class="name">Introduction to KVM Virtualization</span></a></li><li class="inactive"><a href="cha.containers.intro.html"><span class="number">4 </span><span class="name">Introduction to Linux Containers</span></a></li><li class="inactive"><a href="cha.tools.intro.html"><span class="number">5 </span><span class="name">Virtualization Tools</span></a></li><li class="inactive"><a href="cha.vt.installation.html"><span class="number">6 </span><span class="name">Installation of Virtualization Components</span></a></li></ol></li><li class="inactive"><a href="part.virt.libvirt.html"><span class="number">II </span><span class="name">Managing Virtual Machines with <code class="systemitem">libvirt</code></span></a><ol><li class="inactive"><a href="cha.libvirt.overview.html"><span class="number">7 </span><span class="name">Starting and Stopping <code class="systemitem">libvirtd</code></span></a></li><li class="inactive"><a href="cha.kvm.inst.html"><span class="number">8 </span><span class="name">Guest Installation</span></a></li><li class="inactive"><a href="cha.libvirt.managing.html"><span class="number">9 </span><span class="name">Basic VM Guest Management</span></a></li><li class="inactive"><a href="cha.libvirt.connect.html"><span class="number">10 </span><span class="name">Connecting and Authorizing</span></a></li><li class="inactive"><a href="cha.libvirt.storage.html"><span class="number">11 </span><span class="name">Managing Storage</span></a></li><li class="inactive"><a href="cha.libvirt.networks.html"><span class="number">12 </span><span class="name">Managing Networks</span></a></li><li class="inactive"><a href="cha.libvirt.config.html"><span class="number">13 </span><span class="name">Configuring Virtual Machines</span></a></li></ol></li><li class="inactive"><a href="part.virt.common.html"><span class="number">III </span><span class="name">Hypervisor-Independent Features</span></a><ol><li class="inactive"><a href="cha.cachemodes.html"><span class="number">14 </span><span class="name">Disk Cache Modes</span></a></li><li class="inactive"><a href="sec.kvm.managing.clock.html"><span class="number">15 </span><span class="name">VM Guest Clock Settings</span></a></li><li class="inactive"><a href="chap.guestfs.html"><span class="number">16 </span><span class="name">libguestfs</span></a></li></ol></li><li class="inactive"><a href="part.virt.xen.html"><span class="number">IV </span><span class="name">Managing Virtual Machines with Xen</span></a><ol><li class="inactive"><a href="cha.xen.vhost.html"><span class="number">17 </span><span class="name">Setting Up a Virtual Machine Host</span></a></li><li class="inactive"><a href="cha.xen.network.html"><span class="number">18 </span><span class="name">Virtual Networking</span></a></li><li class="inactive"><a href="cha.xen.manage.html"><span class="number">19 </span><span class="name">Managing a Virtualization Environment</span></a></li><li class="inactive"><a href="cha.xen.vbd.html"><span class="number">20 </span><span class="name">Block Devices in Xen</span></a></li><li class="inactive"><a href="cha.xen.config.html"><span class="number">21 </span><span class="name">Virtualization: Configuration Options and Settings</span></a></li><li class="inactive"><a href="cha.xen.admin.html"><span class="number">22 </span><span class="name">Administrative Tasks</span></a></li><li class="inactive"><a href="cha.xen.xenstore.html"><span class="number">23 </span><span class="name">XenStore: Configuration Database Shared between Domains</span></a></li><li class="inactive"><a href="cha.xen.ha.html"><span class="number">24 </span><span class="name">Xen as a High-Availability Virtualization Host</span></a></li></ol></li><li class="inactive"><a href="part.virt.qemu.html"><span class="number">V </span><span class="name">Managing Virtual Machines with QEMU</span></a><ol><li class="inactive"><a href="cha.qemu.overview.html"><span class="number">25 </span><span class="name">QEMU Overview</span></a></li><li class="inactive"><a href="cha.qemu.host.html"><span class="number">26 </span><span class="name">Setting Up a KVM VM Host Server</span></a></li><li class="inactive"><a href="cha.qemu.guest_inst.html"><span class="number">27 </span><span class="name">Guest Installation</span></a></li><li class="inactive"><a href="cha.qemu.running.html"><span class="number">28 </span><span class="name">Running Virtual Machines with qemu-system-ARCH</span></a></li><li class="inactive"><a href="cha.qemu.monitor.html"><span class="number">29 </span><span class="name">Virtual Machine Administration Using QEMU Monitor</span></a></li></ol></li><li class="inactive"><a href="part.virt.lxc.html"><span class="number">VI </span><span class="name">Managing Virtual Machines with LXC</span></a><ol><li class="inactive"><a href="cha.lxc.html"><span class="number">30 </span><span class="name">Linux Containers</span></a></li><li class="inactive"><a href="cha.lxc2libvirt.html"><span class="number">31 </span><span class="name">Migration from LXC to <code class="systemitem">libvirt-lxc</code></span></a></li></ol></li><li class="inactive"><a href="gloss.vt.glossary.html"><span class="number"> </span><span class="name">Glossary</span></a></li><li class="inactive"><a href="app.kvm.html"><span class="number">A </span><span class="name">Appendix</span></a></li><li class="inactive"><a href="cha.xmtoxl.html"><span class="number">B </span><span class="name">XM, XL Toolstacks and Libvirt framework</span></a></li><li class="inactive"><a href="bk06apc.html"><span class="number">C </span><span class="name">GNU Licenses</span></a></li></ol></div><div class="clearme"></div></div></div></div><div id="_nav-area" class="inactive"><div class="tool"><span class="nav-inner"><span class="tool-label">Navigation</span><a accesskey="p" class="tool-spacer" title="Chapter 21. Virtualization: Configuration Options and Settings" href="cha.xen.config.html"><span class="prev-icon">←</span></a><a accesskey="n" class="tool-spacer" title="Chapter 23. XenStore: Configuration Database Shared between Domains" href="cha.xen.xenstore.html"><span class="next-icon">→</span></a></span></div></div></div></div><div id="_fixed-header-wrap" class="inactive"><div id="_fixed-header"><div class="crumbs"><a class="book-link" href="index.html" title="openSUSE Leap Documentation"><span class="book-icon">openSUSE Leap Documentation</span></a><span> › </span><a class="crumb" href="book.virt.html">Virtualization Guide</a><span> › </span><a class="crumb" href="part.virt.xen.html">Managing Virtual Machines with Xen</a><span> › </span><a class="crumb" href="cha.xen.admin.html">Administrative Tasks</a></div><div class="buttons"><a class="top-button button" href="#">Top</a><div class="button"><a accesskey="p" class="tool-spacer" title="Chapter 21. Virtualization: Configuration Options and Settings" href="cha.xen.config.html"><span class="prev-icon">←</span></a><a accesskey="n" class="tool-spacer" title="Chapter 23. XenStore: Configuration Database Shared between Domains" href="cha.xen.xenstore.html"><span class="next-icon">→</span></a></div><div class="clearme"></div></div><div class="clearme"></div></div></div><div id="_content" class="draft "><div class="documentation"><div class="chapter " id="cha.xen.admin"><div class="titlepage"><div><div class="version-info">Applies to  <span class="productname"><span class="productname"><span class="phrase">openSUSE Leap</span></span></span> <span class="productnumber"><span class="productnumber"><span class="phrase">42.3</span></span></span></div><div><h2 class="title"><span class="number">22 </span><span class="name">Administrative Tasks</span> </h2><div class="doc-status"><ul><li><span class="ds-label">Filename: </span>xen_administrating.xml</li><li><span class="ds-label">ID: </span>cha.xen.admin</li></ul></div></div></div></div><div class="line"><div class="toc"><dl><dt><span class="sect1"><a href="cha.xen.admin.html#sec.xen.config.bootloader"><span class="number">22.1 </span><span class="name">The Boot Loader Program</span></a></span></dt><dt><span class="sect1"><a href="cha.xen.admin.html#sec.xen.config.sparse"><span class="number">22.2 </span><span class="name">Sparse Image Files and Disk Space</span></a></span></dt><dt><span class="sect1"><a href="cha.xen.admin.html#sec.xen.manage.migrate"><span class="number">22.3 </span><span class="name">Migrating Xen VM Guest Systems</span></a></span></dt><dt><span class="sect1"><a href="cha.xen.admin.html#sec.xen.monitor"><span class="number">22.4 </span><span class="name">Monitoring Xen</span></a></span></dt><dt><span class="sect1"><a href="cha.xen.admin.html#sec.xen.admin.vhostmd"><span class="number">22.5 </span><span class="name">Providing Host Information for VM Guest Systems</span></a></span></dt></dl></div></div><div class="sect1 " id="sec.xen.config.bootloader"><div class="titlepage"><div><div><h2 class="title" id="sec.xen.config.bootloader"><span class="number">22.1 </span><span class="name">The Boot Loader Program</span> <a title="Permalink" class="permalink" href="cha.xen.admin.html#sec.xen.config.bootloader">#</a></h2></div></div></div><p>
   The boot loader controls how the virtualization software boots and runs.
   You can modify the boot loader properties by using YaST, or by
   directly editing the boot loader configuration file.
  </p><p>
   The YaST boot loader program is located at <span class="guimenu">YaST</span> › <span class="guimenu">System</span> › <span class="guimenu">Boot
   Loader</span>. Click the <span class="guimenu">Bootloader
   Options</span> tab and select the line containing the Xen kernel
   as the <span class="guimenu">Default Boot Section</span>.
  </p><div class="figure" id="idm139989022790400"><div class="figure-contents"><div class="mediaobject"><a xmlns="" href="images/xen_bootloader.png"><img src="images/xen_bootloader.png" width="" alt="Boot Loader Settings" /></a></div></div><div class="figure-title-wrap"><h6 class="figure-title"><span class="number">Figure 22.1: </span><span class="name">Boot Loader Settings </span><a title="Permalink" class="permalink" href="cha.xen.admin.html#idm139989022790400">#</a></h6></div></div><p>
   Confirm with <span class="guimenu">OK</span>. Next time you boot the host, it will
   be ready to provide the Xen virtualization environment.
  </p><p>
   You can use the Boot Loader program to specify functionality, such as:
  </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
     Pass kernel command line parameters.
    </p></li><li class="listitem "><p>
     Specify the kernel image and initial RAM disk.
    </p></li><li class="listitem "><p>
     Select a specific hypervisor.
    </p></li><li class="listitem "><p>
     Pass additional parameters to the hypervisor. See
     <a class="link" href="http://xenbits.xen.org/docs/unstable/misc/xen-command-line.html" target="_blank">http://xenbits.xen.org/docs/unstable/misc/xen-command-line.html</a>
     for their complete list.
    </p></li></ul></div><p>
   You can customize your virtualization environment by editing the
   <code class="filename">/etc/default/grub</code> file. Add the following line to
   this file:
   <code class="literal">GRUB_CMDLINE_XEN="&lt;boot_parameters&gt;"</code>. Do not
   forget to run <code class="command">grub2-mkconfig -o /boot/grub2/grub.cfg</code>
   after editing the file.
  </p></div><div class="sect1 " id="sec.xen.config.sparse"><div class="titlepage"><div><div><h2 class="title" id="sec.xen.config.sparse"><span class="number">22.2 </span><span class="name">Sparse Image Files and Disk Space</span> <a title="Permalink" class="permalink" href="cha.xen.admin.html#sec.xen.config.sparse">#</a></h2></div></div></div><p>
   If the host’s physical disk reaches a state where it has no available
   space, a virtual machine using a virtual disk based on a sparse image
   file cannot write to its disk. Consequently, it reports I/O errors.
  </p><p>
   If this situation
   occurs, you should free up available space on the physical disk, remount
   the virtual machine’s file system, and set the file system back to
   read-write.
  </p><p>
   To check the actual disk requirements of a sparse image file, use the
   command <code class="command">du -h &lt;image file&gt;</code>.
  </p><p>
   To increase the available space of a sparse image file, first increase
   the file size and then the file system.
  </p><div id="idm139989022772496" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.png" /><h6>Warning: Back Up Before Resizing</h6><p>
    Touching the sizes of partitions or sparse files always bears the risk
    of data failure. Do not work without a backup.
   </p></div><p>
   The resizing of the image file can be done online, while the VM Guest
   is running. Increase the size of a sparse image file with:
  </p><div class="verbatim-wrap"><pre class="screen">dd if=/dev/zero of=&lt;image file&gt; count=0 bs=1M seek=&lt;new size in MB&gt;</pre></div><p>
   For example, to increase the file
   <code class="filename">/var/lib/xen/images/sles/disk0</code> to a size of 16GB,
   use the command:
  </p><div class="verbatim-wrap"><pre class="screen">dd if=/dev/zero of=/var/lib/xen/images/sles/disk0 count=0 bs=1M seek=16000</pre></div><div id="idm139989022768480" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.png" /><h6>Note: Increasing Non-Sparse Images</h6><p>
    It is also possible to increase the image files of devices that are not
    sparse files. However, you must know exactly where the previous image
    ends. Use the seek parameter to point to the end of the image file and
    use a command similar to the following:
   </p><div class="verbatim-wrap"><pre class="screen">dd if=/dev/zero of=/var/lib/xen/images/sles/disk0 seek=8000 bs=1M count=2000</pre></div></div><p>
   Be sure to use the right seek, else data loss may happen.
  </p><p>
   If the VM Guest is running during the resize operation, also resize
   the loop device that provides the image file to the VM Guest. First
   detect the correct loop device with the command:
  </p><div class="verbatim-wrap"><pre class="screen">losetup -j /var/lib/xen/images/sles/disk0</pre></div><p>
   Then resize the loop device, for example <code class="filename">/dev/loop0</code>,
   with the following command:
  </p><div class="verbatim-wrap"><pre class="screen">losetup -c /dev/loop0</pre></div><p>
   Finally check the size of the block device inside the guest system with
   the command <code class="command">fdisk -l /dev/xvdb</code>. The device name
   depends on the actually increased device.
  </p><p>
   The resizing of the file system inside the sparse file involves tools that
   are depending on the actual file system. 
  </p></div><div class="sect1 " id="sec.xen.manage.migrate"><div class="titlepage"><div><div><h2 class="title" id="sec.xen.manage.migrate"><span class="number">22.3 </span><span class="name">Migrating Xen VM Guest Systems</span> <a title="Permalink" class="permalink" href="cha.xen.admin.html#sec.xen.manage.migrate">#</a></h2></div></div></div><p>
   With Xen it is possible to migrate a VM Guest system from one
   VM Host Server to another with almost no service interruption. This could be
   used for example to move a busy VM Guest to a VM Host Server that has
   stronger hardware or is not yet loaded. Or, if a service of a VM Host Server
   is required, all VM Guest systems running on this machine can be
   migrated to other machines to avoid interruption of service.
   These are only two examples—many more reasons may apply to your
   personal situation.
  </p><p>
   Before starting, some preliminary considerations regarding the
   VM Host Server should be taken into account:
  </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
     All VM Host Server systems should use a similar CPU. The frequency is not
     so important, but they should be using the same CPU family. To get more
     information about the used CPU, see <code class="command">cat
     /proc/cpuinfo</code>.
    </p></li><li class="listitem "><p>
     All resources that are used by a specific guest system must be
     available on all involved VM Host Server systems—for example all used block devices
     must exist on both VM Host Server systems.
    </p></li><li class="listitem "><p>
     If the hosts included in the migration process run in different subnets,
     make sure that either DHCP relay is available to the guests,
     or for guests with static network configuration, set up the network manually.
    </p></li><li class="listitem "><p>
     Using special features like <code class="literal">PCI Pass-Through</code> may be
     problematic. Do not implement these when deploying for an environment
     that should migrate VM Guest systems between different VM Host Server
     systems.
    </p></li><li class="listitem "><p>
     For fast migrations, a fast network is mandatory. If possible, use GB
     Ethernet and fast switches. Deploying VLAN might also help avoid
     collisions.
    </p></li></ul></div><div class="sect2 " id="sec.xen.manage.migrate.block"><div class="titlepage"><div><div><h3 class="title" id="sec.xen.manage.migrate.block"><span class="number">22.3.1 </span><span class="name">Preparing Block Devices for Migrations</span> <a title="Permalink" class="permalink" href="cha.xen.admin.html#sec.xen.manage.migrate.block">#</a></h3></div></div></div><p>
    The block devices needed by the VM Guest system must be available on
    all involved VM Host Server systems. This is done by implementing some kind
    of shared storage that serves as container for the root file system of
    the migrated VM Guest system. Common possibilities include:
   </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
      <code class="literal">iSCSI</code> can be set up to give access to the same block
      devices from different systems at the same time. 
     </p></li><li class="listitem "><p>
      <code class="literal">NFS</code> is a widely used root file system that can
      easily be accessed from different locations. For more information, see
      <span class="intraxref">Book “<em class="citetitle ">Reference</em>”, Chapter 22 “Sharing File Systems with NFS”</span>.
     </p></li><li class="listitem "><p>
      <code class="literal">DRBD</code> can be used if only two VM Host Server systems
      are involved. This gives some extra data security, because the used
      data is mirrored over the network. .
     </p></li><li class="listitem "><p>
      <code class="literal">SCSI</code> can also be used if the available hardware
      permits shared access to the same disks.
     </p></li><li class="listitem "><p>
      <code class="literal">NPIV</code> is a special mode to use Fibre channel disks.
      However, in this case all migration hosts must be attached to the same
      Fibre channel switch. For more information about NPIV, see
      <a class="xref" href="cha.xen.vbd.html#sec.xen.config.disk" title="20.1. Mapping Physical Storage to Virtual Disks">Section 20.1, “Mapping Physical Storage to Virtual Disks”</a>. Commonly, this works if the
      Fibre channel environment supports 4 Gbit or faster connections.
     </p></li></ul></div></div><div class="sect2 " id="sec.xen.manage.migrate.xl"><div class="titlepage"><div><div><h3 class="title" id="sec.xen.manage.migrate.xl"><span class="number">22.3.2 </span><span class="name">Migrating VM Guest Systems</span> <a title="Permalink" class="permalink" href="cha.xen.admin.html#sec.xen.manage.migrate.xl">#</a></h3></div></div></div><p>
    The actual migration of the VM Guest system is done with the
    command:
   </p><div class="verbatim-wrap"><pre class="screen">xl migrate &lt;domain_name&gt; &lt;host&gt;</pre></div><p>
    The speed of the migration depends on how fast the memory print can be
    saved to disk, sent to the new VM Host Server and loaded there. This means
    that small VM Guest systems can be migrated faster than big systems
    with a lot of memory.
   </p></div></div><div class="sect1 " id="sec.xen.monitor"><div class="titlepage"><div><div><h2 class="title" id="sec.xen.monitor"><span class="number">22.4 </span><span class="name">Monitoring Xen</span> <a title="Permalink" class="permalink" href="cha.xen.admin.html#sec.xen.monitor">#</a></h2></div></div></div><p>
   For a regular operation of many virtual guests, having a possibility to
   check the sanity of all the different VM Guest systems is
   indispensable. Xen offers several tools besides the system tools to
   gather information about the system.
  </p><div id="idm139989022734992" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.png" /><h6>Tip: Monitoring the VM Host Server</h6><p>
    Basic monitoring of the VM Host Server (I/O and CPU) is available via the
    Virtual Machine Manager. Refer to
    <a class="xref" href="cha.libvirt.managing.html#cha.libvirt.admin.monitor.virt-manager" title="9.8.1. Monitoring with Virtual Machine Manager">Section 9.8.1, “Monitoring with Virtual Machine Manager”</a> for details.
   </p></div><div class="sect2 " id="sec.xen.monitor.xentop"><div class="titlepage"><div><div><h3 class="title" id="sec.xen.monitor.xentop"><span class="number">22.4.1 </span><span class="name">Monitor Xen with <code class="command">xentop</code></span> <a title="Permalink" class="permalink" href="cha.xen.admin.html#sec.xen.monitor.xentop">#</a></h3></div></div></div><p>
    The preferred terminal application to gather information about Xen
    virtual environment is <code class="command">xentop</code>. Unfortunately, this
    tool needs a rather broad terminal, else it inserts line breaks into the
    display.
   </p><p>
    <code class="command">xentop</code> has several command keys that can give you
    more information about the system that is monitored. Some of the more
    important are:
   </p><div class="variablelist "><dl class="variablelist"><dt id="idm139989022729104"><span class="term ">D</span></dt><dd><p>
       Change the delay between the refreshes of the screen.
      </p></dd><dt id="idm139989022727264"><span class="term ">N</span></dt><dd><p>
       Also display network statistics. Note, that only standard
       configurations will be displayed. If you use a special configuration
       like a routed network, no network will be displayed.
      </p></dd><dt id="idm139989022725280"><span class="term ">B</span></dt><dd><p>
       Display the respective block devices and their cumulated usage count.
      </p></dd></dl></div><p>
    For more information about <code class="command">xentop</code> see the manual page
    <code class="command">man 1 xentop</code>.
   </p><div id="idm139989022721888" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.png" /><h6>Tip: <code class="command">virt-top</code></h6><p>
     libvirt offers the hypervisor-agnostic tool <code class="command">virt-top</code>,
     which is recommended for monitoring VM Guests. See <a class="xref" href="cha.libvirt.managing.html#cha.libvirt.admin.monitor.virt-top" title="9.8.2. Monitoring with virt-top">Section 9.8.2, “Monitoring with <code class="command">virt-top</code>”</a> for details.
    </p></div></div><div class="sect2 " id="sec.xen.monitor.tools"><div class="titlepage"><div><div><h3 class="title" id="sec.xen.monitor.tools"><span class="number">22.4.2 </span><span class="name">Additional Tools</span> <a title="Permalink" class="permalink" href="cha.xen.admin.html#sec.xen.monitor.tools">#</a></h3></div></div></div><p>
    There are many system tools that also help monitoring or debugging a
    running <span class="phrase">openSUSE</span> system. Many of these are covered in
    <span class="intraxref">Book “<em class="citetitle ">System Analysis and Tuning Guide</em>”, Chapter 2 “System Monitoring Utilities”</span>. Especially useful for monitoring a
    virtualization environment are the following tools:
   </p><div class="variablelist "><dl class="variablelist"><dt id="idm139989022715792"><span class="term ">ip</span></dt><dd><p>
       The command line utility <code class="command">ip</code> may be used to monitor
       arbitrary network interfaces. This is especially useful if you have
       set up a network that is routed or applied a masqueraded network. To
       monitor a network interface with the name
       <code class="literal">alice.0</code>, run the following command:
      </p><div class="verbatim-wrap"><pre class="screen">watch ip -s link show alice.0</pre></div></dd><dt id="idm139989022712400"><span class="term ">brctl</span></dt><dd><p>
       In a standard setup, all the Xen VM Guest systems are
       attached to a virtual network bridge. <code class="command">brctl</code> allows
       you to determine the connection between the bridge and the virtual
       network adapter in the VM Guest system. For example, the output
       of <code class="command">brctl show</code> may look like the following:
      </p><div class="verbatim-wrap"><pre class="screen">bridge name     bridge id               STP enabled     interfaces
br0             8000.000476f060cc       no              eth0
                                                        vif1.0
br1             8000.00001cb5a9e7       no              vlan22</pre></div><p>
       This shows that there are two virtual bridges defined on the system.
       One is connected to the physical Ethernet device
       <code class="literal">eth0</code>, the other one is connected to a VLAN
       interface <code class="literal">vlan22</code>.
      </p><p>
       There is only one guest interface active in this setup,
       <code class="literal">vif1.0</code>. This means that the guest with ID 1 has an
       Ethernet interface <code class="literal">eth0</code> assigned, that is
       connected to <code class="literal">br0</code> in the VM Host Server.
      </p></dd><dt id="idm139989022705328"><span class="term ">iptables-save</span></dt><dd><p>
       Especially when using masquerade networks, or if several Ethernet
       interfaces are set up together with a firewall setup, it may be
       helpful to check the current firewall rules.
      </p><p>
       The command <code class="command">iptables</code> may be used to check all the
       different firewall settings. To list all the rules of a chain, or
       even of the complete setup, you may use the commands
       <code class="command">iptables-save</code> or <code class="command">iptables -S</code>.
      </p></dd></dl></div></div></div><div class="sect1 " id="sec.xen.admin.vhostmd"><div class="titlepage"><div><div><h2 class="title" id="sec.xen.admin.vhostmd"><span class="number">22.5 </span><span class="name">Providing Host Information for VM Guest Systems</span> <a title="Permalink" class="permalink" href="cha.xen.admin.html#sec.xen.admin.vhostmd">#</a></h2></div></div></div><p>
   In a standard Xen environment, the VM Guest systems have only
   very limited information about the VM Host Server system they are running
   on. If a guest should know more about the VM Host Server it runs on,
   <code class="systemitem">vhostmd</code> can provide more information to selected
   guests. To set up your system to run <code class="systemitem">vhostmd</code>,
   proceed as follows:
  </p><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
     Install the package vhostmd on the VM Host Server.
    </p></li><li class="step "><p>
     To add or remove <code class="literal">metric</code> sections from the
     configuration, edit the file
     <code class="filename">/etc/vhostmd/vhostmd.conf</code>. However, the default works
     well.
    </p></li><li class="step "><p>
     Check the validity of the <code class="filename">vhostmd.conf</code>
     configuration file with the command:
    </p><div class="verbatim-wrap"><pre class="screen">cd /etc/vhostmd
xmllint --postvalid --noout vhostmd.conf</pre></div></li><li class="step "><p>
     Start the vhostmd daemon with the command <code class="command">sudo systemctl start
     vhostmd</code>.
    </p><p>
     If vhostmd should be started automatically during start-up of the
     system, run the command:
    </p><div class="verbatim-wrap"><pre class="screen">sudo systemctl enable vhostmd</pre></div></li><li class="step "><p>
     Attach the image file <code class="filename">/dev/shm/vhostmd0</code> to the
     VM Guest system named alice with the command:
    </p><div class="verbatim-wrap"><pre class="screen">xl block-attach opensuse /dev/shm/vhostmd0,,xvdb,ro</pre></div></li><li class="step "><p>
     Log on the VM Guest system.
    </p></li><li class="step "><p>
     Install the client package <code class="systemitem">vm-dump-metrics</code>.
    </p></li><li class="step "><p>
     Run the command <code class="command">vm-dump-metrics</code>. To save the result to
     a file, use the option <code class="systemitem">-d &lt;filename&gt;</code>.
    </p></li></ol></div></div><p>
   The result of the <code class="systemitem">vm-dump-metrics</code> is an XML
   output. The respective metric entries follow the DTD
   <code class="filename">/etc/vhostmd/metric.dtd</code>.
  </p><p>
   For more information, see the manual pages <code class="command">man 8
   vhostmd</code> and <code class="filename">/usr/share/doc/vhostmd/README</code>
   on the VM Host Server system. On the guest, see the manual page <code class="command">man
   1 vm-dump-metrics</code>.
  </p></div></div></div><div class="page-bottom"><div id="_bottom-navigation"><a class="nav-link" href="cha.xen.xenstore.html"><span class="next-icon">→</span><span class="nav-label"><span class="number">Chapter 23 </span>XenStore: Configuration Database Shared between Domains</span></a><a class="nav-link" href="cha.xen.config.html"><span class="prev-icon">←</span><span class="nav-label"><span class="number">Chapter 21 </span>Virtualization: Configuration Options and Settings</span></a></div><div id="_share-print"><div class="online-contents share"><strong>Share this page: </strong><span class="share-buttons"><span id="_share-fb" class="bottom-button">Facebook</span><span class="spacer"> • </span><span id="_share-gp" class="bottom-button">Google+</span><span class="spacer"> • </span><span id="_share-tw" class="bottom-button">Twitter</span></span></div><div class="print"><span id="_print-button" class="bottom-button">Print this page</span></div><div class="clearme"></div></div></div></div><div id="_inward"></div></div><div id="_footer-wrap"><div id="_footer"><p>©
        2018 
        SUSE</p></div></div></body></html>