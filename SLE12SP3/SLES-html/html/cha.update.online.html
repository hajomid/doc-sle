<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang=""><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Upgrading Online | Deployment Guide | SUSE Linux Enterprise Server 12 SP3</title><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" /><link rel="stylesheet" type="text/css" href="static/css/style.css" /><link rel="stylesheet" type="text/css" href="static/css/highlight.css" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><meta name="product-name" content="SUSE Linux Enterprise Server" /><meta name="product-number" content="12 SP3" /><meta name="book-title" content="Deployment Guide" /><meta name="chapter-title" content="Chapter 21. Upgrading Online" /><meta name="description" content="SUSE offers an intuitive graphical and a simple command line tool to upgrade a running system to a new service pack. They provide support for rollback of service packs and more. This chapter explains how to do a service pack upgrade step by step with these tools." /><meta name="tracker-url" content="https://bugzilla.suse.com/enter_bug.cgi" /><meta name="tracker-type" content="bsc" /><meta name="tracker-bsc-assignee" content="fs@suse.com" /><meta name="tracker-bsc-component" content="Documentation" /><meta name="tracker-bsc-product" content="SUSE Linux Enterprise Server 12 SP3" /><link rel="home" href="index.html" title="SUSE Linux Enterprise Server Documentation" /><link rel="up" href="part.update.html" title="Part VI. Updating and Upgrading SUSE Linux Enterprise" /><link rel="prev" href="cha.update.offline.html" title="Chapter 20. Upgrading Offline" /><link rel="next" href="cha.update.backporting.html" title="Chapter 22. Backporting Source Code" /><script type="text/javascript">

var protocol = window.location.protocol.toLowerCase();
if ( protocol != 'file:' ) {
  var agent = navigator.userAgent.toLowerCase();
  var wanted = ( protocol == 'https:') ? 'https' : 'http';
  var file = 'fonts.css';
  document.write('<link rel="stylesheet" type="text/css" href="' + wanted + '://static.opensuse.org/fonts/'+ file +'"></link>');
}
else {
   document.write('<link rel="stylesheet" type="text/css" href="static/css/fonts-onlylocal.css"></link>');
}

</script><noscript><link rel="stylesheet" type="text/css" href="http://static.opensuse.org/fonts/fonts.css" /></noscript><script src="static/js/jquery-1.10.2.min.js" type="text/javascript"></script><script src="static/js/script.js" type="text/javascript"></script><script src="static/js/highlight.min.js" type="text/javascript"></script><script>

$(document).ready(function() {
  $('.verbatim-wrap.highlight').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});
hljs.configure({
  useBR: false
});

</script></head><body class="draft offline js-off"><div id="_outer-wrap"><div id="_white-bg"><div id="_header"><div id="_logo"><img src="static/images/logo.png" alt="Logo" /></div><div class="crumbs"><a class="book-link" href="index.html" title="SUSE Linux Enterprise Server Documentation"><span class="book-icon">SUSE Linux Enterprise Server Documentation</span></a><span> › </span><a class="crumb" href="book.sle.deployment.html">Deployment Guide</a><span> › </span><a class="crumb" href="part.update.html">Updating and Upgrading SUSE Linux Enterprise</a><span> › </span><a class="crumb" href="cha.update.online.html">Upgrading Online</a></div><div class="clearme"></div></div></div><div id="_toolbar-wrap"><div id="_toolbar"><div id="_toc-area" class="inactive"><a id="_toc-area-button" class="tool" title="Contents" accesskey="c" href="index.html"><span class="tool-spacer"><span class="toc-icon">Contents</span><span class="clearme"></span></span><span class="tool-label">Contents</span></a><div class="active-contents bubble-corner"></div><div class="active-contents bubble"><div class="bubble-container"><h6>Deployment Guide</h6><div id="_bubble-toc"><ol><li class="inactive"><a href="preface.deployment.html"><span class="number"> </span><span class="name">About This Guide</span></a></li><li class="inactive"><a href="cha.planning.html"><span class="number">1 </span><span class="name">Planning for <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span></span></a></li><li class="inactive"><a href="part.prep.html"><span class="number">I </span><span class="name">Installation Preparation</span></a><ol><li class="inactive"><a href="cha.x86.html"><span class="number">2 </span><span class="name">Installation on AMD64 and Intel 64</span></a></li><li class="inactive"><a href="cha.power.html"><span class="number">3 </span><span class="name">Installation on IBM POWER</span></a></li><li class="inactive"><a href="cha.zseries.html"><span class="number">4 </span><span class="name">Installation on IBM z Systems</span></a></li><li class="inactive"><a href="cha.aarch64.html"><span class="number">5 </span><span class="name">Installation on ARM AArch64</span></a></li></ol></li><li class="inactive"><a href="part.mandeploy.html"><span class="number">II </span><span class="name">The Installation Workflow</span></a><ol><li class="inactive"><a href="cha.inst.html"><span class="number">6 </span><span class="name">Installation with YaST</span></a></li><li class="inactive"><a href="cha.deployment.clone_image.html"><span class="number">7 </span><span class="name">Cloning Disk Images</span></a></li></ol></li><li class="inactive"><a href="part.installserver.html"><span class="number">III </span><span class="name">Setting Up an Installation Server</span></a><ol><li class="inactive"><a href="cha.deployment.instserver.html"><span class="number">8 </span><span class="name">Setting Up the Server Holding the Installation Sources</span></a></li><li class="inactive"><a href="cha.deployment.prep_boot.html"><span class="number">9 </span><span class="name">Preparing the Boot of the Target System</span></a></li></ol></li><li class="inactive"><a href="part.remoteinstall.html"><span class="number">IV </span><span class="name">Remote Installation</span></a><ol><li class="inactive"><a href="cha.deployment.remoteinst.html"><span class="number">10 </span><span class="name">Remote Installation</span></a></li></ol></li><li class="inactive"><a href="part.sysconfig.html"><span class="number">V </span><span class="name">Initial System Configuration</span></a><ol><li class="inactive"><a href="cha.y2.hw.html"><span class="number">11 </span><span class="name">Setting Up Hardware Components with YaST</span></a></li><li class="inactive"><a href="cha.advdisk.html"><span class="number">12 </span><span class="name">Advanced Disk Setup</span></a></li><li class="inactive"><a href="cha.y2.sw.html"><span class="number">13 </span><span class="name">Installing or Removing Software</span></a></li><li class="inactive"><a href="cha.add-ons.html"><span class="number">14 </span><span class="name">Installing Modules, Extensions, and Third Party Add-On Products</span></a></li><li class="inactive"><a href="cha.tuning.multikernel.html"><span class="number">15 </span><span class="name">Installing Multiple Kernel Versions</span></a></li><li class="inactive"><a href="cha.y2.userman.html"><span class="number">16 </span><span class="name">Managing Users with YaST</span></a></li><li class="inactive"><a href="cha.y2.lang.html"><span class="number">17 </span><span class="name">Changing Language and Country Settings with YaST</span></a></li></ol></li><li class="inactive"><a href="part.update.html"><span class="number">VI </span><span class="name">Updating and Upgrading SUSE Linux Enterprise</span></a><ol><li class="inactive"><a href="cha.update.background.html"><span class="number">18 </span><span class="name">Life Cycle and Support</span></a></li><li class="inactive"><a href="cha.update.sle.html"><span class="number">19 </span><span class="name">Upgrading SUSE Linux Enterprise</span></a></li><li class="inactive"><a href="cha.update.offline.html"><span class="number">20 </span><span class="name">Upgrading Offline</span></a></li><li class="inactive"><a href="cha.update.online.html"><span class="number">21 </span><span class="name">Upgrading Online</span></a></li><li class="inactive"><a href="cha.update.backporting.html"><span class="number">22 </span><span class="name">Backporting Source Code</span></a></li></ol></li><li class="inactive"><a href="app.deployment.docupdates.html"><span class="number">A </span><span class="name">Documentation Updates</span></a></li><li class="inactive"><a href="bk02apb.html"><span class="number">B </span><span class="name">GNU Licenses</span></a></li></ol></div><div class="clearme"></div></div></div></div><div id="_nav-area" class="inactive"><div class="tool"><span class="nav-inner"><span class="tool-label">Navigation</span><a accesskey="p" class="tool-spacer" title="Chapter 20. Upgrading Offline" href="cha.update.offline.html"><span class="prev-icon">←</span></a><a accesskey="n" class="tool-spacer" title="Chapter 22. Backporting Source Code" href="cha.update.backporting.html"><span class="next-icon">→</span></a></span></div></div></div></div><div id="_fixed-header-wrap" class="inactive"><div id="_fixed-header"><div class="crumbs"><a class="book-link" href="index.html" title="SUSE Linux Enterprise Server Documentation"><span class="book-icon">SUSE Linux Enterprise Server Documentation</span></a><span> › </span><a class="crumb" href="book.sle.deployment.html">Deployment Guide</a><span> › </span><a class="crumb" href="part.update.html">Updating and Upgrading SUSE Linux Enterprise</a><span> › </span><a class="crumb" href="cha.update.online.html">Upgrading Online</a></div><div class="buttons"><a class="top-button button" href="#">Top</a><div class="button"><a accesskey="p" class="tool-spacer" title="Chapter 20. Upgrading Offline" href="cha.update.offline.html"><span class="prev-icon">←</span></a><a accesskey="n" class="tool-spacer" title="Chapter 22. Backporting Source Code" href="cha.update.backporting.html"><span class="next-icon">→</span></a></div><div class="clearme"></div></div><div class="clearme"></div></div></div><div id="_content" class="draft "><div class="documentation"><div class="chapter " id="cha.update.online"><div class="titlepage"><div><div class="version-info">Applies to  <span class="productname"><span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span></span> <span class="productnumber"><span class="productnumber"><span class="phrase">12 SP3</span></span></span></div><div><h2 class="title"><span class="number">21 </span><span class="name">Upgrading Online</span> </h2><div class="doc-status"><ul><li><span class="ds-label">Filename: </span>sle_update_online.xml</li><li><span class="ds-label">ID: </span>cha.update.online</li></ul></div></div><div><div class="abstract"><div class="abstract-title-wrap"><h6 class="abstract-title">Abstract<a title="Permalink" class="permalink" href="cha.update.online.html#idm139668998814960">#</a></h6></div><p>
    SUSE offers an intuitive graphical and a simple command line tool to
    upgrade a running system to a new service pack. They provide support
    for <span class="quote">“<span class="quote">rollback</span>”</span> of service packs and more. This chapter
    explains how to do a service pack upgrade step by step with these tools.
   </p></div></div></div></div><div class="line"><div class="toc"><dl><dt><span class="sect1"><a href="cha.update.online.html#sec.update.migr.conceptual-overview"><span class="number">21.1 </span><span class="name">Conceptual Overview</span></a></span></dt><dt><span class="sect1"><a href="cha.update.online.html#sec.update.migr.workflow"><span class="number">21.2 </span><span class="name">Service Pack Migration Workflow</span></a></span></dt><dt><span class="sect1"><a href="cha.update.online.html#sec.update.migr.cancel.spm"><span class="number">21.3 </span><span class="name">Canceling Service Pack Migration</span></a></span></dt><dt><span class="sect1"><a href="cha.update.online.html#sec.update.migr.yast.onlinemigr"><span class="number">21.4 </span><span class="name">Upgrading with the Online Migration Tool (YaST)</span></a></span></dt><dt><span class="sect1"><a href="cha.update.online.html#sec.update.migr.zypper.onlinemigr"><span class="number">21.5 </span><span class="name">Upgrading with Zypper</span></a></span></dt><dt><span class="sect1"><a href="cha.update.online.html#sec.update.migr.plainzypper.onlinemigr"><span class="number">21.6 </span><span class="name">Upgrading with Plain Zypper</span></a></span></dt><dt><span class="sect1"><a href="cha.update.online.html#sec.update.migr.rollback"><span class="number">21.7 </span><span class="name">Rolling Back a Service Pack</span></a></span></dt></dl></div></div><div class="sect1 " id="sec.update.migr.conceptual-overview"><div class="titlepage"><div><div><h2 class="title" id="sec.update.migr.conceptual-overview"><span class="number">21.1 </span><span class="name">Conceptual Overview</span> <a title="Permalink" class="permalink" href="cha.update.online.html#sec.update.migr.conceptual-overview">#</a></h2></div></div></div><p>
   SUSE releases new service packs for the SUSE Linux Enterprise family at regular intervals.
   To make it easy for customers to migrate to a new service pack and minimize
   downtime, SUSE supports migrating online while the system is running.
  </p><p>
   Starting with SLE 12, YaST Wagon has been replaced by
   YaST migration (GUI) and Zypper migration (command line). The following
   features are supported:
  </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
     System always in a defined state until the first RPM is updated
    </p></li><li class="listitem "><p>
     Canceling is possible until the first RPM is updated
    </p></li><li class="listitem "><p>
     Simple recovery, if there is an error
    </p></li><li class="listitem "><p>
     <span class="quote">“<span class="quote">Rollback</span>”</span> via system tools; no backup/restore needed
    </p></li><li class="listitem "><p>
     Use of all active repositories
    </p></li><li class="listitem "><p>
     The ability to skip a service pack
    </p></li></ul></div></div><div class="sect1 " id="sec.update.migr.workflow"><div class="titlepage"><div><div><h2 class="title" id="sec.update.migr.workflow"><span class="number">21.2 </span><span class="name">Service Pack Migration Workflow</span> <a title="Permalink" class="permalink" href="cha.update.online.html#sec.update.migr.workflow">#</a></h2></div></div></div><p>
   A service pack migration can be executed by either YaST,
   <code class="command">zypper</code>, or AutoYaST.
  </p><p>
   Before you can start a service pack migration, your system must be
   registered at the SUSE Customer Center or a local SMT server.  SUSE Manager can
   also be used.
  </p><p>
   Regardless of the method, a service pack migration consists of the following
   steps:
  </p><div class="orderedlist "><ol class="orderedlist" type="1"><li class="listitem "><p>
     Find possible migration targets on your registered systems.
    </p></li><li class="listitem "><p>
     Select one migration target.
    </p></li><li class="listitem "><p>
     Request and enable new repositories.
    </p></li><li class="listitem "><p>
     Run the migration.
    </p></li></ol></div><p>
   The list of migration targets depends on the products you have installed and
   registered. If you have an extension installed for which the new SP is not
   yet available, it could be that no migration target is offered to you.
  </p><p>
   The list of migration targets available for your host will always be
   retrieved from the SUSE Customer Center and depend on products or extensions installed.
  </p></div><div class="sect1 " id="sec.update.migr.cancel.spm"><div class="titlepage"><div><div><h2 class="title" id="sec.update.migr.cancel.spm"><span class="number">21.3 </span><span class="name">Canceling Service Pack Migration</span> <a title="Permalink" class="permalink" href="cha.update.online.html#sec.update.migr.cancel.spm">#</a></h2></div></div></div><p>
   A service pack migration can only be cancelled at specific stages during the
   migration process:
  </p><div class="orderedlist "><ol class="orderedlist" type="1"><li class="listitem "><p>
     Until the package upgrade starts, there are only minimal changes on the
     system, like for services and repositories. Restore
     <code class="filename">/etc/zypp/repos.d/*</code> to revert to the former state.
    </p></li><li class="listitem "><p>
     After the package upgrade starts, you can revert to the former state by
     using a Snapper snapshot (see <a class="xref" href="cha.snapper.html" title="Chapter 7. System Recovery and Snapshot Management with Snapper">Chapter 7, <em>System Recovery and Snapshot Management with Snapper</em></a>).
    </p></li><li class="listitem "><p>
     After the migration target was selected, SUSE Customer Center changes the repository
     data. To revert this state manually, use <code class="command">SUSEConnect</code>
     <code class="option">--rollback</code>.
    </p></li></ol></div></div><div class="sect1 " id="sec.update.migr.yast.onlinemigr"><div class="titlepage"><div><div><h2 class="title" id="sec.update.migr.yast.onlinemigr"><span class="number">21.4 </span><span class="name">Upgrading with the Online Migration Tool (YaST)</span> <a title="Permalink" class="permalink" href="cha.update.online.html#sec.update.migr.yast.onlinemigr">#</a></h2></div></div></div><p>
   To perform a service pack migration with YaST, use the <span class="guimenu">Online
   Migration</span> tool. By default, YaST does not install any packages
   from a third-party repository. If a package was installed from a third-party
   repository, YaST prevents packages from being replaced with the same
   package coming from SUSE.
  </p><div id="idm139668998785408" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.png" /><h6>Note: Reduce Installation Size</h6><p>
    When performing the SP migration, YaST will install all recommended
    packages. Especially in the case of custom minimal installations, this may
    increase the installation size of the system significantly.
   </p><p>
    To change this default behavior and allow only required packages, adjust
    <code class="filename">/etc/zypp/zypp.conf</code> and set the following variable:
   </p><div class="verbatim-wrap"><pre class="screen">solver.onlyRequires = true
installRecommends=false # or commented</pre></div></div><p>
   This changes the behavior of all package operations, such as the
   installation of patches or new packages.
  </p><p>
   To start the service pack migration, do the following:
  </p><div class="procedure " id="pro.update.migr.yast"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
     Deactivate all unused extensions on your registration server to avoid
     future dependency conflicts. In case you forget an extension, YaST
     will later detect unused extension repositories and deactivate them.
    </p></li><li class="step "><p>
     If you are logged in to a GNOME session running on the machine you are
     going to update, switch to a text console. Running the update from within
     a GNOME session is not recommended. Note that this does not apply when
     being logged in from a remote machine (unless you are running a VNC
     session with GNOME).
    </p></li><li class="step "><p>
     If you are an LTSS subscriber, make sure that the LTSS extension repository
     is active.
    </p></li><li class="step "><p>
     Run YaST online update to get the latest package updates for your
     system.
    </p></li><li class="step "><p>
     Install the package
     <span class="package">yast2-migration</span>
     and its dependencies (in YaST under <span class="guimenu">Software</span> › <span class="guimenu">Software Management</span>).
    </p></li><li class="step "><p>
     Restart YaST, otherwise the newly installed module will not be shown in
     the control center.
    </p></li><li class="step "><p>
     In YaST, choose <span class="guimenu">Online Migration</span> (depending on the
     version of <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> that you are upgrading from, this module is
     categorized under either <span class="guimenu">System</span> or
     <span class="guimenu">Software</span>). YaST will show possible migration
     targets and a summary. If more than one migration target is available
     for your system, select one from the list.
    </p></li><li class="step "><p>
     Select one migration target from the list and proceed with
     <span class="guimenu">Next</span>.
    </p></li><li class="step "><p>
     In case the migration tool offers update repositories, it is recommended
     to proceed with <span class="guimenu">Yes</span>.
    </p></li><li class="step "><p>
     
     If the Online Migration tool finds obsolete repositories coming from DVD
     or a local server, it is highly recommended to disable them. Obsolete
     repositories are from a previous SP. Any old repositories from SCC or SMT
     are removed automatically.
    </p></li><li class="step "><p>
     Check the summary and proceed with the migration by clicking
     <span class="guimenu">Next</span>. Confirm with <span class="guimenu">Start Update</span>.
    </p></li><li class="step "><p>
     After the successful migration restart your system.
    </p></li></ol></div></div></div><div class="sect1 " id="sec.update.migr.zypper.onlinemigr"><div class="titlepage"><div><div><h2 class="title" id="sec.update.migr.zypper.onlinemigr"><span class="number">21.5 </span><span class="name">Upgrading with Zypper</span> <a title="Permalink" class="permalink" href="cha.update.online.html#sec.update.migr.zypper.onlinemigr">#</a></h2></div></div></div><p>
   To perform a service pack migration with Zypper, use the command line tool
   <code class="command">zypper</code> <code class="option">migration</code> from the package
   <span class="package">zypper-migration-plugin</span>.
  </p><div id="idm139668998757984" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.png" /><h6>Note: Reduce Installation Size</h6><p>
    When performing the SP migration, YaST will install all recommended
    packages. Especially in the case of custom minimal installations, this may
    increase the installation size of the system significantly.
   </p><p>
    To change this default behavior and allow only required packages, adjust
    <code class="filename">/etc/zypp/zypp.conf</code> and set the following variable:
   </p><div class="verbatim-wrap"><pre class="screen">solver.onlyRequires = true
installRecommends=false # or commented</pre></div></div><p>
   This changes the behavior of all package operations, such as the
   installation of patches or new packages. To change the behavior of Zypper
   for a single invocation, add the parameter <code class="option">--no-recommends</code>
   to your command line.
  </p><p>
   To start the service pack migration, do the following:
  </p><div class="procedure " id="pro.update.migr.zypper"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
     If you are logged in to a GNOME session running on the machine you are
     going to update, switch to a text console. Running the update from within
     a GNOME session is not recommended. Note that this does not apply when
     being logged in from a remote machine (unless you are running a VNC
     session with GNOME).
    </p></li><li class="step "><p>
     Register your SUSE Linux Enterprise machine if you have not done so:
    </p><div class="verbatim-wrap"><pre class="screen">sudo <code class="command">SUSEConnect</code> --regcode <em class="replaceable ">YOUR_REGISTRATION_CODE</em></pre></div></li><li class="step "><p>
     If you are an LTSS subscriber, make sure that the LTSS extension
     repository is active.
    </p></li><li class="step "><p>
     Install the latest updates:
    </p><div class="verbatim-wrap"><pre class="screen">sudo <code class="command">zypper</code> patch</pre></div></li><li class="step "><p>
     Install the <span class="package">zypper-migration-plugin</span> package and
     its dependencies:
    </p><div class="verbatim-wrap"><pre class="screen">sudo <code class="command">zypper</code> in zypper-migration-plugin</pre></div></li><li class="step "><p>
     Run <code class="command">zypper</code> <code class="option">migration</code>:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code>sudo <code class="command">zypper</code> migration
Executing 'zypper  patch-check'

Refreshing service 'SUSE_Linux_Enterprise_Server_12_x86_64'.
Loading repository data...
Reading installed packages...
0 patches needed (0 security patches)

Available migrations:

    1 | SUSE Linux Enterprise Server 12 SP1 x86_64
    2 | SUSE Linux Enterprise Server 12 SP2 x86_64</pre></div><p>
     Some notes about the migration process:
    </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
       If more than one migration target is available for your system, Zypper
       allows you to select one SP from the list. This is the same as skipping
       one or more SPs. Keep in mind, online migration for base
       products (SLES, SLED) remains available only between the SPs of a
       major version.
      </p></li><li class="listitem "><p>
       By default, Zypper uses the option
       <code class="option">--no-allow-vendor-change</code> which is passed to
       <code class="command">zypper</code> <code class="option">dup</code>. If a package was
       installed from a third-party repository, this option prevents packages
       from being replaced with the same package coming from SUSE.
      </p></li><li class="listitem "><p>
       
       If Zypper finds obsolete repositories coming from DVD or a local server,
       it is highly recommended to disable them. Old SCC or SMT repositories
       are removed automatically.
      </p></li></ul></div></li><li class="step "><p>
     Review all the changes, especially the packages that are going to be
     removed. Proceed by typing <code class="literal">y</code> (the exact number of
     packages to upgrade can vary on your system):
    </p><div class="verbatim-wrap"><pre class="screen">266 packages to upgrade, 54 to downgrade, 17 new, 8 to reinstall, 5 to remove, 1 to change arch.
Overall download size: 285.1 MiB. Already cached: 0 B  After the operation, additional 139.8 MiB will be used.
Continue? [y/n/? shows all options] (y):</pre></div><p>
     Use the <span class="keycap">Shift</span><span class="key-connector">–</span><span class="keycap">Page ↑</span> or <span class="keycap">Shift</span><span class="key-connector">–</span><span class="keycap">Page ↓</span> keys to scroll in your shell.
    </p></li><li class="step "><p>
     After successful migration restart your system.
    </p></li></ol></div></div></div><div class="sect1 " id="sec.update.migr.plainzypper.onlinemigr"><div class="titlepage"><div><div><h2 class="title" id="sec.update.migr.plainzypper.onlinemigr"><span class="number">21.6 </span><span class="name">Upgrading with Plain Zypper</span> <a title="Permalink" class="permalink" href="cha.update.online.html#sec.update.migr.plainzypper.onlinemigr">#</a></h2></div></div></div><p>
   If you cannot use YaST migration or the Zypper migration, you can still
   migrate with plain Zypper and some manual interactions. To start a service
   pack migration, do the following:
  </p><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
     If you are logged in to a GNOME session running on the machine you are
     going to update, switch to a text console. Running the update from within
     a GNOME session is not recommended. Note that this does not apply when
     being logged in from a remote machine (unless you are running a VNC
     session with GNOME).
    </p></li><li class="step "><p>
     Update the package management tools with the old SUSE Linux Enterprise repositories:
    </p><div class="verbatim-wrap"><pre class="screen">sudo <code class="command">zypper</code> patch --updatestack-only</pre></div></li><li class="step "><p>
     If the system is registered, it needs to be deregistered:
    </p><div class="verbatim-wrap"><pre class="screen">sudo <code class="command">SUSEConnect</code> --de-register</pre></div></li><li class="step "><p>
     Remove the old installation sources and repositories and adjust the
     third-party repositories.
    </p></li><li class="step "><p>
     Add the new installation sources, be it local or remote sources (for the
     placeholder <em class="replaceable ">REPOSITORY</em>, refer to
     <a class="xref" href="cha.update.background.html#sec.update.nmm.repositories" title="18.6. Repository Model">Section 18.6, “Repository Model”</a>):
    </p><div class="verbatim-wrap"><pre class="screen">sudo <code class="command">zypper</code> addrepo <em class="replaceable ">REPOSITORY</em></pre></div><p>
     You can also use SUSE Customer Center or Subscription Management Tool. The command for SUSE Linux Enterprise 12 SP1 on x86-64
     is:
    </p><div class="verbatim-wrap"><pre class="screen">sudo <code class="command">SUSEConnect</code> -p SLES/12.2/x86_64 <em class="replaceable ">OPTIONS</em></pre></div><p>
     Keep in mind, cross-architecture upgrades are not supported.
    </p><p>
     Zypper will display a conflict between the old and new kernel. Choose
     Solution 1 to continue.
    </p><div class="verbatim-wrap"><pre class="screen">Problem: product:SLES-12.2-0.x86_64 conflicts with kernel &lt; 4.4 provided by kernel-default-<em class="replaceable ">VERSION</em>
 Solution 1: Following actions will be done:
  replacement of kernel-default-<em class="replaceable ">VERSION</em> with kernel-default-<em class="replaceable ">VERSION</em>
  deinstallation of kernel-default-<em class="replaceable ">VERSION</em>
 Solution 2: do not install product:SLES-12.2-0.x86_64</pre></div></li><li class="step "><p>
     Finalize the migration:
    </p><div class="verbatim-wrap"><pre class="screen">sudo <code class="command">zypper</code> ref -f -s
sudo <code class="command">zypper</code> dup --no-allow-vendor-change --no-recommends</pre></div><p>
     The first command will update all services and repositories. The second
     command performs a distribution upgrade. Here, the last two options are
     important: <code class="option">-no-allow-vendor-change</code> ensures that
     third-party RPMs will not overwrite RPMs from the base system. The option
     <code class="option">--no-recommends</code> ensures that packages deselected during
     initial installation will not be added again.
    </p></li></ol></div></div></div><div class="sect1 " id="sec.update.migr.rollback"><div class="titlepage"><div><div><h2 class="title" id="sec.update.migr.rollback"><span class="number">21.7 </span><span class="name">Rolling Back a Service Pack</span> <a title="Permalink" class="permalink" href="cha.update.online.html#sec.update.migr.rollback">#</a></h2></div></div></div><p>
   If a service pack does not work for you, SUSE Linux Enterprise supports reverting the system
   to the state before the service pack migration was started. Prerequisite is
   a Btrfs root partition with snapshots enabled (this is the default when
   installing SLES 12). See <a class="xref" href="cha.snapper.html" title="Chapter 7. System Recovery and Snapshot Management with Snapper">Chapter 7, <em>System Recovery and Snapshot Management with Snapper</em></a> for details.
  </p><div class="procedure " id="pro.update.migr.rollback"><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
     Get a list of all Snapper snapshots:
    </p><div class="verbatim-wrap"><pre class="screen">sudo snapper list</pre></div><p>
     Review the output to locate the snapshot that was created immediately
     before the service pack migration was started. The column
     <span class="guimenu">Description</span> contains a corresponding statement and the
     snapshot is marked as <code class="literal">important</code> in the column
     <span class="guimenu">Userdata</span>. Memorize the snapshot number from the column
     <span class="guimenu">#</span> and its date from the column
     <span class="guimenu">Date</span>.
    </p></li><li class="step "><p>
     Reboot the system. From the boot menu, select <span class="guimenu">Start boot loader
     from a read-only snapshot</span> and then choose the snapshot with the
     date and number you memorized in the previous step. A second boot menu
     (the one from the snapshot) is loaded. Select the entry starting with
     <code class="literal">SLES 12</code> and boot it.
    </p></li><li class="step "><p>
     The system boots into the previous state with the system partition mounted
     read-only. Log in as <code class="systemitem">root</code> and check whether you have chosen the
     correct snapshot. Also make sure everything works as expected. Note that
     since the root file system is mounted read-only, restrictions
     in functionality may apply.
    </p><p>
     In case of problems or if you have booted the wrong snapshot, reboot
     and choose a different snapshot to boot from—up to this point no
     permanent changes have been made. If the snapshot is correct and works as
     expected, make the change permanent by running the following command:
    </p><div class="verbatim-wrap"><pre class="screen">snapper rollback</pre></div><p>
     Reboot afterward. On the boot screen, choose the default boot entry to
     reboot into the reinstated system.
    </p></li><li class="step "><p>
     Check if the repository configuration has been properly
     reset. Furthermore, check if all products are properly registered. If
     either one is not the case, updating the system at a later point in time
     may no longer work, or the system may be updated using the wrong package
     repositories.
    </p><p>
     Make sure the system can access the Internet before starting
     this procedure.
    </p><ol type="a" class="substeps "><li class="step "><p>
       Refresh services and repositories by running
      </p><div class="verbatim-wrap"><pre class="screen">sudo zypper ref -fs</pre></div></li><li class="step "><p>
       Get a list of active repositories by running
      </p><div class="verbatim-wrap"><pre class="screen">sudo zypper lr</pre></div><p>
       Carefully check the output of this command. No services and repositories
       that were added for the update should be listed. If you, for example,
       are rolling back from a service pack migration from SLES 12 SP1 to
       SLES 12 SP2, the list must <span class="emphasis"><em>not</em></span> contain the
       repositories <code class="literal">SLES12-SP2-Pool</code> and
       <code class="literal">SLES12-SP2-Updates</code>, but rather the
       <code class="literal">SP1</code> versions.
      </p><p>
       If wrong repositories are listed, delete them and, if
       necessary, replace them with the versions matching your product or
       service pack version. For a list of repositories for the supported
       migration paths refer to <a class="xref" href="cha.update.background.html#sec.update.nmm.repositories" title="18.6. Repository Model">Section 18.6, “Repository Model”</a>.
      </p></li><li class="step "><p>
       Last, check the registration status for all products installed by
       running
      </p><div class="verbatim-wrap"><pre class="screen">SUSEConnect --status</pre></div><p>
       All products should be reported as being
       <code class="literal">Registered</code>. If this is not the case, repair the
       registration by running
      </p><div class="verbatim-wrap"><pre class="screen">SUSEConnect --rollback</pre></div></li></ol></li></ol></div></div><p>
   Now you have successfully reverted the system to the state that was captured
   immediately before the service pack migration was started.
  </p></div></div></div><div class="page-bottom"><div id="_bottom-navigation"><a class="nav-link" href="cha.update.backporting.html"><span class="next-icon">→</span><span class="nav-label"><span class="number">Chapter 22 </span>Backporting Source Code</span></a><a class="nav-link" href="cha.update.offline.html"><span class="prev-icon">←</span><span class="nav-label"><span class="number">Chapter 20 </span>Upgrading Offline</span></a></div><div id="_share-print"><div class="online-contents share"><strong>Share this page: </strong><span class="share-buttons"><span id="_share-fb" class="bottom-button">Facebook</span><span class="spacer"> • </span><span id="_share-gp" class="bottom-button">Google+</span><span class="spacer"> • </span><span id="_share-tw" class="bottom-button">Twitter</span><span class="spacer"> • </span><span id="_share-mail" class="bottom-button">E-Mail</span></span></div><div class="print"><span id="_print-button" class="bottom-button">Print this page</span></div><div class="clearme"></div></div></div></div><div id="_inward"></div></div><div id="_footer-wrap"><div id="_footer"><p>©
        2018 
        SUSE</p><ul><li><a href="http://www.suse.com/company/careers/" target="_top">Careers</a></li><li><a href="http://www.suse.com/company/legal/" target="_top">Legal</a></li><li><a href="http://www.suse.com/company/" target="_top">About</a></li><li><a href="http://www.suse.com/ContactsOffices/contacts_offices.jsp" target="_top">Contact Us</a></li></ul></div></div></body></html>