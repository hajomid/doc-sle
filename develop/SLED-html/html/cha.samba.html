<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang=""><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Samba | Administration Guide | SUSE Linux Enterprise Desktop 15</title><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" /><link rel="stylesheet" type="text/css" href="static/css/style.css" /><link rel="stylesheet" type="text/css" href="static/css/highlight.css" /><meta name="generator" content="DAPS 2.4.0 using SUSE XSL Stylesheets 2.0.8 (based on DocBook XSL Stylesheets 1.78.1) - chunked" /><meta name="product-name" content="SUSE Linux Enterprise Desktop" /><meta name="product-number" content="15" /><meta name="book-title" content="Administration Guide" /><meta name="chapter-title" content="Chapter 30. Samba" /><meta name="description" content="Using Samba, a Unix machine can be configured as a file and print server for macOS, Windows, and OS/2 machines. Samba has developed into a fully-fledged and rather complex product. Configure Samba with YaST, or by editing the configuration file manually." /><meta name="tracker-url" content="https://bugzilla.suse.com/enter_bug.cgi" /><meta name="tracker-type" content="bsc" /><meta name="tracker-bsc-assignee" content="fs@suse.com" /><meta name="tracker-bsc-component" content="Documentation" /><meta name="tracker-bsc-product" content="Beta SUSE Linux Enterprise Desktop 15" /><link rel="home" href="index.html" title="SUSE Linux Enterprise Desktop Documentation" /><link rel="up" href="part.services.html" title="Part IV. Services" /><link rel="prev" href="cha.nfs.html" title="Chapter 29. Sharing File Systems with NFS" /><link rel="next" href="cha.autofs.html" title="Chapter 31. On-Demand Mounting with Autofs" /><script type="text/javascript">

var protocol = window.location.protocol.toLowerCase();
if ( protocol != 'file:' ) {
  var agent = navigator.userAgent.toLowerCase();
  var wanted = ( protocol == 'https:') ? 'https' : 'http';
  var file = 'fonts.css';
  document.write('<link rel="stylesheet" type="text/css" href="' + wanted + '://static.opensuse.org/fonts/'+ file +'"></link>');
}
else {
   document.write('<link rel="stylesheet" type="text/css" href="static/css/fonts-onlylocal.css"></link>');
}

</script><noscript><link rel="stylesheet" type="text/css" href="http://static.opensuse.org/fonts/fonts.css" /></noscript><script src="static/js/jquery-1.10.2.min.js" type="text/javascript"></script><script src="static/js/script.js" type="text/javascript"></script><script src="static/js/highlight.min.js" type="text/javascript"></script><script>

$(document).ready(function() {
  $('.verbatim-wrap.highlight').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});
hljs.configure({
  useBR: false
});

</script></head><body class="draft offline js-off"><div id="_outer-wrap"><div id="_white-bg"><div id="_header"><div id="_logo"><img src="static/images/logo.png" alt="Logo" /></div><div class="crumbs"><a class="book-link" href="index.html" title="SUSE Linux Enterprise Desktop Documentation"><span class="book-icon">SUSE Linux Enterprise Desktop Documentation</span></a><span> › </span><a class="crumb" href="book.sle.admin.html">Administration Guide</a><span> › </span><a class="crumb" href="part.services.html">Services</a><span> › </span><a class="crumb" href="cha.samba.html">Samba</a></div><div class="clearme"></div></div></div><div id="_toolbar-wrap"><div id="_toolbar"><div id="_toc-area" class="inactive"><a id="_toc-area-button" class="tool" title="Contents" accesskey="c" href="index.html"><span class="tool-spacer"><span class="toc-icon">Contents</span><span class="clearme"></span></span><span class="tool-label">Contents</span></a><div class="active-contents bubble-corner"></div><div class="active-contents bubble"><div class="bubble-container"><h6>Administration Guide</h6><div id="_bubble-toc"><ol><li class="inactive"><a href="pre.sle.html"><span class="number"> </span><span class="name">About This Guide</span></a></li><li class="inactive"><a href="part.administration.html"><span class="number">I </span><span class="name">Common Tasks</span></a><ol><li class="inactive"><a href="cha.adm.shell.html"><span class="number">1 </span><span class="name">Bash and Bash Scripts</span></a></li><li class="inactive"><a href="cha.adm.sudo.html"><span class="number">2 </span><span class="name">sudo
</span></a></li><li class="inactive"><a href="cha.onlineupdate.you.html"><span class="number">3 </span><span class="name">YaST Online Update</span></a></li><li class="inactive"><a href="cha.yast.gui.html"><span class="number">4 </span><span class="name">YaST</span></a></li><li class="inactive"><a href="cha.yast.text.html"><span class="number">5 </span><span class="name">YaST in Text Mode</span></a></li><li class="inactive"><a href="cha.sw_cl.html"><span class="number">6 </span><span class="name">Managing Software with Command Line Tools</span></a></li><li class="inactive"><a href="cha.snapper.html"><span class="number">7 </span><span class="name">System Recovery and Snapshot Management with Snapper</span></a></li><li class="inactive"><a href="cha.vnc.html"><span class="number">8 </span><span class="name">Remote Access with VNC</span></a></li><li class="inactive"><a href="cha.net.rsync.html"><span class="number">9 </span><span class="name">File Copying with RSync</span></a></li><li class="inactive"><a href="cha.gnome.gconf.html"><span class="number">10 </span><span class="name">GNOME Configuration for Administrators</span></a></li></ol></li><li class="inactive"><a href="part.boot.html"><span class="number">II </span><span class="name">Booting a Linux System</span></a><ol><li class="inactive"><a href="cha.boot.html"><span class="number">11 </span><span class="name">Introduction to the Booting Process</span></a></li><li class="inactive"><a href="cha.uefi.html"><span class="number">12 </span><span class="name">UEFI (Unified Extensible Firmware Interface)</span></a></li><li class="inactive"><a href="cha.grub2.html"><span class="number">13 </span><span class="name">The Boot Loader GRUB 2</span></a></li><li class="inactive"><a href="cha.systemd.html"><span class="number">14 </span><span class="name">The <code class="systemitem">systemd</code> Daemon</span></a></li></ol></li><li class="inactive"><a href="part.system.html"><span class="number">III </span><span class="name">System</span></a><ol><li class="inactive"><a href="cha.64bit.html"><span class="number">15 </span><span class="name">32-Bit and 64-Bit Applications in a 64-Bit System Environment</span></a></li><li class="inactive"><a href="cha.journalctl.html"><span class="number">16 </span><span class="name"><code class="command">journalctl</code>: Query the <code class="systemitem">systemd</code> Journal</span></a></li><li class="inactive"><a href="cha.update-alternative.html"><span class="number">17 </span><span class="name"><code class="command">update-alternatives</code>: Managing Multiple Versions of Commands and Files</span></a></li><li class="inactive"><a href="cha.network.html"><span class="number">18 </span><span class="name">Basic Networking</span></a></li><li class="inactive"><a href="cha.print.html"><span class="number">19 </span><span class="name">Printer Operation</span></a></li><li class="inactive"><a href="cha.x11.html"><span class="number">20 </span><span class="name">The X Window System</span></a></li><li class="inactive"><a href="cha.fuse.html"><span class="number">21 </span><span class="name">Accessing File Systems with FUSE</span></a></li><li class="inactive"><a href="cha.mod.html"><span class="number">22 </span><span class="name">Managing Kernel Modules</span></a></li><li class="inactive"><a href="cha.udev.html"><span class="number">23 </span><span class="name">Dynamic Kernel Device Management with <code class="systemitem">udev</code></span></a></li><li class="inactive"><a href="cha.kgraft.html"><span class="number">24 </span><span class="name">Live Patching the Linux Kernel Using kGraft</span></a></li><li class="inactive"><a href="cha.suse.html"><span class="number">25 </span><span class="name">Special System Features</span></a></li><li class="inactive"><a href="cha.nm.html"><span class="number">26 </span><span class="name">Using NetworkManager</span></a></li><li class="inactive"><a href="cha.power-mgmt.html"><span class="number">27 </span><span class="name">Power Management</span></a></li></ol></li><li class="inactive"><a href="part.services.html"><span class="number">IV </span><span class="name">Services</span></a><ol><li class="inactive"><a href="cha.ntp.html"><span class="number">28 </span><span class="name">Time Synchronization with NTP</span></a></li><li class="inactive"><a href="cha.nfs.html"><span class="number">29 </span><span class="name">Sharing File Systems with NFS</span></a></li><li class="inactive"><a href="cha.samba.html"><span class="number">30 </span><span class="name">Samba</span></a></li><li class="inactive"><a href="cha.autofs.html"><span class="number">31 </span><span class="name">On-Demand Mounting with Autofs</span></a></li></ol></li><li class="inactive"><a href="part.trouble.html"><span class="number">V </span><span class="name">Troubleshooting</span></a><ol><li class="inactive"><a href="cha.adminhelp.html"><span class="number">32 </span><span class="name">Help and Documentation</span></a></li><li class="inactive"><a href="cha.adm.support.html"><span class="number">33 </span><span class="name">Gathering System Information for Support</span></a></li><li class="inactive"><a href="cha.trouble.html"><span class="number">34 </span><span class="name">Common Problems and Their Solutions</span></a></li></ol></li><li class="inactive"><a href="app.nwscheme.html"><span class="number">A </span><span class="name">An Example Network</span></a></li><li class="inactive"><a href="bk01apb.html"><span class="number">B </span><span class="name">GNU Licenses</span></a></li></ol></div><div class="clearme"></div></div></div></div><div id="_nav-area" class="inactive"><div class="tool"><span class="nav-inner"><span class="tool-label">Navigation</span><a accesskey="p" class="tool-spacer" title="Chapter 29. Sharing File Systems with NFS" href="cha.nfs.html"><span class="prev-icon">←</span></a><a accesskey="n" class="tool-spacer" title="Chapter 31. On-Demand Mounting with Autofs" href="cha.autofs.html"><span class="next-icon">→</span></a></span></div></div></div></div><div id="_fixed-header-wrap" class="inactive"><div id="_fixed-header"><div class="crumbs"><a class="book-link" href="index.html" title="SUSE Linux Enterprise Desktop Documentation"><span class="book-icon">SUSE Linux Enterprise Desktop Documentation</span></a><span> › </span><a class="crumb" href="book.sle.admin.html">Administration Guide</a><span> › </span><a class="crumb" href="part.services.html">Services</a><span> › </span><a class="crumb" href="cha.samba.html">Samba</a></div><div class="buttons"><a class="top-button button" href="#">Top</a><div class="button"><a accesskey="p" class="tool-spacer" title="Chapter 29. Sharing File Systems with NFS" href="cha.nfs.html"><span class="prev-icon">←</span></a><a accesskey="n" class="tool-spacer" title="Chapter 31. On-Demand Mounting with Autofs" href="cha.autofs.html"><span class="next-icon">→</span></a></div><div class="clearme"></div></div><div class="clearme"></div></div></div><div id="_content" class="draft "><div class="documentation"><div class="chapter " id="cha.samba"><div class="titlepage"><div><div class="version-info">Applies to  <span class="productname"><span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span></span> <span class="productnumber"><span class="productnumber"><span class="phrase">15</span></span></span></div><div><h2 class="title"><span class="number">30 </span><span class="name">Samba</span> </h2><div class="doc-status"><ul><li><span class="ds-label">Filename: </span>net_samba.xml</li><li><span class="ds-label">ID: </span>cha.samba</li></ul></div></div><div><div class="abstract"><div class="abstract-title-wrap"><h6 class="abstract-title">Abstract<a title="Permalink" class="permalink" href="cha.samba.html#idm139760523280672">#</a></h6></div><p>
    Using Samba, a Unix machine can be configured as a file and print server
    for macOS, Windows, and OS/2 machines. Samba has developed into a
    fully-fledged and rather complex product. Configure Samba with YaST, or
    by editing the configuration file manually.
   </p></div></div></div></div><div class="line"><div class="toc"><dl><dt><span class="sect1"><a href="cha.samba.html#sec.samba.term"><span class="number">30.1 </span><span class="name">Terminology</span></a></span></dt><dt><span class="sect1"><a href="cha.samba.html#sec.samba.install"><span class="number">30.2 </span><span class="name">Installing a Samba Server</span></a></span></dt><dt><span class="sect1"><a href="cha.samba.html#sec.samba.serv.inst"><span class="number">30.3 </span><span class="name">Configuring a Samba Server</span></a></span></dt><dt><span class="sect1"><a href="cha.samba.html#sec.samba.client.inst"><span class="number">30.4 </span><span class="name">Configuring Clients</span></a></span></dt><dt><span class="sect1"><a href="cha.samba.html#sec.samba.anmeld.serv"><span class="number">30.5 </span><span class="name">Samba as Login Server</span></a></span></dt><dt><span class="sect1"><a href="cha.samba.html#sec.samba.advanced"><span class="number">30.6 </span><span class="name">Advanced Topics</span></a></span></dt><dt><span class="sect1"><a href="cha.samba.html#sec.samba.info"><span class="number">30.7 </span><span class="name">For More Information</span></a></span></dt></dl></div></div><div class="sect1 " id="sec.samba.term"><div class="titlepage"><div><div><h2 class="title" id="sec.samba.term"><span class="number">30.1 </span><span class="name">Terminology</span> <a title="Permalink" class="permalink" href="cha.samba.html#sec.samba.term">#</a></h2></div></div></div><p>
   The following are some terms used in Samba documentation and in the YaST
   module.
  </p><div class="variablelist "><dl class="variablelist"><dt id="idm139760523276048"><span class="term ">SMB protocol</span></dt><dd><p>
      Samba uses the SMB (server message block) protocol that is
      based on the <span class="productname">NetBIOS</span> services.
      Microsoft released the protocol so other software manufacturers could
      establish connections to a Microsoft domain network. With Samba, the SMB
      protocol works on top of the TCP/IP protocol, so the TCP/IP protocol must
      be installed on all clients.
     </p></dd><dt id="idm139760523273200"><span class="term ">CIFS protocol</span></dt><dd><p>
      CIFS (common Internet file system) protocol is another
      protocol supported by Samba. CIFS defines a standard remote file system
      access protocol for use over the network, enabling groups of users to
      work together and share documents across the network.
     </p></dd><dt id="idm139760523271136"><span class="term ">NetBIOS</span></dt><dd><p>
      NetBIOS is a software interface (API) designed for
      communication between machines providing a name service. It enables
      machines connected to the network to reserve names for themselves. After
      reservation, these machines can be addressed by name. There is no central
      process that checks names. Any machine on the network can reserve as many
      names as it wants as long as the names are not already in use. The
      NetBIOS interface can be implemented for different network architectures.
      An implementation that works relatively closely with network hardware is
      called <span class="productname">NetBEUI</span>, but this is often
      called <span class="productname">NetBIOS</span>. Network protocols
      implemented with NetBIOS are IPX from Novell (NetBIOS via TCP/IP) and
      TCP/IP.
     </p><p>
      The NetBIOS names sent via TCP/IP have nothing in common with the names
      used in <code class="filename">/etc/hosts</code> or those defined by DNS. NetBIOS
      uses its own, completely independent naming convention. However, it is
      recommended to use names that correspond to DNS host names to make
      administration easier or use DNS natively. This is the default used by
      Samba.
     </p></dd><dt id="idm139760523265952"><span class="term ">Samba server</span></dt><dd><p>
      Samba server provides SMB/CIFS services and NetBIOS over IP naming
      services to clients. For Linux, there are three daemons for Samba server:
      smbd for SMB/CIFS services, nmbd for naming services, and winbind for
      authentication.
     </p></dd><dt id="idm139760523263920"><span class="term ">Samba client</span></dt><dd><p>
      The Samba client is a system that uses Samba services from a Samba server
      over the SMB protocol. Common operating systems, such as Windows and
      macOS support the SMB protocol. The TCP/IP protocol must be
      installed on all computers. Samba provides a client for the different
      Unix flavors. For Linux, there is a kernel module for SMB that allows the
      integration of SMB resources on the Linux system level. You do not need
      to run any daemon for the Samba client.
     </p></dd><dt id="idm139760523261632"><span class="term ">Shares</span></dt><dd><p>
      SMB servers provide resources to the clients by means of
      shares. Shares are printers and directories with their subdirectories on
      the server. It is exported by means of a name and can be accessed by its
      name. The share name can be set to any name—it does not need to be
      the name of the export directory. A printer is also assigned a name.
      Clients can access the printer by its name.
     </p></dd><dt id="idm139760523259424"><span class="term ">DC</span></dt><dd><p>
      A domain controller (DC) is a server that handles accounts
      in a domain. For data replication, additional domain controllers are
      available in one domain.
     </p></dd></dl></div></div><div class="sect1 " id="sec.samba.install"><div class="titlepage"><div><div><h2 class="title" id="sec.samba.install"><span class="number">30.2 </span><span class="name">Installing a Samba Server</span> <a title="Permalink" class="permalink" href="cha.samba.html#sec.samba.install">#</a></h2></div></div></div><p>
   To install a Samba server, start YaST and select
   <span class="guimenu">Software</span> › <span class="guimenu">Software
   Management</span>. Choose
   <span class="guimenu">View</span> › <span class="guimenu">Patterns</span>
   and select <span class="guimenu">File Server</span>. Confirm the installation of the
   required packages to finish the installation process.
  </p></div><div class="sect1 " id="sec.samba.serv.inst"><div class="titlepage"><div><div><h2 class="title" id="sec.samba.serv.inst"><span class="number">30.3 </span><span class="name">Configuring a Samba Server</span> <a title="Permalink" class="permalink" href="cha.samba.html#sec.samba.serv.inst">#</a></h2></div></div></div><p>
   For configuring a Samba server, see the SUSE Linux Enterprise Server documentation.
  </p></div><div class="sect1 " id="sec.samba.client.inst"><div class="titlepage"><div><div><h2 class="title" id="sec.samba.client.inst"><span class="number">30.4 </span><span class="name">Configuring Clients</span> <a title="Permalink" class="permalink" href="cha.samba.html#sec.samba.client.inst">#</a></h2></div></div></div><p>
   Clients can only access the Samba server via TCP/IP. NetBEUI and NetBIOS via
   IPX cannot be used with Samba.
  </p><div class="sect2 " id="sec.samba.client.inst.yast"><div class="titlepage"><div><div><h3 class="title" id="sec.samba.client.inst.yast"><span class="number">30.4.1 </span><span class="name">Configuring a Samba Client with YaST</span> <a title="Permalink" class="permalink" href="cha.samba.html#sec.samba.client.inst.yast">#</a></h3></div></div></div><p>
    Configure a Samba client to access resources (files or printers) on the
    Samba or Windows server. Enter the NT or Active Directory domain or
    workgroup in the dialog <span class="guimenu">Network Services</span> › <span class="guimenu">Windows Domain Membership</span>. If you activate
    <span class="guimenu">Also Use SMB Information for Linux Authentication</span>, the
    user authentication runs over the Samba, NT or Kerberos server.
   </p><p>
    Click <span class="guimenu">Expert Settings</span> for advanced configuration
    options. For example, use the <span class="guimenu">Mount Server Directories</span>
    table to enable mounting server home directory automatically with
    authentication. This way users can access their home directories when
    hosted on CIFS. For details, see the <code class="systemitem">pam_mount</code> man
    page.
   </p><p>
    After completing all settings, confirm the dialog to finish the
    configuration.
   </p></div></div><div class="sect1 " id="sec.samba.anmeld.serv"><div class="titlepage"><div><div><h2 class="title" id="sec.samba.anmeld.serv"><span class="number">30.5 </span><span class="name">Samba as Login Server</span> <a title="Permalink" class="permalink" href="cha.samba.html#sec.samba.anmeld.serv">#</a></h2></div></div></div><p>
   In networks where predominantly Windows clients are found, it is often
   preferable that users may only register with a valid account and password.
   In a Windows-based network, this task is handled by a primary domain
   controller (PDC). You can use a Windows NT server configured as PDC, but
   this task can also be done with a Samba server. The entries that must be
   made in the <code class="literal">[global]</code> section of
   <code class="filename">smb.conf</code> are shown in
   <a class="xref" href="cha.samba.html#dat.samba.smb.conf.dom" title="Global Section in smb.conf">Example 30.1, “Global Section in smb.conf”</a>.
  </p><div class="example" id="dat.samba.smb.conf.dom"><div class="example-title-wrap"><h6 class="example-title"><span class="number">Example 30.1: </span><span class="name">Global Section in smb.conf </span><a title="Permalink" class="permalink" href="cha.samba.html#dat.samba.smb.conf.dom">#</a></h6></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen">[global]
    workgroup = WORKGROUP
    domain logons = Yes
    domain master = Yes</pre></div></div></div><p>
   It is necessary to prepare user accounts and passwords in an encryption
   format that conforms with Windows. Do this with the command
   <code class="command">smbpasswd</code> <code class="option">-a name</code>. Create the domain
   account for the computers, required by the Windows domain concept, with the
   following commands:
  </p><div class="verbatim-wrap"><pre class="screen">useradd hostname\$
smbpasswd -a -m hostname</pre></div><p>
   With the <code class="command">useradd</code> command, a dollar sign is added. The
   command <code class="command">smbpasswd</code> inserts this automatically when the
   parameter <code class="option">-m</code> is used. The commented configuration example
   (<code class="filename">/usr/share/doc/packages/samba/examples/smb.conf.SUSE</code>)
   contains settings that automate this task.
  </p><div class="verbatim-wrap"><pre class="screen">add machine script = /usr/sbin/useradd -g nogroup -c "NT Machine Account" \
-s /bin/false %m\$</pre></div><p>
   To make sure that Samba can execute this script correctly, choose a Samba
   user with the required administrator permissions and add it to the
   <code class="systemitem">ntadmin</code> group. Then all users
   belonging to this Linux group can be assigned <code class="literal">Domain
   Admin</code> status with the command:
  </p><div class="verbatim-wrap"><pre class="screen">net groupmap add ntgroup="Domain Admins" unixgroup=ntadmin</pre></div></div><div class="sect1 " id="sec.samba.advanced"><div class="titlepage"><div><div><h2 class="title" id="sec.samba.advanced"><span class="number">30.6 </span><span class="name">Advanced Topics</span> <a title="Permalink" class="permalink" href="cha.samba.html#sec.samba.advanced">#</a></h2></div></div></div><p>
   This section introduces more advanced techniques to manage both the client
   and server part of the Samba suite.
  </p><div class="sect2 " id="sec.samba.advanced.compress"><div class="titlepage"><div><div><h3 class="title" id="sec.samba.advanced.compress"><span class="number">30.6.1 </span><span class="name">Transparent File Compression on Btrfs</span> <a title="Permalink" class="permalink" href="cha.samba.html#sec.samba.advanced.compress">#</a></h3></div></div></div><p>
    Samba allows clients to remotely manipulate file and directory compression
    flags for shares placed on the Btrfs file system. Windows Explorer provides
    the ability to flag files/directories for transparent compression via the
    <span class="guimenu">File</span> › <span class="guimenu">Properties</span> › <span class="guimenu">Advanced</span>
    dialog:
   </p><div class="figure" id="idm139760523225136"><div class="figure-contents"><div class="mediaobject"><a xmlns="" href="images/samba_win_expl_advattr.png"><img src="images/samba_win_expl_advattr.png" width="" alt="Windows Explorer Advanced Attributes Dialog" /></a></div></div><div class="figure-title-wrap"><h6 class="figure-title"><span class="number">Figure 30.1: </span><span class="name">Windows Explorer <span class="guimenu">Advanced Attributes</span> Dialog </span><a title="Permalink" class="permalink" href="cha.samba.html#idm139760523225136">#</a></h6></div></div><p>
    Files flagged for compression are transparently compressed and decompressed
    by the underlying file system when accessed or modified. This normally
    results in storage capacity savings at the expense of extra CPU overhead
    when accessing the file. New files and directories inherit the compression
    flag from the parent directory, unless created with the FILE_NO_COMPRESSION
    option.
   </p><p>
    Windows Explorer presents compressed files and directories visually
    differently to those that are not compressed:
   </p><div class="figure" id="idm139760523218272"><div class="figure-contents"><div class="mediaobject"><a xmlns="" href="images/samba_win_expl_view_compressed.png"><img src="images/samba_win_expl_view_compressed.png" width="" alt="Windows Explorer Directory Listing with Compressed Files" /></a></div></div><div class="figure-title-wrap"><h6 class="figure-title"><span class="number">Figure 30.2: </span><span class="name">Windows Explorer Directory Listing with Compressed Files </span><a title="Permalink" class="permalink" href="cha.samba.html#idm139760523218272">#</a></h6></div></div><p>
    You can enable Samba share compression either manually by adding
   </p><div class="verbatim-wrap"><pre class="screen">vfs objects = btrfs</pre></div><p>
    to the share configuration in <code class="filename">/etc/samba/smb.conf</code>, or
    using YaST: <span class="guimenu">Network Services</span> › <span class="guimenu">Samba
    Server</span> › <span class="guimenu">Add</span>, and checking
    <span class="guimenu">Utilize Btrfs Features</span>.
   </p></div><div class="sect2 " id="sec.samba.advanced.snapshots"><div class="titlepage"><div><div><h3 class="title" id="sec.samba.advanced.snapshots"><span class="number">30.6.2 </span><span class="name">Snapshots</span> <a title="Permalink" class="permalink" href="cha.samba.html#sec.samba.advanced.snapshots">#</a></h3></div></div></div><p>
    Snapshots, also called Shadow Copies, are copies of the state of a file
    system subvolume at a certain point of time. Snapper is the tool to manage
    these snapshots in Linux. Snapshots are supported on the Btrfs file system
    or thin-provisioned LVM volumes. The Samba suite supports managing of
    remote snapshots through the FSRVP protocol on both the server and client
    side.
   </p><div class="sect3 " id="sec.samba.advanced.snapshots.client"><div class="titlepage"><div><div><h4 class="title" id="sec.samba.advanced.snapshots.client"><span class="number">30.6.2.1 </span><span class="name">Previous Versions</span> <a title="Permalink" class="permalink" href="cha.samba.html#sec.samba.advanced.snapshots.client">#</a></h4></div></div></div><p>
     Snapshots on a Samba server can be exposed to remote Windows clients as
     file or directory previous versions.
    </p><p>
     To enable snapshots on a Samba server, the following conditions must be
     fulfilled:
    </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
       The SMB network share resides on a Btrfs subvolume.
      </p></li><li class="listitem "><p>
       The SMB network share path has a related snapper configuration file. You
       can create the snapper file with
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> snapper -c &lt;cfg_name&gt; create-config <code class="option">/path/to/share</code></pre></div><p>
       For more information on snapper, see <a class="xref" href="cha.snapper.html" title="Chapter 7. System Recovery and Snapshot Management with Snapper">Chapter 7, <em>System Recovery and Snapshot Management with Snapper</em></a>.
      </p></li><li class="listitem "><p>
       The snapshot directory tree must allow access for relevant users. For
       more information, see the PERMISSIONS section of the vfs_snapper manual
       page (<code class="command">man 8 vfs_snapper</code>).
      </p></li></ul></div><p>
     To support remote snapshots, you need to modify the
     <code class="filename">/etc/samba/smb.conf</code> file. You can do it either with
     <span class="guimenu">YaST</span> › <span class="guimenu">Network
     Services</span> › <span class="guimenu">Samba Server</span>, or
     manually by enhancing the relevant share section with
    </p><div class="verbatim-wrap"><pre class="screen">vfs objects = snapper</pre></div><p>
     Note that you need to restart the Samba service for manual
     <code class="filename">smb.conf</code> changes to take effect:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> systemctl restart nmb smb</pre></div><div class="figure" id="fig.yast2.samba.snapshot"><div class="figure-contents"><div class="mediaobject"><a xmlns="" href="images/yast2_samba_snapshot.png"><img src="images/yast2_samba_snapshot.png" width="" alt="Adding a New Samba Share with Snapshotting Enabled" /></a></div></div><div class="figure-title-wrap"><h6 class="figure-title"><span class="number">Figure 30.3: </span><span class="name">Adding a New Samba Share with Snapshotting Enabled </span><a title="Permalink" class="permalink" href="cha.samba.html#fig.yast2.samba.snapshot">#</a></h6></div></div><p>
     After being configured, snapshots created by snapper for the Samba share
     path can be accessed from Windows Explorer from a file or directory's
     <span class="guimenu">Previous Versions</span> tab.
    </p><div class="figure" id="fig.samba.win_explorer"><div class="figure-contents"><div class="mediaobject"><a xmlns="" href="images/samba_winexpl_previous_versions.png"><img src="images/samba_winexpl_previous_versions.png" width="" alt="The Previous Versions tab in Windows Explorer" /></a></div></div><div class="figure-title-wrap"><h6 class="figure-title"><span class="number">Figure 30.4: </span><span class="name">The <span class="guimenu">Previous Versions</span> tab in Windows Explorer </span><a title="Permalink" class="permalink" href="cha.samba.html#fig.samba.win_explorer">#</a></h6></div></div></div><div class="sect3 " id="sec.samba.advanced.snapshots.server"><div class="titlepage"><div><div><h4 class="title" id="sec.samba.advanced.snapshots.server"><span class="number">30.6.2.2 </span><span class="name">Remote Share Snapshots</span> <a title="Permalink" class="permalink" href="cha.samba.html#sec.samba.advanced.snapshots.server">#</a></h4></div></div></div><p>
     By default, snapshots can only be created and deleted on the Samba server
     locally, via the snapper command line utility, or using snapper's time
     line feature.
    </p><p>
     Samba can be configured to process share snapshot creation and deletion
     requests from remote hosts using the File Server Remote VSS Protocol
     (FSRVP).
    </p><p>
     In addition to the configuration and prerequisites documented in
     <a class="xref" href="cha.samba.html#sec.samba.advanced.snapshots.client" title="30.6.2.1. Previous Versions">Section 30.6.2.1, “Previous Versions”</a>, the following global
     configuration is required in <code class="filename">/etc/samba/smb.conf</code>:
    </p><div class="verbatim-wrap"><pre class="screen">[global]
rpc_daemon:fssd = fork
registry shares = yes
include = registry</pre></div><p>
     FSRVP clients, including Samba's <code class="command">rpcclient</code> and Windows
     Server 2012 <code class="command">DiskShadow.exe</code>, can then instruct Samba to
     create or delete a snapshot for a given share, and expose the snapshot as
     a new share.
    </p></div><div class="sect3 " id="sec.samba.advanced.snapshots.client.linux"><div class="titlepage"><div><div><h4 class="title" id="sec.samba.advanced.snapshots.client.linux"><span class="number">30.6.2.3 </span><span class="name">Managing Snapshots Remotely from Linux with <code class="command">rpcclient</code></span> <a title="Permalink" class="permalink" href="cha.samba.html#sec.samba.advanced.snapshots.client.linux">#</a></h4></div></div></div><p>
     The <code class="systemitem">samba-client</code> package contains an FSRVP client
     that can remotely request a Windows/Samba server to create and expose a
     snapshot of a given share. You can then use existing tools in
     <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> to mount the exposed share and back up its files. Requests
     to the server are sent using the <code class="command">rpcclient</code> binary.
    </p><div class="complex-example"><div class="example" id="idm139760523170752"><div class="example-title-wrap"><h6 class="example-title"><span class="number">Example 30.2: </span><span class="name">Using <code class="command">rpcclient</code> to Request a Windows Server 2012 Share Snapshot </span><a title="Permalink" class="permalink" href="cha.samba.html#idm139760523170752">#</a></h6></div><div class="example-contents"><p>
      Connect to <code class="literal">win-server.example.com</code> server as an
      administrator in an <code class="literal">EXAMPLE</code> domain:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root">root # </code>rpcclient -U '<em class="replaceable ">EXAMPLE</em>\Administrator' ncacn_np:<em class="replaceable ">win-server.example.com</em>[ndr64,sign]
Enter EXAMPLE/Administrator's password:</pre></div><p>
      Check that the SMB share is visible for <code class="command">rpcclient</code>:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root">root # </code>rpcclient $&gt; netshareenum
netname: windows_server_2012_share
remark:
path:   C:\Shares\windows_server_2012_share
password:       (null)</pre></div><p>
      Check that the SMB share supports snapshot creation:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root">root # </code>rpcclient $&gt; fss_is_path_sup windows_server_2012_share \
UNC \\WIN-SERVER\windows_server_2012_share\ supports shadow copy requests</pre></div><p>
      Request the creation of a share snapshot:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root">root # </code>rpcclient $&gt; fss_create_expose backup ro windows_server_2012_share
13fe880e-e232-493d-87e9-402f21019fb6: shadow-copy set created
13fe880e-e232-493d-87e9-402f21019fb6(1c26544e-8251-445f-be89-d1e0a3938777): \
\\WIN-SERVER\windows_server_2012_share\ shadow-copy added to set
13fe880e-e232-493d-87e9-402f21019fb6: prepare completed in 0 secs
13fe880e-e232-493d-87e9-402f21019fb6: commit completed in 1 secs
13fe880e-e232-493d-87e9-402f21019fb6(1c26544e-8251-445f-be89-d1e0a3938777): \
share windows_server_2012_share@{1C26544E-8251-445F-BE89-D1E0A3938777} \
exposed as a snapshot of \\WIN-SERVER\windows_server_2012_share\</pre></div><p>
      Confirm that the snapshot share is exposed by the server:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root">root # </code>rpcclient $&gt; netshareenum
netname: windows_server_2012_share
remark:
path:   C:\Shares\windows_server_2012_share
password:       (null)

netname: windows_server_2012_share@{1C26544E-8251-445F-BE89-D1E0A3938777}
remark: (null)
path:   \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy{F6E6507E-F537-11E3-9404-B8AC6F927453}\Shares\windows_server_2012_share\
password:       (null)</pre></div><p>
      Attempt to delete the snapshot share:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root">root # </code>rpcclient $&gt; fss_delete windows_server_2012_share \
13fe880e-e232-493d-87e9-402f21019fb6 1c26544e-8251-445f-be89-d1e0a3938777
13fe880e-e232-493d-87e9-402f21019fb6(1c26544e-8251-445f-be89-d1e0a3938777): \
\\WIN-SERVER\windows_server_2012_share\ shadow-copy deleted</pre></div><p>
      Confirm that the snapshot share has been removed by the server:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root">root # </code>rpcclient $&gt; netshareenum
netname: windows_server_2012_share
remark:
path:   C:\Shares\windows_server_2012_share
password:       (null)</pre></div></div></div></div></div><div class="sect3 " id="sec.samba.advanced.snapshots.client.winserver"><div class="titlepage"><div><div><h4 class="title" id="sec.samba.advanced.snapshots.client.winserver"><span class="number">30.6.2.4 </span><span class="name">Managing Snapshots Remotely from Windows with <code class="command">DiskShadow.exe</code></span> <a title="Permalink" class="permalink" href="cha.samba.html#sec.samba.advanced.snapshots.client.winserver">#</a></h4></div></div></div><p>
     You can manage snapshots of SMB shares on the Linux Samba server from the
     Windows environment acting as a client as well. Windows Server 2012
     includes the <code class="command">DiskShadow.exe</code> utility that can manage
     remote shares similar to the <code class="command">rpcclient</code> described in
     <a class="xref" href="cha.samba.html#sec.samba.advanced.snapshots.client.linux" title="30.6.2.3. Managing Snapshots Remotely from Linux with rpcclient">Section 30.6.2.3, “Managing Snapshots Remotely from Linux with <code class="command">rpcclient</code>”</a>. Note that you
     need to carefully set up the Samba server first.
    </p><p>
     Following is an example procedure to set up the Samba server so that the
     Windows Server client can manage its share's snapshots. Note that <em class="replaceable ">EXAMPLE</em>
     is the Active Directory domain used in the testing environment,
     <code class="uri">fsrvp-server.example.com</code> is the host name of the Samba server, and
     <code class="filename">/srv/smb</code> is the path to the SMB share.
    </p><div class="procedure " id="idm139760523149104"><div class="procedure-title-wrap"><h6 class="procedure-title"><span class="number">Procedure 30.1: </span><span class="name">Detailed Samba Server Configuration </span><a title="Permalink" class="permalink" href="cha.samba.html#idm139760523149104">#</a></h6></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
       Join Active Directory domain via YaST.
      </p></li><li class="step "><p>
       Ensure that the Active Domain DNS entry was correct:
      </p><div class="verbatim-wrap"><pre class="screen">fsrvp-server:~ # net -U 'Administrator' ads dns register \
fsrvp-server.example.com &lt;IP address&gt;
Successfully registered hostname with DNS</pre></div></li><li class="step "><p>
       Create Btrfs subvolume at <code class="filename">/srv/smb</code>
      </p><div class="verbatim-wrap"><pre class="screen">fsrvp-server:~ # btrfs subvolume create /srv/smb</pre></div></li><li class="step "><p>
       Create snapper configuration file for path <code class="filename">/srv/smb</code>
      </p><div class="verbatim-wrap"><pre class="screen">fsrvp-server:~ # snapper -c &lt;snapper_config&gt; create-config /srv/smb</pre></div></li><li class="step "><p>
       Create new share with path <code class="filename">/srv/smb</code>, and YaST
       <span class="guimenu">Expose Snapshots</span> check box enabled. Make sure to add
       the following snippets to the global section of
       <code class="filename">/etc/samba/smb.conf</code> as mentioned in
       <a class="xref" href="cha.samba.html#sec.samba.advanced.snapshots.server" title="30.6.2.2. Remote Share Snapshots">Section 30.6.2.2, “Remote Share Snapshots”</a>:
      </p><div class="verbatim-wrap"><pre class="screen">[global]
 rpc_daemon:fssd = fork
 registry shares = yes
 include = registry</pre></div></li><li class="step "><p>
       Restart Samba with <code class="command">systemctl restart nmb smb</code>
      </p></li><li class="step "><p>
       Configure snapper permissions:
      </p><div class="verbatim-wrap"><pre class="screen">fsrvp-server:~ # snapper -c &lt;snapper_config&gt; set-config \
ALLOW_USERS="EXAMPLE\\\\Administrator EXAMPLE\\\\win-client$"</pre></div><p>
       Ensure that any ALLOW_USERS are also permitted traversal of the
       <code class="filename">.snapshots</code> subdirectory.
      </p><div class="verbatim-wrap"><pre class="screen">fsrvp-server:~ # snapper -c &lt;snapper_config&gt; set-config SYNC_ACL=yes</pre></div><div id="idm139760523134608" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.png" /><h6>Important: Path Escaping</h6><p>
        Be careful about the '\' escapes! Escape twice to ensure that the value
        stored in
        <code class="filename">/etc/snapper/configs/&lt;snapper_config&gt;</code> is
        escaped once.
       </p></div><p>
       "EXAMPLE\win-client$" corresponds to the Windows client computer
       account. Windows issues initial FSRVP requests while authenticated with
       this account.
      </p></li><li class="step "><p>
       Grant Windows client account necessary privileges:
      </p><div class="verbatim-wrap"><pre class="screen">fsrvp-server:~ # net -U 'Administrator' rpc rights grant \
"EXAMPLE\\win-client$" SeBackupPrivilege
Successfully granted rights.</pre></div><p>
       The previous command is not needed for the "EXAMPLE\Administrator" user,
       which has privileges already granted.
      </p></li></ol></div></div><div class="procedure " id="idm139760523129696"><div class="procedure-title-wrap"><h6 class="procedure-title"><span class="number">Procedure 30.2: </span><span class="name">Windows Client Setup and <code class="command">DiskShadow.exe</code> in Action </span><a title="Permalink" class="permalink" href="cha.samba.html#idm139760523129696">#</a></h6></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
       Boot Windows Server 2012 (example host name WIN-CLIENT).
      </p></li><li class="step "><p>
       Join the same Active Directory domain EXAMPLE as with the <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span>.
      </p></li><li class="step "><p>
       Reboot.
      </p></li><li class="step "><p>
       Open Powershell.
      </p></li><li class="step "><p>
       Start <code class="command">DiskShadow.exe</code> and begin the backup procedure:
      </p><div class="verbatim-wrap"><pre class="screen">PS C:\Users\Administrator.EXAMPLE&gt; diskshadow.exe
Microsoft DiskShadow version 1.0
Copyright (C) 2012 Microsoft Corporation
On computer:  WIN-CLIENT,  6/17/2014 3:53:54 PM

DISKSHADOW&gt; begin backup</pre></div></li><li class="step "><p>
       Specify that shadow copy persists across program exit, reset or reboot:
      </p><div class="verbatim-wrap"><pre class="screen">DISKSHADOW&gt; set context PERSISTENT</pre></div></li><li class="step "><p>
       Check whether the specified share supports snapshots, and create one:
      </p><div class="verbatim-wrap"><pre class="screen">DISKSHADOW&gt; add volume \\fsrvp-server\sles_snapper

DISKSHADOW&gt; create
Alias VSS_SHADOW_1 for shadow ID {de4ddca4-4978-4805-8776-cdf82d190a4a} set as \
 environment variable.
Alias VSS_SHADOW_SET for shadow set ID {c58e1452-c554-400e-a266-d11d5c837cb1} \
 set as environment variable.

Querying all shadow copies with the shadow copy set ID \
 {c58e1452-c554-400e-a266-d11d5c837cb1}

 * Shadow copy ID = {de4ddca4-4978-4805-8776-cdf82d190a4a}     %VSS_SHADOW_1%
    - Shadow copy set: {c58e1452-c554-400e-a266-d11d5c837cb1}  %VSS_SHADOW_SET%
    - Original count of shadow copies = 1
    - Original volume name: \\FSRVP-SERVER\SLES_SNAPPER\ \
      [volume not on this machine]
    - Creation time: 6/17/2014 3:54:43 PM
    - Shadow copy device name:
      \\FSRVP-SERVER\SLES_SNAPPER@{31afd84a-44a7-41be-b9b0-751898756faa}
    - Originating machine: FSRVP-SERVER
    - Service machine: win-client.example.com
    - Not exposed
    - Provider ID: {89300202-3cec-4981-9171-19f59559e0f2}
    - Attributes:  No_Auto_Release Persistent FileShare

Number of shadow copies listed: 1</pre></div></li><li class="step "><p>
       Finish the backup procedure:
      </p><div class="verbatim-wrap"><pre class="screen">DISKSHADOW&gt; end backup</pre></div></li><li class="step "><p>
       After the snapshot was created, try to delete it and verify the
       deletion:
      </p><div class="verbatim-wrap"><pre class="screen">DISKSHADOW&gt; delete shadows volume \\FSRVP-SERVER\SLES_SNAPPER\
Deleting shadow copy {de4ddca4-4978-4805-8776-cdf82d190a4a} on volume \
 \\FSRVP-SERVER\SLES_SNAPPER\ from provider \
{89300202-3cec-4981-9171-19f59559e0f2} [Attributes: 0x04000009]...

Number of shadow copies deleted: 1

DISKSHADOW&gt; list shadows all

Querying all shadow copies on the computer ...
No shadow copies found in system.</pre></div></li></ol></div></div></div></div></div><div class="sect1 " id="sec.samba.info"><div class="titlepage"><div><div><h2 class="title" id="sec.samba.info"><span class="number">30.7 </span><span class="name">For More Information</span> <a title="Permalink" class="permalink" href="cha.samba.html#sec.samba.info">#</a></h2></div></div></div><p>
   Documentation for Samba ships with the <code class="systemitem">samba-doc</code>
   package which is not installed by default. Install it with <code class="command">zypper
   install samba-doc</code>. Enter <code class="command">apropos</code>
   <code class="option">samba</code> at the command line to display some manual pages or
   browse the <code class="filename">/usr/share/doc/packages/samba</code> directory for
   more online documentation and examples. Find a commented example
   configuration (<code class="filename">smb.conf.SUSE</code>) in the
   <code class="filename">examples</code> subdirectory. Another file to look for Samba
   related information is
   <code class="filename">/usr/share/doc/packages/samba/README.SUSE</code>.
  </p><p>
   The Samba HOWTO (see <a class="link" href="https://wiki.samba.org" target="_blank">https://wiki.samba.org</a>) provided
   by the Samba team includes a section about troubleshooting. In addition to
   that, Part V of the document provides a step-by-step guide to checking your
   configuration.
  </p></div></div></div><div class="page-bottom"><div id="_bottom-navigation"><a class="nav-link" href="cha.autofs.html"><span class="next-icon">→</span><span class="nav-label"><span class="number">Chapter 31 </span>On-Demand Mounting with Autofs</span></a><a class="nav-link" href="cha.nfs.html"><span class="prev-icon">←</span><span class="nav-label"><span class="number">Chapter 29 </span>Sharing File Systems with NFS</span></a></div><div id="_share-print"><div class="online-contents share"><strong>Share this page: </strong><span class="share-buttons"><span id="_share-fb" class="bottom-button">Facebook</span><span class="spacer"> • </span><span id="_share-gp" class="bottom-button">Google+</span><span class="spacer"> • </span><span id="_share-tw" class="bottom-button">Twitter</span><span class="spacer"> • </span><span id="_share-mail" class="bottom-button">E-Mail</span></span></div><div class="print"><span id="_print-button" class="bottom-button">Print this page</span></div><div class="clearme"></div></div></div></div><div id="_inward"></div></div><div id="_footer-wrap"><div id="_footer"><p>©
        2018 
        SUSE</p><ul><li><a href="http://www.suse.com/company/careers/" target="_top">Careers</a></li><li><a href="http://www.suse.com/company/legal/" target="_top">Legal</a></li><li><a href="http://www.suse.com/company/" target="_top">About</a></li><li><a href="http://www.suse.com/ContactsOffices/contacts_offices.jsp" target="_top">Contact Us</a></li></ul></div></div></body></html>