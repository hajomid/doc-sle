<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang=""><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Authentication with PAM | Security Guide | SUSE Linux Enterprise Desktop 15</title><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" /><link rel="stylesheet" type="text/css" href="static/css/style.css" /><link rel="stylesheet" type="text/css" href="static/css/highlight.css" /><meta name="generator" content="DAPS 2.4.0 using SUSE XSL Stylesheets 2.0.8 (based on DocBook XSL Stylesheets 1.78.1) - chunked" /><meta name="product-name" content="SUSE Linux Enterprise Desktop" /><meta name="product-number" content="15" /><meta name="book-title" content="Security Guide" /><meta name="chapter-title" content="Chapter 2. Authentication with PAM" /><meta name="description" content="Linux uses PAM (pluggable authentication modules) in the authentication process as a layer that mediates between user and application. PAM modules are available on a systemwide basis, so they can be requested by any application. This chapter describes how the modular authentication mechanism works and how it is configured." /><meta name="tracker-url" content="https://bugzilla.suse.com/enter_bug.cgi" /><meta name="tracker-type" content="bsc" /><meta name="tracker-bsc-assignee" content="fs@suse.com" /><meta name="tracker-bsc-component" content="Documentation" /><meta name="tracker-bsc-product" content="SUSE Linux Enterprise Desktop 15" /><link rel="home" href="index.html" title="SUSE Linux Enterprise Desktop Documentation" /><link rel="up" href="part.auth.html" title="Part I. Authentication" /><link rel="prev" href="part.auth.html" title="Part I. Authentication" /><link rel="next" href="cha.nis.html" title="Chapter 3. Using NIS" /><script type="text/javascript">

var protocol = window.location.protocol.toLowerCase();
if ( protocol != 'file:' ) {
  var agent = navigator.userAgent.toLowerCase();
  var wanted = ( protocol == 'https:') ? 'https' : 'http';
  var file = 'fonts.css';
  document.write('<link rel="stylesheet" type="text/css" href="' + wanted + '://static.opensuse.org/fonts/'+ file +'"></link>');
}
else {
   document.write('<link rel="stylesheet" type="text/css" href="static/css/fonts-onlylocal.css"></link>');
}

</script><noscript><link rel="stylesheet" type="text/css" href="http://static.opensuse.org/fonts/fonts.css" /></noscript><script src="static/js/jquery-1.10.2.min.js" type="text/javascript"></script><script src="static/js/script.js" type="text/javascript"></script><script src="static/js/highlight.min.js" type="text/javascript"></script><script>

$(document).ready(function() {
  $('.verbatim-wrap.highlight').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});
hljs.configure({
  useBR: false
});

</script></head><body class="draft offline js-off"><div id="_outer-wrap"><div id="_white-bg"><div id="_header"><div id="_logo"><img src="static/images/logo.png" alt="Logo" /></div><div class="crumbs"><a class="book-link" href="index.html" title="SUSE Linux Enterprise Desktop Documentation"><span class="book-icon">SUSE Linux Enterprise Desktop Documentation</span></a><span> › </span><a class="crumb" href="book.security.html">Security Guide</a><span> › </span><a class="crumb" href="part.auth.html">Authentication</a><span> › </span><a class="crumb" href="cha.pam.html">Authentication with PAM</a></div><div class="clearme"></div></div></div><div id="_toolbar-wrap"><div id="_toolbar"><div id="_toc-area" class="inactive"><a id="_toc-area-button" class="tool" title="Contents" accesskey="c" href="index.html"><span class="tool-spacer"><span class="toc-icon">Contents</span><span class="clearme"></span></span><span class="tool-label">Contents</span></a><div class="active-contents bubble-corner"></div><div class="active-contents bubble"><div class="bubble-container"><h6>Security Guide</h6><div id="_bubble-toc"><ol><li class="inactive"><a href="preface.security.html"><span class="number"> </span><span class="name">About This Guide</span></a></li><li class="inactive"><a href="cha.security.html"><span class="number">1 </span><span class="name">Security and Confidentiality</span></a></li><li class="inactive"><a href="part.auth.html"><span class="number">I </span><span class="name">Authentication</span></a><ol><li class="inactive"><a href="cha.pam.html"><span class="number">2 </span><span class="name">Authentication with PAM</span></a></li><li class="inactive"><a href="cha.nis.html"><span class="number">3 </span><span class="name">Using NIS</span></a></li><li class="inactive"><a href="cha.security.auth.html"><span class="number">4 </span><span class="name">Setting Up Authentication Servers and Clients Using YaST</span></a></li><li class="inactive"><a href="cha.security.ldap.html"><span class="number">5 </span><span class="name">LDAP—A Directory Service</span></a></li><li class="inactive"><a href="cha.security.kerberos.html"><span class="number">6 </span><span class="name">Network Authentication with Kerberos</span></a></li><li class="inactive"><a href="cha.security.ad.html"><span class="number">7 </span><span class="name">Active Directory Support</span></a></li></ol></li><li class="inactive"><a href="part.local_security.html"><span class="number">II </span><span class="name">Local Security</span></a><ol><li class="inactive"><a href="cha.security.yast_security.html"><span class="number">8 </span><span class="name">Configuring Security Settings with YaST</span></a></li><li class="inactive"><a href="cha.security.policykit.html"><span class="number">9 </span><span class="name">Authorization with PolKit</span></a></li><li class="inactive"><a href="cha.security.acls.html"><span class="number">10 </span><span class="name">Access Control Lists in Linux</span></a></li><li class="inactive"><a href="cha.security.cryptofs.html"><span class="number">11 </span><span class="name">Encrypting Partitions and Files</span></a></li><li class="inactive"><a href="cha.certstore.html"><span class="number">12 </span><span class="name">Certificate Store</span></a></li><li class="inactive"><a href="cha.aide.html"><span class="number">13 </span><span class="name">Intrusion Detection with AIDE</span></a></li></ol></li><li class="inactive"><a href="part.network_security.html"><span class="number">III </span><span class="name">Network Security</span></a><ol><li class="inactive"><a href="cha.ssh.html"><span class="number">14 </span><span class="name">SSH: Secure Network Operations</span></a></li><li class="inactive"><a href="cha.security.firewall.html"><span class="number">15 </span><span class="name">Masquerading and Firewalls</span></a></li><li class="inactive"><a href="cha.security.vpnserver.html"><span class="number">16 </span><span class="name">Configuring a VPN Server</span></a></li><li class="inactive"><a href="cha.security.yast_ca.html"><span class="number">17 </span><span class="name">Managing X.509 Certification</span></a></li></ol></li><li class="inactive"><a href="part.apparmor.html"><span class="number">IV </span><span class="name">Confining Privileges with <span class="phrase">AppArmor</span></span></a><ol><li class="inactive"><a href="cha.apparmor.intro.html"><span class="number">18 </span><span class="name">Introducing <span class="phrase">AppArmor</span></span></a></li><li class="inactive"><a href="cha.apparmor.start.html"><span class="number">19 </span><span class="name">Getting Started</span></a></li><li class="inactive"><a href="cha.apparmor.concept.html"><span class="number">20 </span><span class="name">Immunizing Programs</span></a></li><li class="inactive"><a href="cha.apparmor.profiles.html"><span class="number">21 </span><span class="name">Profile Components and Syntax</span></a></li><li class="inactive"><a href="cha.apparmor.repos.html"><span class="number">22 </span><span class="name"><span class="phrase">AppArmor</span> Profile Repositories</span></a></li><li class="inactive"><a href="cha.apparmor.yast.html"><span class="number">23 </span><span class="name">Building and Managing Profiles with YaST</span></a></li><li class="inactive"><a href="cha.apparmor.commandline.html"><span class="number">24 </span><span class="name">Building Profiles from the Command Line</span></a></li><li class="inactive"><a href="cha.apparmor.hat.html"><span class="number">25 </span><span class="name">Profiling Your Web Applications Using ChangeHat</span></a></li><li class="inactive"><a href="cha.apparmor.pam.html"><span class="number">26 </span><span class="name">Confining Users with <code class="systemitem">pam_apparmor</code></span></a></li><li class="inactive"><a href="cha.apparmor.managing.html"><span class="number">27 </span><span class="name">Managing Profiled Applications</span></a></li><li class="inactive"><a href="cha.apparmor.support.html"><span class="number">28 </span><span class="name">Support</span></a></li><li class="inactive"><a href="cha.apparmor.glossary.html"><span class="number">29 </span><span class="name"><span class="phrase">AppArmor</span> Glossary</span></a></li></ol></li><li class="inactive"><a href="part.audit.html"><span class="number">V </span><span class="name"><em class="citetitle ">The Linux Audit Framework</em></span></a><ol><li class="inactive"><a href="cha.audit.comp.html"><span class="number">30 </span><span class="name">Understanding Linux Audit</span></a></li><li class="inactive"><a href="cha.audit.setup.html"><span class="number">31 </span><span class="name">Setting Up the Linux Audit Framework</span></a></li><li class="inactive"><a href="cha.audit.scenarios.html"><span class="number">32 </span><span class="name">Introducing an Audit Rule Set</span></a></li><li class="inactive"><a href="cha.audit.moreinfo.html"><span class="number">33 </span><span class="name">Useful Resources</span></a></li></ol></li><li class="inactive"><a href="bk05apa.html"><span class="number">A </span><span class="name">GNU Licenses</span></a></li></ol></div><div class="clearme"></div></div></div></div><div id="_nav-area" class="inactive"><div class="tool"><span class="nav-inner"><span class="tool-label">Navigation</span><a accesskey="p" class="tool-spacer" title="Part I. Authentication" href="part.auth.html"><span class="prev-icon">←</span></a><a accesskey="n" class="tool-spacer" title="Chapter 3. Using NIS" href="cha.nis.html"><span class="next-icon">→</span></a></span></div></div></div></div><div id="_fixed-header-wrap" class="inactive"><div id="_fixed-header"><div class="crumbs"><a class="book-link" href="index.html" title="SUSE Linux Enterprise Desktop Documentation"><span class="book-icon">SUSE Linux Enterprise Desktop Documentation</span></a><span> › </span><a class="crumb" href="book.security.html">Security Guide</a><span> › </span><a class="crumb" href="part.auth.html">Authentication</a><span> › </span><a class="crumb" href="cha.pam.html">Authentication with PAM</a></div><div class="buttons"><a class="top-button button" href="#">Top</a><div class="button"><a accesskey="p" class="tool-spacer" title="Part I. Authentication" href="part.auth.html"><span class="prev-icon">←</span></a><a accesskey="n" class="tool-spacer" title="Chapter 3. Using NIS" href="cha.nis.html"><span class="next-icon">→</span></a></div><div class="clearme"></div></div><div class="clearme"></div></div></div><div id="_content" class="draft "><div class="documentation"><div class="chapter " id="cha.pam"><div class="titlepage"><div><div class="version-info">Applies to  <span class="productname"><span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span></span> <span class="productnumber"><span class="productnumber"><span class="phrase">15</span></span></span></div><div><h2 class="title"><span class="number">2 </span><span class="name">Authentication with PAM</span> </h2><div class="doc-status"><ul><li><span class="ds-label">Filename: </span>security_pam.xml</li><li><span class="ds-label">ID: </span>cha.pam</li></ul></div></div><div><div class="abstract"><div class="abstract-title-wrap"><h6 class="abstract-title">Abstract<a title="Permalink" class="permalink" href="cha.pam.html#idm140148733101264">#</a></h6></div><p>
    Linux uses PAM (pluggable authentication modules) in the authentication
    process as a layer that mediates between user and application. PAM
    modules are available on a systemwide basis, so they can be requested by
    any application. This chapter describes how the modular authentication
    mechanism works and how it is configured.
   </p></div></div></div></div><div class="line"><div class="toc"><dl><dt><span class="sect1"><a href="cha.pam.html#sec.security.pam.whatis"><span class="number">2.1 </span><span class="name">What is PAM?</span></a></span></dt><dt><span class="sect1"><a href="cha.pam.html#sec.pam.struc.files"><span class="number">2.2 </span><span class="name">Structure of a PAM Configuration File</span></a></span></dt><dt><span class="sect1"><a href="cha.pam.html#sec.pam.struc.format"><span class="number">2.3 </span><span class="name">The PAM Configuration of sshd</span></a></span></dt><dt><span class="sect1"><a href="cha.pam.html#sec.pam.struc.conf"><span class="number">2.4 </span><span class="name">Configuration of PAM Modules</span></a></span></dt><dt><span class="sect1"><a href="cha.pam.html#sec.pam.pam-config"><span class="number">2.5 </span><span class="name">Configuring PAM Using pam-config</span></a></span></dt><dt><span class="sect1"><a href="cha.pam.html#sec.pam.manual-config"><span class="number">2.6 </span><span class="name">Manually Configuring PAM</span></a></span></dt><dt><span class="sect1"><a href="cha.pam.html#sec.pam.info"><span class="number">2.7 </span><span class="name">For More Information</span></a></span></dt></dl></div></div><div class="sect1 " id="sec.security.pam.whatis"><div class="titlepage"><div><div><h2 class="title" id="sec.security.pam.whatis"><span class="number">2.1 </span><span class="name">What is PAM?</span> <a title="Permalink" class="permalink" href="cha.pam.html#sec.security.pam.whatis">#</a></h2></div></div></div><p>
   System administrators and programmers often want to restrict access to
   certain parts of the system or to limit the use of certain functions of
   an application. Without PAM, applications must be adapted every time a
   new authentication mechanism, such as LDAP, Samba, or Kerberos, is
   introduced. However, this process is time-consuming and
   error-prone. One way to avoid these drawbacks is to separate applications
   from the authentication mechanism and delegate authentication to
   centrally managed modules. Whenever a newly required authentication
   scheme is needed, it is sufficient to adapt or write a suitable
   <span class="emphasis"><em>PAM module</em></span> for use by the program in question.
  </p><p>
   The PAM concept consists of:
  </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
     <span class="emphasis"><em>PAM modules</em></span>, which are a set of shared libraries
     for a specific authentication mechanism.
    </p></li><li class="listitem "><p>
     A <span class="emphasis"><em>module stack</em></span> with of one or more PAM modules.
    </p></li><li class="listitem "><p>
     A PAM-aware <span class="emphasis"><em>service</em></span> which needs authentication by
     using a module stack or PAM modules. Usually a service is a familiar
     name of the corresponding application, like <code class="command">login</code> or
     <code class="command">su</code>. The service name <code class="literal">other</code> is a
     reserved word for default rules.
    </p></li><li class="listitem "><p>
     <span class="emphasis"><em>Module arguments</em></span>, with which the execution of a
     single PAM module can be influenced.
    </p></li><li class="listitem "><p>
     A mechanism evaluating each <span class="emphasis"><em>result</em></span> of a single PAM
     module execution. A positive value executes the next PAM module. The
     way a negative value is dealt with depends on the configuration:
     <span class="quote">“<span class="quote">no influence, proceed</span>”</span> up to <span class="quote">“<span class="quote">terminate
     immediately</span>”</span> and anything in between are valid options.
    </p></li></ul></div></div><div class="sect1 " id="sec.pam.struc.files"><div class="titlepage"><div><div><h2 class="title" id="sec.pam.struc.files"><span class="number">2.2 </span><span class="name">Structure of a PAM Configuration File</span> <a title="Permalink" class="permalink" href="cha.pam.html#sec.pam.struc.files">#</a></h2></div></div></div><p>
   PAM can be configured in two ways:
  </p><div class="variablelist "><dl class="variablelist"><dt id="idm140148733083456"><span class="term ">File based configuration (<code class="filename">/etc/pam.conf</code>)</span></dt><dd><p>
      The configuration of each service is stored in
      <code class="filename">/etc/pam.conf</code>. However, for maintenance and
      usability reasons, this configuration scheme is not used in
      <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span>.
     </p></dd><dt id="idm140148733079488"><span class="term ">Directory based configuration (<code class="filename">/etc/pam.d/</code>)</span></dt><dd><p>
      Every service (or program) that relies on the PAM mechanism has its
      own configuration file in the <code class="filename">/etc/pam.d/</code>
      directory. For example, the service for
      <code class="systemitem">sshd</code> can be found in the
      <code class="filename">/etc/pam.d/sshd</code> file.
     </p></dd></dl></div><p>
   The files under <code class="filename">/etc/pam.d/</code> define the PAM modules
   used for authentication. Each file consists of lines, which define a
   service, and each line consists of a maximum of four components:
  </p><div class="verbatim-wrap"><pre class="screen"><em class="replaceable ">TYPE</em>  <em class="replaceable ">CONTROL</em>
 <em class="replaceable ">MODULE_PATH</em>  <em class="replaceable ">MODULE_ARGS</em></pre></div><p>
   The components have the following meaning:
  </p><div class="variablelist "><dl class="variablelist"><dt id="idm140148733071584"><span class="term "><em class="replaceable ">TYPE</em>
    </span></dt><dd><p>
      Declares the type of the service. PAM modules are processed as stacks.
      Different types of modules have different purposes. For example, one
      module checks the password, another verifies the location from which
      the system is accessed, and yet another reads user-specific settings.
      PAM knows about four different types of modules:
     </p><div class="variablelist "><dl class="variablelist"><dt id="idm140148733069184"><span class="term "><code class="literal">auth</code>
       </span></dt><dd><p>
         Check the user's authenticity, traditionally by querying a
         password. However, this can also be achieved with a
         chip card or through biometrics (for example, fingerprints or iris
         scan).
        </p></dd><dt id="idm140148733066896"><span class="term "><code class="literal">account</code>
       </span></dt><dd><p>
         Modules of this type check if the user has general permission to
         use the requested service. As an example, such a check should be
         performed to ensure that no one can log in with the user name of an
         expired account.
        </p></dd><dt id="idm140148733064576"><span class="term "><code class="literal">password</code>
       </span></dt><dd><p>
         The purpose of this type of module is to enable the change of an
         authentication token. Usually this is a password.
        </p></dd><dt id="idm140148733062368"><span class="term "><code class="literal">session</code>
       </span></dt><dd><p>
         Modules of this type are responsible for managing and configuring
         user sessions. They are started before and after authentication to
         log login attempts and configure the user's specific environment
         (mail accounts, home directory, system limits, etc.).
        </p></dd></dl></div></dd><dt id="idm140148733059520"><span class="term "><em class="replaceable ">CONTROL</em>
    </span></dt><dd><p>
      Indicates the behavior of a PAM module. Each module can have the
      following control flags:
     </p><div class="variablelist "><dl class="variablelist"><dt id="idm140148733057376"><span class="term "><code class="literal">required</code>
       </span></dt><dd><p>
         A module with this flag must be successfully processed before the
         authentication may proceed. After the failure of a module with the
         <code class="literal">required</code> flag, all other modules with the same
         flag are processed before the user receives a message about the
         failure of the authentication attempt.
        </p></dd><dt id="idm140148733054544"><span class="term "><code class="literal">requisite</code>
       </span></dt><dd><p>
         Modules having this flag must also be processed successfully, in
         much the same way as a module with the <code class="literal">required</code>
         flag. However, in case of failure a module with this flag gives
         immediate feedback to the user and no further modules are
         processed. In case of success, other modules are subsequently
         processed, like any modules with the <code class="literal">required</code>
         flag. The <code class="literal">requisite</code> flag can be used as a basic
         filter checking for the existence of certain conditions that are
         essential for a correct authentication.
        </p></dd><dt id="idm140148733050624"><span class="term "><code class="literal">sufficient</code>
       </span></dt><dd><p>
         After a module with this flag has been successfully processed, the
         requesting application receives an immediate message about the
         success and no further modules are processed, provided there was no
         preceding failure of a module with the <code class="literal">required</code>
         flag. The failure of a module with the
         <code class="literal">sufficient</code> flag has no direct consequences, in
         the sense that any subsequent modules are processed in their
         respective order.
        </p></dd><dt id="idm140148733047216"><span class="term "><code class="literal">optional</code>
       </span></dt><dd><p>
         The failure or success of a module with this flag does not have any
         direct consequences. This can be useful for modules that are only
         intended to display a message (for example, to tell the user that
         mail has arrived) without taking any further action.
        </p></dd><dt id="idm140148733044848"><span class="term "><code class="literal">include</code>
       </span></dt><dd><p>
         If this flag is given, the file specified as argument is inserted
         at this place.
        </p></dd></dl></div></dd><dt id="idm140148733042192"><span class="term "><em class="replaceable ">MODULE_PATH</em>
    </span></dt><dd><p>
      Contains a full file name of a PAM module. It does not need to be
      specified explicitly, as long as the module is located in the default
      directory <code class="filename">/lib/security</code> (for all 64-bit platforms
      supported by <span class="productname"><span class="phrase">SUSE® Linux Enterprise Desktop</span></span>, the directory is
      <code class="filename">/lib64/security</code>).
     </p></dd><dt id="idm140148733037888"><span class="term "><em class="replaceable ">MODULE_ARGS</em>
    </span></dt><dd><p>
      Contains a space-separated list of options to influence the behavior
      of a PAM module, such as <code class="option">debug</code> (enables debugging) or
      <code class="option">nullok</code> (allows the use of empty passwords).
     </p></dd></dl></div><p>
   In addition, there are global configuration files for PAM modules under
   <code class="filename">/etc/security</code>, which define the exact behavior of
   these modules (examples include <code class="filename">pam_env.conf</code> and
   <code class="filename">time.conf</code>). Every application that uses a PAM module
   actually calls a set of PAM functions, which then process the information
   in the various configuration files and return the result to the
   requesting application.
  </p><p>
   To simplify the creation and maintenance of PAM modules, common default
   configuration files for the types <code class="literal">auth</code>,
   <code class="literal">account</code>, <code class="literal">password</code>, and
   <code class="literal">session</code> modules have been introduced. These are
   retrieved from every application's PAM configuration. Updates to the
   global PAM configuration modules in <code class="filename">common-*</code> are
   thus propagated across all PAM configuration files without requiring the
   administrator to update every single PAM configuration file.
  </p><p>
   The global PAM configuration files are maintained using the
   <code class="command">pam-config</code> tool. This tool automatically adds new
   modules to the configuration, changes the configuration of existing ones
   or deletes modules (or options) from the configurations. Manual
   intervention in maintaining PAM configurations is minimized or no longer
   required.
  </p><div id="idm140148733028224" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.png" /><h6>Note: 64-Bit and 32-Bit Mixed Installations</h6><p>
    When using a 64-bit operating system, it is possible to also include a
    runtime environment for 32-bit applications. In this case, make sure
    that you also install the 32-bit version of the PAM modules.
   </p></div></div><div class="sect1 " id="sec.pam.struc.format"><div class="titlepage"><div><div><h2 class="title" id="sec.pam.struc.format"><span class="number">2.3 </span><span class="name">The PAM Configuration of sshd</span> <a title="Permalink" class="permalink" href="cha.pam.html#sec.pam.struc.format">#</a></h2></div></div></div><p>
   Consider the PAM configuration of sshd as an example:
  </p><div class="example" id="dat.pam.sshd"><div class="example-title-wrap"><h6 class="example-title"><span class="number">Example 2.1: </span><span class="name">PAM Configuration for sshd (<code class="filename">/etc/pam.d/sshd</code>) </span><a title="Permalink" class="permalink" href="cha.pam.html#dat.pam.sshd">#</a></h6></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen">#%PAM-1.0 <span id="co.security.pam.sshd.pam-line"></span><span class="callout">1</span>
auth     requisite      pam_nologin.so                              <span id="co.security.pam.sshd.pam_nologin"></span><span class="callout">2</span>
auth     include        common-auth                                 <span id="co.security.pam.sshd.common-auth"></span><span class="callout">3</span>
account  requisite      pam_nologin.so                              <a class="xref" href="cha.pam.html#co.security.pam.sshd.pam_nologin"><span class="callout">2</span></a>
account  include        common-account                              <a class="xref" href="cha.pam.html#co.security.pam.sshd.common-auth"><span class="callout">3</span></a>
password include        common-password                             <a class="xref" href="cha.pam.html#co.security.pam.sshd.common-auth"><span class="callout">3</span></a>
session  required       pam_loginuid.so                             <span id="co.security.pam.sshd.pam_loginuid"></span><span class="callout">4</span>
session  include        common-session                              <a class="xref" href="cha.pam.html#co.security.pam.sshd.common-auth"><span class="callout">3</span></a>
session  optional       pam_lastlog.so   silent noupdate showfailed <span id="co.security.pam.sshd.lastlog"></span><span class="callout">5</span></pre></div><div class="calloutlist "><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#co.security.pam.sshd.pam-line"><span class="callout">1</span></a> </p></td><td valign="top" align="left"><p>
      Declares the version of this configuration file for PAM 1.0. This is
      merely a convention, but could be used in the future to check the
      version.
     </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co.security.pam.sshd.pam_nologin"><span class="callout">2</span></a> </p></td><td valign="top" align="left"><p>
      Checks, if <code class="filename">/etc/nologin</code> exists. If it does, no
      user other than <code class="systemitem">root</code> may log
      in.
     </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co.security.pam.sshd.common-auth"><span class="callout">3</span></a> </p></td><td valign="top" align="left"><p>
      Refers to the configuration files of four module types:
      <code class="filename">common-auth</code>, <code class="filename">common-account</code>,
      <code class="filename">common-password</code>, and
      <code class="filename">common-session</code>. These four files hold the default
      configuration for each module type.
     </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co.security.pam.sshd.pam_loginuid"><span class="callout">4</span></a> </p></td><td valign="top" align="left"><p>
      Sets the login uid process attribute for the process that was
      authenticated.
     </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co.security.pam.sshd.lastlog"><span class="callout">5</span></a> </p></td><td valign="top" align="left"><p>
      Displays information about the last login of a user.
     </p></td></tr></table></div></div></div><p>
   By including the configuration files instead of adding each module
   separately to the respective PAM configuration, you automatically get an
   updated PAM configuration when an administrator changes the defaults.
   Formerly, you needed to adjust all configuration files manually for all
   applications when changes to PAM occurred or a new application was
   installed. Now the PAM configuration is made with central configuration
   files and all changes are automatically inherited by the PAM
   configuration of each service.
  </p><p>
   The first include file (<code class="filename">common-auth</code>) calls three
   modules of the <code class="literal">auth</code> type:
   <code class="systemitem">pam_env.so</code>,
   <code class="systemitem">pam_gnome_keyring.so</code> and
   <code class="systemitem">pam_unix.so</code>. See
   <a class="xref" href="cha.pam.html#dat.pam.common-auth" title="Default Configuration for the auth Section (common-auth)">Example 2.2, “Default Configuration for the <code class="literal">auth</code> Section (<code class="filename">common-auth</code>)”</a>.
  </p><div class="example" id="dat.pam.common-auth"><div class="example-title-wrap"><h6 class="example-title"><span class="number">Example 2.2: </span><span class="name">Default Configuration for the <code class="literal">auth</code> Section (<code class="filename">common-auth</code>) </span><a title="Permalink" class="permalink" href="cha.pam.html#dat.pam.common-auth">#</a></h6></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen">auth  required  pam_env.so                   <span id="co.security.pam.sshd.pam_env"></span><span class="callout">1</span>
auth  optional  pam_gnome_keyring.so         <span id="co.security.pam.sshd.gnome"></span><span class="callout">2</span>
auth  required  pam_unix.so  try_first_pass <span id="co.security.pam.sshd.pam_unix"></span><span class="callout">3</span></pre></div></div></div><div class="calloutlist "><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#co.security.pam.sshd.pam_env"><span class="callout">1</span></a> </p></td><td valign="top" align="left"><p>
     <code class="systemitem">pam_env.so</code> loads
     <code class="filename">/etc/security/pam_env.conf</code> to set the environment
     variables as specified in this file. It can be used to set the
     <code class="envar">DISPLAY</code> variable to the correct value, because the
     <code class="systemitem">pam_env</code> module knows about the
     location from which the login is taking place.
    </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co.security.pam.sshd.gnome"><span class="callout">2</span></a> </p></td><td valign="top" align="left"><p>
     <code class="systemitem">pam_gnome_keyring.so</code> checks
     the user's login and password against the GNOME key ring
    </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co.security.pam.sshd.pam_unix"><span class="callout">3</span></a> </p></td><td valign="top" align="left"><p>
     <code class="systemitem">pam_unix</code> checks the user's
     login and password against <code class="filename">/etc/passwd</code> and
     <code class="filename">/etc/shadow</code>.
    </p></td></tr></table></div><p>
   The whole stack of <code class="literal">auth</code> modules is processed before
   <code class="systemitem">sshd</code> gets any feedback about
   whether the login has succeeded. All modules of the stack having the
   <code class="literal">required</code> control flag must be processed successfully
   before <code class="systemitem">sshd</code> receives a message
   about the positive result. If one of the modules is not successful, the
   entire module stack is still processed and only then is
   <code class="systemitem">sshd</code> notified about the negative
   result.
  </p><p>
   When all modules of the <code class="literal">auth</code> type have been
   successfully processed, another include statement is processed, in this
   case, that in <a class="xref" href="cha.pam.html#dat.pam.common-account" title="Default Configuration for the account Section (common-account)">Example 2.3, “Default Configuration for the <code class="literal">account</code> Section (<code class="filename">common-account</code>)”</a>.
   <code class="filename">common-account</code> contains only one module,
   <code class="literal">pam_unix</code>. If <code class="literal">pam_unix</code> returns the
   result that the user exists, sshd receives a message announcing this
   success and the next stack of modules (<code class="literal">password</code>) is
   processed, shown in <a class="xref" href="cha.pam.html#dat.pam.common-password" title="Default Configuration for the password Section (common-password)">Example 2.4, “Default Configuration for the <code class="literal">password</code> Section (<code class="filename">common-password</code>)”</a>.
  </p><div class="example" id="dat.pam.common-account"><div class="example-title-wrap"><h6 class="example-title"><span class="number">Example 2.3: </span><span class="name">Default Configuration for the <code class="literal">account</code> Section (<code class="filename">common-account</code>) </span><a title="Permalink" class="permalink" href="cha.pam.html#dat.pam.common-account">#</a></h6></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen">account  required  pam_unix.so  try_first_pass</pre></div></div></div><div class="example" id="dat.pam.common-password"><div class="example-title-wrap"><h6 class="example-title"><span class="number">Example 2.4: </span><span class="name">Default Configuration for the <code class="literal">password</code> Section (<code class="filename">common-password</code>) </span><a title="Permalink" class="permalink" href="cha.pam.html#dat.pam.common-password">#</a></h6></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen">password  requisite  pam_cracklib.so
password  optional   pam_gnome_keyring.so  use_authtok
password  required   pam_unix.so  use_authtok nullok shadow try_first_pass</pre></div></div></div><p>
   Again, the PAM configuration of
   <code class="systemitem">sshd</code> involves only an include
   statement referring to the default configuration for
   <code class="literal">password</code> modules located in
   <code class="filename">common-password</code>. These modules must successfully be
   completed (control flags <code class="literal">requisite</code> and
   <code class="literal">required</code>) whenever the application requests the change
   of an authentication token.
  </p><p>
   Changing a password or another authentication token requires a security
   check. This is achieved with the <code class="filename">pam_cracklib</code>
   module. The <code class="filename">pam_unix</code> module used afterward carries
   over any old and new passwords from <code class="filename">pam_cracklib</code>, so
   the user does not need to authenticate again after changing the password.
   This procedure makes it impossible to circumvent the checks carried out
   by <code class="filename">pam_cracklib</code>. Whenever the
   <code class="literal">account</code> or the <code class="literal">auth</code> type are
   configured to complain about expired passwords, the
   <code class="literal">password</code> modules should also be used.
  </p><div class="example" id="dat.pam.common-session"><div class="example-title-wrap"><h6 class="example-title"><span class="number">Example 2.5: </span><span class="name">Default Configuration for the <code class="literal">session</code> Section (<code class="filename">common-session</code>) </span><a title="Permalink" class="permalink" href="cha.pam.html#dat.pam.common-session">#</a></h6></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen">session  required  pam_limits.so
session  required  pam_unix.so  try_first_pass
session  optional  pam_umask.so
session  optional  pam_systemd.so
session  optional  pam_gnome_keyring.so auto_start only_if=gdm,gdm-password,lxdm,lightdm
session  optional  pam_env.so</pre></div></div></div><p>
   As the final step, the modules of the <code class="literal">session</code> type
   (bundled in the <code class="filename">common-session</code> file) are called to
   configure the session according to the settings for the user in question.
   The <code class="filename">pam_limits</code> module loads the file
   <code class="filename">/etc/security/limits.conf</code>, which may define limits
   on the use of certain system resources. The <code class="filename">pam_unix</code>
   module is processed again. The <code class="filename">pam_umask</code> module can
   be used to set the file mode creation mask. Since this module carries the
   <code class="literal">optional</code> flag, a failure of this module would not
   affect the successful completion of the entire session module stack. The
   <code class="literal">session</code> modules are called a second time when the user
   logs out.
  </p></div><div class="sect1 " id="sec.pam.struc.conf"><div class="titlepage"><div><div><h2 class="title" id="sec.pam.struc.conf"><span class="number">2.4 </span><span class="name">Configuration of PAM Modules</span> <a title="Permalink" class="permalink" href="cha.pam.html#sec.pam.struc.conf">#</a></h2></div></div></div><p>
   Some PAM modules are configurable. The configuration files are
   located in <code class="filename">/etc/security</code>. This section briefly
   describes the configuration files relevant to the sshd
   example—<code class="filename">pam_env.conf</code> and
   <code class="filename">limits.conf</code>.
  </p><div class="sect2 " id="sec.pam.struc.conf.pamenv"><div class="titlepage"><div><div><h3 class="title" id="sec.pam.struc.conf.pamenv"><span class="number">2.4.1 </span><span class="name">pam_env.conf</span> <a title="Permalink" class="permalink" href="cha.pam.html#sec.pam.struc.conf.pamenv">#</a></h3></div></div></div><p>
    <code class="filename">pam_env.conf</code> can be used to define a standardized
    environment for users that is set whenever the
    <code class="systemitem">pam_env</code> module is called. With it, preset
    environment variables using the following syntax:
   </p><div class="verbatim-wrap"><pre class="screen"><em class="replaceable ">VARIABLE</em>  [DEFAULT=<em class="replaceable ">VALUE</em>]  [OVERRIDE=<em class="replaceable ">VALUE</em>]</pre></div><div class="variablelist "><dl class="variablelist"><dt id="idm140148732950896"><span class="term "><em class="replaceable ">VARIABLE</em>
     </span></dt><dd><p>
       Name of the environment variable to set.
      </p></dd><dt id="idm140148732948784"><span class="term "><code class="systemitem">[DEFAULT=&lt;value&gt;]</code>
     </span></dt><dd><p>
       Default <em class="replaceable ">VALUE</em> the administrator wants to
       set.
      </p></dd><dt id="idm140148732946224"><span class="term "><code class="systemitem">[OVERRIDE=&lt;value&gt;]</code>
     </span></dt><dd><p>
       Values that may be queried and set by
       <code class="systemitem">pam_env</code>, overriding the default value.
      </p></dd></dl></div><p>
    A typical example of how <code class="systemitem">pam_env</code> can be used is
    the adaptation of the <code class="envar">DISPLAY</code> variable, which is changed
    whenever a remote login takes place. This is shown in
    <a class="xref" href="cha.pam.html#dat.pam.pamenv" title="pam_env.conf">Example 2.6, “pam_env.conf”</a>.
   </p><div class="example" id="dat.pam.pamenv"><div class="example-title-wrap"><h6 class="example-title"><span class="number">Example 2.6: </span><span class="name">pam_env.conf </span><a title="Permalink" class="permalink" href="cha.pam.html#dat.pam.pamenv">#</a></h6></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen">REMOTEHOST  DEFAULT=localhost          OVERRIDE=@{PAM_RHOST}
DISPLAY     DEFAULT=${REMOTEHOST}:0.0  OVERRIDE=${DISPLAY}</pre></div></div></div><p>
    The first line sets the value of the <code class="envar">REMOTEHOST</code> variable
    to <code class="literal">localhost</code>, which is used whenever
    <code class="filename">pam_env</code> cannot determine any other value. The
    <code class="envar">DISPLAY</code> variable in turn contains the value of
    <code class="envar">REMOTEHOST</code>. Find more information in the comments in
    <code class="filename">/etc/security/pam_env.conf</code>.
   </p></div><div class="sect2 " id="sec.pam.struc.conf.pammount"><div class="titlepage"><div><div><h3 class="title" id="sec.pam.struc.conf.pammount"><span class="number">2.4.2 </span><span class="name">pam_mount.conf.xml</span> <a title="Permalink" class="permalink" href="cha.pam.html#sec.pam.struc.conf.pammount">#</a></h3></div></div></div><p>
    The purpose of <code class="systemitem">pam_mount</code> is to mount user home
    directories during the login process, and to unmount them during logout
    in an environment where a central file server keeps all the home
    directories of users. With this method, it is not necessary to mount a
    complete <code class="filename">/home</code> directory where all the user home
    directories would be accessible. Instead, only the home directory of the
    user who is about to log in, is mounted.
   </p><p>
    After installing <code class="systemitem">pam_mount</code>, a template for
    <code class="filename">pam_mount.conf.xml</code> is available in
    <code class="filename">/etc/security</code>. The description of the various
    elements can be found in the manual page <code class="command">man 5
    pam_mount.conf</code>.
   </p><p>
    A basic configuration of this feature can be done with YaST. Select
    <span class="guimenu">Network Settings</span> › <span class="guimenu">Windows Domain
    Membership</span> › <span class="guimenu">Expert Settings</span> to
    add the file server; see <a class="xref" href="cha.samba.html#sec.samba.client.inst" title="30.4. Configuring Clients">Section 30.4, “Configuring Clients”</a>.
   </p></div><div class="sect2 " id="sec.pam.struc.pamlimits"><div class="titlepage"><div><div><h3 class="title" id="sec.pam.struc.pamlimits"><span class="number">2.4.3 </span><span class="name">limits.conf</span> <a title="Permalink" class="permalink" href="cha.pam.html#sec.pam.struc.pamlimits">#</a></h3></div></div></div><p>
    System limits can be set on a user or group basis in
    <code class="filename">limits.conf</code>, which is read by the
    <code class="systemitem">pam_limits</code> module. The file allows you to set
    hard limits, which may not be exceeded, and soft limits, which
    may be exceeded temporarily. For more information about the syntax and
    the options, see the comments in
    <code class="filename">/etc/security/limits.conf</code>.
   </p></div></div><div class="sect1 " id="sec.pam.pam-config"><div class="titlepage"><div><div><h2 class="title" id="sec.pam.pam-config"><span class="number">2.5 </span><span class="name">Configuring PAM Using pam-config</span> <a title="Permalink" class="permalink" href="cha.pam.html#sec.pam.pam-config">#</a></h2></div></div></div><p>
   The <code class="command">pam-config</code> tool helps you configure the global PAM
   configuration files (<code class="filename">/etc/pam.d/common-*</code>) and
   several selected application configurations. For a list of supported
   modules, use the <code class="command">pam-config --list-modules</code> command.
   Use the <code class="command">pam-config</code> command to maintain your PAM
   configuration files. Add new modules to your PAM configurations, delete
   other modules or modify options to these modules. When changing global
   PAM configuration files, no manual tweaking of the PAM setup for
   individual applications is required.
  </p><p>
   A simple use case for <code class="command">pam-config</code> involves the
   following:
  </p><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p><span class="formalpara-title">Auto-generate a fresh Unix-style PAM configuration. </span>
      Let pam-config create the simplest possible setup which you can extend
      later on. The <code class="command">pam-config --create</code> command creates a
      simple Unix authentication configuration. Pre-existing configuration
      files not maintained by pam-config are overwritten, but backup copies
      are kept as <code class="literal">*.pam-config-backup</code>.
     </p></li><li class="step "><p><span class="formalpara-title">Add a new authentication method. </span>
      Adding a new authentication method (for example, LDAP) to your stack
      of PAM modules comes down to a simple <code class="command">pam-config --add
      --ldap</code> command. LDAP is added wherever appropriate across
      all <code class="filename">common-*-pc</code> PAM configuration files.
     </p></li><li class="step "><p><span class="formalpara-title">Add debugging for test purposes. </span>
      To make sure the new authentication procedure works as planned, turn
      on debugging for all PAM-related operations. The <code class="command">pam-config
      --add --ldap-debug</code> turns on debugging for LDAP-related PAM
      operations. Find the debugging output in the <code class="systemitem">systemd</code> journal (see
      <a class="xref" href="cha.journalctl.html" title="Chapter 16. journalctl: Query the systemd Journal">Chapter 16, <em><code class="command">journalctl</code>: Query the <code class="systemitem">systemd</code> Journal</em></a>).
     </p></li><li class="step "><p><span class="formalpara-title">Query your setup. </span>
      Before you finally apply your new PAM setup, check if it contains all
      the options you wanted to add. The <code class="command">pam-config --query
      --</code> <em class="replaceable ">MODULE</em> lists both the type and
      the options for the queried PAM module.
     </p></li><li class="step "><p><span class="formalpara-title">Remove the debug options. </span>
      Finally, remove the debug option from your setup when you are entirely
      satisfied with the performance of it. The <code class="command">pam-config --delete
      --ldap-debug</code> command turns off debugging for LDAP
      authentication. In case you had debugging options added for other
      modules, use similar commands to turn these off.
     </p></li></ol></div></div><p>
   For more information on the <code class="command">pam-config</code> command and the
   options available, refer to the manual page of
   <code class="command">pam-config(8)</code>.
  </p></div><div class="sect1 " id="sec.pam.manual-config"><div class="titlepage"><div><div><h2 class="title" id="sec.pam.manual-config"><span class="number">2.6 </span><span class="name">Manually Configuring PAM</span> <a title="Permalink" class="permalink" href="cha.pam.html#sec.pam.manual-config">#</a></h2></div></div></div><p>
   If you prefer to manually create or maintain your PAM configuration
   files, make sure to disable <code class="command">pam-config</code> for these
   files.
  </p><p>
   When you create your PAM configuration files from scratch using the
   <code class="command">pam-config --create</code> command, it creates symbolic links
   from the <code class="filename">common-<em class="replaceable ">*</em></code> to the
   <code class="filename">common-<em class="replaceable ">*</em>-pc</code> files.
   <code class="command">pam-config</code> only modifies the
   <code class="filename">common-<em class="replaceable ">*</em>-pc</code> configuration
   files. Removing these symbolic links effectively disables pam-config,
   because pam-config only operates on the
   <code class="filename">common-<em class="replaceable ">*</em>-pc</code> files and
   these files are not put into effect without the symbolic links.
  </p><div id="idm140148732895792" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.png" /><h6>Warning: Include <code class="filename">pam_systemd.so</code> into Configuration</h6><p>
    If you are creating your own PAM configuration, make sure to include
    a <code class="literal">session  optional  pam_systemd.so</code>. Not including
    the <code class="literal">pam_systemd.so</code> can cause problems with
    <code class="systemitem">systemd</code> task limits. For details, refer to the man page of
    <code class="literal">pam_systemd.so</code>.
   </p></div></div><div class="sect1 " id="sec.pam.info"><div class="titlepage"><div><div><h2 class="title" id="sec.pam.info"><span class="number">2.7 </span><span class="name">For More Information</span> <a title="Permalink" class="permalink" href="cha.pam.html#sec.pam.info">#</a></h2></div></div></div><p>
   In the <code class="filename">/usr/share/doc/packages/pam</code> directory after
   installing the <code class="systemitem">pam-doc</code> package, find the
   following additional documentation:
  </p><div class="variablelist "><dl class="variablelist"><dt id="idm140148732888800"><span class="term ">READMEs</span></dt><dd><p>
      In the top level of this directory, there is the
      <code class="filename">modules</code> subdirectory holding README files about
      the available PAM modules.
     </p></dd><dt id="idm140148732886448"><span class="term ">The Linux-PAM System Administrators' Guide</span></dt><dd><p>
      This document comprises everything that the system administrator
      should know about PAM. It discusses a range of topics, from the syntax
      of configuration files to the security aspects of PAM.
     </p></dd><dt id="idm140148732884432"><span class="term ">The Linux-PAM Module Writers' Manual</span></dt><dd><p>
      This document summarizes the topic from the developer's point of view,
      with information about how to write standard-compliant PAM modules.
     </p></dd><dt id="idm140148732882480"><span class="term ">The Linux-PAM Application Developers' Guide</span></dt><dd><p>
      This document comprises everything needed by an application developer
      who wants to use the PAM libraries.
     </p></dd><dt id="idm140148732880544"><span class="term ">The PAM Manual Pages</span></dt><dd><p>
      PAM in general and the individual modules come with manual
      pages that provide a good overview of the functionality of all the
      components.
     </p></dd></dl></div></div></div></div><div class="page-bottom"><div id="_bottom-navigation"><a class="nav-link" href="cha.nis.html"><span class="next-icon">→</span><span class="nav-label"><span class="number">Chapter 3 </span>Using NIS</span></a><a class="nav-link" href="part.auth.html"><span class="prev-icon">←</span><span class="nav-label"><span class="number">Part I </span>Authentication</span></a></div><div id="_share-print"><div class="online-contents share"><strong>Share this page: </strong><span class="share-buttons"><span id="_share-fb" class="bottom-button">Facebook</span><span class="spacer"> • </span><span id="_share-gp" class="bottom-button">Google+</span><span class="spacer"> • </span><span id="_share-tw" class="bottom-button">Twitter</span><span class="spacer"> • </span><span id="_share-mail" class="bottom-button">E-Mail</span></span></div><div class="print"><span id="_print-button" class="bottom-button">Print this page</span></div><div class="clearme"></div></div></div></div><div id="_inward"></div></div><div id="_footer-wrap"><div id="_footer"><p>©
        2018 
        SUSE</p><ul><li><a href="http://www.suse.com/company/careers/" target="_top">Careers</a></li><li><a href="http://www.suse.com/company/legal/" target="_top">Legal</a></li><li><a href="http://www.suse.com/company/" target="_top">About</a></li><li><a href="http://www.suse.com/ContactsOffices/contacts_offices.jsp" target="_top">Contact Us</a></li></ul></div></div></body></html>