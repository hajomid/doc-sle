<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang=""><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Advanced Topics | Subscription Management Tool for SLES 15 | SUSE Linux Enterprise Desktop 15</title><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" /><link rel="stylesheet" type="text/css" href="static/css/style.css" /><link rel="stylesheet" type="text/css" href="static/css/highlight.css" /><meta name="generator" content="DAPS 2.4.0 using SUSE XSL Stylesheets 2.0.8 (based on DocBook XSL Stylesheets 1.78.1) - chunked" /><meta name="product-name" content="SUSE Linux Enterprise Desktop" /><meta name="product-number" content="15" /><meta name="book-title" content="Subscription Management Tool for SLES 15" /><meta name="chapter-title" content="Chapter 9. Advanced Topics" /><meta name="tracker-url" content="https://bugzilla.suse.com/enter_bug.cgi" /><meta name="tracker-type" content="bsc" /><meta name="tracker-bsc-assignee" content="fs@suse.com" /><meta name="tracker-bsc-component" content="Documentation" /><meta name="tracker-bsc-product" content="Beta SUSE Linux Enterprise Desktop 15" /><link rel="home" href="index.html" title="SUSE Linux Enterprise Desktop Documentation" /><link rel="up" href="index.html" title="Subscription Management Tool for SLES 15" /><link rel="prev" href="smt.client.html" title="Chapter 8. Configuring Clients to Use SMT" /><link rel="next" href="smt.app.api.html" title="Appendix A. SMT REST API" /><script type="text/javascript">

var protocol = window.location.protocol.toLowerCase();
if ( protocol != 'file:' ) {
  var agent = navigator.userAgent.toLowerCase();
  var wanted = ( protocol == 'https:') ? 'https' : 'http';
  var file = 'fonts.css';
  document.write('<link rel="stylesheet" type="text/css" href="' + wanted + '://static.opensuse.org/fonts/'+ file +'"></link>');
}
else {
   document.write('<link rel="stylesheet" type="text/css" href="static/css/fonts-onlylocal.css"></link>');
}

</script><noscript><link rel="stylesheet" type="text/css" href="http://static.opensuse.org/fonts/fonts.css" /></noscript><script src="static/js/jquery-1.10.2.min.js" type="text/javascript"></script><script src="static/js/script.js" type="text/javascript"></script><script src="static/js/highlight.min.js" type="text/javascript"></script><script>

$(document).ready(function() {
  $('.verbatim-wrap.highlight').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});
hljs.configure({
  useBR: false
});

</script></head><body class="draft offline js-off"><div id="_outer-wrap"><div id="_white-bg"><div id="_header"><div id="_logo"><img src="static/images/logo.png" alt="Logo" /></div><div class="crumbs"><a class="book-link" href="index.html" title="SUSE Linux Enterprise Desktop Documentation"><span class="book-icon">SUSE Linux Enterprise Desktop Documentation</span></a><span> › </span><a class="crumb" href="index.html">SMT Guide</a><span> › </span><a class="crumb" href="smt.advanced.html">Advanced Topics</a></div><div class="clearme"></div></div></div><div id="_toolbar-wrap"><div id="_toolbar"><div id="_toc-area" class="inactive"><a id="_toc-area-button" class="tool" title="Contents" accesskey="c" href="index.html"><span class="tool-spacer"><span class="toc-icon">Contents</span><span class="clearme"></span></span><span class="tool-label">Contents</span></a><div class="active-contents bubble-corner"></div><div class="active-contents bubble"><div class="bubble-container"><h6>Subscription Management Tool for SLES 15</h6><div id="_bubble-toc"><ol><li class="inactive"><a href="pre_smt.html"><span class="number"> </span><span class="name">About This Guide</span></a></li><li class="inactive"><a href="smt.installation.html"><span class="number">1 </span><span class="name">SMT Installation</span></a></li><li class="inactive"><a href="smt.server.html"><span class="number">2 </span><span class="name">SMT Server Configuration</span></a></li><li class="inactive"><a href="smt.mirroring.html"><span class="number">3 </span><span class="name">Mirroring Repositories on the SMT Server</span></a></li><li class="inactive"><a href="smt.management.html"><span class="number">4 </span><span class="name">Managing Repositories with YaST SMT Server Management</span></a></li><li class="inactive"><a href="smt.registration.html"><span class="number">5 </span><span class="name">Managing Client Machines with SMT</span></a></li><li class="inactive"><a href="smt.reporting.html"><span class="number">6 </span><span class="name">SMT Reports</span></a></li><li class="inactive"><a href="smt.tools.html"><span class="number">7 </span><span class="name">SMT Tools and Configuration Files</span></a></li><li class="inactive"><a href="smt.client.html"><span class="number">8 </span><span class="name">Configuring Clients to Use SMT</span></a></li><li class="inactive"><a href="smt.advanced.html"><span class="number">9 </span><span class="name">Advanced Topics</span></a></li><li class="inactive"><a href="smt.app.api.html"><span class="number">A </span><span class="name">SMT REST API</span></a></li></ol></div><div class="clearme"></div></div></div></div><div id="_nav-area" class="inactive"><div class="tool"><span class="nav-inner"><span class="tool-label">Navigation</span><a accesskey="p" class="tool-spacer" title="Chapter 8. Configuring Clients to Use SMT" href="smt.client.html"><span class="prev-icon">←</span></a><a accesskey="n" class="tool-spacer" title="Appendix A. SMT REST API" href="smt.app.api.html"><span class="next-icon">→</span></a></span></div></div></div></div><div id="_fixed-header-wrap" class="inactive"><div id="_fixed-header"><div class="crumbs"><a class="book-link" href="index.html" title="SUSE Linux Enterprise Desktop Documentation"><span class="book-icon">SUSE Linux Enterprise Desktop Documentation</span></a><span> › </span><a class="crumb" href="index.html">SMT Guide</a><span> › </span><a class="crumb" href="smt.advanced.html">Advanced Topics</a></div><div class="buttons"><a class="top-button button" href="#">Top</a><div class="button"><a accesskey="p" class="tool-spacer" title="Chapter 8. Configuring Clients to Use SMT" href="smt.client.html"><span class="prev-icon">←</span></a><a accesskey="n" class="tool-spacer" title="Appendix A. SMT REST API" href="smt.app.api.html"><span class="next-icon">→</span></a></div><div class="clearme"></div></div><div class="clearme"></div></div></div><div id="_content" class="draft "><div class="documentation"><div class="chapter " id="smt.advanced"><div class="titlepage"><div><div class="version-info">Applies to  <span class="productname"><span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span></span> <span class="productnumber"><span class="productnumber"><span class="phrase">15</span></span></span></div><div><h1 class="title"><span class="number">9 </span><span class="name">Advanced Topics</span> </h1><div class="doc-status"><ul><li><span class="ds-label">Filename: </span>smt_advanced.xml</li><li><span class="ds-label">ID: </span>smt.advanced</li></ul></div></div></div></div><div class="line"><div class="toc"><dl><dt><span class="sect1"><a href="smt.advanced.html#smt.backup"><span class="number">9.1 </span><span class="name">Backup of the SMT Server</span></a></span></dt><dt><span class="sect1"><a href="smt.advanced.html#smt.disconnected"><span class="number">9.2 </span><span class="name">Disconnected SMT Servers</span></a></span></dt></dl></div></div><p>
  This chapter covers usage scenarios beyond the regular workflow to
  give you more control over your SMT server.
 </p><div class="sect1 " id="smt.backup"><div class="titlepage"><div><div><h2 class="title" id="smt.backup"><span class="number">9.1 </span><span class="name">Backup of the SMT Server</span> <a title="Permalink" class="permalink" href="smt.advanced.html#smt.backup">#</a></h2></div></div></div><p>
   Creating backups of the SMT server regularly can help restore it quickly
   and reliably if the server fails.
  </p><p>
   There are three main parts on the SMT server to back up:
  </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
     Configuration files
    </p></li><li class="listitem "><p>
     Package repositories
    </p></li><li class="listitem "><p>
     The database
    </p></li></ul></div><div class="sect2 " id="smt.backup.conf_files"><div class="titlepage"><div><div><h3 class="title" id="smt.backup.conf_files"><span class="number">9.1.1 </span><span class="name">Configuration Files and Repositories</span> <a title="Permalink" class="permalink" href="smt.advanced.html#smt.backup.conf_files">#</a></h3></div></div></div><p>
    The SMT server configuration is stored in the
    <code class="filename">/etc/smt.conf</code> file and files in the
    <code class="filename">/etc/smt.d</code> directory.
   </p><p>
    As SMT depends on the services provided by the Apache Web server and
    MariaDB database engine, you need to back up their configuration files as
    well. Apache configuration files are located in the
    <code class="filename">/etc/apache2</code> directory, while configuration of
    MariaDB is stored in <code class="filename">/etc/my.cnf</code>,
    <code class="filename">/etc/mysqlaccess.conf</code>, and files in the
    <code class="filename">/etc/my.cnf.d</code> directory.
   </p><p>
    Package repositories are stored in the
    <code class="filename">/srv/www/htdocs/repo</code> directory. While you can
    normally mirror the repositories on the restored server from the update
    server as well, the download can take a long time. Therefore backing up the
    repositories can save you time and bandwidth. Moreover, backing up
    the repositories is necessary if you are using repository staging and
    want to restore the snapshots of the repositories (see
    <a class="xref" href="smt.mirroring.html#smt.staging" title="3.6. Testing and Filtering Update Repositories with Staging">Section 3.6, “Testing and Filtering Update Repositories with Staging”</a>).
   </p><div id="idm139760508953776" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.png" /><h6>Warning: Size of the Repositories</h6><p>
     The software repositories can be significant in size, and you will need to
     transfer them from the update server.
    </p></div><p>
    Use your preferred tool to back up the configuration and repository files.
   </p></div><div class="sect2 " id="smt.backup.db"><div class="titlepage"><div><div><h3 class="title" id="smt.backup.db"><span class="number">9.1.2 </span><span class="name">The Database</span> <a title="Permalink" class="permalink" href="smt.advanced.html#smt.backup.db">#</a></h3></div></div></div><p>
    SMT uses the MariaDB database to store information about clients,
    registrations, machine data, which repositories are enabled for mirroring, and
    custom repositories. Unlike the configuration files and repositories, the
    database information cannot be recovered without a valid backup.
   </p><p>
    To back up the SMT database, you can for example create a cron job that
    performs an SQL dump into a plain text file:
   </p><div class="verbatim-wrap"><pre class="screen">mysqldump -u root -p <em class="replaceable ">SMT_DB_PASSWORD</em> smt &gt; /<em class="replaceable ">BACKUP_DIR</em>/smt-db-backup.sql</pre></div><p>
    Then add the resulting file to your regular backup jobs.
   </p></div></div><div class="sect1 " id="smt.disconnected"><div class="titlepage"><div><div><h2 class="title" id="smt.disconnected"><span class="number">9.2 </span><span class="name">Disconnected SMT Servers</span> <a title="Permalink" class="permalink" href="smt.advanced.html#smt.disconnected">#</a></h2></div></div></div><p>
   In some restricted environments it is not possible for SMT servers to
   access the Internet because they are located on disconnected or isolated
   networks. In this case, you can back up the relevant data on an external
   storage device using special parameters with the SMT commands.
  </p><p>
   You need an external SMT server that mirrors the repositories
   from SUSE Customer Center. Then you can transfer these repositories to the SMT servers on
   the isolated network using the external storage device.
  </p><div class="figure" id="idm139760508944512"><div class="figure-contents"><div class="mediaobject"><a xmlns="" href="images/smt_disconnected.png"><img src="images/smt_disconnected.png" width="" alt="SMT Disconnected Setup" /></a></div></div><div class="figure-title-wrap"><h6 class="figure-title"><span class="number">Figure 9.1: </span><span class="name">SMT Disconnected Setup </span><a title="Permalink" class="permalink" href="smt.advanced.html#idm139760508944512">#</a></h6></div></div><p>
   Although the initial setup of this solution requires additional
   configuration, the regular update synchronization with SUSE Customer Center and
   distribution to isolated servers is simple. The steps required during the
   initial setup are as follows:
  </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
     Installing and configuring the external SMT server
    </p></li><li class="listitem "><p>
     Installing the internal server
    </p></li><li class="listitem "><p>
     Editing <code class="filename">/etc/smt.conf</code> and setting up a cron job on the
     internal SMT server
    </p></li><li class="listitem "><p>
     Transferring the SUSE Customer Center data from the external SMT server  to
     the internal server
    </p></li><li class="listitem "><p>
     Enabling and disabling repositories on the internal server
    </p></li><li class="listitem "><p>
     Creating an SMT database replacement file on the
     internal server—when performing the mirror jobs, the file can be used
     instead of the normal MariaDB database
    </p></li></ul></div><p>
   Day-to-day operation requires the following actions:
  </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
      Running the <code class="command">smt-mirror</code> job on the external
      server
    </p></li><li class="listitem "><p>
     Synchronizing the mirrored repositories from the external storage device to the
     internal SMT server
    </p></li></ul></div><p>
   Below is a detailed description of the individual steps.
  </p><div class="procedure " id="idm139760508928336"><div class="procedure-title-wrap"><h6 class="procedure-title"><span class="number">Procedure 9.1: </span><span class="name">External SMT Server Configuration for the Disconnected Setup </span><a title="Permalink" class="permalink" href="smt.advanced.html#idm139760508928336">#</a></h6></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
     Install and configure SMT as described in
     <a class="xref" href="smt.installation.html" title="Chapter 1. SMT Installation">Chapter 1, <em>SMT Installation</em></a>.
    </p></li><li class="step "><p>
     Enable the repositories for use by the internal SMT servers.
    </p></li><li class="step "><p>
     Perform a standard repository mirroring from SUSE Customer Center with
     <code class="command">smt-mirror</code>.
    </p></li><li class="step "><p>
     Attach a removable storage device to the server and mount it.
    </p></li><li class="step "><p>
     Export the required SUSE Customer Center data to a directory on the mounted storage device:
    </p><ol type="a" class="substeps "><li class="step "><p>
       Create a directory with correct permissions for storing the data. Because
       the <code class="command">smt</code> commands run as the
       <code class="systemitem">smt</code> user (whose numeric UID
       can differ between the servers), you need to make permissions for
       the directories on the external storage device less restrictive:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code>chmod o+w <em class="replaceable ">/path/to/scc/dir/on/storage/device</em></pre></div></li><li class="step "><p>
       Export the SUSE Customer Center data:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> smt-sync --todir <em class="replaceable ">/path/to/scc/dir/on/storage/device</em></pre></div></li></ol></li><li class="step "><p>
     Create a directory with correct permissions:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code>mkdir <em class="replaceable ">/path/to/repository/on/storage/device</em>
<code class="prompt user">tux &gt; </code>chmod o+w <em class="replaceable ">/path/to/repository/on/storage/device</em></pre></div></li><li class="step "><p>
     Unmount and detach the storage device.
    </p></li></ol></div></div><div class="procedure " id="idm139760508911744"><div class="procedure-title-wrap"><h6 class="procedure-title"><span class="number">Procedure 9.2: </span><span class="name">Internal SMT Server Configuration for the Disconnected Setup </span><a title="Permalink" class="permalink" href="smt.advanced.html#idm139760508911744">#</a></h6></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
     Ensure you have a working SUSE Linux Enterprise Server installation source.
    </p></li><li class="step "><p>
     Install SMT the same way as on the external server with the following
     exceptions:
    </p><ol type="a" class="substeps "><li class="step "><p>
       Select <span class="guimenu">Generate new SCC credentials</span> in the
       <span class="guimenu">SCC Credentials</span> dialog.
      </p></li><li class="step "><p>
       Ignore the error message when running the synchronization script in the
       <span class="guimenu">Writing SMT Configuration</span> phase of the wizard.
      </p></li><li class="step "><p>
       Abort the <span class="guimenu">SUSE Customer Center Configuration</span> wizard
       and click <span class="guimenu">OK</span> in the list of installed add-on
       products.
      </p></li></ol></li><li class="step "><p>
     Re-launch the YaST Subscription Management Tool Server Configuration module (<code class="command">yast2
     smt-server</code>) and go to the<span class="guimenu"> Scheduled SMT Jobs</span>
     tab.
    </p></li><li class="step "><p>
     Delete <code class="literal">SCC Registration</code> and <code class="literal">Synchronization of Updates</code> jobs.
    </p></li><li class="step "><p>
     Click <span class="guimenu">OK</span> to finish the wizard, provide the SMT
     user password, and acknowledge the synchronization error again.
    </p></li><li class="step "><p>
     Prevent registration data upstream synchronization to SUSE Customer Center by setting
    </p><div class="verbatim-wrap"><pre class="screen">forwardRegistration = false</pre></div><p>
     in <code class="filename">/etc/smt.conf</code>.
    </p></li><li class="step "><p>
     Connect an external storage device and mount it.
    </p></li><li class="step "><p>
     Populate the SMT database with the previously created SUSE Customer Center data:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> smt-sync --fromdir <em class="replaceable ">/path/to/scc/dir/on/mobile/disk</em></pre></div></li><li class="step "><p>
     Enable mirroring of the desired repositories using the <code class="command">smt-repos
     -e</code> command.
    </p></li><li class="step "><p>
     Create a database replacement file on the external storage device:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> smt-sync --createdbreplacementfile <em class="replaceable ">/path/to/dbrepl/file/on/mobile/disk</em></pre></div></li><li class="step "><p>
     Unmount and detach the storage device.
    </p></li></ol></div></div><p>
   Now the configuration of both the external and internal SMT servers is
   complete. However, the update repository is still empty. After you run the
   following daily operation routines for the first time, the repository will
   be synchronized, and the internal SMT server will be ready to serve clients.
  </p><div class="procedure " id="idm139760508887232"><div class="procedure-title-wrap"><h6 class="procedure-title"><span class="number">Procedure 9.3: </span><span class="name">Daily External SMT Server Operation </span><a title="Permalink" class="permalink" href="smt.advanced.html#idm139760508887232">#</a></h6></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
     Connect an external storage device and mount it.
    </p></li><li class="step "><p>
     Perform a mirror to a directory on the storage device based on the file
     stored on it:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> smt-mirror --dbreplfile <em class="replaceable ">/path/to/dbrepl/file/on/storage/device</em> \
 --fromlocalsmt --directory <em class="replaceable ">/path/to/repository/on/storage/device</em> \
 -L /var/log/smt/smt-mirror-example.log</pre></div></li><li class="step "><p>
     Update the database on the storage device with the product and subscription
     info from SUSE Customer Center:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> smt-sync --todir <em class="replaceable ">/path/to/scc/dir/on/storage/device</em></pre></div></li><li class="step "><p>
     Optionally, scan the storage device for viruses and other unwanted content.
    </p></li><li class="step "><p>
     Unmount and disconnect the storage device.
    </p></li></ol></div></div><div class="procedure " id="idm139760508878160"><div class="procedure-title-wrap"><h6 class="procedure-title"><span class="number">Procedure 9.4: </span><span class="name">Daily Internal SMT Server Operation </span><a title="Permalink" class="permalink" href="smt.advanced.html#idm139760508878160">#</a></h6></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
     Connect a storage device and mount it.
    </p></li><li class="step "><p>
     Update the SUSE Customer Center data on the server:
    </p><div class="verbatim-wrap"><pre class="screen">smt-sync --fromdir <em class="replaceable ">/path/to/scc/dir/on/storage/device</em></pre></div></li><li class="step "><p>
     Mirror from the storage device to the server:
    </p><div class="verbatim-wrap"><pre class="screen">smt-mirror --fromdir <em class="replaceable ">/path/to/repository/on/storage/device</em></pre></div></li><li class="step "><p>
     Update the SUSE Customer Center data on the storage device with local changes in the mirror
     status since the last synchronization:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> smt-sync --createdbreplacementfile <em class="replaceable ">/path/to/dbrepl/file/on/storage/device</em></pre></div></li><li class="step "><p>
     Unmount and disconnect the storage device.
    </p></li></ol></div></div></div></div></div><div class="page-bottom"><div id="_bottom-navigation"><a class="nav-link" href="smt.app.api.html"><span class="next-icon">→</span><span class="nav-label"><span class="number">Appendix A </span>SMT REST API</span></a><a class="nav-link" href="smt.client.html"><span class="prev-icon">←</span><span class="nav-label"><span class="number">Chapter 8 </span>Configuring Clients to Use SMT</span></a></div><div id="_share-print"><div class="online-contents share"><strong>Share this page: </strong><span class="share-buttons"><span id="_share-fb" class="bottom-button">Facebook</span><span class="spacer"> • </span><span id="_share-gp" class="bottom-button">Google+</span><span class="spacer"> • </span><span id="_share-tw" class="bottom-button">Twitter</span><span class="spacer"> • </span><span id="_share-mail" class="bottom-button">E-Mail</span></span></div><div class="print"><span id="_print-button" class="bottom-button">Print this page</span></div><div class="clearme"></div></div></div></div><div id="_inward"></div></div><div id="_footer-wrap"><div id="_footer"><p>©
        2018 
        SUSE</p><ul><li><a href="http://www.suse.com/company/careers/" target="_top">Careers</a></li><li><a href="http://www.suse.com/company/legal/" target="_top">Legal</a></li><li><a href="http://www.suse.com/company/" target="_top">About</a></li><li><a href="http://www.suse.com/ContactsOffices/contacts_offices.jsp" target="_top">Contact Us</a></li></ul></div></div></body></html>