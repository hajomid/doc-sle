<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang=""><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Samba | Reference | openSUSE Leap 42.3</title><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" /><link rel="stylesheet" type="text/css" href="static/css/style.css" /><link rel="stylesheet" type="text/css" href="static/css/highlight.css" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><meta name="product-name" content="openSUSE Leap" /><meta name="product-number" content="42.3" /><meta name="book-title" content="Reference" /><meta name="chapter-title" content="Chapter 21. Samba" /><meta name="description" content="Using Samba, a Unix machine can be configured as a file and print server for macOS, Windows, and OS/2 machines. Samba has developed into a fully-fledged and rather complex product. Configure Samba with YaST, or by editing the configuration file manually." /><meta name="tracker-url" content="https://bugzilla.opensuse.org/enter_bug.cgi" /><meta name="tracker-type" content="bsc" /><meta name="tracker-bsc-assignee" content="fs@suse.com" /><meta name="tracker-bsc-component" content="Documentation" /><meta name="tracker-bsc-product" content="openSUSE Distribution" /><meta name="tracker-bsc-version" content="Leap 42.2" /><link rel="home" href="index.html" title="openSUSE Leap Documentation" /><link rel="up" href="part.reference.services.html" title="Part III. Services" /><link rel="prev" href="cha.dhcp.html" title="Chapter 20. DHCP" /><link rel="next" href="cha.nfs.html" title="Chapter 22. Sharing File Systems with NFS" /><script type="text/javascript">

var protocol = window.location.protocol.toLowerCase();
if ( protocol != 'file:' ) {
  var agent = navigator.userAgent.toLowerCase();
  var wanted = ( protocol == 'https:') ? 'https' : 'http';
  var file = 'fonts.css';
  document.write('<link rel="stylesheet" type="text/css" href="' + wanted + '://static.opensuse.org/fonts/'+ file +'"></link>');
}
else {
   document.write('<link rel="stylesheet" type="text/css" href="static/css/fonts-onlylocal.css"></link>');
}

</script><noscript><link rel="stylesheet" type="text/css" href="http://static.opensuse.org/fonts/fonts.css" /></noscript><script src="static/js/jquery-1.10.2.min.js" type="text/javascript"></script><script src="static/js/script.js" type="text/javascript"></script><script src="static/js/highlight.min.js" type="text/javascript"></script><script>

$(document).ready(function() {
  $('.verbatim-wrap.highlight').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});
hljs.configure({
  useBR: false
});

</script></head><body class="draft offline js-off"><div id="_outer-wrap"><div id="_white-bg"><div id="_header"><div id="_logo"><img src="static/images/logo.png" alt="Logo" /></div><div class="crumbs"><a class="book-link" href="index.html" title="openSUSE Leap Documentation"><span class="book-icon">openSUSE Leap Documentation</span></a><span> › </span><a class="crumb" href="book.opensuse.reference.html">Reference</a><span> › </span><a class="crumb" href="part.reference.services.html">Services</a><span> › </span><a class="crumb" href="cha.samba.html">Samba</a></div><div class="clearme"></div></div></div><div id="_toolbar-wrap"><div id="_toolbar"><div id="_toc-area" class="inactive"><a id="_toc-area-button" class="tool" title="Contents" accesskey="c" href="index.html"><span class="tool-spacer"><span class="toc-icon">Contents</span><span class="clearme"></span></span><span class="tool-label">Contents</span></a><div class="active-contents bubble-corner"></div><div class="active-contents bubble"><div class="bubble-container"><h6>Reference</h6><div id="_bubble-toc"><ol><li class="inactive"><a href="preface.reference.html"><span class="number"> </span><span class="name">About This Guide</span></a></li><li class="inactive"><a href="part.reference.adv_admin.html"><span class="number">I </span><span class="name">Advanced Administration</span></a><ol><li class="inactive"><a href="cha.yast.text.html"><span class="number">1 </span><span class="name">YaST in Text Mode</span></a></li><li class="inactive"><a href="cha.sw_cl.html"><span class="number">2 </span><span class="name">Managing Software with Command Line Tools</span></a></li><li class="inactive"><a href="cha.snapper.html"><span class="number">3 </span><span class="name">System Recovery and Snapshot Management with Snapper</span></a></li><li class="inactive"><a href="cha.vnc.html"><span class="number">4 </span><span class="name">Remote Access with VNC</span></a></li><li class="inactive"><a href="cha.advdisk.html"><span class="number">5 </span><span class="name">Advanced Disk Setup</span></a></li><li class="inactive"><a href="cha.tuning.multikernel.html"><span class="number">6 </span><span class="name">Installing Multiple Kernel Versions</span></a></li><li class="inactive"><a href="cha.gnome.gconf.html"><span class="number">7 </span><span class="name">GNOME Configuration for Administrators</span></a></li></ol></li><li class="inactive"><a href="part.reference.system.html"><span class="number">II </span><span class="name">System</span></a><ol><li class="inactive"><a href="cha.64bit.html"><span class="number">8 </span><span class="name">32-Bit and 64-Bit Applications in a 64-Bit System Environment</span></a></li><li class="inactive"><a href="cha.boot.html"><span class="number">9 </span><span class="name">Introduction to the Booting Process</span></a></li><li class="inactive"><a href="cha.systemd.html"><span class="number">10 </span><span class="name">The <code class="systemitem">systemd</code> Daemon</span></a></li><li class="inactive"><a href="cha.journalctl.html"><span class="number">11 </span><span class="name"><code class="command">journalctl</code>: Query the <code class="systemitem">systemd</code> Journal</span></a></li><li class="inactive"><a href="cha.grub2.html"><span class="number">12 </span><span class="name">The Boot Loader GRUB 2</span></a></li><li class="inactive"><a href="cha.network.html"><span class="number">13 </span><span class="name">Basic Networking</span></a></li><li class="inactive"><a href="cha.uefi.html"><span class="number">14 </span><span class="name">UEFI (Unified Extensible Firmware Interface)</span></a></li><li class="inactive"><a href="cha.suse.html"><span class="number">15 </span><span class="name">Special System Features</span></a></li><li class="inactive"><a href="cha.udev.html"><span class="number">16 </span><span class="name">Dynamic Kernel Device Management with <code class="systemitem">udev</code></span></a></li></ol></li><li class="inactive"><a href="part.reference.services.html"><span class="number">III </span><span class="name">Services</span></a><ol><li class="inactive"><a href="cha.slp.html"><span class="number">17 </span><span class="name">SLP</span></a></li><li class="inactive"><a href="cha.ntp.html"><span class="number">18 </span><span class="name">Time Synchronization with NTP</span></a></li><li class="inactive"><a href="cha.dns.html"><span class="number">19 </span><span class="name">The Domain Name System</span></a></li><li class="inactive"><a href="cha.dhcp.html"><span class="number">20 </span><span class="name">DHCP</span></a></li><li class="inactive"><a href="cha.samba.html"><span class="number">21 </span><span class="name">Samba</span></a></li><li class="inactive"><a href="cha.nfs.html"><span class="number">22 </span><span class="name">Sharing File Systems with NFS</span></a></li><li class="inactive"><a href="cha.autofs.html"><span class="number">23 </span><span class="name">On-Demand Mounting with Autofs</span></a></li><li class="inactive"><a href="cha.apache2.html"><span class="number">24 </span><span class="name">The Apache HTTP Server</span></a></li><li class="inactive"><a href="cha.ftp.html"><span class="number">25 </span><span class="name">Setting Up an FTP Server with YaST</span></a></li><li class="inactive"><a href="cha.squid.html"><span class="number">26 </span><span class="name">The Proxy Server Squid</span></a></li></ol></li><li class="inactive"><a href="part.reference.mobility.html"><span class="number">IV </span><span class="name">Mobile Computers</span></a><ol><li class="inactive"><a href="cha.mobile.html"><span class="number">27 </span><span class="name">Mobile Computing with Linux</span></a></li><li class="inactive"><a href="cha.nm.html"><span class="number">28 </span><span class="name">Using NetworkManager</span></a></li><li class="inactive"><a href="cha.power-mgmt.html"><span class="number">29 </span><span class="name">Power Management</span></a></li></ol></li><li class="inactive"><a href="app.nwscheme.html"><span class="number">A </span><span class="name">An Example Network</span></a></li><li class="inactive"><a href="bk02apb.html"><span class="number">B </span><span class="name">GNU Licenses</span></a></li></ol></div><div class="clearme"></div></div></div></div><div id="_nav-area" class="inactive"><div class="tool"><span class="nav-inner"><span class="tool-label">Navigation</span><a accesskey="p" class="tool-spacer" title="Chapter 20. DHCP" href="cha.dhcp.html"><span class="prev-icon">←</span></a><a accesskey="n" class="tool-spacer" title="Chapter 22. Sharing File Systems with NFS" href="cha.nfs.html"><span class="next-icon">→</span></a></span></div></div></div></div><div id="_fixed-header-wrap" class="inactive"><div id="_fixed-header"><div class="crumbs"><a class="book-link" href="index.html" title="openSUSE Leap Documentation"><span class="book-icon">openSUSE Leap Documentation</span></a><span> › </span><a class="crumb" href="book.opensuse.reference.html">Reference</a><span> › </span><a class="crumb" href="part.reference.services.html">Services</a><span> › </span><a class="crumb" href="cha.samba.html">Samba</a></div><div class="buttons"><a class="top-button button" href="#">Top</a><div class="button"><a accesskey="p" class="tool-spacer" title="Chapter 20. DHCP" href="cha.dhcp.html"><span class="prev-icon">←</span></a><a accesskey="n" class="tool-spacer" title="Chapter 22. Sharing File Systems with NFS" href="cha.nfs.html"><span class="next-icon">→</span></a></div><div class="clearme"></div></div><div class="clearme"></div></div></div><div id="_content" class="draft "><div class="documentation"><div class="chapter " id="cha.samba"><div class="titlepage"><div><div class="version-info">Applies to  <span class="productname"><span class="productname"><span class="phrase">openSUSE Leap</span></span></span> <span class="productnumber"><span class="productnumber"><span class="phrase">42.3</span></span></span></div><div><h2 class="title"><span class="number">21 </span><span class="name">Samba</span> </h2><div class="doc-status"><ul><li><span class="ds-label">Filename: </span>net_samba.xml</li><li><span class="ds-label">ID: </span>cha.samba</li></ul></div></div><div><div class="abstract"><div class="abstract-title-wrap"><h6 class="abstract-title">Abstract<a title="Permalink" class="permalink" href="cha.samba.html#idm139641289897040">#</a></h6></div><p>
    Using Samba, a Unix machine can be configured as a file and print server
    for macOS, Windows, and OS/2 machines. Samba has developed into a
    fully-fledged and rather complex product. Configure Samba with YaST, or
    by editing the configuration file manually.
   </p></div></div></div></div><div class="line"><div class="toc"><dl><dt><span class="sect1"><a href="cha.samba.html#sec.samba.term"><span class="number">21.1 </span><span class="name">Terminology</span></a></span></dt><dt><span class="sect1"><a href="cha.samba.html#sec.samba.install"><span class="number">21.2 </span><span class="name">Installing a Samba Server</span></a></span></dt><dt><span class="sect1"><a href="cha.samba.html#sec.samba.serv.start"><span class="number">21.3 </span><span class="name">Starting and Stopping Samba</span></a></span></dt><dt><span class="sect1"><a href="cha.samba.html#sec.samba.serv.inst"><span class="number">21.4 </span><span class="name">Configuring a Samba Server</span></a></span></dt><dt><span class="sect1"><a href="cha.samba.html#sec.samba.client.inst"><span class="number">21.5 </span><span class="name">Configuring Clients</span></a></span></dt><dt><span class="sect1"><a href="cha.samba.html#sec.samba.anmeld.serv"><span class="number">21.6 </span><span class="name">Samba as Login Server</span></a></span></dt><dt><span class="sect1"><a href="cha.samba.html#sec.samba.adnet"><span class="number">21.7 </span><span class="name">Samba Server in the Network with Active Directory</span></a></span></dt><dt><span class="sect1"><a href="cha.samba.html#sec.samba.advanced"><span class="number">21.8 </span><span class="name">Advanced Topics</span></a></span></dt><dt><span class="sect1"><a href="cha.samba.html#sec.samba.info"><span class="number">21.9 </span><span class="name">For More Information</span></a></span></dt></dl></div></div><div class="sect1 " id="sec.samba.term"><div class="titlepage"><div><div><h2 class="title" id="sec.samba.term"><span class="number">21.1 </span><span class="name">Terminology</span> <a title="Permalink" class="permalink" href="cha.samba.html#sec.samba.term">#</a></h2></div></div></div><p>
   The following are some terms used in Samba documentation and in the YaST
   module.
  </p><div class="variablelist "><dl class="variablelist"><dt id="idm139641289892416"><span class="term ">SMB protocol</span></dt><dd><p>
      Samba uses the SMB (server message block) protocol that is
      based on the <span class="productname">NetBIOS</span> services.
      Microsoft released the protocol so other software manufacturers could
      establish connections to a Microsoft domain network. With Samba, the SMB
      protocol works on top of the TCP/IP protocol, so the TCP/IP protocol must
      be installed on all clients.
     </p></dd><dt id="idm139641289889568"><span class="term ">CIFS protocol</span></dt><dd><p>
      CIFS (common Internet file system) protocol is another
      protocol supported by Samba. CIFS defines a standard remote file system
      access protocol for use over the network, enabling groups of users to
      work together and share documents across the network.
     </p></dd><dt id="idm139641289887504"><span class="term ">NetBIOS</span></dt><dd><p>
      NetBIOS is a software interface (API) designed for
      communication between machines providing a name service. It enables
      machines connected to the network to reserve names for themselves. After
      reservation, these machines can be addressed by name. There is no central
      process that checks names. Any machine on the network can reserve as many
      names as it wants as long as the names are not already in use. The
      NetBIOS interface can be implemented for different network architectures.
      An implementation that works relatively closely with network hardware is
      called <span class="productname">NetBEUI</span>, but this is often
      called <span class="productname">NetBIOS</span>. Network protocols
      implemented with NetBIOS are IPX from Novell (NetBIOS via TCP/IP) and
      TCP/IP.
     </p><p>
      The NetBIOS names sent via TCP/IP have nothing in common with the names
      used in <code class="filename">/etc/hosts</code> or those defined by DNS. NetBIOS
      uses its own, completely independent naming convention. However, it is
      recommended to use names that correspond to DNS host names to make
      administration easier or use DNS natively. This is the default used by
      Samba.
     </p></dd><dt id="idm139641289882320"><span class="term ">Samba server</span></dt><dd><p>
      Samba server provides SMB/CIFS services and NetBIOS over IP naming
      services to clients. For Linux, there are three daemons for Samba server:
      smbd for SMB/CIFS services, nmbd for naming services, and winbind for
      authentication.
     </p></dd><dt id="idm139641289880288"><span class="term ">Samba client</span></dt><dd><p>
      The Samba client is a system that uses Samba services from a Samba server
      over the SMB protocol. Common operating systems, such as Windows and
      macOS support the SMB protocol. The TCP/IP protocol must be
      installed on all computers. Samba provides a client for the different
      Unix flavors. For Linux, there is a kernel module for SMB that allows the
      integration of SMB resources on the Linux system level. You do not need
      to run any daemon for the Samba client.
     </p></dd><dt id="idm139641289878000"><span class="term ">Shares</span></dt><dd><p>
      SMB servers provide resources to the clients by means of
      shares. Shares are printers and directories with their subdirectories on
      the server. It is exported by means of a name and can be accessed by its
      name. The share name can be set to any name—it does not need to be
      the name of the export directory. A printer is also assigned a name.
      Clients can access the printer by its name.
     </p></dd><dt id="idm139641289875792"><span class="term ">DC</span></dt><dd><p>
      A domain controller (DC) is a server that handles accounts
      in a domain. For data replication, additional domain controllers are
      available in one domain.
     </p></dd></dl></div></div><div class="sect1 " id="sec.samba.install"><div class="titlepage"><div><div><h2 class="title" id="sec.samba.install"><span class="number">21.2 </span><span class="name">Installing a Samba Server</span> <a title="Permalink" class="permalink" href="cha.samba.html#sec.samba.install">#</a></h2></div></div></div><p>
   To install a Samba server, start YaST and select
   <span class="guimenu">Software</span> › <span class="guimenu">Software
   Management</span>. Choose
   <span class="guimenu">View</span> › <span class="guimenu">Patterns</span>
   and select <span class="guimenu">File Server</span>. Confirm the installation of the
   required packages to finish the installation process.
  </p></div><div class="sect1 " id="sec.samba.serv.start"><div class="titlepage"><div><div><h2 class="title" id="sec.samba.serv.start"><span class="number">21.3 </span><span class="name">Starting and Stopping Samba</span> <a title="Permalink" class="permalink" href="cha.samba.html#sec.samba.serv.start">#</a></h2></div></div></div><p>
   You can start or stop the Samba server automatically (during boot) or
   manually. Starting and stopping policy is a part of the YaST Samba server
   configuration described in <a class="xref" href="cha.samba.html#sec.samba.yast2.conf" title="21.4.1. Configuring a Samba Server with YaST">Section 21.4.1, “Configuring a Samba Server with YaST”</a>.
  </p><p>
   From a command line, stop services required for Samba with
   <code class="command">systemctl stop smb nmb</code> and start them with
   <code class="command">systemctl start nmb smb</code>. The <code class="literal">smb</code>
   service cares about <code class="literal">winbind</code> if needed.
  </p><div id="idm139641289864160" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.png" /><h6>Tip: <code class="systemitem">winbind</code></h6><p>
    <code class="systemitem">winbind</code> is an independent service, and as such is
    also offered as an individual <code class="systemitem">samba-winbind</code>
    package.
   </p></div></div><div class="sect1 " id="sec.samba.serv.inst"><div class="titlepage"><div><div><h2 class="title" id="sec.samba.serv.inst"><span class="number">21.4 </span><span class="name">Configuring a Samba Server</span> <a title="Permalink" class="permalink" href="cha.samba.html#sec.samba.serv.inst">#</a></h2></div></div></div><p>
   A Samba server in <span class="productname"><span class="phrase">openSUSE® Leap</span></span> can be configured in two different ways:
   with YaST or manually. Manual configuration offers a higher level of
   detail, but lacks the convenience of the YaST GUI.
  </p><div class="sect2 " id="sec.samba.yast2.conf"><div class="titlepage"><div><div><h3 class="title" id="sec.samba.yast2.conf"><span class="number">21.4.1 </span><span class="name">Configuring a Samba Server with YaST</span> <a title="Permalink" class="permalink" href="cha.samba.html#sec.samba.yast2.conf">#</a></h3></div></div></div><p>
    To configure a Samba server, start YaST and select
    <span class="guimenu">Network Services</span> › <span class="guimenu">Samba
    Server</span>.
   </p><div class="sect3 " id="sec.samba.yast2.conf.inst"><div class="titlepage"><div><div><h4 class="title" id="sec.samba.yast2.conf.inst"><span class="number">21.4.1.1 </span><span class="name">Initial Samba Configuration</span> <a title="Permalink" class="permalink" href="cha.samba.html#sec.samba.yast2.conf.inst">#</a></h4></div></div></div><p>
     When starting the module for the first time, the <span class="guimenu">Samba
     Installation</span> dialog starts, prompting you to make a few basic
     decisions concerning administration of the server. At the end of the
     configuration it prompts for the Samba administrator password
     (<span class="guimenu">Samba Root Password</span>). For later starts, the
     <span class="guimenu">Samba Configuration</span> dialog appears.
    </p><p>
     The <span class="guimenu">Samba Installation</span> dialog consists of two steps and
     optional detailed settings:
    </p><div class="variablelist "><dl class="variablelist"><dt id="idm139641289851104"><span class="term ">Workgroup or Domain Name</span></dt><dd><p>
        Select an existing name from <span class="guimenu">Workgroup or Domain
        Name</span> or enter a new one and click <span class="guimenu">Next</span>.
       </p></dd><dt id="idm139641289848352"><span class="term ">Samba Server Type</span></dt><dd><p>
        In the next step, specify whether your server should act as a primary
        domain controller (PDC), backup domain controller (BDC), or not act
        as a domain controller. Continue with <span class="guimenu">Next</span>.
       </p></dd></dl></div><p>
     If you do not want to proceed with a detailed server configuration,
     confirm with <span class="guimenu">OK</span>. Then in the final pop-up box, set the
     <span class="guimenu">Samba root Password</span>.
    </p><p>
     You can change all settings later in the <span class="guimenu">Samba
     Configuration</span> dialog with the <span class="guimenu">Start-Up</span>,
     <span class="guimenu">Shares</span>, <span class="guimenu">Identity</span>, <span class="guimenu">Trusted
     Domains</span>, and <span class="guimenu">LDAP Settings</span> tabs.
    </p></div><div class="sect3 " id="sec.samba.yast2.conf.adv"><div class="titlepage"><div><div><h4 class="title" id="sec.samba.yast2.conf.adv"><span class="number">21.4.1.2 </span><span class="name">Advanced Samba Configuration</span> <a title="Permalink" class="permalink" href="cha.samba.html#sec.samba.yast2.conf.adv">#</a></h4></div></div></div><p>
     During the first start of the Samba server module the <span class="guimenu">Samba
     Configuration</span> dialog appears directly after the two initial
     steps described in <a class="xref" href="cha.samba.html#sec.samba.yast2.conf.inst" title="21.4.1.1. Initial Samba Configuration">Section 21.4.1.1, “Initial Samba Configuration”</a>. Use it to
     adjust your Samba server configuration.
    </p><p>
     After editing your configuration, click <span class="guimenu">OK</span> to save your
     settings.
    </p><div class="sect4 " id="sec.samba.yast2.conf.adv.start"><div class="titlepage"><div><div><h5 class="title" id="sec.samba.yast2.conf.adv.start"><span class="number">21.4.1.2.1 </span><span class="name">Starting the Server</span> <a title="Permalink" class="permalink" href="cha.samba.html#sec.samba.yast2.conf.adv.start">#</a></h5></div></div></div><p>
      In the <span class="guimenu">Start Up</span> tab, configure the start of the Samba
      server. To start the service every time your system boots, select
      <span class="guimenu">During Boot</span>. To activate manual start, choose
      <span class="guimenu">Manually</span>. More information about starting a Samba
      server is provided in <a class="xref" href="cha.samba.html#sec.samba.serv.start" title="21.3. Starting and Stopping Samba">Section 21.3, “Starting and Stopping Samba”</a>.
     </p><p>
      In this tab, you can also open ports in your firewall. To do so, select
      <span class="guimenu">Open Port in Firewall</span>. If you have multiple network
      interfaces, select the network interface for Samba services by clicking
      <span class="guimenu">Firewall Details</span>, selecting the interfaces, and
      clicking <span class="guimenu">OK</span>.
     </p></div><div class="sect4 " id="sec.samba.yast2.conf.adv.shares"><div class="titlepage"><div><div><h5 class="title" id="sec.samba.yast2.conf.adv.shares"><span class="number">21.4.1.2.2 </span><span class="name">Shares</span> <a title="Permalink" class="permalink" href="cha.samba.html#sec.samba.yast2.conf.adv.shares">#</a></h5></div></div></div><p>
      In the <span class="guimenu">Shares</span> tab, determine the Samba shares to
      activate. There are some predefined shares, like homes and printers. Use
      <span class="guimenu">Toggle Status</span> to switch between
      <span class="guimenu">Active</span> and <span class="guimenu">Inactive</span>. Click
      <span class="guimenu">Add</span> to add new shares and <span class="guimenu">Delete</span> to
      delete the selected share.
     </p><p>
      <span class="guimenu">Allow Users to Share Their Directories</span> enables members
      of the group in <span class="guimenu">Permitted Group</span> to share directories
      they own with other users. For example, <code class="systemitem">users</code>
      for a local scope or <code class="systemitem">DOMAIN\Users</code> for a domain
      scope. The user also must make sure that the file system permissions
      allow access. With <span class="guimenu">Maximum Number of Shares</span>, limit the
      total amount of shares that may be created. To permit access to user
      shares without authentication, enable <span class="guimenu">Allow Guest
      Access</span>.

     </p></div><div class="sect4 " id="sec.samba.yast2.conf.adv.identity"><div class="titlepage"><div><div><h5 class="title" id="sec.samba.yast2.conf.adv.identity"><span class="number">21.4.1.2.3 </span><span class="name">Identity</span> <a title="Permalink" class="permalink" href="cha.samba.html#sec.samba.yast2.conf.adv.identity">#</a></h5></div></div></div><p>
      In the <span class="guimenu">Identity</span> tab, you can determine the domain with
      which the host is associated (<span class="guimenu">Base Settings</span>) and
      whether to use an alternative host name in the network (<span class="guimenu">NetBIOS
      Hostname</span>).

      It is also possible to use Microsoft Windows Internet Name Service (WINS)
      for name resolution. In this case, activate <span class="guimenu">Use WINS for
      Hostname Resolution</span> and decide whether to <span class="guimenu">Retrieve
      WINS server via DHCP</span>. To set expert global settings or set a
      user authentication source, <span class="phrase">for example LDAP
      instead of TDB database, </span>click <span class="guimenu">Advanced
      Settings</span>.

     </p></div><div class="sect4 " id="sec.samba.yast2.conf.adv.trusted"><div class="titlepage"><div><div><h5 class="title" id="sec.samba.yast2.conf.adv.trusted"><span class="number">21.4.1.2.4 </span><span class="name">Trusted Domains</span> <a title="Permalink" class="permalink" href="cha.samba.html#sec.samba.yast2.conf.adv.trusted">#</a></h5></div></div></div><p>
      To enable users from other domains to access your domain, make the
      appropriate settings in the <span class="guimenu">Trusted Domains</span> tab. To
      add a new domain, click <span class="guimenu">Add</span>. To remove the selected
      domain, click <span class="guimenu">Delete</span>.
     </p></div><div class="sect4 " id="sec.samba.yast2.conf.adv.ldap"><div class="titlepage"><div><div><h5 class="title" id="sec.samba.yast2.conf.adv.ldap"><span class="number">21.4.1.2.5 </span><span class="name">LDAP Settings</span> <a title="Permalink" class="permalink" href="cha.samba.html#sec.samba.yast2.conf.adv.ldap">#</a></h5></div></div></div><p>
      In the tab <span class="guimenu">LDAP Settings</span>, you can determine the LDAP
      server to use for authentication. To test the connection to your LDAP
      server, click <span class="guimenu">Test Connection</span>. To set expert LDAP
      settings or use default values, click <span class="guimenu">Advanced
      Settings</span>.
     </p><p>
      For more information about LDAP configuration, see
      <span class="intraxref">Book “<em class="citetitle ">Security Guide</em>”, Chapter 5 “LDAP—A Directory Service”</span>.
     </p></div></div></div><div class="sect2 " id="sec.samba.serv.inst.manual"><div class="titlepage"><div><div><h3 class="title" id="sec.samba.serv.inst.manual"><span class="number">21.4.2 </span><span class="name">Configuring the Server Manually</span> <a title="Permalink" class="permalink" href="cha.samba.html#sec.samba.serv.inst.manual">#</a></h3></div></div></div><p>
    If you intend to use Samba as a server, install
    <code class="systemitem">samba</code>. The main configuration
    file for Samba is <code class="filename">/etc/samba/smb.conf</code>. This file can
    be divided into two logical parts. The <code class="literal">[global]</code> section
    contains the central and global settings. The following default sections
    contain the individual file and printer shares:
   </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
      [homes]
     </p></li><li class="listitem "><p>
      [profiles]
     </p></li><li class="listitem "><p>
      [users]
     </p></li><li class="listitem "><p>
      [groups]
     </p></li><li class="listitem "><p>
      [printers]
     </p></li><li class="listitem "><p>
      [print$]
     </p></li></ul></div><p>
    Using this approach, options of the shares can be set
    differently or globally in the <code class="literal">[global]</code> section, which
    makes the configuration file easier to understand.
   </p><div class="sect3 " id="sec.samba.smb.conf.Erlaeuterung"><div class="titlepage"><div><div><h4 class="title" id="sec.samba.smb.conf.Erlaeuterung"><span class="number">21.4.2.1 </span><span class="name">The global Section</span> <a title="Permalink" class="permalink" href="cha.samba.html#sec.samba.smb.conf.Erlaeuterung">#</a></h4></div></div></div><p>
     The following parameters of the <code class="literal">[global]</code> section should
     be modified to match the requirements of your network setup, so other
     machines can access your Samba server via SMB in a Windows environment.
    </p><div class="variablelist "><dl class="variablelist"><dt id="idm139641289795360"><span class="term "><code class="literal">workgroup = WORKGROUP</code>
      </span></dt><dd><p>
        This line assigns the Samba server to a workgroup. Replace
        <code class="literal">WORKGROUP</code> with an appropriate workgroup of your
        networking environment. Your Samba server appears under its DNS name
        unless this name has been assigned to some other machine in the
        network. If the DNS name is not available, set the server name using
        <code class="literal">netbiosname=<em class="replaceable ">MYNAME</em></code>. For
        more details about this parameter, see the
        <code class="systemitem">smb.conf</code> man page.
       </p></dd><dt id="idm139641289791280"><span class="term "><code class="literal">os level = 20</code>
      </span></dt><dd><p>
        This parameter triggers whether your Samba server tries to become LMB
        (local master browser) for its workgroup. Choose a very low value such
        as <code class="literal">2</code> to spare the existing Windows network from any
        interruptions caused by a misconfigured Samba server. More information
        about this topic can be found in the Network Browsing chapter
        of the Samba 3 Howto; for more information on the Samba 3 Howto, see
        <a class="xref" href="cha.samba.html#sec.samba.info" title="21.9. For More Information">Section 21.9, “For More Information”</a>.
       </p><p>
        If no other SMB server is in your network (such as a Windows 2000
        server) and you want the Samba server to keep a list of all systems
        present in the local environment, set the <code class="literal">os level</code>
        to a higher value (for example, <code class="literal">65</code>). Your Samba
        server is then chosen as LMB for your local network.
       </p><p>
        When changing this setting, consider carefully how this could affect an
        existing Windows network environment. First test the changes in an
        isolated network or at a noncritical time of day.
       </p></dd><dt id="idm139641289785472"><span class="term "><code class="literal">wins support</code> and <code class="literal">wins server</code>
      </span></dt><dd><p>
        To integrate your Samba server into an existing Windows network with an
        active WINS server, enable the <code class="option">wins server</code> option and
        set its value to the IP address of that WINS server.
       </p><p>
        If your Windows machines are connected to separate subnets and need to
        still be aware of each other, you have to set up a WINS server. To turn
        a Samba server into such a WINS server, set the option <code class="literal">wins
        support = Yes</code>. Make sure that only one Samba server of the
        network has this setting enabled. The options <code class="literal">wins
        server</code> and <code class="literal">wins support</code> must never be
        enabled at the same time in your <code class="filename">smb.conf</code> file.
       </p></dd></dl></div></div><div class="sect3 " id="sec.samba.smb.conf.shares"><div class="titlepage"><div><div><h4 class="title" id="sec.samba.smb.conf.shares"><span class="number">21.4.2.2 </span><span class="name">Shares</span> <a title="Permalink" class="permalink" href="cha.samba.html#sec.samba.smb.conf.shares">#</a></h4></div></div></div><p>
     The following examples illustrate how a CD-ROM drive and the user
     directories (<code class="literal">homes</code>) are made available to the SMB
     clients.
    </p><div class="variablelist "><dl class="variablelist"><dt id="idm139641289776928"><span class="term ">[cdrom]</span></dt><dd><p>
        To avoid having the CD-ROM drive accidentally made available, these
        lines are deactivated with comment marks (semicolons in this case).
        Remove the semicolons in the first column to share the CD-ROM drive
        with Samba.
       </p><div class="example" id="dat.cd.rom"><div class="example-title-wrap"><h6 class="example-title"><span class="number">Example 21.1: </span><span class="name">A CD-ROM Share </span><a title="Permalink" class="permalink" href="cha.samba.html#dat.cd.rom">#</a></h6></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen">[cdrom]
       comment = Linux CD-ROM
       path = /media/cdrom
       locking = No</pre></div></div></div><div class="variablelist "><dl class="variablelist"><dt id="idm139641289773088"><span class="term "><code class="option">[cdrom]</code> and <code class="option">comment</code>
         </span></dt><dd><p>
           The <code class="literal">[cdrom]</code> section entry is the name of the
           share that can be seen by all SMB clients on the network. An
           additional <code class="literal">comment</code> can be added to further
           describe the share.
          </p></dd><dt id="idm139641289769504"><span class="term "><code class="option">path = /media/cdrom</code>
         </span></dt><dd><p>
           <code class="option">path</code> exports the directory
           <code class="filename">/media/cdrom</code>.
          </p></dd></dl></div><p>
        By means of a very restrictive default configuration, this kind of
        share is only made available to the users present on this system. If
        this share should be made available to everybody, add a line
        <code class="literal">guest ok = yes</code> to the configuration. This setting
        gives read permissions to anyone on the network. It is recommended to
        handle this parameter with great care. This applies even more to the
        use of this parameter in the <code class="literal">[global]</code> section.
       </p></dd><dt id="idm139641289764320"><span class="term "><code class="option">[homes]</code>
      </span></dt><dd><p>
        The <code class="option">[homes]</code> share is of special importance here. If
        the user has a valid account and password for the Linux file server and
        his own home directory, he can be connected to it.
       </p><div class="example" id="dat.homes.frei"><div class="example-title-wrap"><h6 class="example-title"><span class="number">Example 21.2: </span><span class="name">[homes] Share </span><a title="Permalink" class="permalink" href="cha.samba.html#dat.homes.frei">#</a></h6></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen">[homes]
        comment = Home Directories
        valid users = %S
        browseable = No
        read only = No
        inherit acls = Yes</pre></div></div></div><div class="variablelist "><dl class="variablelist"><dt id="idm139641289759744"><span class="term ">[homes]</span></dt><dd><p>
           As long as there is no other share using the share name of the user
           connecting to the SMB server, a share is dynamically generated using
           the <code class="literal">[homes]</code> share directives. The resulting name
           of the share is the user name.
          </p></dd><dt id="idm139641289757264"><span class="term "><code class="option">valid users = %S</code>
         </span></dt><dd><p>
           <code class="literal">%S</code> is replaced with the concrete name of the
           share when a connection has been successfully established. For a
           <code class="option">[homes]</code> share, this is always the user name. As a
           consequence, access rights to a user's share are restricted
           exclusively to that user.
          </p></dd><dt id="idm139641289754032"><span class="term "><code class="option">browseable = No</code>
         </span></dt><dd><p>
           This setting makes the share invisible in the network environment.
          </p></dd><dt id="idm139641289751872"><span class="term "><code class="option">read only = No</code>
         </span></dt><dd><p>
           By default, Samba prohibits write access to any exported share by
           means of the <code class="literal">read only = Yes</code> parameter. To make a
           share writable, set the value <code class="literal">read only = No</code>,
           which is synonymous with <code class="literal">writable = Yes</code>.
          </p></dd><dt id="idm139641289748304"><span class="term "><code class="option">create mask = 0640</code>
         </span></dt><dd><p>
           Systems that are not based on MS Windows NT do not understand the
           concept of Unix permissions, so they cannot assign permissions when
           creating a file. The parameter <code class="literal">create mask</code>
           defines the access permissions assigned to newly created files. This
           only applies to writable shares. In effect, this setting means the
           owner has read and write permissions and the members of the owner's
           primary group have read permissions. <code class="option">valid users =
           %S</code> prevents read access even if the group has read
           permissions. For the group to have read or write access, deactivate
           the line <code class="option">valid users = %S</code>.
          </p></dd></dl></div></dd></dl></div><div id="idm139641289743648" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.png" /><h6>Warning: Do not share <code class="literal">NFS</code> mounts with Samba</h6><p>
      Sharing <code class="literal">NFS</code> mounts with samba may result in data loss
      and is not supported. Install Samba directly on the file server or
      consider using alternatives such as <code class="literal">iSCSI</code>.
     </p></div></div><div class="sect3 " id="sec.samba.rechte"><div class="titlepage"><div><div><h4 class="title" id="sec.samba.rechte"><span class="number">21.4.2.3 </span><span class="name">Security Levels</span> <a title="Permalink" class="permalink" href="cha.samba.html#sec.samba.rechte">#</a></h4></div></div></div><p>
     To improve security, each share access can be protected with a password.
     SMB offers the following ways of checking permissions:
    </p><div class="variablelist "><dl class="variablelist"><dt id="idm139641289738624"><span class="term ">User Level Security (<code class="literal">security = user</code>)</span></dt><dd><p>
        This variant introduces the concept of the user to SMB. Each user must
        register with the server with his or her own password. After
        registration, the server can grant access to individual exported shares
        dependent on user names.
       </p></dd><dt id="idm139641289736128"><span class="term ">ADS Level Security (<code class="literal">security = ADS</code>)</span></dt><dd><p>
        In this mode, Samba will act as a domain member in an Active Directory
        environment. To operate in this mode, the machine running Samba needs
        Kerberos installed and configured. You must join the machine using
        Samba to the ADS realm. This can be done using the YaST
        <span class="guimenu">Windows Domain Membership</span> module.
       </p></dd><dt id="idm139641289733136"><span class="term ">Domain Level Security (<code class="literal">security = domain</code>)</span></dt><dd><p>
        This mode will only work correctly if the machine has been joined into
        a Windows NT Domain. Samba will try to validate user name and password
        by passing it to a Windows NT Primary or Backup Domain Controller. The
        same way as a Windows NT Server would do. It expects the encrypted
        passwords parameter to be set to <code class="literal">yes</code>.
       </p></dd></dl></div><p>
     The selection of share, user, server, or domain level security applies to
     the entire server. It is not possible to offer individual shares of a
     server configuration with share level security and others with user level
     security. However, you can run a separate Samba server for each configured
     IP address on a system.
    </p><p>
     More information about this subject can be found in the Samba 3 HOWTO.
     For multiple servers on one system, pay attention to the options
     <code class="option">interfaces</code> and <code class="option">bind interfaces only</code>.
    </p></div></div></div><div class="sect1 " id="sec.samba.client.inst"><div class="titlepage"><div><div><h2 class="title" id="sec.samba.client.inst"><span class="number">21.5 </span><span class="name">Configuring Clients</span> <a title="Permalink" class="permalink" href="cha.samba.html#sec.samba.client.inst">#</a></h2></div></div></div><p>
   Clients can only access the Samba server via TCP/IP. NetBEUI and NetBIOS via
   IPX cannot be used with Samba.
  </p><div class="sect2 " id="sec.samba.client.inst.yast"><div class="titlepage"><div><div><h3 class="title" id="sec.samba.client.inst.yast"><span class="number">21.5.1 </span><span class="name">Configuring a Samba Client with YaST</span> <a title="Permalink" class="permalink" href="cha.samba.html#sec.samba.client.inst.yast">#</a></h3></div></div></div><p>
    Configure a Samba client to access resources (files or printers) on the
    Samba or Windows server. Enter the NT or Active Directory domain or
    workgroup in the dialog <span class="guimenu">Network Services</span> › <span class="guimenu">Windows Domain Membership</span>. If you activate
    <span class="guimenu">Also Use SMB Information for Linux Authentication</span>, the
    user authentication runs over the Samba, NT or Kerberos server.
   </p><p>
    Click <span class="guimenu">Expert Settings</span> for advanced configuration
    options. For example, use the <span class="guimenu">Mount Server Directories</span>
    table to enable mounting server home directory automatically with
    authentication. This way users can access their home directories when
    hosted on CIFS. For details, see the <code class="systemitem">pam_mount</code> man
    page.
   </p><p>
    After completing all settings, confirm the dialog to finish the
    configuration.
   </p></div></div><div class="sect1 " id="sec.samba.anmeld.serv"><div class="titlepage"><div><div><h2 class="title" id="sec.samba.anmeld.serv"><span class="number">21.6 </span><span class="name">Samba as Login Server</span> <a title="Permalink" class="permalink" href="cha.samba.html#sec.samba.anmeld.serv">#</a></h2></div></div></div><p>
   In networks where predominantly Windows clients are found, it is often
   preferable that users may only register with a valid account and password.
   In a Windows-based network, this task is handled by a primary domain
   controller (PDC). You can use a Windows NT server configured as PDC, but
   this task can also be done with a Samba server. The entries that must be
   made in the <code class="literal">[global]</code> section of
   <code class="filename">smb.conf</code> are shown in
   <a class="xref" href="cha.samba.html#dat.samba.smb.conf.dom" title="Global Section in smb.conf">Example 21.3, “Global Section in smb.conf”</a>.
  </p><div class="example" id="dat.samba.smb.conf.dom"><div class="example-title-wrap"><h6 class="example-title"><span class="number">Example 21.3: </span><span class="name">Global Section in smb.conf </span><a title="Permalink" class="permalink" href="cha.samba.html#dat.samba.smb.conf.dom">#</a></h6></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen">[global]
    workgroup = WORKGROUP
    domain logons = Yes
    domain master = Yes</pre></div></div></div><p>
   It is necessary to prepare user accounts and passwords in an encryption
   format that conforms with Windows. Do this with the command
   <code class="command">smbpasswd</code> <code class="option">-a name</code>. Create the domain
   account for the computers, required by the Windows domain concept, with the
   following commands:
  </p><div class="verbatim-wrap"><pre class="screen">useradd hostname\$
smbpasswd -a -m hostname</pre></div><p>
   With the <code class="command">useradd</code> command, a dollar sign is added. The
   command <code class="command">smbpasswd</code> inserts this automatically when the
   parameter <code class="option">-m</code> is used. The commented configuration example
   (<code class="filename">/usr/share/doc/packages/samba/examples/smb.conf.SUSE</code>)
   contains settings that automate this task.
  </p><div class="verbatim-wrap"><pre class="screen">add machine script = /usr/sbin/useradd -g nogroup -c "NT Machine Account" \
-s /bin/false %m\$</pre></div><p>
   To make sure that Samba can execute this script correctly, choose a Samba
   user with the required administrator permissions and add it to the
   <code class="systemitem">ntadmin</code> group. Then all users
   belonging to this Linux group can be assigned <code class="literal">Domain
   Admin</code> status with the command:
  </p><div class="verbatim-wrap"><pre class="screen">net groupmap add ntgroup="Domain Admins" unixgroup=ntadmin</pre></div></div><div class="sect1 " id="sec.samba.adnet"><div class="titlepage"><div><div><h2 class="title" id="sec.samba.adnet"><span class="number">21.7 </span><span class="name">Samba Server in the Network with Active Directory</span> <a title="Permalink" class="permalink" href="cha.samba.html#sec.samba.adnet">#</a></h2></div></div></div><p>
   If you run Linux servers and Windows servers together, you can build two
   independent authentication systems and networks or connect servers to one
   network with one central authentication system. Because Samba can cooperate
   with an active directory domain, you can join your SUSE Linux Enterprise Server to Active Directory
   (AD).
  </p><p>
   To join an AD domain proceed as follows:
  </p><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
     Log in as <code class="systemitem">root</code> and start YaST.
    </p></li><li class="step "><p>
     Start <span class="guimenu">Network Services</span> › <span class="guimenu">Windows
     Domain Membership</span>.
    </p></li><li class="step "><p>
     Enter the domain to join at <span class="guimenu">Domain or Workgroup</span> in the
     <span class="guimenu">Windows Domain Membership</span> screen.
    </p><div class="figure" id="idm139641289697696"><div class="figure-contents"><div class="mediaobject"><a xmlns="" href="images/ad_sambaclient.png"><img src="images/ad_sambaclient.png" width="" alt="Determining Windows Domain Membership" /></a></div></div><div class="figure-title-wrap"><h6 class="figure-title"><span class="number">Figure 21.1: </span><span class="name">Determining Windows Domain Membership </span><a title="Permalink" class="permalink" href="cha.samba.html#idm139641289697696">#</a></h6></div></div></li><li class="step "><p>
     Check <span class="guimenu">Also Use SMB Information for Linux Authentication</span>
     to use the SMB source for Linux authentication on your server.
    </p></li><li class="step "><p>
     Click <span class="guimenu">OK</span> and confirm the domain join when prompted for
     it.
    </p></li><li class="step "><p>
     Provide the password for the Windows Administrator on the AD server and
     click <span class="guimenu">OK</span>.
    </p><p>
     Your server is now set up to pull in all authentication data from the
     Active Directory domain controller.
    </p></li></ol></div></div><div id="idm139641289687552" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.png" /><h6>Tip: Identity Mapping</h6><p>
    In an environment with more than one Samba server, UIDs and GIDs will not
    be created consistently. The UIDs that get assigned to users will be
    dependent on the order in which they first log in, which results in UID
    conflicts across servers. To fix this, you need to use identity mapping.
    See
    <a class="link" href="https://www.samba.org/samba/docs/man/Samba-HOWTO-Collection/idmapper.html" target="_blank">https://www.samba.org/samba/docs/man/Samba-HOWTO-Collection/idmapper.html</a>
    for more details.
   </p></div></div><div class="sect1 " id="sec.samba.advanced"><div class="titlepage"><div><div><h2 class="title" id="sec.samba.advanced"><span class="number">21.8 </span><span class="name">Advanced Topics</span> <a title="Permalink" class="permalink" href="cha.samba.html#sec.samba.advanced">#</a></h2></div></div></div><p>
   This section introduces more advanced techniques to manage both the client
   and server part of the Samba suite.
  </p><div class="sect2 " id="sec.samba.advanced.compress"><div class="titlepage"><div><div><h3 class="title" id="sec.samba.advanced.compress"><span class="number">21.8.1 </span><span class="name">Transparent File Compression on Btrfs</span> <a title="Permalink" class="permalink" href="cha.samba.html#sec.samba.advanced.compress">#</a></h3></div></div></div><p>
    Samba allows clients to remotely manipulate file and directory compression
    flags for shares placed on the Btrfs file system. Windows Explorer provides
    the ability to flag files/directories for transparent compression via the
    <span class="guimenu">File</span> › <span class="guimenu">Properties</span> › <span class="guimenu">Advanced</span>
    dialog:
   </p><div class="figure" id="idm139641289680336"><div class="figure-contents"><div class="mediaobject"><a xmlns="" href="images/samba_win_expl_advattr.png"><img src="images/samba_win_expl_advattr.png" width="" alt="Windows Explorer Advanced Attributes Dialog" /></a></div></div><div class="figure-title-wrap"><h6 class="figure-title"><span class="number">Figure 21.2: </span><span class="name">Windows Explorer <span class="guimenu">Advanced Attributes</span> Dialog </span><a title="Permalink" class="permalink" href="cha.samba.html#idm139641289680336">#</a></h6></div></div><p>
    Files flagged for compression are transparently compressed and decompressed
    by the underlying file system when accessed or modified. This normally
    results in storage capacity savings at the expense of extra CPU overhead
    when accessing the file. New files and directories inherit the compression
    flag from the parent directory, unless created with the FILE_NO_COMPRESSION
    option.
   </p><p>
    Windows Explorer presents compressed files and directories visually
    differently to those that are not compressed:
   </p><div class="figure" id="idm139641289673472"><div class="figure-contents"><div class="mediaobject"><a xmlns="" href="images/samba_win_expl_view_compressed.png"><img src="images/samba_win_expl_view_compressed.png" width="" alt="Windows Explorer Directory Listing with Compressed Files" /></a></div></div><div class="figure-title-wrap"><h6 class="figure-title"><span class="number">Figure 21.3: </span><span class="name">Windows Explorer Directory Listing with Compressed Files </span><a title="Permalink" class="permalink" href="cha.samba.html#idm139641289673472">#</a></h6></div></div><p>
    You can enable Samba share compression either manually by adding
   </p><div class="verbatim-wrap"><pre class="screen">vfs objects = btrfs</pre></div><p>
    to the share configuration in <code class="filename">/etc/samba/smb.conf</code>, or
    using YaST: <span class="guimenu">Network Services</span> › <span class="guimenu">Samba
    Server</span> › <span class="guimenu">Add</span>, and checking
    <span class="guimenu">Utilize Btrfs Features</span>.
   </p></div><div class="sect2 " id="sec.samba.advanced.snapshots"><div class="titlepage"><div><div><h3 class="title" id="sec.samba.advanced.snapshots"><span class="number">21.8.2 </span><span class="name">Snapshots</span> <a title="Permalink" class="permalink" href="cha.samba.html#sec.samba.advanced.snapshots">#</a></h3></div></div></div><p>
    Snapshots, also called Shadow Copies, are copies of the state of a file
    system subvolume at a certain point of time. Snapper is the tool to manage
    these snapshots in Linux. Snapshots are supported on the Btrfs file system
    or thin-provisioned LVM volumes. The Samba suite supports managing of
    remote snapshots through the FSRVP protocol on both the server and client
    side.
   </p><div class="sect3 " id="sec.samba.advanced.snapshots.client"><div class="titlepage"><div><div><h4 class="title" id="sec.samba.advanced.snapshots.client"><span class="number">21.8.2.1 </span><span class="name">Previous Versions</span> <a title="Permalink" class="permalink" href="cha.samba.html#sec.samba.advanced.snapshots.client">#</a></h4></div></div></div><p>
     Snapshots on a Samba server can be exposed to remote Windows clients as
     file or directory previous versions.
    </p><p>
     To enable snapshots on a Samba server, the following conditions must be
     fulfilled:
    </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
       The SMB network share resides on a Btrfs subvolume.
      </p></li><li class="listitem "><p>
       The SMB network share path has a related snapper configuration file. You
       can create the snapper file with
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> snapper -c &lt;cfg_name&gt; create-config <code class="option">/path/to/share</code></pre></div><p>
       For more information on snapper, see <a class="xref" href="cha.snapper.html" title="Chapter 3. System Recovery and Snapshot Management with Snapper">Chapter 3, <em>System Recovery and Snapshot Management with Snapper</em></a>.
      </p></li><li class="listitem "><p>
       The snapshot directory tree must allow access for relevant users. For
       more information, see the PERMISSIONS section of the vfs_snapper manual
       page (<code class="command">man 8 vfs_snapper</code>).
      </p></li></ul></div><p>
     To support remote snapshots, you need to modify the
     <code class="filename">/etc/samba/smb.conf</code> file. You can do it either with
     <span class="guimenu">YaST</span> › <span class="guimenu">Network
     Services</span> › <span class="guimenu">Samba Server</span>, or
     manually by enhancing the relevant share section with
    </p><div class="verbatim-wrap"><pre class="screen">vfs objects = snapper</pre></div><p>
     Note that you need to restart the Samba service for manual
     <code class="filename">smb.conf</code> changes to take effect:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> systemctl restart nmb smb</pre></div><div class="figure" id="fig.yast2.samba.snapshot"><div class="figure-contents"><div class="mediaobject"><a xmlns="" href="images/yast2_samba_snapshot.png"><img src="images/yast2_samba_snapshot.png" width="" alt="Adding a New Samba Share with Snapshotting Enabled" /></a></div></div><div class="figure-title-wrap"><h6 class="figure-title"><span class="number">Figure 21.4: </span><span class="name">Adding a New Samba Share with Snapshotting Enabled </span><a title="Permalink" class="permalink" href="cha.samba.html#fig.yast2.samba.snapshot">#</a></h6></div></div><p>
     After being configured, snapshots created by snapper for the Samba share
     path can be accessed from Windows Explorer from a file or directory's
     <span class="guimenu">Previous Versions</span> tab.
    </p><div class="figure" id="fig.samba.win_explorer"><div class="figure-contents"><div class="mediaobject"><a xmlns="" href="images/samba_winexpl_previous_versions.png"><img src="images/samba_winexpl_previous_versions.png" width="" alt="The Previous Versions tab in Windows Explorer" /></a></div></div><div class="figure-title-wrap"><h6 class="figure-title"><span class="number">Figure 21.5: </span><span class="name">The <span class="guimenu">Previous Versions</span> tab in Windows Explorer </span><a title="Permalink" class="permalink" href="cha.samba.html#fig.samba.win_explorer">#</a></h6></div></div></div><div class="sect3 " id="sec.samba.advanced.snapshots.server"><div class="titlepage"><div><div><h4 class="title" id="sec.samba.advanced.snapshots.server"><span class="number">21.8.2.2 </span><span class="name">Remote Share Snapshots</span> <a title="Permalink" class="permalink" href="cha.samba.html#sec.samba.advanced.snapshots.server">#</a></h4></div></div></div><p>
     By default, snapshots can only be created and deleted on the Samba server
     locally, via the snapper command line utility, or using snapper's time
     line feature.
    </p><p>
     Samba can be configured to process share snapshot creation and deletion
     requests from remote hosts using the File Server Remote VSS Protocol
     (FSRVP).
    </p><p>
     In addition to the configuration and prerequisites documented in
     <a class="xref" href="cha.samba.html#sec.samba.advanced.snapshots.client" title="21.8.2.1. Previous Versions">Section 21.8.2.1, “Previous Versions”</a>, the following global
     configuration is required in <code class="filename">/etc/samba/smb.conf</code>:
    </p><div class="verbatim-wrap"><pre class="screen">[global]
rpc_daemon:fssd = fork
registry shares = yes
include = registry</pre></div><p>
     FSRVP clients, including Samba's <code class="command">rpcclient</code> and Windows
     Server 2012 <code class="command">DiskShadow.exe</code>, can then instruct Samba to
     create or delete a snapshot for a given share, and expose the snapshot as
     a new share.
    </p></div><div class="sect3 " id="sec.samba.advanced.snapshots.client.linux"><div class="titlepage"><div><div><h4 class="title" id="sec.samba.advanced.snapshots.client.linux"><span class="number">21.8.2.3 </span><span class="name">Managing Snapshots Remotely from Linux with <code class="command">rpcclient</code></span> <a title="Permalink" class="permalink" href="cha.samba.html#sec.samba.advanced.snapshots.client.linux">#</a></h4></div></div></div><p>
     The <code class="systemitem">samba-client</code> package contains an FSRVP client
     that can remotely request a Windows/Samba server to create and expose a
     snapshot of a given share. You can then use existing tools in
     <span class="productname"><span class="phrase">openSUSE Leap</span></span> to mount the exposed share and back up its files. Requests
     to the server are sent using the <code class="command">rpcclient</code> binary.
    </p><div class="complex-example"><div class="example" id="idm139641289625968"><div class="example-title-wrap"><h6 class="example-title"><span class="number">Example 21.4: </span><span class="name">Using <code class="command">rpcclient</code> to Request a Windows Server 2012 Share Snapshot </span><a title="Permalink" class="permalink" href="cha.samba.html#idm139641289625968">#</a></h6></div><div class="example-contents"><p>
      Connect to <code class="literal">win-server.example.com</code> server as an
      administrator in an <code class="literal">EXAMPLE</code> domain:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root">root # </code>rpcclient -U '<em class="replaceable ">EXAMPLE</em>\Administrator' ncacn_np:<em class="replaceable ">win-server.example.com</em>[ndr64,sign]
Enter EXAMPLE/Administrator's password:</pre></div><p>
      Check that the SMB share is visible for <code class="command">rpcclient</code>:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root">root # </code>rpcclient $&gt; netshareenum
netname: windows_server_2012_share
remark:
path:   C:\Shares\windows_server_2012_share
password:       (null)</pre></div><p>
      Check that the SMB share supports snapshot creation:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root">root # </code>rpcclient $&gt; fss_is_path_sup windows_server_2012_share \
UNC \\WIN-SERVER\windows_server_2012_share\ supports shadow copy requests</pre></div><p>
      Request the creation of a share snapshot:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root">root # </code>rpcclient $&gt; fss_create_expose backup ro windows_server_2012_share
13fe880e-e232-493d-87e9-402f21019fb6: shadow-copy set created
13fe880e-e232-493d-87e9-402f21019fb6(1c26544e-8251-445f-be89-d1e0a3938777): \
\\WIN-SERVER\windows_server_2012_share\ shadow-copy added to set
13fe880e-e232-493d-87e9-402f21019fb6: prepare completed in 0 secs
13fe880e-e232-493d-87e9-402f21019fb6: commit completed in 1 secs
13fe880e-e232-493d-87e9-402f21019fb6(1c26544e-8251-445f-be89-d1e0a3938777): \
share windows_server_2012_share@{1C26544E-8251-445F-BE89-D1E0A3938777} \
exposed as a snapshot of \\WIN-SERVER\windows_server_2012_share\</pre></div><p>
      Confirm that the snapshot share is exposed by the server:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root">root # </code>rpcclient $&gt; netshareenum
netname: windows_server_2012_share
remark:
path:   C:\Shares\windows_server_2012_share
password:       (null)

netname: windows_server_2012_share@{1C26544E-8251-445F-BE89-D1E0A3938777}
remark: (null)
path:   \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy{F6E6507E-F537-11E3-9404-B8AC6F927453}\Shares\windows_server_2012_share\
password:       (null)</pre></div><p>
      Attempt to delete the snapshot share:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root">root # </code>rpcclient $&gt; fss_delete windows_server_2012_share \
13fe880e-e232-493d-87e9-402f21019fb6 1c26544e-8251-445f-be89-d1e0a3938777
13fe880e-e232-493d-87e9-402f21019fb6(1c26544e-8251-445f-be89-d1e0a3938777): \
\\WIN-SERVER\windows_server_2012_share\ shadow-copy deleted</pre></div><p>
      Confirm that the snapshot share has been removed by the server:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root">root # </code>rpcclient $&gt; netshareenum
netname: windows_server_2012_share
remark:
path:   C:\Shares\windows_server_2012_share
password:       (null)</pre></div></div></div></div></div><div class="sect3 " id="sec.samba.advanced.snapshots.client.winserver"><div class="titlepage"><div><div><h4 class="title" id="sec.samba.advanced.snapshots.client.winserver"><span class="number">21.8.2.4 </span><span class="name">Managing Snapshots Remotely from Windows with <code class="command">DiskShadow.exe</code></span> <a title="Permalink" class="permalink" href="cha.samba.html#sec.samba.advanced.snapshots.client.winserver">#</a></h4></div></div></div><p>
     You can manage snapshots of SMB shares on the Linux Samba server from the
     Windows environment acting as a client as well. Windows Server 2012
     includes the <code class="command">DiskShadow.exe</code> utility that can manage
     remote shares similar to the <code class="command">rpcclient</code> described in
     <a class="xref" href="cha.samba.html#sec.samba.advanced.snapshots.client.linux" title="21.8.2.3. Managing Snapshots Remotely from Linux with rpcclient">Section 21.8.2.3, “Managing Snapshots Remotely from Linux with <code class="command">rpcclient</code>”</a>. Note that you
     need to carefully set up the Samba server first.
    </p><p>
     Following is an example procedure to set up the Samba server so that the
     Windows Server client can manage its share's snapshots. Note that <em class="replaceable ">EXAMPLE</em>
     is the Active Directory domain used in the testing environment,
     <code class="uri">fsrvp-server.example.com</code> is the host name of the Samba server, and
     <code class="filename">/srv/smb</code> is the path to the SMB share.
    </p><div class="procedure " id="idm139641289604320"><div class="procedure-title-wrap"><h6 class="procedure-title"><span class="number">Procedure 21.1: </span><span class="name">Detailed Samba Server Configuration </span><a title="Permalink" class="permalink" href="cha.samba.html#idm139641289604320">#</a></h6></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
       Join Active Directory domain via YaST.<span class="phrase"> For
       more information, <a class="xref" href="cha.samba.html#sec.samba.adnet" title="21.7. Samba Server in the Network with Active Directory">Section 21.7, “Samba Server in the Network with Active Directory”</a>.</span>
      </p></li><li class="step "><p>
       Ensure that the Active Domain DNS entry was correct:
      </p><div class="verbatim-wrap"><pre class="screen">fsrvp-server:~ # net -U 'Administrator' ads dns register \
fsrvp-server.example.com &lt;IP address&gt;
Successfully registered hostname with DNS</pre></div></li><li class="step "><p>
       Create Btrfs subvolume at <code class="filename">/srv/smb</code>
      </p><div class="verbatim-wrap"><pre class="screen">fsrvp-server:~ # btrfs subvolume create /srv/smb</pre></div></li><li class="step "><p>
       Create snapper configuration file for path <code class="filename">/srv/smb</code>
      </p><div class="verbatim-wrap"><pre class="screen">fsrvp-server:~ # snapper -c &lt;snapper_config&gt; create-config /srv/smb</pre></div></li><li class="step "><p>
       Create new share with path <code class="filename">/srv/smb</code>, and YaST
       <span class="guimenu">Expose Snapshots</span> check box enabled. Make sure to add
       the following snippets to the global section of
       <code class="filename">/etc/samba/smb.conf</code> as mentioned in
       <a class="xref" href="cha.samba.html#sec.samba.advanced.snapshots.server" title="21.8.2.2. Remote Share Snapshots">Section 21.8.2.2, “Remote Share Snapshots”</a>:
      </p><div class="verbatim-wrap"><pre class="screen">[global]
 rpc_daemon:fssd = fork
 registry shares = yes
 include = registry</pre></div></li><li class="step "><p>
       Restart Samba with <code class="command">systemctl restart nmb smb</code>
      </p></li><li class="step "><p>
       Configure snapper permissions:
      </p><div class="verbatim-wrap"><pre class="screen">fsrvp-server:~ # snapper -c &lt;snapper_config&gt; set-config \
ALLOW_USERS="EXAMPLE\\\\Administrator EXAMPLE\\\\win-client$"</pre></div><p>
       Ensure that any ALLOW_USERS are also permitted traversal of the
       <code class="filename">.snapshots</code> subdirectory.
      </p><div class="verbatim-wrap"><pre class="screen">fsrvp-server:~ # snapper -c &lt;snapper_config&gt; set-config SYNC_ACL=yes</pre></div><div id="idm139641289588528" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.png" /><h6>Important: Path Escaping</h6><p>
        Be careful about the '\' escapes! Escape twice to ensure that the value
        stored in
        <code class="filename">/etc/snapper/configs/&lt;snapper_config&gt;</code> is
        escaped once.
       </p></div><p>
       "EXAMPLE\win-client$" corresponds to the Windows client computer
       account. Windows issues initial FSRVP requests while authenticated with
       this account.
      </p></li><li class="step "><p>
       Grant Windows client account necessary privileges:
      </p><div class="verbatim-wrap"><pre class="screen">fsrvp-server:~ # net -U 'Administrator' rpc rights grant \
"EXAMPLE\\win-client$" SeBackupPrivilege
Successfully granted rights.</pre></div><p>
       The previous command is not needed for the "EXAMPLE\Administrator" user,
       which has privileges already granted.
      </p></li></ol></div></div><div class="procedure " id="idm139641289583616"><div class="procedure-title-wrap"><h6 class="procedure-title"><span class="number">Procedure 21.2: </span><span class="name">Windows Client Setup and <code class="command">DiskShadow.exe</code> in Action </span><a title="Permalink" class="permalink" href="cha.samba.html#idm139641289583616">#</a></h6></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
       Boot Windows Server 2012 (example host name WIN-CLIENT).
      </p></li><li class="step "><p>
       Join the same Active Directory domain EXAMPLE as with the <span class="productname"><span class="phrase">openSUSE Leap</span></span>.
      </p></li><li class="step "><p>
       Reboot.
      </p></li><li class="step "><p>
       Open Powershell.
      </p></li><li class="step "><p>
       Start <code class="command">DiskShadow.exe</code> and begin the backup procedure:
      </p><div class="verbatim-wrap"><pre class="screen">PS C:\Users\Administrator.EXAMPLE&gt; diskshadow.exe
Microsoft DiskShadow version 1.0
Copyright (C) 2012 Microsoft Corporation
On computer:  WIN-CLIENT,  6/17/2014 3:53:54 PM

DISKSHADOW&gt; begin backup</pre></div></li><li class="step "><p>
       Specify that shadow copy persists across program exit, reset or reboot:
      </p><div class="verbatim-wrap"><pre class="screen">DISKSHADOW&gt; set context PERSISTENT</pre></div></li><li class="step "><p>
       Check whether the specified share supports snapshots, and create one:
      </p><div class="verbatim-wrap"><pre class="screen">DISKSHADOW&gt; add volume \\fsrvp-server\sles_snapper

DISKSHADOW&gt; create
Alias VSS_SHADOW_1 for shadow ID {de4ddca4-4978-4805-8776-cdf82d190a4a} set as \
 environment variable.
Alias VSS_SHADOW_SET for shadow set ID {c58e1452-c554-400e-a266-d11d5c837cb1} \
 set as environment variable.

Querying all shadow copies with the shadow copy set ID \
 {c58e1452-c554-400e-a266-d11d5c837cb1}

 * Shadow copy ID = {de4ddca4-4978-4805-8776-cdf82d190a4a}     %VSS_SHADOW_1%
    - Shadow copy set: {c58e1452-c554-400e-a266-d11d5c837cb1}  %VSS_SHADOW_SET%
    - Original count of shadow copies = 1
    - Original volume name: \\FSRVP-SERVER\SLES_SNAPPER\ \
      [volume not on this machine]
    - Creation time: 6/17/2014 3:54:43 PM
    - Shadow copy device name:
      \\FSRVP-SERVER\SLES_SNAPPER@{31afd84a-44a7-41be-b9b0-751898756faa}
    - Originating machine: FSRVP-SERVER
    - Service machine: win-client.example.com
    - Not exposed
    - Provider ID: {89300202-3cec-4981-9171-19f59559e0f2}
    - Attributes:  No_Auto_Release Persistent FileShare

Number of shadow copies listed: 1</pre></div></li><li class="step "><p>
       Finish the backup procedure:
      </p><div class="verbatim-wrap"><pre class="screen">DISKSHADOW&gt; end backup</pre></div></li><li class="step "><p>
       After the snapshot was created, try to delete it and verify the
       deletion:
      </p><div class="verbatim-wrap"><pre class="screen">DISKSHADOW&gt; delete shadows volume \\FSRVP-SERVER\SLES_SNAPPER\
Deleting shadow copy {de4ddca4-4978-4805-8776-cdf82d190a4a} on volume \
 \\FSRVP-SERVER\SLES_SNAPPER\ from provider \
{89300202-3cec-4981-9171-19f59559e0f2} [Attributes: 0x04000009]...

Number of shadow copies deleted: 1

DISKSHADOW&gt; list shadows all

Querying all shadow copies on the computer ...
No shadow copies found in system.</pre></div></li></ol></div></div></div></div></div><div class="sect1 " id="sec.samba.info"><div class="titlepage"><div><div><h2 class="title" id="sec.samba.info"><span class="number">21.9 </span><span class="name">For More Information</span> <a title="Permalink" class="permalink" href="cha.samba.html#sec.samba.info">#</a></h2></div></div></div><p>
   Documentation for Samba ships with the <code class="systemitem">samba-doc</code>
   package which is not installed by default. Install it with <code class="command">zypper
   install samba-doc</code>. Enter <code class="command">apropos</code>
   <code class="option">samba</code> at the command line to display some manual pages or
   browse the <code class="filename">/usr/share/doc/packages/samba</code> directory for
   more online documentation and examples. Find a commented example
   configuration (<code class="filename">smb.conf.SUSE</code>) in the
   <code class="filename">examples</code> subdirectory. Another file to look for Samba
   related information is
   <code class="filename">/usr/share/doc/packages/samba/README.SUSE</code>.
  </p><p>
   The Samba HOWTO (see <a class="link" href="https://wiki.samba.org" target="_blank">https://wiki.samba.org</a>) provided
   by the Samba team includes a section about troubleshooting. In addition to
   that, Part V of the document provides a step-by-step guide to checking your
   configuration.
  </p></div></div></div><div class="page-bottom"><div id="_bottom-navigation"><a class="nav-link" href="cha.nfs.html"><span class="next-icon">→</span><span class="nav-label"><span class="number">Chapter 22 </span>Sharing File Systems with NFS</span></a><a class="nav-link" href="cha.dhcp.html"><span class="prev-icon">←</span><span class="nav-label"><span class="number">Chapter 20 </span>DHCP</span></a></div><div id="_share-print"><div class="online-contents share"><strong>Share this page: </strong><span class="share-buttons"><span id="_share-fb" class="bottom-button">Facebook</span><span class="spacer"> • </span><span id="_share-gp" class="bottom-button">Google+</span><span class="spacer"> • </span><span id="_share-tw" class="bottom-button">Twitter</span><span class="spacer"> • </span><span id="_share-mail" class="bottom-button">E-Mail</span></span></div><div class="print"><span id="_print-button" class="bottom-button">Print this page</span></div><div class="clearme"></div></div></div></div><div id="_inward"></div></div><div id="_footer-wrap"><div id="_footer"><p>©
        2018 
        SUSE</p><ul><li><a href="http://www.suse.com/company/careers/" target="_top">Careers</a></li><li><a href="http://www.suse.com/company/legal/" target="_top">Legal</a></li><li><a href="http://www.suse.com/company/" target="_top">About</a></li><li><a href="http://www.suse.com/ContactsOffices/contacts_offices.jsp" target="_top">Contact Us</a></li></ul></div></div></body></html>