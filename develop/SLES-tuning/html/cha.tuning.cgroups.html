<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang=""><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Kernel Control Groups | System Analysis and Tuning Guide | SUSE Linux Enterprise Server 15</title><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" /><link rel="stylesheet" type="text/css" href="static/css/style.css" /><link rel="stylesheet" type="text/css" href="static/css/highlight.css" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><meta name="product-name" content="SUSE Linux Enterprise Server" /><meta name="product-number" content="15" /><meta name="book-title" content="System Analysis and Tuning Guide" /><meta name="chapter-title" content="Chapter 9. Kernel Control Groups" /><meta name="description" content="Kernel Control Groups (abbreviated known as cgroups) are a kernel feature that allows aggregating or partitioning tasks (processes) and all their children into hierarchical organized groups. These hierarchical groups can be configured to show a specialized behavior that helps with tuning the system to make best use of available hardware and network resources. In the following sections, we often reference kernel documentation such as /usr/src/linux/Documentation/cgroups/. These files are part of the kernel-source package. This chapter is an overview. To use cgroups properly and to avoid performance implications, you must study the provided references. taroth 2017-12-14: for the sake of using the prompt entities (tux &gt; or root # ) consistently in our docs: please do not mix several example commands within one screen and do not use '#' to refer to an example command - this makes it impossible to mark the individual commands with a proper prompt" /><meta name="tracker-url" content="https://bugzilla.suse.com/enter_bug.cgi" /><meta name="tracker-type" content="bsc" /><meta name="tracker-bsc-assignee" content="fs@suse.com" /><meta name="tracker-bsc-component" content="Documentation" /><meta name="tracker-bsc-product" content="SUSE Linux Enterprise Server 15" /><link rel="home" href="index.html" title="SUSE Linux Enterprise Server Documentation" /><link rel="up" href="part.tuning.resources.html" title="Part IV. Resource Management" /><link rel="prev" href="cha.tuning.resources.html" title="Chapter 8. General System Resource Management" /><link rel="next" href="cha.tuning.numactl.html" title="Chapter 10. Automatic Non-Uniform Memory Access (NUMA) Balancing" /><script type="text/javascript">

var protocol = window.location.protocol.toLowerCase();
if ( protocol != 'file:' ) {
  var agent = navigator.userAgent.toLowerCase();
  var wanted = ( protocol == 'https:') ? 'https' : 'http';
  var file = 'fonts.css';
  document.write('<link rel="stylesheet" type="text/css" href="' + wanted + '://static.opensuse.org/fonts/'+ file +'"></link>');
}
else {
   document.write('<link rel="stylesheet" type="text/css" href="static/css/fonts-onlylocal.css"></link>');
}

</script><noscript><link rel="stylesheet" type="text/css" href="http://static.opensuse.org/fonts/fonts.css" /></noscript><script src="static/js/jquery-1.10.2.min.js" type="text/javascript"></script><script src="static/js/script.js" type="text/javascript"></script><script src="static/js/highlight.min.js" type="text/javascript"></script><script>

$(document).ready(function() {
  $('.verbatim-wrap.highlight').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});
hljs.configure({
  useBR: false
});

</script></head><body class="draft offline js-off"><div id="_outer-wrap"><div id="_white-bg"><div id="_header"><div id="_logo"><img src="static/images/logo.png" alt="Logo" /></div><div class="crumbs"><a class="book-link" href="index.html" title="SUSE Linux Enterprise Server Documentation"><span class="book-icon">SUSE Linux Enterprise Server Documentation</span></a><span> › </span><a class="crumb" href="book.sle.tuning.html">System Analysis and Tuning Guide</a><span> › </span><a class="crumb" href="part.tuning.resources.html">Resource Management</a><span> › </span><a class="crumb" href="cha.tuning.cgroups.html">Kernel Control Groups</a></div><div class="clearme"></div></div></div><div id="_toolbar-wrap"><div id="_toolbar"><div id="_toc-area" class="inactive"><a id="_toc-area-button" class="tool" title="Contents" accesskey="c" href="index.html"><span class="tool-spacer"><span class="toc-icon">Contents</span><span class="clearme"></span></span><span class="tool-label">Contents</span></a><div class="active-contents bubble-corner"></div><div class="active-contents bubble"><div class="bubble-container"><h6>System Analysis and Tuning Guide</h6><div id="_bubble-toc"><ol><li class="inactive"><a href="preface.tuning.html"><span class="number"> </span><span class="name">About This Guide</span></a></li><li class="inactive"><a href="part.tuning.basics.html"><span class="number">I </span><span class="name">Basics</span></a><ol><li class="inactive"><a href="cha.tuning.basics.html"><span class="number">1 </span><span class="name">General Notes on System Tuning</span></a></li></ol></li><li class="inactive"><a href="part.tuning.monitoring.html"><span class="number">II </span><span class="name">System Monitoring</span></a><ol><li class="inactive"><a href="cha.util.html"><span class="number">2 </span><span class="name">System Monitoring Utilities</span></a></li><li class="inactive"><a href="cha.tuning.logfiles.html"><span class="number">3 </span><span class="name">Analyzing and Managing System Log Files</span></a></li></ol></li><li class="inactive"><a href="part.tuning.kerneltrace.html"><span class="number">III </span><span class="name">Kernel Monitoring</span></a><ol><li class="inactive"><a href="cha.tuning.systemtap.html"><span class="number">4 </span><span class="name">SystemTap—Filtering and Analyzing System Data</span></a></li><li class="inactive"><a href="cha.tuning.kprobes.html"><span class="number">5 </span><span class="name">Kernel Probes</span></a></li><li class="inactive"><a href="cha.perf.html"><span class="number">6 </span><span class="name">Hardware-Based Performance Monitoring with Perf</span></a></li><li class="inactive"><a href="cha.tuning.oprofile.html"><span class="number">7 </span><span class="name">OProfile—System-Wide Profiler</span></a></li></ol></li><li class="inactive"><a href="part.tuning.resources.html"><span class="number">IV </span><span class="name">Resource Management</span></a><ol><li class="inactive"><a href="cha.tuning.resources.html"><span class="number">8 </span><span class="name">General System Resource Management</span></a></li><li class="inactive"><a href="cha.tuning.cgroups.html"><span class="number">9 </span><span class="name">Kernel Control Groups</span></a></li><li class="inactive"><a href="cha.tuning.numactl.html"><span class="number">10 </span><span class="name">Automatic Non-Uniform Memory Access (NUMA) Balancing</span></a></li><li class="inactive"><a href="cha.tuning.power.html"><span class="number">11 </span><span class="name">Power Management</span></a></li></ol></li><li class="inactive"><a href="part.tuning.kernel.html"><span class="number">V </span><span class="name">Kernel Tuning</span></a><ol><li class="inactive"><a href="cha.tuning.io.html"><span class="number">12 </span><span class="name">Tuning I/O Performance</span></a></li><li class="inactive"><a href="cha.tuning.taskscheduler.html"><span class="number">13 </span><span class="name">Tuning the Task Scheduler</span></a></li><li class="inactive"><a href="cha.tuning.memory.html"><span class="number">14 </span><span class="name">Tuning the Memory Management Subsystem</span></a></li><li class="inactive"><a href="cha.tuning.network.html"><span class="number">15 </span><span class="name">Tuning the Network</span></a></li></ol></li><li class="inactive"><a href="part.tuning.dumps.html"><span class="number">VI </span><span class="name">Handling System Dumps</span></a><ol><li class="inactive"><a href="cha.tuning.tracing.html"><span class="number">16 </span><span class="name">Tracing Tools</span></a></li><li class="inactive"><a href="cha.tuning.kexec.html"><span class="number">17 </span><span class="name">Kexec and Kdump</span></a></li></ol></li><li class="inactive"><a href="part.tuning.ptp.html"><span class="number">VII </span><span class="name">Synchronized Clocks with Precision Time Protocol</span></a><ol><li class="inactive"><a href="cha.tuning.ptp.html"><span class="number">18 </span><span class="name">Precision Time Protocol</span></a></li></ol></li><li class="inactive"><a href="bk06apa.html"><span class="number">A </span><span class="name">GNU Licenses</span></a></li></ol></div><div class="clearme"></div></div></div></div><div id="_nav-area" class="inactive"><div class="tool"><span class="nav-inner"><span class="tool-label">Navigation</span><a accesskey="p" class="tool-spacer" title="Chapter 8. General System Resource Management" href="cha.tuning.resources.html"><span class="prev-icon">←</span></a><a accesskey="n" class="tool-spacer" title="Chapter 10. Automatic Non-Uniform Memory Access (NUMA) Balancing" href="cha.tuning.numactl.html"><span class="next-icon">→</span></a></span></div></div></div></div><div id="_fixed-header-wrap" class="inactive"><div id="_fixed-header"><div class="crumbs"><a class="book-link" href="index.html" title="SUSE Linux Enterprise Server Documentation"><span class="book-icon">SUSE Linux Enterprise Server Documentation</span></a><span> › </span><a class="crumb" href="book.sle.tuning.html">System Analysis and Tuning Guide</a><span> › </span><a class="crumb" href="part.tuning.resources.html">Resource Management</a><span> › </span><a class="crumb" href="cha.tuning.cgroups.html">Kernel Control Groups</a></div><div class="buttons"><a class="top-button button" href="#">Top</a><div class="button"><a accesskey="p" class="tool-spacer" title="Chapter 8. General System Resource Management" href="cha.tuning.resources.html"><span class="prev-icon">←</span></a><a accesskey="n" class="tool-spacer" title="Chapter 10. Automatic Non-Uniform Memory Access (NUMA) Balancing" href="cha.tuning.numactl.html"><span class="next-icon">→</span></a></div><div class="clearme"></div></div><div class="clearme"></div></div></div><div id="_content" class="draft "><div class="documentation"><div class="chapter " id="cha.tuning.cgroups"><div class="titlepage"><div><div class="version-info">Applies to  <span class="productname"><span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span></span> <span class="productnumber"><span class="productnumber"><span class="phrase">15</span></span></span></div><div><h2 class="title"><span class="number">9 </span><span class="name">Kernel Control Groups</span> </h2><div class="doc-status"><ul><li><span class="ds-label">Filename: </span>tuning_cgroups.xml</li><li><span class="ds-label">ID: </span>cha.tuning.cgroups</li></ul></div></div><div><div class="abstract"><div class="abstract-title-wrap"><h6 class="abstract-title">Abstract<a title="Permalink" class="permalink" href="cha.tuning.cgroups.html#idm140339029935808">#</a></h6></div><p>
    Kernel Control Groups (abbreviated known as <span class="quote">“<span class="quote">cgroups</span>”</span>) are
    a kernel feature that allows aggregating or partitioning tasks
    (processes) and all their children into hierarchical organized groups.
    These hierarchical groups can be configured to show a specialized
    behavior that helps with tuning the system to make best use of available
    hardware and network resources.
   </p><p>
    In the following sections, we often reference kernel documentation
    such as <code class="filename">/usr/src/linux/Documentation/cgroups/</code>.
    These files are part of the <code class="systemitem">kernel-source</code>
    package.
   </p><p>
    This chapter is an overview.  To use cgroups properly and to
    avoid performance implications, you must study the provided
    references.
   </p><p>
    
   </p></div></div></div></div><div class="line"><div class="toc"><dl><dt><span class="sect1"><a href="cha.tuning.cgroups.html#sec.tuning.cgroups.overview"><span class="number">9.1 </span><span class="name">Technical Overview and Definitions</span></a></span></dt><dt><span class="sect1"><a href="cha.tuning.cgroups.html#sec.tuning.cgroups.scenario"><span class="number">9.2 </span><span class="name">Scenario</span></a></span></dt><dt><span class="sect1"><a href="cha.tuning.cgroups.html#sec.tuning.cgroups.subsys"><span class="number">9.3 </span><span class="name">Control Group Subsystems</span></a></span></dt><dt><span class="sect1"><a href="cha.tuning.cgroups.html#sec.tuning.cgroups.usage"><span class="number">9.4 </span><span class="name">Using Controller Groups</span></a></span></dt><dt><span class="sect1"><a href="cha.tuning.cgroups.html#sec.tuning.cgroups.info"><span class="number">9.5 </span><span class="name">For More Information</span></a></span></dt></dl></div></div><div class="sect1 " id="sec.tuning.cgroups.overview"><div class="titlepage"><div><div><h2 class="title" id="sec.tuning.cgroups.overview"><span class="number">9.1 </span><span class="name">Technical Overview and Definitions</span> <a title="Permalink" class="permalink" href="cha.tuning.cgroups.html#sec.tuning.cgroups.overview">#</a></h2></div></div></div><p>
   The following terms are used in this chapter:
  </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
     <span class="quote">“<span class="quote">cgroup</span>”</span> is another name for Control Groups.
    </p></li><li class="listitem "><p>
     In a cgroup there is a set of tasks (processes) associated with a set
     of subsystems that act as parameters constituting an environment for
     the tasks.
    </p></li><li class="listitem "><p>
     Subsystems provide the parameters that can be assigned and define CPU
     sets, freezer, or—more general—<span class="quote">“<span class="quote">resource
     controllers</span>”</span> for memory, disk I/O, network traffic, etc.
    </p></li><li class="listitem "><p>
     cgroups are organized in a tree-structured hierarchy. There can be more
     than one hierarchy in the system. You use a different or alternate
     hierarchy to cope with specific situations.
    </p></li><li class="listitem "><p>
     Every task running in the system is in exactly one of the cgroups in
     the hierarchy.
    </p></li></ul></div></div><div class="sect1 " id="sec.tuning.cgroups.scenario"><div class="titlepage"><div><div><h2 class="title" id="sec.tuning.cgroups.scenario"><span class="number">9.2 </span><span class="name">Scenario</span> <a title="Permalink" class="permalink" href="cha.tuning.cgroups.html#sec.tuning.cgroups.scenario">#</a></h2></div></div></div><p>
   See the following resource planning scenario for a better understanding
   (source:
   <code class="filename">/usr/src/linux/Documentation/cgroups/cgroups.txt</code>):
  </p><div class="figure" id="fig.tuning.cgroups.scenario1"><div class="figure-contents"><div class="mediaobject"><a xmlns="" href="images/cgroups1.png"><img src="images/cgroups1.png" width="" alt="Resource Planning" /></a></div></div><div class="figure-title-wrap"><h6 class="figure-title"><span class="number">Figure 9.1: </span><span class="name">Resource Planning </span><a title="Permalink" class="permalink" href="cha.tuning.cgroups.html#fig.tuning.cgroups.scenario1">#</a></h6></div></div><p>
   Web browsers such as Firefox will be part of the Web network class, while
   the NFS daemons such as (k)nfsd will be part of the NFS network class. On
   the other side, Firefox will share appropriate CPU and memory classes
   depending on whether a professor or student started it.
  </p></div><div class="sect1 " id="sec.tuning.cgroups.subsys"><div class="titlepage"><div><div><h2 class="title" id="sec.tuning.cgroups.subsys"><span class="number">9.3 </span><span class="name">Control Group Subsystems</span> <a title="Permalink" class="permalink" href="cha.tuning.cgroups.html#sec.tuning.cgroups.subsys">#</a></h2></div></div></div><p>
   The following subsystems are available:
   
   

       <code class="literal">cpuset</code>,
       <code class="literal">cpu</code>,
       <code class="literal">cpuacct</code>,
       <code class="literal">memory</code>,
       <code class="literal">devices</code>,
       <code class="literal">freezer</code>,
       <code class="literal">net_cls</code>,
       <code class="literal">net_prio</code>,
       <code class="literal">blkio</code>,
       <code class="literal">perf_event</code>, and
       <code class="literal">hugetlbt</code>.
  </p><p>
   Either mount each subsystem separately, for example:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> mkdir /cpuset /cpu
<code class="prompt user">tux &gt; </code><code class="command">sudo</code> mount -t cgroup -o cpuset      none /cpuset
<code class="prompt user">tux &gt; </code><code class="command">sudo</code> mount -t cgroup -o cpu,cpuacct none /cpu</pre></div><p>
   or all subsystems in one go; you can use an arbitrary device name (for example
   <code class="literal">none</code>), which will appear in
   <code class="filename">/proc/mounts</code>, for example:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> mount -t cgroup none /sys/fs/cgroup</pre></div><p>
   Some additional information on available subsystems:
  </p><div class="variablelist "><dl class="variablelist"><dt id="idm140339029898416"><span class="term "><code class="literal">net_cls</code> (Identification)</span></dt><dd><p>
      The Network classifier cgroup helps with providing identification
      for controlling processes such as Traffic Controller (tc) or
      Netfilter (iptables).  These controller tools can act on tagged
      network packets.
     </p><p>
      For more information, see
      <code class="filename">/usr/src/linux/Documentation/cgroups/net_cls.txt</code>.
     </p></dd><dt id="idm140339029895168"><span class="term "><code class="literal">net_prio</code> (Identification)</span></dt><dd><p>
      The Network priority cgroup helps with setting the priority of
      network packets.
     </p><p>
      For more information, see
      <code class="filename">/usr/src/linux/Documentation/cgroups/net_prio.txt</code>.
     </p></dd><dt id="idm140339029892064"><span class="term "><code class="literal">devices</code> (Isolation)</span></dt><dd><p>
      A system administrator can provide a list of devices that can be
      accessed by processes under cgroups.
     </p><p>
      It limits access to a device or a file system on a device to only
      tasks that belong to the specified cgroup. For more information, see
      <code class="filename">/usr/src/linux/Documentation/cgroups/devices.txt</code>.
     </p></dd><dt id="idm140339029888800"><span class="term "><code class="literal">freezer</code> (Control)</span></dt><dd><p>
      The <code class="literal">freezer</code> subsystem is useful for
      high-performance computing clusters (HPC clusters). Use it to
      freeze (stop) all tasks in a group or to stop tasks, if they reach
      a defined checkpoint. For more information, see
      <code class="filename">/usr/src/linux/Documentation/cgroups/freezer-subsystem.txt</code>.
     </p><p>
      Here are basic commands to use the freezer subsystem:
     </p><div class="verbatim-wrap"><pre class="screen">mount -t cgroup -o freezer freezer /freezer
# Create a child cgroup:
mkdir /freezer/0
# Put a task into this cgroup:
echo $task_pid &gt; /freezer/0/tasks
# Freeze it:
echo FROZEN &gt; /freezer/0/freezer.state
# Unfreeze (thaw) it:
echo THAWED &gt; /freezer/0/freezer.state</pre></div></dd><dt id="idm140339029884384"><span class="term "><code class="literal">perf_event</code> (Control)</span></dt><dd><p>
      <code class="literal">perf_event</code> collects performance data.
     </p></dd><dt id="idm140339029881840"><span class="term "><code class="literal">cpuset</code> (Isolation)</span></dt><dd><p>
      Use <code class="literal">cpuset</code> to tie processes to system subsets
      of CPUs and memory (<span class="quote">“<span class="quote">memory nodes</span>”</span>). For an example,
      see <a class="xref" href="cha.tuning.cgroups.html#sec.tuning.cgroups.usage.ex.cpusets" title="9.4.2. Example: Cpusets">Section 9.4.2, “Example: Cpusets”</a>.
     </p></dd><dt id="idm140339029878224"><span class="term "><code class="literal">cpuacct</code> (Accounting)</span></dt><dd><p>
      The CPU accounting controller groups tasks using cgroups and accounts
      the CPU usage of these groups. For more information, see
      <code class="filename">/usr/src/linux/Documentation/cgroups/cpuacct.txt</code>.
     </p></dd><dt id="idm140339029875536"><span class="term "><code class="literal">memory</code> (Resource Control)</span></dt><dd><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
        Tracking or limiting memory usage of user space processes.
       </p></li><li class="listitem "><p>
        Control swap usage by setting <code class="literal">swapaccount=1</code> as a
        kernel boot parameter.
       </p></li><li class="listitem "><p>
        Limit LRU (Least Recently Used) pages.
       </p></li><li class="listitem "><p>
        Anonymous and file cache.
       </p></li><li class="listitem "><p>
        No limits for kernel memory.
       </p></li><li class="listitem "><p>
        Maybe in another subsystem if needed.
       </p></li></ul></div><div id="idm140339029867168" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.png" /><h6>Note: Protection from Memory Pressure</h6><p>
       Memory cgroup now offers a mechanism allowing easier workload
       opt-in isolation. Memory cgroup can define its so called low
       limit (<code class="literal">memory.low_limit_in_bytes</code>), which works
       as a protection from memory pressure. For workloads that need to be
       isolated from outside memory management activity, the value should be set
       to the expected Resident Set Size (RSS) plus some head
       room. If a memory pressure condition triggers on the system and
       the particular group is still under its low limit, its memory is
       protected from reclaim. As a result, workloads outside of the
       cgroup do not need the aforementioned capping.
      </p></div><p>
      For more information, see
      <code class="filename">/usr/src/linux/Documentation/cgroups/memory.txt</code>.
     </p></dd><dt id="idm140339029863440"><span class="term "><code class="literal">hugetlb</code> (Resource Control)</span></dt><dd><p>
      The HugeTLB controller manages the memory allocated to huge
      pages.
     </p><p>
      For more information, see
      <code class="filename">/usr/src/linux/Documentation/cgroups/hugetlb.txt</code>.
     </p></dd><dt id="idm140339029860352"><span class="term "><code class="literal">cpu</code> (Control)</span></dt><dd><p>
      Share CPU bandwidth between groups with the group scheduling function
      of CFS (the scheduler). Mechanically complicated.
     </p></dd><dt id="idm140339029858144"><span class="term ">Blkio (Resource Control)</span></dt><dd><p>
      The Block IO controller is available as a disk I/O
      controller. With the blkio controller you can currently set policies
      for proportional bandwidth and for throttling.
     </p><p>
      These are the basic commands to configure proportional weight division
      of bandwidth by setting weight values in
      <code class="filename">blkio.weight</code>:
     </p><div class="verbatim-wrap"><pre class="screen"># Setup in /sys/fs/cgroup
mkdir /sys/fs/cgroup/blkio
mount -t cgroup -o blkio none /sys/fs/cgroup/blkio
# Start two cgroups
mkdir -p /sys/fs/cgroup/blkio/group1 /sys/fs/cgroup/blkio/group2
# Set weights
echo 1000 &gt; /sys/fs/cgroup/blkio/group1/blkio.weight
echo  500 &gt; /sys/fs/cgroup/blkio/group2/blkio.weight
# Write the PIDs of the processes to be controlled to the
# appropriate groups
<em class="replaceable ">COMMAND1</em> &amp;
echo $! &gt; /sys/fs/cgroup/blkio/group1/tasks

<em class="replaceable ">COMMAND2</em> &amp;
echo $! &gt; /sys/fs/cgroup/blkio/group2/tasks</pre></div><p>
      These are the basic commands to configure throttling or upper limit
      policy by setting values in
      <code class="literal">blkio.throttle.read_bps_device</code> for reads and
      <code class="literal">blkio.throttle.write_bps_device</code> for writes:
     </p><div class="verbatim-wrap"><pre class="screen"># Setup in /sys/fs/cgroup
mkdir /sys/fs/cgroup/blkio
mount -t cgroup -o blkio none /sys/fs/cgroup/blkio
# Bandwidth rate of a device for the root group; format:
# &lt;major&gt;:&lt;minor&gt;  &lt;byes_per_second&gt;
echo "8:16  1048576" &gt; /sys/fs/cgroup/blkio/blkio.throttle.read_bps_device</pre></div><p>
      For more information about caveats, usage scenarios, and additional
      parameters, see
      <code class="filename">/usr/src/linux/Documentation/cgroups/blkio-controller.txt</code>.
     </p></dd></dl></div></div><div class="sect1 " id="sec.tuning.cgroups.usage"><div class="titlepage"><div><div><h2 class="title" id="sec.tuning.cgroups.usage"><span class="number">9.4 </span><span class="name">Using Controller Groups</span> <a title="Permalink" class="permalink" href="cha.tuning.cgroups.html#sec.tuning.cgroups.usage">#</a></h2></div></div></div><div class="sect2 " id="sec.tuning.cgroups.usage.prer"><div class="titlepage"><div><div><h3 class="title" id="sec.tuning.cgroups.usage.prer"><span class="number">9.4.1 </span><span class="name">Prerequisites</span> <a title="Permalink" class="permalink" href="cha.tuning.cgroups.html#sec.tuning.cgroups.usage.prer">#</a></h3></div></div></div><p>
    To conveniently use cgroups, install the following additional packages:
   </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
      <code class="systemitem">libcgroup-tools</code> — basic user space tools
      to simplify resource management
     </p></li><li class="listitem "><p>
      <code class="systemitem">libcgroup1</code> — control groups
      management library
     </p></li><li class="listitem "><p>
      <code class="systemitem">cpuset</code> — contains the
      <code class="command">cset</code> to manipulate cpusets
     </p></li><li class="listitem "><p>
      <code class="systemitem">libcpuset1</code> — C API to cpusets
     </p></li><li class="listitem "><p>
      <code class="systemitem">kernel-source</code> — only needed for
      documentation purposes
     </p></li></ul></div></div><div class="sect2 " id="sec.tuning.cgroups.usage.ex.cpusets"><div class="titlepage"><div><div><h3 class="title" id="sec.tuning.cgroups.usage.ex.cpusets"><span class="number">9.4.2 </span><span class="name">Example: Cpusets</span> <a title="Permalink" class="permalink" href="cha.tuning.cgroups.html#sec.tuning.cgroups.usage.ex.cpusets">#</a></h3></div></div></div><p>
    With the command line proceed as follows:
   </p><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
      To determine the number of CPUs and memory nodes see
      <code class="filename">/proc/cpuinfo</code> and
      <code class="filename">/proc/zoneinfo</code>.
     </p></li><li class="step "><p>
      Create the cpuset hierarchy as a virtual file system (source:
      <code class="filename">/usr/src/linux/Documentation/cgroups/cpusets.txt</code>):
     </p><div class="verbatim-wrap"><pre class="screen">mount -t cgroup -ocpuset cpuset /sys/fs/cgroup/cpuset
cd /sys/fs/cgroup/cpuset
mkdir Charlie
cd Charlie
# List of CPUs in this cpuset:
echo 2-3 &gt; cpuset.cpus
# List of memory nodes in this cpuset:
echo 1 &gt; cpuset.mems
echo $$ &gt; tasks
# The subshell 'sh' is now running in cpuset Charlie
# The next line should display '/Charlie'
cat /proc/self/cpuset</pre></div></li><li class="step "><p>
      Remove the cpuset using shell commands:
     </p><div class="verbatim-wrap"><pre class="screen">rmdir /sys/fs/cgroup/cpuset/Charlie</pre></div><p>
      This fails as long as this cpuset is in use. First, you must remove
      the inside cpusets or tasks (processes) that belong to it. Check it
      with:
     </p><div class="verbatim-wrap"><pre class="screen">cat /sys/fs/cgroup/cpuset/Charlie/tasks</pre></div></li></ol></div></div><p>
    For background information and additional configuration flags, see
    <code class="filename">/usr/src/linux/Documentation/cgroups/cpusets.txt</code>.
   </p><p>
    With the <code class="command">cset</code> tool, proceed as follows:
   </p><div class="verbatim-wrap"><pre class="screen"># Determine the number of CPUs and memory nodes
cset set --list
# Creating the cpuset hierarchy
cset set --cpu=2-3 --mem=1 --set=Charlie
# Starting processes in a cpuset
cset proc --set Charlie --exec -- stress -c 1 &amp;
# Moving existing processes to a cpuset
cset proc --move --pid <em class="replaceable ">PID</em> --toset=Charlie
# List task in a cpuset
cset proc --list --set Charlie
# Removing a cpuset
cset set --destroy Charlie</pre></div></div><div class="sect2 " id="sec.tuning.cgroups.usage.ex.cg"><div class="titlepage"><div><div><h3 class="title" id="sec.tuning.cgroups.usage.ex.cg"><span class="number">9.4.3 </span><span class="name">Example: cgroups</span> <a title="Permalink" class="permalink" href="cha.tuning.cgroups.html#sec.tuning.cgroups.usage.ex.cg">#</a></h3></div></div></div><p>
    Using shell commands, proceed as follows:
   </p><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
      Create the cgroups hierarchy:
     </p><div class="verbatim-wrap"><pre class="screen">mount -t cgroup cgroup /sys/fs/cgroup
cd /sys/fs/cgroup/cpuset/cgroup
mkdir priority
cd priority
cat cpu.shares</pre></div></li><li class="step "><p>
      Understanding cpu.shares:
     </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
        1024 is the default (for more information, see
        <code class="filename">/Documentation/scheduler/sched-design-CFS.txt</code>)
        = 50% usage
       </p></li><li class="listitem "><p>
        1524 = 60% usage
       </p></li><li class="listitem "><p>
        2048 = 67% usage
       </p></li><li class="listitem "><p>
        512 = 40% usage
       </p></li></ul></div></li><li class="step "><p>
      Changing cpu.shares
     </p><div class="verbatim-wrap"><pre class="screen">echo 1024 &gt; cpu.shares</pre></div></li></ol></div></div></div><div class="sect2 " id="sec.tuning.cgroups.usage.perms"><div class="titlepage"><div><div><h3 class="title" id="sec.tuning.cgroups.usage.perms"><span class="number">9.4.4 </span><span class="name">Setting Directory and File Permissions</span> <a title="Permalink" class="permalink" href="cha.tuning.cgroups.html#sec.tuning.cgroups.usage.perms">#</a></h3></div></div></div><p>
    This is a simple example. Use the following in
    <code class="filename">/etc/cgconfig.conf</code>:
   </p><div class="verbatim-wrap"><pre class="screen">group foo {
        perm {
                task {
                        uid = root;
                        gid = users;
                        fperm = 660;
                }
                admin {
                        uid = root;
                        gid = root;
                        fperm = 600;
                        dperm = 750;
                }
        }
}

mount {
        cpu = /mnt/cgroups/cpu;
}</pre></div><p>
    Then start the cgconfig service and <code class="command">stat
    /mnt/cgroups/cpu/foo/tasks</code> which should show the permissions
    mask <code class="literal">660</code> with <code class="literal">root</code> as an owner and
    <code class="literal">users</code> as a group. <code class="command">stat
    /mnt/cgroups/cpu/foo/</code> should be <code class="literal">750</code> and all
    files (but <code class="filename">tasks</code>) should have the mask
    <code class="literal">600</code>. Note that <code class="literal">fperm</code> is applied on
    top of existing file permissions as a mask.
   </p><p>
    For more information, see the <code class="systemitem">cgconfig.conf</code> man
    page.
   </p></div></div><div class="sect1 " id="sec.tuning.cgroups.info"><div class="titlepage"><div><div><h2 class="title" id="sec.tuning.cgroups.info"><span class="number">9.5 </span><span class="name">For More Information</span> <a title="Permalink" class="permalink" href="cha.tuning.cgroups.html#sec.tuning.cgroups.info">#</a></h2></div></div></div><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
     Kernel documentation (package <code class="systemitem">kernel-source</code>):
     files in <code class="filename">/usr/src/linux/Documentation/cgroups</code>.
    </p></li><li class="listitem "><p>
     <a class="link" href="http://lwn.net/Articles/604609/" target="_blank">http://lwn.net/Articles/604609/</a>—Brown,
     Neil: Control Groups Series (2014, 7 parts).
    </p></li><li class="listitem "><p>
     <a class="link" href="http://lwn.net/Articles/243795/" target="_blank">http://lwn.net/Articles/243795/</a>—Corbet,
     Jonathan: Controlling memory use in containers (2007).
    </p></li><li class="listitem "><p>
     <a class="link" href="http://lwn.net/Articles/236038/" target="_blank">http://lwn.net/Articles/236038/</a>—Corbet,
     Jonathan: Process containers (2007).
    </p></li></ul></div></div></div></div><div class="page-bottom"><div id="_bottom-navigation"><a class="nav-link" href="cha.tuning.numactl.html"><span class="next-icon">→</span><span class="nav-label"><span class="number">Chapter 10 </span>Automatic Non-Uniform Memory Access (NUMA) Balancing</span></a><a class="nav-link" href="cha.tuning.resources.html"><span class="prev-icon">←</span><span class="nav-label"><span class="number">Chapter 8 </span>General System Resource Management</span></a></div><div id="_share-print"><div class="online-contents share"><strong>Share this page: </strong><span class="share-buttons"><span id="_share-fb" class="bottom-button">Facebook</span><span class="spacer"> • </span><span id="_share-gp" class="bottom-button">Google+</span><span class="spacer"> • </span><span id="_share-tw" class="bottom-button">Twitter</span><span class="spacer"> • </span><span id="_share-mail" class="bottom-button">E-Mail</span></span></div><div class="print"><span id="_print-button" class="bottom-button">Print this page</span></div><div class="clearme"></div></div></div></div><div id="_inward"></div></div><div id="_footer-wrap"><div id="_footer"><p>©
        2018 
        SUSE</p><ul><li><a href="http://www.suse.com/company/careers/" target="_top">Careers</a></li><li><a href="http://www.suse.com/company/legal/" target="_top">Legal</a></li><li><a href="http://www.suse.com/company/" target="_top">About</a></li><li><a href="http://www.suse.com/ContactsOffices/contacts_offices.jsp" target="_top">Contact Us</a></li></ul></div></div></body></html>