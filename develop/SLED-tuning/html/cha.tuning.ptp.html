<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang=""><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Precision Time Protocol | System Analysis and Tuning Guide | SUSE Linux Enterprise Desktop 15</title><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" /><link rel="stylesheet" type="text/css" href="static/css/style.css" /><link rel="stylesheet" type="text/css" href="static/css/highlight.css" /><meta name="generator" content="DAPS 2.4.0 using SUSE XSL Stylesheets 2.0.8 (based on DocBook XSL Stylesheets 1.78.1) - chunked" /><meta name="product-name" content="SUSE Linux Enterprise Desktop" /><meta name="product-number" content="15" /><meta name="book-title" content="System Analysis and Tuning Guide" /><meta name="chapter-title" content="Chapter 18. Precision Time Protocol" /><meta name="tracker-url" content="https://bugzilla.suse.com/enter_bug.cgi" /><meta name="tracker-type" content="bsc" /><meta name="tracker-bsc-assignee" content="fs@suse.com" /><meta name="tracker-bsc-component" content="Documentation" /><meta name="tracker-bsc-product" content="Beta SUSE Linux Enterprise Desktop 15" /><link rel="home" href="index.html" title="SUSE Linux Enterprise Desktop Documentation" /><link rel="up" href="part.tuning.ptp.html" title="Part VII. Synchronized Clocks with Precision Time Protocol" /><link rel="prev" href="part.tuning.ptp.html" title="Part VII. Synchronized Clocks with Precision Time Protocol" /><link rel="next" href="bk06apa.html" title="Appendix A. GNU Licenses" /><script type="text/javascript">

var protocol = window.location.protocol.toLowerCase();
if ( protocol != 'file:' ) {
  var agent = navigator.userAgent.toLowerCase();
  var wanted = ( protocol == 'https:') ? 'https' : 'http';
  var file = 'fonts.css';
  document.write('<link rel="stylesheet" type="text/css" href="' + wanted + '://static.opensuse.org/fonts/'+ file +'"></link>');
}
else {
   document.write('<link rel="stylesheet" type="text/css" href="static/css/fonts-onlylocal.css"></link>');
}

</script><noscript><link rel="stylesheet" type="text/css" href="http://static.opensuse.org/fonts/fonts.css" /></noscript><script src="static/js/jquery-1.10.2.min.js" type="text/javascript"></script><script src="static/js/script.js" type="text/javascript"></script><script src="static/js/highlight.min.js" type="text/javascript"></script><script>

$(document).ready(function() {
  $('.verbatim-wrap.highlight').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});
hljs.configure({
  useBR: false
});

</script></head><body class="draft offline js-off"><div id="_outer-wrap"><div id="_white-bg"><div id="_header"><div id="_logo"><img src="static/images/logo.png" alt="Logo" /></div><div class="crumbs"><a class="book-link" href="index.html" title="SUSE Linux Enterprise Desktop Documentation"><span class="book-icon">SUSE Linux Enterprise Desktop Documentation</span></a><span> › </span><a class="crumb" href="book.sle.tuning.html">System Analysis and Tuning Guide</a><span> › </span><a class="crumb" href="part.tuning.ptp.html">Synchronized Clocks with Precision Time Protocol</a><span> › </span><a class="crumb" href="cha.tuning.ptp.html">Precision Time Protocol</a></div><div class="clearme"></div></div></div><div id="_toolbar-wrap"><div id="_toolbar"><div id="_toc-area" class="inactive"><a id="_toc-area-button" class="tool" title="Contents" accesskey="c" href="index.html"><span class="tool-spacer"><span class="toc-icon">Contents</span><span class="clearme"></span></span><span class="tool-label">Contents</span></a><div class="active-contents bubble-corner"></div><div class="active-contents bubble"><div class="bubble-container"><h6>System Analysis and Tuning Guide</h6><div id="_bubble-toc"><ol><li class="inactive"><a href="preface.tuning.html"><span class="number"> </span><span class="name">About This Guide</span></a></li><li class="inactive"><a href="part.tuning.basics.html"><span class="number">I </span><span class="name">Basics</span></a><ol><li class="inactive"><a href="cha.tuning.basics.html"><span class="number">1 </span><span class="name">General Notes on System Tuning</span></a></li></ol></li><li class="inactive"><a href="part.tuning.monitoring.html"><span class="number">II </span><span class="name">System Monitoring</span></a><ol><li class="inactive"><a href="cha.util.html"><span class="number">2 </span><span class="name">System Monitoring Utilities</span></a></li><li class="inactive"><a href="cha.tuning.logfiles.html"><span class="number">3 </span><span class="name">Analyzing and Managing System Log Files</span></a></li></ol></li><li class="inactive"><a href="part.tuning.kerneltrace.html"><span class="number">III </span><span class="name">Kernel Monitoring</span></a><ol><li class="inactive"><a href="cha.tuning.systemtap.html"><span class="number">4 </span><span class="name">SystemTap—Filtering and Analyzing System Data</span></a></li><li class="inactive"><a href="cha.tuning.kprobes.html"><span class="number">5 </span><span class="name">Kernel Probes</span></a></li><li class="inactive"><a href="cha.perf.html"><span class="number">6 </span><span class="name">Hardware-Based Performance Monitoring with Perf</span></a></li><li class="inactive"><a href="cha.tuning.oprofile.html"><span class="number">7 </span><span class="name">OProfile—System-Wide Profiler</span></a></li></ol></li><li class="inactive"><a href="part.tuning.resources.html"><span class="number">IV </span><span class="name">Resource Management</span></a><ol><li class="inactive"><a href="cha.tuning.resources.html"><span class="number">8 </span><span class="name">General System Resource Management</span></a></li><li class="inactive"><a href="cha.tuning.cgroups.html"><span class="number">9 </span><span class="name">Kernel Control Groups</span></a></li><li class="inactive"><a href="cha.tuning.numactl.html"><span class="number">10 </span><span class="name">Automatic Non-Uniform Memory Access (NUMA) Balancing</span></a></li><li class="inactive"><a href="cha.tuning.power.html"><span class="number">11 </span><span class="name">Power Management</span></a></li></ol></li><li class="inactive"><a href="part.tuning.kernel.html"><span class="number">V </span><span class="name">Kernel Tuning</span></a><ol><li class="inactive"><a href="cha.tuning.io.html"><span class="number">12 </span><span class="name">Tuning I/O Performance</span></a></li><li class="inactive"><a href="cha.tuning.taskscheduler.html"><span class="number">13 </span><span class="name">Tuning the Task Scheduler</span></a></li><li class="inactive"><a href="cha.tuning.memory.html"><span class="number">14 </span><span class="name">Tuning the Memory Management Subsystem</span></a></li><li class="inactive"><a href="cha.tuning.network.html"><span class="number">15 </span><span class="name">Tuning the Network</span></a></li></ol></li><li class="inactive"><a href="part.tuning.dumps.html"><span class="number">VI </span><span class="name">Handling System Dumps</span></a><ol><li class="inactive"><a href="cha.tuning.tracing.html"><span class="number">16 </span><span class="name">Tracing Tools</span></a></li><li class="inactive"><a href="cha.tuning.kexec.html"><span class="number">17 </span><span class="name">Kexec and Kdump</span></a></li></ol></li><li class="inactive"><a href="part.tuning.ptp.html"><span class="number">VII </span><span class="name">Synchronized Clocks with Precision Time Protocol</span></a><ol><li class="inactive"><a href="cha.tuning.ptp.html"><span class="number">18 </span><span class="name">Precision Time Protocol</span></a></li></ol></li><li class="inactive"><a href="bk06apa.html"><span class="number">A </span><span class="name">GNU Licenses</span></a></li></ol></div><div class="clearme"></div></div></div></div><div id="_nav-area" class="inactive"><div class="tool"><span class="nav-inner"><span class="tool-label">Navigation</span><a accesskey="p" class="tool-spacer" title="Part VII. Synchronized Clocks with Precision Time Protocol" href="part.tuning.ptp.html"><span class="prev-icon">←</span></a><a accesskey="n" class="tool-spacer" title="Appendix A. GNU Licenses" href="bk06apa.html"><span class="next-icon">→</span></a></span></div></div></div></div><div id="_fixed-header-wrap" class="inactive"><div id="_fixed-header"><div class="crumbs"><a class="book-link" href="index.html" title="SUSE Linux Enterprise Desktop Documentation"><span class="book-icon">SUSE Linux Enterprise Desktop Documentation</span></a><span> › </span><a class="crumb" href="book.sle.tuning.html">System Analysis and Tuning Guide</a><span> › </span><a class="crumb" href="part.tuning.ptp.html">Synchronized Clocks with Precision Time Protocol</a><span> › </span><a class="crumb" href="cha.tuning.ptp.html">Precision Time Protocol</a></div><div class="buttons"><a class="top-button button" href="#">Top</a><div class="button"><a accesskey="p" class="tool-spacer" title="Part VII. Synchronized Clocks with Precision Time Protocol" href="part.tuning.ptp.html"><span class="prev-icon">←</span></a><a accesskey="n" class="tool-spacer" title="Appendix A. GNU Licenses" href="bk06apa.html"><span class="next-icon">→</span></a></div><div class="clearme"></div></div><div class="clearme"></div></div></div><div id="_content" class="draft "><div class="documentation"><div class="chapter " id="cha.tuning.ptp"><div class="titlepage"><div><div class="version-info">Applies to  <span class="productname"><span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span></span> <span class="productnumber"><span class="productnumber"><span class="phrase">15</span></span></span></div><div><h2 class="title"><span class="number">18 </span><span class="name">Precision Time Protocol</span> </h2><div class="doc-status"><ul><li><span class="ds-label">Filename: </span>tuning_ptp.xml</li><li><span class="ds-label">ID: </span>cha.tuning.ptp</li></ul></div></div></div></div><div class="line"><div class="toc"><dl><dt><span class="sect1"><a href="cha.tuning.ptp.html#tuning.ptp.intro"><span class="number">18.1 </span><span class="name">Introduction to PTP</span></a></span></dt><dt><span class="sect1"><a href="cha.tuning.ptp.html#tuning.ptp.using"><span class="number">18.2 </span><span class="name">Using PTP</span></a></span></dt><dt><span class="sect1"><a href="cha.tuning.ptp.html#tuning.ptp.phc2sys"><span class="number">18.3 </span><span class="name">Synchronizing the Clocks with <code class="command">phc2sys</code></span></a></span></dt><dt><span class="sect1"><a href="cha.tuning.ptp.html#tuning.ptp.examples"><span class="number">18.4 </span><span class="name">Examples of Configurations</span></a></span></dt><dt><span class="sect1"><a href="cha.tuning.ptp.html#tuning.ptp.ntp"><span class="number">18.5 </span><span class="name">PTP and NTP</span></a></span></dt></dl></div></div><p>
  For network environments, it is vital to keep the computer and other devices'
  clocks synchronized and accurate. There are several solutions to achieve
  this, for example the widely used Network Time Protocol (NTP) described in
  <span class="intraxref">Book “<em class="citetitle ">Administration Guide</em>”, Chapter 27 “Time Synchronization with NTP”</span>.
 </p><p>
  The Precision Time Protocol (PTP) is a protocol capable of sub-microsecond accuracy, which is
  better than what NTP achieves. PTP support is divided between the kernel and
  user space. The kernel in <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span> includes support for PTP clocks,
  which are provided by network drivers.
 </p><div class="sect1 " id="tuning.ptp.intro"><div class="titlepage"><div><div><h2 class="title" id="tuning.ptp.intro"><span class="number">18.1 </span><span class="name">Introduction to PTP</span> <a title="Permalink" class="permalink" href="cha.tuning.ptp.html#tuning.ptp.intro">#</a></h2></div></div></div><p>
   The clocks managed by PTP follow a master-slave hierarchy. The slaves are
   synchronized to their masters. The hierarchy is updated by the
   <span class="emphasis"><em>best master clock</em></span> (BMC) algorithm, which runs on every
   clock. The clock with only one port can be either master or slave. Such a
   clock is called an <span class="emphasis"><em>ordinary clock</em></span> (OC). A clock with
   multiple ports can be master on one port and slave on another. Such a clock
   is called a <span class="emphasis"><em>boundary clock</em></span> (BC). The top-level master
   is called the <span class="emphasis"><em>grandmaster clock</em></span>. The grandmaster clock
   can be synchronized with a Global Positioning System (GPS). This way
   disparate networks can be synchronized with a high degree of accuracy.
  </p><p>
   The hardware support is the main advantage of PTP. It is supported by
   various network switches and network interface controllers (NIC). While it
   is possible to use non-PTP enabled hardware within the network, having
   network components between all PTP clocks PTP hardware enabled achieves the
   best possible accuracy.
  </p><div class="sect2 " id="tuning.ptp.linuxptp"><div class="titlepage"><div><div><h3 class="title" id="tuning.ptp.linuxptp"><span class="number">18.1.1 </span><span class="name">PTP Linux Implementation</span> <a title="Permalink" class="permalink" href="cha.tuning.ptp.html#tuning.ptp.linuxptp">#</a></h3></div></div></div><p>
    On <span class="productname"><span class="phrase">SUSE Linux Enterprise Desktop</span></span>, the implementation of PTP is provided by the
    <code class="systemitem">linuxptp</code> package. Install it with <code class="command">zypper
    install linuxptp</code>. It includes the <code class="command">ptp4l</code> and
    <code class="command">phc2sys</code> programs for clock synchronization.
    <code class="command">ptp4l</code> implements the PTP boundary clock and ordinary
    clock. When hardware time stamping is enabled, <code class="command">ptp4l</code>
    synchronizes the PTP hardware clock to the master clock. With software time
    stamping, it synchronizes the system clock to the master clock.
    <code class="command">phc2sys</code> is needed only with hardware time stamping to
    synchronize the system clock to the PTP hardware clock on the network
    interface card (NIC).
   </p></div></div><div class="sect1 " id="tuning.ptp.using"><div class="titlepage"><div><div><h2 class="title" id="tuning.ptp.using"><span class="number">18.2 </span><span class="name">Using PTP</span> <a title="Permalink" class="permalink" href="cha.tuning.ptp.html#tuning.ptp.using">#</a></h2></div></div></div><div class="sect2 " id="tuning.ptp.driver_support"><div class="titlepage"><div><div><h3 class="title" id="tuning.ptp.driver_support"><span class="number">18.2.1 </span><span class="name">Network Driver and Hardware Support</span> <a title="Permalink" class="permalink" href="cha.tuning.ptp.html#tuning.ptp.driver_support">#</a></h3></div></div></div><p>
    PTP requires that the used kernel network driver supports either software
    or hardware time stamping. Moreover, the NIC must support time stamping in
    the physical hardware. You can verify the driver and NIC time stamping
    capabilities with <code class="command">ethtool</code>:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> ethtool -T eth0
Time stamping parameters for eth0:
Capabilities:
hardware-transmit     (SOF_TIMESTAMPING_TX_HARDWARE)
        software-transmit     (SOF_TIMESTAMPING_TX_SOFTWARE)
        hardware-receive      (SOF_TIMESTAMPING_RX_HARDWARE)
        software-receive      (SOF_TIMESTAMPING_RX_SOFTWARE)
        software-system-clock (SOF_TIMESTAMPING_SOFTWARE)
        hardware-raw-clock    (SOF_TIMESTAMPING_RAW_HARDWARE)
PTP Hardware Clock: 0
Hardware Transmit Timestamp Modes:
        off                   (HWTSTAMP_TX_OFF)
        on                    (HWTSTAMP_TX_ON)
Hardware Receive Filter Modes:
        none                  (HWTSTAMP_FILTER_NONE)
        all                   (HWTSTAMP_FILTER_ALL)</pre></div><p>
    Software time stamping requires the following parameters:
   </p><div class="verbatim-wrap"><pre class="screen">SOF_TIMESTAMPING_SOFTWARE
SOF_TIMESTAMPING_TX_SOFTWARE
SOF_TIMESTAMPING_RX_SOFTWARE</pre></div><p>
    Hardware time stamping requires the following parameters:
   </p><div class="verbatim-wrap"><pre class="screen">SOF_TIMESTAMPING_RAW_HARDWARE
SOF_TIMESTAMPING_TX_HARDWARE
SOF_TIMESTAMPING_RX_HARDWARE</pre></div></div><div class="sect2 " id="tuning.ptp.ptp41"><div class="titlepage"><div><div><h3 class="title" id="tuning.ptp.ptp41"><span class="number">18.2.2 </span><span class="name">Using <code class="command">ptp4l</code></span> <a title="Permalink" class="permalink" href="cha.tuning.ptp.html#tuning.ptp.ptp41">#</a></h3></div></div></div><p>
    <code class="command">ptp4l</code> uses hardware time stamping by default. As
    <code class="systemitem">root</code>, you need to specify the network interface capable of hardware
    time stamping with the <code class="option">-i</code> option. The <code class="option">-m</code>
    tells <code class="command">ptp4l</code> to print its output to the standard output
    instead of the system's logging facility:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> ptp4l -m -i eth0
selected eth0 as PTP clock
port 1: INITIALIZING to LISTENING on INITIALIZE
port 0: INITIALIZING to LISTENING on INITIALIZE
port 1: new foreign master 00a152.fffe.0b334d-1
selected best master clock 00a152.fffe.0b334d
port 1: LISTENING to UNCALIBRATED on RS_SLAVE
master offset -25937 s0 freq +0 path delay       12340
master offset -27887 s0 freq +0 path delay       14232
master offset -38802 s0 freq +0 path delay       13847
master offset -36205 s1 freq +0 path delay       10623
master offset  -6975 s2 freq -30575 path delay   10286
port 1: UNCALIBRATED to SLAVE on MASTER_CLOCK_SELECTED
master offset  -4284 s2 freq -30135 path delay    9892</pre></div><p>
    The <code class="literal">master offset</code> value represents the measured offset
    from the master (in nanoseconds).
   </p><p>
    The <code class="literal">s0</code>, <code class="literal">s1</code>, <code class="literal">s2</code>
    indicators show the different states of the clock servo:
    <code class="literal">s0</code> is unlocked, <code class="literal">s1</code> is clock step, and
    <code class="literal">s2</code> is locked. If the servo is in the locked state
    (<code class="literal">s2</code>), the clock will not be stepped (only slowly
    adjusted) if the <code class="option">pi_offset_const</code> option is set to a
    negative value in the configuration file (see <code class="command">man 8
    ptp4l</code> for more information).
   </p><p>
    The <code class="literal">freq</code> value represents the frequency adjustment of
    the clock (in parts per billion, ppb).
   </p><p>
    The <code class="literal">path delay</code> value represents the estimated delay of
    the synchronization messages sent from the master (in nanoseconds).
   </p><p>
    Port 0 is a Unix domain socket used for local PTP management. Port 1 is the
    <code class="systemitem">eth0</code> interface.
   </p><p>
    <code class="literal">INITIALIZING</code>, <code class="literal">LISTENING</code>,
    <code class="literal">UNCALIBRATED</code> and <code class="literal">SLAVE</code> are examples
    of port states which change on <code class="literal">INITIALIZE</code>,
    <code class="literal">RS_SLAVE</code>, and <code class="literal">MASTER_CLOCK_SELECTED</code>
    events. When the port state changes from <code class="literal">UNCALIBRATED</code> to
    <code class="literal">SLAVE</code>, the computer has successfully synchronized with a
    PTP master clock.
   </p><p>
    You can enable software time stamping with the <code class="option">-S</code> option.
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> ptp4l -m -S -i eth3</pre></div><p>
    You can also run <code class="command">ptp4l</code> as a service:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> systemctl start ptp4l</pre></div><p>
    In this case, <code class="command">ptp4l</code> reads its options from the
    <code class="filename">/etc/sysconfig/ptp4l</code> file. By default, this file tells
    <code class="command">ptp4l</code> to read the configuration options from
    <code class="filename">/etc/ptp4l.conf</code>. For more information on
    <code class="command">ptp4l</code> options and the configuration file settings, see
    <code class="command">man 8 ptp4l</code>.
   </p><p>
    To enable the <code class="command">ptp4l</code> service permanently, run the
    following:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> systemctl enable ptp4l</pre></div><p>
    To disable it, run
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> systemctl disable ptp4l</pre></div></div><div class="sect2 " id="tuning.ptp.confile"><div class="titlepage"><div><div><h3 class="title" id="tuning.ptp.confile"><span class="number">18.2.3 </span><span class="name"><code class="command">ptp4l</code> Configuration File</span> <a title="Permalink" class="permalink" href="cha.tuning.ptp.html#tuning.ptp.confile">#</a></h3></div></div></div><p>
    <code class="command">ptp4l</code> can read its configuration from an optional
    configuration file. As no configuration file is used by default, you need
    to specify it with <code class="option">-f</code>.
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> ptp4l -f /etc/ptp4l.conf</pre></div><p>
    The configuration file is divided into sections. The global section
    (indicated as <code class="literal">[global]</code>) sets the program options, clock
    options and default port options. Other sections are port specific, and
    they override the default port options. The name of the section is the name
    of the configured port—for example, <code class="literal">[eth0]</code>. An
    empty port section can be used to replace the command line option.
   </p><div class="verbatim-wrap"><pre class="screen">[global]
verbose               1
time_stamping         software
[eth0]</pre></div><p>
    The example configuration file is an equivalent of the following command's
    options:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> ptp4l -i eth0 -m -S</pre></div><p>
    For a complete list of <code class="command">ptp4l</code> configuration options, see
    <code class="command">man 8 ptp4l</code>.
   </p></div><div class="sect2 " id="tuning.ptp.delay_measurement"><div class="titlepage"><div><div><h3 class="title" id="tuning.ptp.delay_measurement"><span class="number">18.2.4 </span><span class="name">Delay Measurement</span> <a title="Permalink" class="permalink" href="cha.tuning.ptp.html#tuning.ptp.delay_measurement">#</a></h3></div></div></div><p>
    <code class="command">ptp4l</code> measures time delay in two different ways:
    <span class="emphasis"><em>peer-to-peer</em></span> (P2P) or <span class="emphasis"><em>end-to-end</em></span>
    (E2E).
   </p><div class="variablelist "><dl class="variablelist"><dt id="idm139986049561456"><span class="term ">P2P</span></dt><dd><p>
       This method is specified with <code class="option">-P</code>.
      </p><p>
       It reacts to changes in the network environment faster and is more
       accurate in measuring the delay. It is only used in networks where each
       port exchanges PTP messages with one other port. P2P needs to be
       supported by all hardware on the communication path.
      </p></dd><dt id="idm139986049558528"><span class="term ">E2E</span></dt><dd><p>
       This method is specified with <code class="option">-E</code>. This is the default.
      </p></dd><dt id="idm139986049556256"><span class="term ">Automatic method selection</span></dt><dd><p>
       This method is specified with <code class="option">-A</code>. The automatic option
       starts <code class="command">ptp4l</code> in E2E mode, and changes to P2P mode if
       a peer delay request is received.
      </p></dd></dl></div><div id="idm139986049553280" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.png" /><h6>Important: Common Measurement Method</h6><p>
     All clocks on a single PTP communication path must use the same method to
     measure the time delay. A warning will be printed if either a peer delay
     request is received on a port using the E2E mechanism, or an E2E delay
     request is received on a port using the P2P mechanism.
    </p></div></div><div class="sect2 " id="tuning.ptp.pmc"><div class="titlepage"><div><div><h3 class="title" id="tuning.ptp.pmc"><span class="number">18.2.5 </span><span class="name">PTP Management Client: <code class="command">pmc</code></span> <a title="Permalink" class="permalink" href="cha.tuning.ptp.html#tuning.ptp.pmc">#</a></h3></div></div></div><p>
    You can use the <code class="command">pmc</code> client to obtain more detailed
    information about <code class="command">ptp41</code>. It reads from the standard
    input—or from the command line—actions specified by name and
    management ID. Then it sends the actions over the selected transport, and
    prints any received replies. There are three actions supported:
    <code class="command">GET</code> retrieves the specified information,
    <code class="command">SET</code> updates the specified information, and
    <code class="command">CMD</code> (or <code class="command">COMMAND</code>) initiates the
    specified event.
   </p><p>
    By default, the management commands are addressed to all ports. The
    <code class="command">TARGET</code> command can be used to select a particular clock
    and port for the subsequent messages. For a complete list of management
    IDs, run <code class="command">pmc help</code>.
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> pmc -u -b 0 'GET TIME_STATUS_NP'
sending: GET TIME_STATUS_NP
        90f2ca.fffe.20d7e9-0 seq 0 RESPONSE MANAGMENT TIME_STATUS_NP
                master_offset              283
                ingress_time               1361569379345936841
                cumulativeScaledRateOffset   +1.000000000
                scaledLastGmPhaseChange    0
                gmTimeBaseIndicator        0
                lastGmPhaseChange          0x0000'0000000000000000.0000
                gmPresent                  true
                gmIdentity                 00b058.feef.0b448a</pre></div><p>
    The <code class="option">-b</code> option specifies the boundary hops value in sent
    messages. Setting it to zero limits the boundary to the local
    <code class="command">ptp4l</code> instance. Increasing the value will retrieve the
    messages also from PTP nodes that are further from the local instance. The
    returned information may include:
   </p><div class="variablelist "><dl class="variablelist"><dt id="idm139986049541552"><span class="term ">stepsRemoved</span></dt><dd><p>
       The number of communication nodes to the grandmaster clock.
      </p></dd><dt id="idm139986049539696"><span class="term ">offsetFromMaster, master_offset</span></dt><dd><p>
       The last measured offset of the clock from the master clock
       (nanoseconds).
      </p></dd><dt id="idm139986049537808"><span class="term ">meanPathDelay</span></dt><dd><p>
       The estimated delay of the synchronization messages sent from the master
       clock (nanoseconds).
      </p></dd><dt id="idm139986049535920"><span class="term ">gmPresent</span></dt><dd><p>
       If <code class="literal">true</code>, the PTP clock is synchronized to the master
       clock; the local clock is not the grandmaster clock.
      </p></dd><dt id="idm139986049533584"><span class="term ">gmIdentity</span></dt><dd><p>
       This is the grandmaster's identity.
      </p></dd></dl></div><p>
    For a complete list of <code class="command">pmc</code> command line options, see
    <code class="command">man 8 pmc</code>.
   </p></div></div><div class="sect1 " id="tuning.ptp.phc2sys"><div class="titlepage"><div><div><h2 class="title" id="tuning.ptp.phc2sys"><span class="number">18.3 </span><span class="name">Synchronizing the Clocks with <code class="command">phc2sys</code></span> <a title="Permalink" class="permalink" href="cha.tuning.ptp.html#tuning.ptp.phc2sys">#</a></h2></div></div></div><p>
   Use <code class="command">phc2sys</code> to synchronize the system clock to the PTP
   hardware clock (PHC) on the network card. The system clock is considered a
   <span class="emphasis"><em>slave</em></span>, while the network card a
   <span class="emphasis"><em>master</em></span>. PHC itself is synchronized with
   <code class="command">ptp4l</code> (see <a class="xref" href="cha.tuning.ptp.html#tuning.ptp.using" title="18.2. Using PTP">Section 18.2, “Using PTP”</a>). Use
   <code class="option">-s</code> to specify the master clock by device or network
   interface. Use <code class="option">-w</code> to wait until <code class="command">ptp4l</code> is
   in a synchronized state.
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> phc2sys -s eth0 -w</pre></div><p>
   PTP operates in <span class="emphasis"><em>International Atomic Time</em></span> (TAI), while
   the system clock uses <span class="emphasis"><em>Coordinated Universal Time</em></span> (UTC).
   If you do not specify <code class="option">-w</code> to wait for
   <code class="command">ptp4l</code> synchronization, you can specify the offset in
   seconds between TAI and UTC with <code class="option">-O</code>:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> phc2sys -s eth0 -O -35</pre></div><p>
   You can run <code class="command">phc2sys</code> as a service as well:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> systemctl start phc2sys</pre></div><p>
   In this case, <code class="command">phc2sys</code> reads its options from the
   <code class="filename">/etc/sysconfig/phc2sys</code> file. For more information on
   <code class="command">phc2sys</code> options, see <code class="command">man 8 phc2sys</code>.
  </p><p>
   To enable the <code class="command">phc2sys</code> service permanently, run the
   following:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> systemctl enable phc2sys</pre></div><p>
   To disable it, run
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> systemctl disable phc2sys</pre></div><div class="sect2 " id="tuning.ptp.phc2sys.verify"><div class="titlepage"><div><div><h3 class="title" id="tuning.ptp.phc2sys.verify"><span class="number">18.3.1 </span><span class="name">Verifying Time Synchronization</span> <a title="Permalink" class="permalink" href="cha.tuning.ptp.html#tuning.ptp.phc2sys.verify">#</a></h3></div></div></div><p>
    When PTP time synchronization is working properly and hardware time
    stamping is used, <code class="command">ptp4l</code> and <code class="command">phc2sys</code>
    output messages with time offsets and frequency adjustments periodically to
    the system log.
   </p><p>
    An example of the <code class="command">ptp4l</code> output:
   </p><div class="verbatim-wrap"><pre class="screen">ptp4l[351.358]: selected /dev/ptp0 as PTP clock
ptp4l[352.361]: port 1: INITIALIZING to LISTENING on INITIALIZE
ptp4l[352.361]: port 0: INITIALIZING to LISTENING on INITIALIZE
ptp4l[353.210]: port 1: new foreign master 00a069.eefe.0b442d-1
ptp4l[357.214]: selected best master clock 00a069.eefe.0b662d
ptp4l[357.214]: port 1: LISTENING to UNCALIBRATED on RS_SLAVE
ptp4l[359.224]: master offset       3304 s0 freq      +0 path delay      9202
ptp4l[360.224]: master offset       3708 s1 freq  -28492 path delay      9202
ptp4l[361.224]: master offset      -3145 s2 freq  -32637 path delay      9202
ptp4l[361.224]: port 1: UNCALIBRATED to SLAVE on MASTER_CLOCK_SELECTED
ptp4l[362.223]: master offset       -145 s2 freq  -30580 path delay      9202
ptp4l[363.223]: master offset       1043 s2 freq  -28436 path delay      8972
[...]
ptp4l[371.235]: master offset        285 s2 freq  -28511 path delay      9199
ptp4l[372.235]: master offset        -78 s2 freq  -28788 path delay      9204</pre></div><p>
    An example of the <code class="command">phc2sys</code> output:
   </p><div class="verbatim-wrap"><pre class="screen">phc2sys[616.617]: Waiting for ptp4l...
phc2sys[628.628]: phc offset     66341 s0 freq      +0 delay   2729
phc2sys[629.628]: phc offset     64668 s1 freq  -37690 delay   2726
[...]
phc2sys[646.630]: phc offset      -333 s2 freq  -37426 delay   2747
phc2sys[646.630]: phc offset       194 s2 freq  -36999 delay   2749</pre></div><p>
    <code class="command">ptp4l</code> normally writes messages very frequently. You can
    reduce the frequency with the <code class="literal">summary_interval</code>
    directive. Its value is an exponent of the 2^N expression. For example, to
    reduce the output to every 1024 (which is equal to 2^10) seconds, add the
    following line to the <code class="filename">/etc/ptp4l.conf</code> file:
   </p><div class="verbatim-wrap"><pre class="screen">summary_interval 10</pre></div><p>
    You can also reduce the frequency of the <code class="command">phc2sys</code>
    command's updates with the <code class="option">-u
    <em class="replaceable ">SUMMARY-UPDATES</em></code> option.
   </p></div></div><div class="sect1 " id="tuning.ptp.examples"><div class="titlepage"><div><div><h2 class="title" id="tuning.ptp.examples"><span class="number">18.4 </span><span class="name">Examples of Configurations</span> <a title="Permalink" class="permalink" href="cha.tuning.ptp.html#tuning.ptp.examples">#</a></h2></div></div></div><p>
   This section includes several examples of <code class="command">ptp4l</code>
   configuration. The examples are not full configuration files but rather a
   minimal list of changes to be made to the specific files. The string
   <em class="replaceable ">ethX</em> stands for the actual network interface name
   in your setup.
  </p><div class="complex-example"><div class="example" id="idm139986049497712"><div class="example-title-wrap"><h6 class="example-title"><span class="number">Example 18.1: </span><span class="name">Slave clock using software time stamping </span><a title="Permalink" class="permalink" href="cha.tuning.ptp.html#idm139986049497712">#</a></h6></div><div class="example-contents"><p>
    <code class="filename">/etc/sysconfig/ptp4l</code>:
   </p><div class="verbatim-wrap"><pre class="screen">OPTIONS=”-f /etc/ptp4l.conf -i ethX”</pre></div><p>
    No changes made to the distribution <code class="filename">/etc/ptp4l.conf</code>.
   </p></div></div></div><div class="complex-example"><div class="example" id="idm139986049494480"><div class="example-title-wrap"><h6 class="example-title"><span class="number">Example 18.2: </span><span class="name">Slave clock using hardware time stamping </span><a title="Permalink" class="permalink" href="cha.tuning.ptp.html#idm139986049494480">#</a></h6></div><div class="example-contents"><p>
    <code class="filename">/etc/sysconfig/ptp4l</code>:
   </p><div class="verbatim-wrap"><pre class="screen">OPTIONS=”-f /etc/ptp4l.conf -i ethX”</pre></div><p>
    <code class="filename">/etc/sysconfig/phc2sys</code>:
   </p><div class="verbatim-wrap"><pre class="screen">OPTIONS=”-s ethX -w”</pre></div><p>
    No changes made to the distribution <code class="filename">/etc/ptp4l.conf</code>.
   </p></div></div></div><div class="complex-example"><div class="example" id="idm139986049489888"><div class="example-title-wrap"><h6 class="example-title"><span class="number">Example 18.3: </span><span class="name">Master clock using hardware time stamping </span><a title="Permalink" class="permalink" href="cha.tuning.ptp.html#idm139986049489888">#</a></h6></div><div class="example-contents"><p>
    <code class="filename">/etc/sysconfig/ptp4l</code>:
   </p><div class="verbatim-wrap"><pre class="screen">OPTIONS=”-f /etc/ptp4l.conf -i ethX”</pre></div><p>
    <code class="filename">/etc/sysconfig/phc2sys</code>:
   </p><div class="verbatim-wrap"><pre class="screen">OPTIONS=”-s CLOCK_REALTIME -c ethX -w”</pre></div><p>
    <code class="filename">/etc/ptp4l.conf</code>:
   </p><div class="verbatim-wrap"><pre class="screen">priority1 127</pre></div></div></div></div><div class="complex-example"><div class="example" id="idm139986049484864"><div class="example-title-wrap"><h6 class="example-title"><span class="number">Example 18.4: </span><span class="name">Master clock using software time stamping (not generally recommended) </span><a title="Permalink" class="permalink" href="cha.tuning.ptp.html#idm139986049484864">#</a></h6></div><div class="example-contents"><p>
    <code class="filename">/etc/sysconfig/ptp4l</code>:
   </p><div class="verbatim-wrap"><pre class="screen">OPTIONS=”-f /etc/ptp4l.conf -i ethX”</pre></div><p>
    <code class="filename">/etc/ptp4l.conf</code>:
   </p><div class="verbatim-wrap"><pre class="screen">priority1 127</pre></div></div></div></div></div><div class="sect1 " id="tuning.ptp.ntp"><div class="titlepage"><div><div><h2 class="title" id="tuning.ptp.ntp"><span class="number">18.5 </span><span class="name">PTP and NTP</span> <a title="Permalink" class="permalink" href="cha.tuning.ptp.html#tuning.ptp.ntp">#</a></h2></div></div></div><p>
   NTP and PTP time synchronization tools can coexist, synchronizing time from
   one to another in both directions.
  </p><div class="sect2 " id="tuning.ptp.ntp2ptp"><div class="titlepage"><div><div><h3 class="title" id="tuning.ptp.ntp2ptp"><span class="number">18.5.1 </span><span class="name">NTP to PTP Synchronization</span> <a title="Permalink" class="permalink" href="cha.tuning.ptp.html#tuning.ptp.ntp2ptp">#</a></h3></div></div></div><p>
    When <code class="systemitem">chronyd</code> is used to synchronize the local system clock, you can
    configure the <code class="command">ptp4l</code> to be the grandmaster clock
    distributing the time from the local system clock via PTP. Include the
    <code class="option">priority1</code> option in <code class="filename">/etc/ptp4l.conf</code>:
   </p><div class="verbatim-wrap"><pre class="screen">[global]
priority1 127
[eth0]</pre></div><p>
    Then run <code class="command">ptp4l</code>:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> ptp4l -f /etc/ptp4l.conf</pre></div><p>
    When hardware time stamping is used, you need to synchronize the PTP
    hardware clock to the system clock with <code class="command">phc2sys</code>:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> phc2sys -c eth0 -s CLOCK_REALTIME -w</pre></div></div><div class="sect2 " id="tuning.ptp.ptp2ntp"><div class="titlepage"><div><div><h3 class="title" id="tuning.ptp.ptp2ntp"><span class="number">18.5.2 </span><span class="name">Configuring PTP-NTP Bridge</span> <a title="Permalink" class="permalink" href="cha.tuning.ptp.html#tuning.ptp.ptp2ntp">#</a></h3></div></div></div><p>
    If a highly accurate PTP grandmaster is available in a network without
    switches or routers with PTP support, a computer may operate as a PTP slave
    and a stratum-1 NTP server. Such a computer needs to have two or more
    network interfaces, and be close to the grandmaster or have a direct
    connection to it. This will ensure highly accurate synchronization in the
    network.
   </p><p>
    Configure the <code class="command">ptp4l</code> and <code class="command">phc2sys</code>
    programs to use one network interface to synchronize the system clock using
    PTP. Then configure <code class="systemitem">chronyd</code> to provide the system time using the other
    interface:
   </p><div class="verbatim-wrap"><pre class="screen">bindaddress 192.0.131.47
hwtimestamp eth1
local stratum 1</pre></div><div id="idm139986049466208" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.png" /><h6>Note: NTP and DHCP</h6><p>
     When the DHCP client command <code class="command">dhclient</code> receives a list
     of NTP servers, it adds them to NTP configuration by default. To prevent
     this behavior, set
    </p><div class="verbatim-wrap"><pre class="screen">NETCONFIG_NTP_POLICY=""</pre></div><p>
     in the <code class="filename">/etc/sysconfig/network/config</code> file.
    </p></div></div></div></div></div><div class="page-bottom"><div id="_bottom-navigation"><a class="nav-link" href="bk06apa.html"><span class="next-icon">→</span><span class="nav-label"><span class="number">Appendix A </span>GNU Licenses</span></a><a class="nav-link" href="part.tuning.ptp.html"><span class="prev-icon">←</span><span class="nav-label"><span class="number">Part VII </span>Synchronized Clocks with Precision Time Protocol</span></a></div><div id="_share-print"><div class="online-contents share"><strong>Share this page: </strong><span class="share-buttons"><span id="_share-fb" class="bottom-button">Facebook</span><span class="spacer"> • </span><span id="_share-gp" class="bottom-button">Google+</span><span class="spacer"> • </span><span id="_share-tw" class="bottom-button">Twitter</span><span class="spacer"> • </span><span id="_share-mail" class="bottom-button">E-Mail</span></span></div><div class="print"><span id="_print-button" class="bottom-button">Print this page</span></div><div class="clearme"></div></div></div></div><div id="_inward"></div></div><div id="_footer-wrap"><div id="_footer"><p>©
        2018 
        SUSE</p><ul><li><a href="http://www.suse.com/company/careers/" target="_top">Careers</a></li><li><a href="http://www.suse.com/company/legal/" target="_top">Legal</a></li><li><a href="http://www.suse.com/company/" target="_top">About</a></li><li><a href="http://www.suse.com/ContactsOffices/contacts_offices.jsp" target="_top">Contact Us</a></li></ul></div></div></body></html>