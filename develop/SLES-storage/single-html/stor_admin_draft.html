<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang=""><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Storage Administration Guide | SUSE Linux Enterprise Server 15</title><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" /><link rel="stylesheet" type="text/css" href="static/css/style.css" /><link rel="stylesheet" type="text/css" href="static/css/highlight.css" /><meta name="generator" content="DAPS 2.4.0 using SUSE XSL Stylesheets 2.0.8 (based on DocBook XSL Stylesheets 1.78.1)" /><meta name="product-name" content="SUSE Linux Enterprise Server" /><meta name="product-number" content="15" /><meta name="book-title" content="Storage Administration Guide" /><meta name="description" content="Provides information about how to manage storage devices on a SUSE Linux Enterprise Server." /><meta name="tracker-url" content="https://bugzilla.suse.com/enter_bug.cgi" /><meta name="tracker-type" content="bsc" /><meta name="tracker-bsc-assignee" content="fs@suse.com" /><meta name="tracker-bsc-component" content="Documentation" /><meta name="tracker-bsc-product" content="Beta SUSE Linux Enterprise Server 15" /><script type="text/javascript">

var protocol = window.location.protocol.toLowerCase();
if ( protocol != 'file:' ) {
  var agent = navigator.userAgent.toLowerCase();
  var wanted = ( protocol == 'https:') ? 'https' : 'http';
  var file = 'fonts.css';
  document.write('<link rel="stylesheet" type="text/css" href="' + wanted + '://static.opensuse.org/fonts/'+ file +'"></link>');
}
else {
   document.write('<link rel="stylesheet" type="text/css" href="static/css/fonts-onlylocal.css"></link>');
}

</script><noscript><link rel="stylesheet" type="text/css" href="http://static.opensuse.org/fonts/fonts.css" /></noscript><script src="static/js/jquery-1.10.2.min.js" type="text/javascript"></script><script src="static/js/script.js" type="text/javascript"></script><script src="static/js/highlight.min.js" type="text/javascript"></script><script>

$(document).ready(function() {
  $('.verbatim-wrap.highlight').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});
hljs.configure({
  useBR: false
});

</script></head><body class="draft single offline js-off"><div id="_outer-wrap"><div id="_white-bg"><div id="_header"><div id="_logo"><img src="static/images/logo.png" alt="Logo" /></div><div class="crumbs inactive"><a class="single-crumb" href="#stor_admin" accesskey="c"><span class="single-contents-icon"></span>Storage Administration Guide</a><div class="bubble-corner active-contents"></div></div><div class="clearme"></div></div></div><div id="_fixed-header-wrap" class="inactive"><div id="_fixed-header"><div class="crumbs inactive"><a class="single-crumb" href="#stor_admin" accesskey="c"><span class="single-contents-icon"></span>Show Contents: Storage Administration Guide</a></div><div class="buttons"><a class="top-button button" href="#">Top</a><div class="clearme"></div></div><div class="clearme"></div></div><div class="active-contents bubble"><div class="bubble-container"><div id="_bubble-toc"><ol><li class="inactive"><a href="#storage.preface"><span class="number"> </span><span class="name">About This Guide</span></a></li><li class="inactive"><a href="#part.filesystems"><span class="number">I </span><span class="name">File Systems and Mounting</span></a><ol><li class="inactive"><a href="#cha.filesystems"><span class="number">1 </span><span class="name">Overview of File Systems in Linux</span></a></li><li class="inactive"><a href="#cha.resize_fs"><span class="number">2 </span><span class="name">Resizing File Systems</span></a></li><li class="inactive"><a href="#cha.uuid"><span class="number">3 </span><span class="name">Using UUIDs to Mount Devices</span></a></li><li class="inactive"><a href="#cha.multitiercache"><span class="number">4 </span><span class="name">Multi-tier Caching for Block Device Operations</span></a></li></ol></li><li class="inactive"><a href="#part.lvm"><span class="number">II </span><span class="name">Logical Volumes (LVM)</span></a><ol><li class="inactive"><a href="#cha.lvm"><span class="number">5 </span><span class="name">LVM Configuration</span></a></li><li class="inactive"><a href="#cha.lvm_snapshots"><span class="number">6 </span><span class="name">LVM Volume Snapshots</span></a></li></ol></li><li class="inactive"><a href="#part.software_raid"><span class="number">III </span><span class="name">Software RAID</span></a><ol><li class="inactive"><a href="#cha.raid"><span class="number">7 </span><span class="name">Software RAID Configuration</span></a></li><li class="inactive"><a href="#cha.raidroot"><span class="number">8 </span><span class="name">Configuring Software RAID for the Root Partition</span></a></li><li class="inactive"><a href="#cha.raid10"><span class="number">9 </span><span class="name">Creating Software RAID 10 Devices</span></a></li><li class="inactive"><a href="#cha.raid_degraded"><span class="number">10 </span><span class="name">Creating a Degraded RAID Array</span></a></li><li class="inactive"><a href="#cha.raid_resize"><span class="number">11 </span><span class="name">Resizing Software RAID Arrays with mdadm</span></a></li><li class="inactive"><a href="#cha.raid_leds"><span class="number">12 </span><span class="name">Storage Enclosure LED Utilities for MD Software RAIDs</span></a></li></ol></li><li class="inactive"><a href="#part.net_storage"><span class="number">IV </span><span class="name">Network Storage</span></a><ol><li class="inactive"><a href="#cha.isns"><span class="number">13 </span><span class="name">iSNS for Linux</span></a></li><li class="inactive"><a href="#cha.iscsi"><span class="number">14 </span><span class="name">Mass Storage over IP Networks: iSCSI</span></a></li><li class="inactive"><a href="#cha.fcoe"><span class="number">15 </span><span class="name">Fibre Channel Storage over Ethernet Networks: FCoE</span></a></li><li class="inactive"><a href="#cha.nvmeof"><span class="number">16 </span><span class="name">NVMe over Fabric</span></a></li><li class="inactive"><a href="#cha.multipath"><span class="number">17 </span><span class="name">Managing Multipath I/O for Devices</span></a></li><li class="inactive"><a href="#cha.nfs4_acls"><span class="number">18 </span><span class="name">Managing Access Control Lists over NFSv4</span></a></li></ol></li><li class="inactive"><a href="#idm139787666424928"><span class="number">A </span><span class="name">GNU Licenses</span></a></li></ol></div><div class="clearme"></div></div></div></div><div id="_toc-bubble-wrap"></div><div id="_content" class="draft "><div class="documentation"><div xml:lang="en" class="book" id="stor_admin" lang="en"><div class="titlepage"><div><h6 class="version-info"><span class="productname"><span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span></span> <span class="productnumber"><span class="productnumber"><span class="phrase">15</span></span></span></h6><div><h1 class="title"><em class="citetitle ">Storage Administration Guide</em></h1></div><div class="abstract "><p>
    Provides information about how to manage storage
    devices on a SUSE Linux Enterprise Server.
   </p></div><div class="date"><span class="imprint-label">Publication Date: </span>
March 22, 2018
</div></div></div><div class="toc"><dl><dt><span class="preface"><a href="#storage.preface"><span class="name">About This Guide</span></a></span></dt><dd><dl><dt><span class="sect1"><a href="#idm139787673056224"><span class="name">Available Documentation</span></a></span></dt><dt><span class="sect1"><a href="#idm139787671177216"><span class="name">Feedback</span></a></span></dt><dt><span class="sect1"><a href="#idm139787671677392"><span class="name">Documentation Conventions</span></a></span></dt></dl></dd><dt><span class="part"><a href="#part.filesystems"><span class="number">I </span><span class="name">File Systems and Mounting</span></a></span></dt><dd><dl><dt><span class="chapter"><a href="#cha.filesystems"><span class="number">1 </span><span class="name">Overview of File Systems in Linux</span></a></span></dt><dd><dl><dt><span class="sect1"><a href="#sec.filesystems.glossary"><span class="number">1.1 </span><span class="name">Terminology</span></a></span></dt><dt><span class="sect1"><a href="#sec.filesystems.major.btrfs"><span class="number">1.2 </span><span class="name">Btrfs</span></a></span></dt><dt><span class="sect1"><a href="#sec.filesystems.major.xfs"><span class="number">1.3 </span><span class="name">XFS</span></a></span></dt><dt><span class="sect1"><a href="#sec.filesystems.major.ext2"><span class="number">1.4 </span><span class="name">Ext2</span></a></span></dt><dt><span class="sect1"><a href="#sec.filesystems.major.ext3"><span class="number">1.5 </span><span class="name">Ext3</span></a></span></dt><dt><span class="sect1"><a href="#sec.filesystems.major.ext4"><span class="number">1.6 </span><span class="name">Ext4</span></a></span></dt><dt><span class="sect1"><a href="#sec.filesystems.major.reiser"><span class="number">1.7 </span><span class="name">ReiserFS</span></a></span></dt><dt><span class="sect1"><a href="#sec.filesystems.other"><span class="number">1.8 </span><span class="name">Other Supported File Systems</span></a></span></dt><dt><span class="sect1"><a href="#sec.filesystems.lfs"><span class="number">1.9 </span><span class="name">Large File Support in Linux</span></a></span></dt><dt><span class="sect1"><a href="#sect.filesystems.stor_limits"><span class="number">1.10 </span><span class="name">Linux Kernel Storage Limitations</span></a></span></dt><dt><span class="sect1"><a href="#sect.filesystems.trouble"><span class="number">1.11 </span><span class="name">Troubleshooting File Systems</span></a></span></dt><dt><span class="sect1"><a href="#sec_filesystems_info"><span class="number">1.12 </span><span class="name">Additional Information</span></a></span></dt></dl></dd><dt><span class="chapter"><a href="#cha.resize_fs"><span class="number">2 </span><span class="name">Resizing File Systems</span></a></span></dt><dd><dl><dt><span class="sect1"><a href="#sec.resize_fs.usecases"><span class="number">2.1 </span><span class="name">Use Cases</span></a></span></dt><dt><span class="sect1"><a href="#sec.resize_fs.guidelines"><span class="number">2.2 </span><span class="name">Guidelines for Resizing</span></a></span></dt><dt><span class="sect1"><a href="#sec.resize_fs.btrfs"><span class="number">2.3 </span><span class="name">Changing the Size of a Btrfs File System</span></a></span></dt><dt><span class="sect1"><a href="#sec.resize_fs.xfs"><span class="number">2.4 </span><span class="name">Changing the Size of an XFS File System</span></a></span></dt><dt><span class="sect1"><a href="#sec.resize_fs.ext"><span class="number">2.5 </span><span class="name">Changing the Size of an Ext2, Ext3, or Ext4 File System</span></a></span></dt></dl></dd><dt><span class="chapter"><a href="#cha.uuid"><span class="number">3 </span><span class="name">Using UUIDs to Mount Devices</span></a></span></dt><dd><dl><dt><span class="sect1"><a href="#sec.uuid.udev"><span class="number">3.1 </span><span class="name">Persistent Device Names with udev</span></a></span></dt><dt><span class="sect1"><a href="#sec.uuid.understanduuid"><span class="number">3.2 </span><span class="name">Understanding UUIDs</span></a></span></dt><dt><span class="sect1"><a href="#sec.uuid.moreinfo"><span class="number">3.3 </span><span class="name">Additional Information</span></a></span></dt></dl></dd><dt><span class="chapter"><a href="#cha.multitiercache"><span class="number">4 </span><span class="name">Multi-tier Caching for Block Device Operations</span></a></span></dt><dd><dl><dt><span class="sect1"><a href="#sec.multitiercache.terminology"><span class="number">4.1 </span><span class="name">General Terminology</span></a></span></dt><dt><span class="sect1"><a href="#sec.multitiercache.caching_modes"><span class="number">4.2 </span><span class="name">Caching Modes</span></a></span></dt><dt><span class="sect1"><a href="#sec.multitiercache.bcache"><span class="number">4.3 </span><span class="name"><code class="systemitem">bcache</code></span></a></span></dt><dt><span class="sect1"><a href="#sec.multitiercache.lvmcache"><span class="number">4.4 </span><span class="name"><code class="systemitem">lvmcache</code></span></a></span></dt></dl></dd></dl></dd><dt><span class="part"><a href="#part.lvm"><span class="number">II </span><span class="name">Logical Volumes (LVM)</span></a></span></dt><dd><dl><dt><span class="chapter"><a href="#cha.lvm"><span class="number">5 </span><span class="name">LVM Configuration</span></a></span></dt><dd><dl><dt><span class="sect1"><a href="#sec.lvm.explained"><span class="number">5.1 </span><span class="name">Understanding the Logical Volume Manager</span></a></span></dt><dt><span class="sect1"><a href="#sec.lvm.vg"><span class="number">5.2 </span><span class="name">Creating Volume Groups</span></a></span></dt><dt><span class="sect1"><a href="#sec.lvm.lv"><span class="number">5.3 </span><span class="name">Creating Logical Volumes</span></a></span></dt><dt><span class="sect1"><a href="#lvm_activate_vgs"><span class="number">5.4 </span><span class="name">Automatically Activating Non-Root LVM Volume Groups</span></a></span></dt><dt><span class="sect1"><a href="#sec.lvm.vg_resize"><span class="number">5.5 </span><span class="name">Resizing an Existing Volume Group</span></a></span></dt><dt><span class="sect1"><a href="#sec.lvm.lv_resize"><span class="number">5.6 </span><span class="name">Resizing a Logical Volume</span></a></span></dt><dt><span class="sect1"><a href="#sec.lvm.delete"><span class="number">5.7 </span><span class="name">Deleting a Volume Group or a Logical Volume</span></a></span></dt><dt><span class="sect1"><a href="#sec.lvm.cli"><span class="number">5.8 </span><span class="name">Using LVM Commands</span></a></span></dt><dt><span class="sect1"><a href="#sec.lvm.tagging"><span class="number">5.9 </span><span class="name">Tagging LVM2 Storage Objects</span></a></span></dt></dl></dd><dt><span class="chapter"><a href="#cha.lvm_snapshots"><span class="number">6 </span><span class="name">LVM Volume Snapshots</span></a></span></dt><dd><dl><dt><span class="sect1"><a href="#sec.lvm_snapshots.intro"><span class="number">6.1 </span><span class="name">Understanding Volume Snapshots</span></a></span></dt><dt><span class="sect1"><a href="#sec.lvm_snapshots.create"><span class="number">6.2 </span><span class="name">Creating Linux Snapshots with LVM</span></a></span></dt><dt><span class="sect1"><a href="#sec.lvm_snapshots.monitor"><span class="number">6.3 </span><span class="name">Monitoring a Snapshot</span></a></span></dt><dt><span class="sect1"><a href="#sec.lvm_snapshots.delete"><span class="number">6.4 </span><span class="name">Deleting Linux Snapshots</span></a></span></dt><dt><span class="sect1"><a href="#sec.lvm_snapshots.xen_host"><span class="number">6.5 </span><span class="name">Using Snapshots for Virtual Machines on a Virtual Host</span></a></span></dt><dt><span class="sect1"><a href="#sec.lvm_snapshots.rollback"><span class="number">6.6 </span><span class="name">Merging a Snapshot with the Source Logical Volume to Revert Changes or Roll Back to a Previous State</span></a></span></dt></dl></dd></dl></dd><dt><span class="part"><a href="#part.software_raid"><span class="number">III </span><span class="name">Software RAID</span></a></span></dt><dd><dl><dt><span class="chapter"><a href="#cha.raid"><span class="number">7 </span><span class="name">Software RAID Configuration</span></a></span></dt><dd><dl><dt><span class="sect1"><a href="#sec.raid.intro"><span class="number">7.1 </span><span class="name">Understanding RAID Levels</span></a></span></dt><dt><span class="sect1"><a href="#sec.raid.yast"><span class="number">7.2 </span><span class="name">Soft RAID Configuration with YaST</span></a></span></dt><dt><span class="sect1"><a href="#sec.raid.trouble"><span class="number">7.3 </span><span class="name">Troubleshooting Software RAIDs</span></a></span></dt><dt><span class="sect1"><a href="#sec.raid.more"><span class="number">7.4 </span><span class="name">For More Information</span></a></span></dt></dl></dd><dt><span class="chapter"><a href="#cha.raidroot"><span class="number">8 </span><span class="name">Configuring Software RAID for the Root Partition</span></a></span></dt><dd><dl><dt><span class="sect1"><a href="#sec.raidroot.require"><span class="number">8.1 </span><span class="name">
   Prerequisites for Using a Software RAID Device for the Root Partition
  </span></a></span></dt><dt><span class="sect1"><a href="#sec.raidroot.setup"><span class="number">8.2 </span><span class="name">
   Setting Up the System with a Software RAID Device for the Root
   (<code class="filename">/</code>) Partition
  </span></a></span></dt></dl></dd><dt><span class="chapter"><a href="#cha.raid10"><span class="number">9 </span><span class="name">Creating Software RAID 10 Devices</span></a></span></dt><dd><dl><dt><span class="sect1"><a href="#sec.raid10.nest"><span class="number">9.1 </span><span class="name">Creating Nested RAID 10 Devices with <code class="command">mdadm</code></span></a></span></dt><dt><span class="sect1"><a href="#sec.raid10.complex"><span class="number">9.2 </span><span class="name">Creating a Complex RAID 10</span></a></span></dt></dl></dd><dt><span class="chapter"><a href="#cha.raid_degraded"><span class="number">10 </span><span class="name">Creating a Degraded RAID Array</span></a></span></dt><dt><span class="chapter"><a href="#cha.raid_resize"><span class="number">11 </span><span class="name">Resizing Software RAID Arrays with mdadm</span></a></span></dt><dd><dl><dt><span class="sect1"><a href="#sec.raid_resize.incr"><span class="number">11.1 </span><span class="name">Increasing the Size of a Software RAID</span></a></span></dt><dt><span class="sect1"><a href="#sec.raid_resize.decr"><span class="number">11.2 </span><span class="name">Decreasing the Size of a Software RAID</span></a></span></dt></dl></dd><dt><span class="chapter"><a href="#cha.raid_leds"><span class="number">12 </span><span class="name">Storage Enclosure LED Utilities for MD Software RAIDs</span></a></span></dt><dd><dl><dt><span class="sect1"><a href="#sec.raid_leds.ledmon"><span class="number">12.1 </span><span class="name">The Storage Enclosure LED Monitor Service</span></a></span></dt><dt><span class="sect1"><a href="#sec.raid_leds.ledctl"><span class="number">12.2 </span><span class="name">The Storage Enclosure LED Control Application</span></a></span></dt><dt><span class="sect1"><a href="#sec.raid_leds.info"><span class="number">12.3 </span><span class="name">Additional Information</span></a></span></dt></dl></dd></dl></dd><dt><span class="part"><a href="#part.net_storage"><span class="number">IV </span><span class="name">Network Storage</span></a></span></dt><dd><dl><dt><span class="chapter"><a href="#cha.isns"><span class="number">13 </span><span class="name">iSNS for Linux</span></a></span></dt><dd><dl><dt><span class="sect1"><a href="#sec.isns.overview"><span class="number">13.1 </span><span class="name">How iSNS Works</span></a></span></dt><dt><span class="sect1"><a href="#sec.isns.install"><span class="number">13.2 </span><span class="name">Installing iSNS Server for Linux</span></a></span></dt><dt><span class="sect1"><a href="#sec.isns.domains"><span class="number">13.3 </span><span class="name">Configuring iSNS Discovery Domains</span></a></span></dt><dt><span class="sect1"><a href="#sec.isns.start"><span class="number">13.4 </span><span class="name">Starting the iSNS Service</span></a></span></dt><dt><span class="sect1"><a href="#sec.isns.info"><span class="number">13.5 </span><span class="name">For More Information</span></a></span></dt></dl></dd><dt><span class="chapter"><a href="#cha.iscsi"><span class="number">14 </span><span class="name">Mass Storage over IP Networks: iSCSI</span></a></span></dt><dd><dl><dt><span class="sect1"><a href="#sec.iscsi.install"><span class="number">14.1 </span><span class="name">Installing the iSCSI LIO Target Server and iSCSI Initiator</span></a></span></dt><dt><span class="sect1"><a href="#sec.iscsi.target"><span class="number">14.2 </span><span class="name">Setting Up an iSCSI LIO Target Server</span></a></span></dt><dt><span class="sect1"><a href="#sec.iscsi.initiator"><span class="number">14.3 </span><span class="name">Configuring iSCSI Initiator</span></a></span></dt><dt><span class="sect1"><a href="#sec.iscsi.installation"><span class="number">14.4 </span><span class="name">Using iSCSI Disks when Installing</span></a></span></dt><dt><span class="sect1"><a href="#sec.iscsi.trouble"><span class="number">14.5 </span><span class="name">Troubleshooting iSCSI</span></a></span></dt><dt><span class="sect1"><a href="#sec.iscsi.terminology"><span class="number">14.6 </span><span class="name">iSCSI LIO Target Terminology</span></a></span></dt><dt><span class="sect1"><a href="#sec.iscsi.info"><span class="number">14.7 </span><span class="name">Additional Information</span></a></span></dt></dl></dd><dt><span class="chapter"><a href="#cha.fcoe"><span class="number">15 </span><span class="name">Fibre Channel Storage over Ethernet Networks: FCoE</span></a></span></dt><dd><dl><dt><span class="sect1"><a href="#sec.fcoe.installation"><span class="number">15.1 </span><span class="name">Configuring FCoE Interfaces during the Installation</span></a></span></dt><dt><span class="sect1"><a href="#sec.fcoe.install"><span class="number">15.2 </span><span class="name">Installing FCoE and the YaST FCoE Client</span></a></span></dt><dt><span class="sect1"><a href="#sec.fcoe.yast"><span class="number">15.3 </span><span class="name">Managing FCoE Services with YaST</span></a></span></dt><dt><span class="sect1"><a href="#sec.fcoe.cli"><span class="number">15.4 </span><span class="name">Configuring FCoE with Commands</span></a></span></dt><dt><span class="sect1"><a href="#sec.fcoe.admin"><span class="number">15.5 </span><span class="name">Managing FCoE Instances with the FCoE Administration Tool</span></a></span></dt><dt><span class="sect1"><a href="#sec.fcoe.info"><span class="number">15.6 </span><span class="name">Additional Information</span></a></span></dt></dl></dd><dt><span class="chapter"><a href="#cha.nvmeof"><span class="number">16 </span><span class="name">NVMe over Fabric</span></a></span></dt><dd><dl><dt><span class="sect1"><a href="#cha.nvmeof.overview"><span class="number">16.1 </span><span class="name">Overview</span></a></span></dt><dt><span class="sect1"><a href="#sec.nvmeof.host_configuration"><span class="number">16.2 </span><span class="name">Setting Up an NVMe over Fabric Host</span></a></span></dt><dt><span class="sect1"><a href="#sec.nvmeof.target_configuration"><span class="number">16.3 </span><span class="name">Setting Up an NVMe over Fabric Target</span></a></span></dt><dt><span class="sect1"><a href="#cha.nvmeof.more_information"><span class="number">16.4 </span><span class="name">More Information</span></a></span></dt></dl></dd><dt><span class="chapter"><a href="#cha.multipath"><span class="number">17 </span><span class="name">Managing Multipath I/O for Devices</span></a></span></dt><dd><dl><dt><span class="sect1"><a href="#sec.multipath.intro"><span class="number">17.1 </span><span class="name">Understanding Multipath I/O</span></a></span></dt><dt><span class="sect1"><a href="#sec.multipath.hardware"><span class="number">17.2 </span><span class="name">Hardware Support</span></a></span></dt><dt><span class="sect1"><a href="#sec.multipath.planning"><span class="number">17.3 </span><span class="name">Planning for Multipathing</span></a></span></dt><dt><span class="sect1"><a href="#sec.multipath.mpiotools"><span class="number">17.4 </span><span class="name">Multipath Management Tools</span></a></span></dt><dt><span class="sect1"><a href="#sec.multipath.config"><span class="number">17.5 </span><span class="name">Configuring the System for Multipathing</span></a></span></dt><dt><span class="sect1"><a href="#sec.multipath.conf_file"><span class="number">17.6 </span><span class="name">Creating or Modifying the /etc/multipath.conf File</span></a></span></dt><dt><span class="sect1"><a href="#sec.multipath.policies_default"><span class="number">17.7 </span><span class="name">Configuring Default Policies for Polling, Queuing, and Failback</span></a></span></dt><dt><span class="sect1"><a href="#sec.multipath.blacklist"><span class="number">17.8 </span><span class="name">Blacklisting Non-Multipath Devices</span></a></span></dt><dt><span class="sect1"><a href="#sec.multipath.names"><span class="number">17.9 </span><span class="name">Configuring User-Friendly Names or Alias Names</span></a></span></dt><dt><span class="sect1"><a href="#sec.multipath.policies_failover"><span class="number">17.10 </span><span class="name">Configuring Path Failover Policies and Priorities</span></a></span></dt><dt><span class="sect1"><a href="#sec.multipath.root"><span class="number">17.11 </span><span class="name">Configuring Multipath I/O for the Root Device</span></a></span></dt><dt><span class="sect1"><a href="#sec.multipath.raid"><span class="number">17.12 </span><span class="name">Configuring Multipath I/O for an Existing Software RAID</span></a></span></dt><dt><span class="sect1"><a href="#sec.multipath.lvm"><span class="number">17.13 </span><span class="name">Using LVM2 on Multipath Devices</span></a></span></dt><dt><span class="sect1"><a href="#sec.multipath.best_practice"><span class="number">17.14 </span><span class="name">Best Practice</span></a></span></dt><dt><span class="sect1"><a href="#sec.multipath.trouble"><span class="number">17.15 </span><span class="name">Troubleshooting MPIO</span></a></span></dt></dl></dd><dt><span class="chapter"><a href="#cha.nfs4_acls"><span class="number">18 </span><span class="name">Managing Access Control Lists over NFSv4</span></a></span></dt></dl></dd><dt><span class="appendix"><a href="#idm139787666424928"><span class="number">A </span><span class="name">GNU Licenses</span></a></span></dt><dd><dl><dt><span class="sect1"><a href="#idm139787666420288"><span class="number">A.1 </span><span class="name">GNU Free Documentation License</span></a></span></dt></dl></dd></dl></div><div class="list-of-figures"><div class="toc-title">List of Figures</div><dl><dt><span class="figure"><a href="#fig.lvm.explain"><span class="number">5.1 </span><span class="name">Physical Partitioning versus LVM</span></a></span></dt><dt><span class="figure"><a href="#fig.yast2.lvm.physical_volumes"><span class="number">5.2 </span><span class="name">Physical Volumes in the Volume Group Named DATA</span></a></span></dt><dt><span class="figure"><a href="#fig.yast2.raid3"><span class="number">7.1 </span><span class="name">Example RAID 5 Configuration</span></a></span></dt><dt><span class="figure"><a href="#idm139787669153440"><span class="number">8.1 </span><span class="name"><span class="guimenu">/</span>, <span class="guimenu">/boot/efi</span>, and swap on RAIDs</span></a></span></dt><dt><span class="figure"><a href="#idm139787668446592"><span class="number">13.1 </span><span class="name">iSNS Discovery Domains</span></a></span></dt><dt><span class="figure"><a href="#idm139787668335728"><span class="number">14.1 </span><span class="name">iSCSI SAN with an iSNS Server</span></a></span></dt><dt><span class="figure"><a href="#idm139787667944960"><span class="number">15.1 </span><span class="name">Open Fibre Channel over Ethernet SAN</span></a></span></dt></dl></div><div class="list-of-tables"><div class="toc-title">List of Tables</div><dl><dt><span class="table"><a href="#tab.filesystems.other"><span class="number">1.1 </span><span class="name">File System Types in Linux</span></a></span></dt><dt><span class="table"><a href="#tab.filesystems.maxsize"><span class="number">1.2 </span><span class="name">Maximum Sizes of Files and File Systems (On-Disk Format, 4 KiB Block Size)</span></a></span></dt><dt><span class="table"><a href="#tab.filesystems.stor_limits"><span class="number">1.3 </span><span class="name">Storage Limitations</span></a></span></dt><dt><span class="table"><a href="#idm139787671468144"><span class="number">2.1 </span><span class="name">File System Support for Resizing</span></a></span></dt><dt><span class="table"><a href="#idm139787669340016"><span class="number">7.1 </span><span class="name">Comparison of RAID 5 and RAID 6</span></a></span></dt><dt><span class="table"><a href="#idm139787669126512"><span class="number">9.1 </span><span class="name">Nested RAID Levels</span></a></span></dt><dt><span class="table"><a href="#idm139787669103600"><span class="number">9.2 </span><span class="name">Scenario for Creating a RAID 10 (1+0) by Nesting</span></a></span></dt><dt><span class="table"><a href="#idm139787669058240"><span class="number">9.3 </span><span class="name">Scenario for Creating a RAID 10 (0+1) by Nesting</span></a></span></dt><dt><span class="table"><a href="#idm139787669014768"><span class="number">9.4 </span><span class="name">Complex RAID 10 compared to Nested RAID 10</span></a></span></dt><dt><span class="table"><a href="#idm139787668899584"><span class="number">9.5 </span><span class="name">Scenario for Creating a RAID 10 Using mdadm</span></a></span></dt><dt><span class="table"><a href="#idm139787668817104"><span class="number">11.1 </span><span class="name">Tasks Involved in Resizing a RAID</span></a></span></dt><dt><span class="table"><a href="#idm139787668792528"><span class="number">11.2 </span><span class="name">Scenario for Increasing the Size of Component Partitions</span></a></span></dt><dt><span class="table"><a href="#idm139787668523920"><span class="number">12.1 </span><span class="name">Translation between Non-SES-2 Patterns and SES-2 Patterns</span></a></span></dt><dt><span class="table"><a href="#idm139787667543168"><span class="number">17.1 </span><span class="name">Multipath I/O Features of Storage Arrays</span></a></span></dt><dt><span class="table"><a href="#idm139787667508848"><span class="number">17.2 </span><span class="name">Tools in the multipath-tools Package</span></a></span></dt><dt><span class="table"><a href="#idm139787667437520"><span class="number">17.3 </span><span class="name">Group Policy Options for the multipath -p Command</span></a></span></dt><dt><span class="table"><a href="#idm139787667196336"><span class="number">17.4 </span><span class="name">Comparison of Multipath Device Name Types</span></a></span></dt><dt><span class="table"><a href="#idm139787667067344"><span class="number">17.5 </span><span class="name">Group Policy Options for the multipath -p Command</span></a></span></dt></dl></div><div><div class="legalnotice" id="idm139787671178176"><p>
  Copyright © 2006–
2018

  SUSE LLC and contributors. All rights reserved.
 </p><p>
  Permission is granted to copy, distribute and/or modify this document under
  the terms of the GNU Free Documentation License, Version 1.2 or (at your
  option) version 1.3; with the Invariant Section being this copyright notice
  and license. A copy of the license version 1.2 is included in the section
  entitled <span class="quote">“<span class="quote">GNU Free Documentation License</span>”</span>.
 </p><p>
  For SUSE trademarks, see
  <a class="link" href="http://www.suse.com/company/legal/" target="_blank">http://www.suse.com/company/legal/</a>. All other
  third-party trademarks are the property of their respective owners. Trademark
  symbols (®, ™ etc.) denote trademarks of SUSE and its affiliates.
  Asterisks (*) denote third-party trademarks.
 </p><p>
  All information found in this book has been compiled with utmost attention to
  detail. However, this does not guarantee complete accuracy. Neither SUSE LLC,
  its affiliates, the authors nor the translators shall be held liable for
  possible errors or the consequences thereof.
 </p></div></div><div class="preface " id="storage.preface"><div class="titlepage"><div><div><h1 class="title"><span class="number"> </span><span class="name">About This Guide</span> <a title="Permalink" class="permalink" href="#storage.preface">#</a></h1><div class="doc-status"><ul><li><span class="ds-label">Filename: </span>storage_intro.xml</li><li><span class="ds-label">ID: </span>storage.preface</li></ul></div></div></div></div><div class="line"><div class="toc"><dl><dt><span class="sect1"><a href="#idm139787673056224"><span class="name">Available Documentation</span></a></span></dt><dt><span class="sect1"><a href="#idm139787671177216"><span class="name">Feedback</span></a></span></dt><dt><span class="sect1"><a href="#idm139787671677392"><span class="name">Documentation Conventions</span></a></span></dt></dl></div></div><p>
  This guide provides information about how to manage storage devices on
  <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> <span class="productnumber"><span class="phrase">15</span></span>. For information about partitioning and
  managing devices, see <span class="intraxref">Book “<em class="citetitle ">Deployment Guide</em>”, Chapter 9 “Expert Partitioner”</span>. This guide is intended
  for system administrators.
 </p><div class="sect1 " id="idm139787673056224"><div class="titlepage"><div><div><h2 class="title" id="idm139787673056224"><span class="number">1 </span><span class="name">Available Documentation</span> <a title="Permalink" class="permalink" href="#idm139787673056224">#</a></h2><div class="doc-status"><ul><li><span class="ds-label">Filename: </span>common_intro_available_doc_i.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><div id="idm139787671134912" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.png" /><h6>Note: Online Documentation and Latest Updates</h6><p>
   Documentation for our products is available at
   <span class="phrase"><a class="link" href="http://www.suse.com/documentation/" target="_blank">http://www.suse.com/documentation/</a></span>, where you can also
   find the latest updates, and browse or download the documentation in various formats.
   
  </p></div><p>
  In addition, the product documentation
  is usually available in your installed system under
  <code class="filename">/usr/share/doc/manual</code>.
 </p><p>
  The following documentation is available for this product:
 </p><div class="variablelist "><dl class="variablelist"><dt id="idm139787671945312"><span class="term "><span class="intraxref">Article “<em class="citetitle ">Installation Quick Start</em>”</span>
   </span></dt><dd><p>
     This Quick Start guides you step-by-step
     through the installation of <span class="productname"><span class="phrase">SUSE® Linux Enterprise Server</span></span> <span class="productnumber"><span class="phrase">15</span></span>.
    </p></dd><dt id="idm139787709797616"><span class="term "><span class="intraxref">Book “<em class="citetitle ">Deployment Guide</em>”</span>
   </span></dt><dd><p>
     
     Shows how to install single or multiple systems
     and how to exploit the product inherent capabilities for a deployment
     infrastructure. Choose from various approaches, ranging from a local
     installation or a network installation server to a mass deployment using
     a remote-controlled, highly-customized, and automated installation
     technique.
    </p></dd><dt id="idm139787711376512"><span class="term "><span class="intraxref">Book “<em class="citetitle ">Administration Guide</em>”</span>
   </span></dt><dd><p>
     Covers system administration tasks like maintaining,
     monitoring and customizing an initially installed system.
    </p></dd><dt id="idm139787672741792"><span class="term "><span class="intraxref">Book “<em class="citetitle ">Virtualization Guide</em>”</span>
   </span></dt><dd><p>
     Describes virtualization technology in
    general, and introduces libvirt—the unified interface to
    virtualization—and detailed information on specific
    hypervisors.
    </p></dd><dt id="idm139787705404400"><span class="term "><a class="xref" href="#stor_admin" title="Storage Administration Guide"><em class="citetitle ">Storage Administration Guide</em></a>
   </span></dt><dd><p>
     Provides information about how to manage storage
    devices on a SUSE Linux Enterprise Server.
    </p></dd><dt id="idm139787712428048"><span class="term "><span class="intraxref">Book “AutoYaST”</span>
   </span></dt><dd><p>
     AutoYaST is a system for unattended mass deployment <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span>
     systems using an AutoYaST
     profile containing installation and configuration data. The manual
     guides you through the basic steps of auto-installation: preparation,
     installation, and configuration.
    </p></dd><dt id="idm139787712630224"><span class="term "><span class="intraxref">Book “<em class="citetitle ">Security Guide</em>”</span>
   </span></dt><dd><p>
     Introduces basic concepts of system security,
     covering both local and network security aspects. Shows how to use
     the product inherent security software like <span class="phrase">AppArmor</span> or the auditing system
     that reliably collects information about any
     security-relevant events.
    </p></dd><dt id="idm139787671939056"><span class="term "><span class="intraxref">Book “Security and Hardening Guide”</span>
   </span></dt><dd><p>
     Deals with the particulars of installing and
     setting up a secure SUSE Linux Enterprise Server, and additional post-installation processes
     required to further secure and harden that installation. Supports the
     administrator with security-related choices and decisions.
    </p></dd><dt id="idm139787705406304"><span class="term "><span class="intraxref">Book “<em class="citetitle ">System Analysis and Tuning Guide</em>”</span>
   </span></dt><dd><p>
     An administrator's guide for problem detection,
     resolution and optimization. Find how to inspect and optimize your system
     by means of monitoring tools and how to efficiently manage
     resources. Also contains an overview of common problems and solutions and
     of additional help and documentation resources.
    </p></dd><dt id="idm139787671180304"><span class="term "><span class="intraxref">Book “Repository Management Tool for SLES <span class="productnumber"><span class="phrase">15</span></span>”</span>
   </span></dt><dd><p>
     An administrator's guide to Repository Management Tool—a proxy system
   for SUSE Customer Center with repository and registration targets. Learn how to install and
   configure a local RMT server, mirror and manage repositories, manage client machines, and configure clients to use RMT.
    </p></dd><dt id="idm139787709798960"><span class="term "><span class="intraxref">Book “<em class="citetitle ">GNOME User Guide</em>”</span>
   </span></dt><dd><p>
     Introduces the GNOME desktop of <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span>. It
     guides you through using and configuring the desktop and helps you
     perform key tasks. It is intended mainly for end users who want to make
     efficient use of GNOME as their default desktop.
    </p></dd></dl></div></div><div class="sect1 " id="idm139787671177216"><div class="titlepage"><div><div><h2 class="title" id="idm139787671177216"><span class="number">2 </span><span class="name">Feedback</span> <a title="Permalink" class="permalink" href="#idm139787671177216">#</a></h2><div class="doc-status"><ul><li><span class="ds-label">Filename: </span>common_intro_feedback_i.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><p>
  Several feedback channels are available:
 </p><div class="variablelist "><dl class="variablelist"><dt id="idm139787671435072"><span class="term ">Bugs and Enhancement Requests</span></dt><dd><p>
     For services and support options available for your product, refer to
     <a class="link" href="http://www.suse.com/support/" target="_blank">http://www.suse.com/support/</a>.
    </p><p>
     Help for openSUSE is provided by the community. Refer to <a class="link" href="https://en.opensuse.org/Portal:Support" target="_blank">https://en.opensuse.org/Portal:Support</a> for more information.
    </p><p>

     To report bugs for a product component, go to
     <a class="link" href="https://scc.suse.com/support/requests" target="_blank">https://scc.suse.com/support/requests</a>, log in, and
     click <span class="guimenu">Create New</span>.
    </p></dd><dt id="idm139787671972608"><span class="term ">User Comments</span></dt><dd><p>
     We want to hear your comments about and suggestions for this manual and
     the other documentation included with this product. Use the User Comments
     feature at the bottom of each page in the online documentation or go to
     <a class="link" href="http://www.suse.com/documentation/feedback.html" target="_blank">http://www.suse.com/documentation/feedback.html</a> and
     enter your comments there.
    </p></dd><dt id="idm139787671969696"><span class="term ">Mail</span></dt><dd><p>
     For feedback on the documentation of this product, you can also send a
     mail to <code class="literal">doc-team@suse.com</code>. Make sure to include the
     document title, the product version and the publication date of the
     documentation. To report errors or suggest enhancements, provide a concise
     description of the problem and refer to the respective section number and
     page (or URL).
    </p></dd></dl></div></div><div class="sect1 " id="idm139787671677392"><div class="titlepage"><div><div><h2 class="title" id="idm139787671677392"><span class="number">3 </span><span class="name">Documentation Conventions</span> <a title="Permalink" class="permalink" href="#idm139787671677392">#</a></h2><div class="doc-status"><ul><li><span class="ds-label">Filename: </span>common_intro_typografie_i.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><p>
  The following notices and typographical conventions are used in this
  documentation:
 </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
    <code class="filename">/etc/passwd</code>: directory names and file names
   </p></li><li class="listitem "><p>
    <em class="replaceable ">PLACEHOLDER</em>: replace
    <em class="replaceable ">PLACEHOLDER</em> with the actual value
   </p></li><li class="listitem "><p>
    <code class="envar">PATH</code>: the environment variable PATH
   </p></li><li class="listitem "><p>
    <code class="command">ls</code>, <code class="option">--help</code>: commands, options, and
    parameters
   </p></li><li class="listitem "><p>
    <code class="systemitem">user</code>: users or groups
   </p></li><li class="listitem "><p>
    <span class="package">package name</span>
    : name of a package
   </p></li><li class="listitem "><p>
    <span class="keycap">Alt</span>, <span class="keycap">Alt</span><span class="key-connector">–</span><span class="keycap">F1</span>: a key to press or a key combination; keys
    are shown in uppercase as on a keyboard
   </p></li><li class="listitem "><p>
    <span class="guimenu">File</span>, <span class="guimenu">File</span> › <span class="guimenu">Save
    As</span>: menu items, buttons
   </p></li><li class="listitem "><p><strong class="arch-arrow-start">x86_64</strong>
    This paragraph is only relevant for the AMD64/Intel 64 architecture. The
    arrows mark the beginning and the end of the text block.
   <strong class="arch-arrow-end"></strong></p><p><strong class="arch-arrow-start">System z, POWER</strong>
    This paragraph is only relevant for the architectures
    <code class="literal">IBM Z</code> and <code class="literal">POWER</code>. The arrows
    mark the beginning and the end of the text block.
   <strong class="arch-arrow-end"></strong></p></li><li class="listitem "><p>
    <span class="emphasis"><em>Dancing Penguins</em></span> (Chapter
    <span class="emphasis"><em>Penguins</em></span>, ↑Another Manual): This is a reference
    to a chapter in another manual.
   </p></li><li class="listitem "><p>
    Commands that must be run with <code class="systemitem">root</code> privileges. Often you can also
    prefix these commands with the <code class="command">sudo</code> command to run them
    as non-privileged user.
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root">root # </code><code class="command">command</code>
<code class="prompt user">tux &gt; </code><code class="command">sudo</code> <code class="command">command</code></pre></div></li><li class="listitem "><p>
    Commands that can be run by non-privileged users.
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">command</code></pre></div></li><li class="listitem "><p>
    Notices
   </p><div id="idm139787671922160" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.png" /><h6>Warning: Warning Notice</h6><p>
     Vital information you must be aware of before proceeding. Warns you about
     security issues, potential loss of data, damage to hardware, or physical
     hazards.
    </p></div><div id="idm139787671920656" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.png" /><h6>Important: Important Notice</h6><p>
     Important information you should be aware of before proceeding.
    </p></div><div id="idm139787671919344" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.png" /><h6>Note: Note Notice</h6><p>
     Additional information, for example about differences in software
     versions.
    </p></div><div id="idm139787671918032" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.png" /><h6>Tip: Tip Notice</h6><p>
     Helpful information, like a guideline or a piece of practical advice.
    </p></div></li></ul></div></div></div><div class="part" id="part.filesystems"><div class="titlepage"><div><div><h1 class="title"><span class="number">Part I </span><span class="name">File Systems and Mounting </span><a title="Permalink" class="permalink" href="#part.filesystems">#</a></h1></div></div></div><div class="toc"><dl><dt><span class="chapter"><a href="#cha.filesystems"><span class="number">1 </span><span class="name">Overview of File Systems in Linux</span></a></span></dt><dd class="toc-abstract"><p>
    <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> ships with different file systems from which to choose,
    including Btrfs, Ext4, Ext3, Ext2 and XFS. Each file system has
    its own advantages and disadvantages. For a side-by-side feature comparison
    of the major operating systems in <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span>, see
    <a class="link" href="http://www.suse.com/products/server/technical-information/#FileSystem" target="_blank">http://www.suse.com/products/server/technical-information/#FileSystem</a>
    (File System Support and Sizes). This chapter contains an overview of how
    these file systems work and what advantages they offer.
   </p></dd><dt><span class="chapter"><a href="#cha.resize_fs"><span class="number">2 </span><span class="name">Resizing File Systems</span></a></span></dt><dd class="toc-abstract"><p>
  Resizing file systems—not to be confused with resizing partitions or
  volumes—can be used to make space available on physical volumes or to
  use additional space available on a physical volume.
 </p></dd><dt><span class="chapter"><a href="#cha.uuid"><span class="number">3 </span><span class="name">Using UUIDs to Mount Devices</span></a></span></dt><dd class="toc-abstract"><p>
  This section describes the use of UUIDs (Universally Unique Identifiers)
  instead of device names (such as <code class="filename">/dev/sda1</code>) to identify
  file system devices. Starting with <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> 12, UUIDs are used by
  default in the boot loader file and the <code class="filename">/etc/fstab</code> file.
 </p></dd><dt><span class="chapter"><a href="#cha.multitiercache"><span class="number">4 </span><span class="name">Multi-tier Caching for Block Device Operations</span></a></span></dt><dd class="toc-abstract"><p>
  A multi-tier cache is a replicated/distributed cache that consists of at
  least two tiers: one is represented by slower but cheaper rotational block
  devices (hard disks), while the other is more expensive but performs faster
  data operations (for example SSD flash disks).
 </p></dd></dl></div><div xml:lang="en" class="chapter " id="cha.filesystems" lang="en"><div class="titlepage"><div><div><h2 class="title"><span class="number">1 </span><span class="name">Overview of File Systems in Linux</span> <a title="Permalink" class="permalink" href="#cha.filesystems">#</a></h2><div class="doc-status"><ul><li><span class="ds-label">Filename: </span>storage_filesystems.xml</li><li><span class="ds-label">ID: </span>cha.filesystems</li></ul></div></div><div><div class="abstract"><div class="abstract-title-wrap"><h6 class="abstract-title">Abstract<a title="Permalink" class="permalink" href="#idm139787671128240">#</a></h6></div><p>
    <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> ships with different file systems from which to choose,
    including Btrfs, Ext4, Ext3, Ext2 and XFS. Each file system has
    its own advantages and disadvantages. For a side-by-side feature comparison
    of the major operating systems in <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span>, see
    <a class="link" href="http://www.suse.com/products/server/technical-information/#FileSystem" target="_blank">http://www.suse.com/products/server/technical-information/#FileSystem</a>
    (File System Support and Sizes). This chapter contains an overview of how
    these file systems work and what advantages they offer.
   </p></div></div></div></div><div class="line"><div class="toc"><dl><dt><span class="sect1"><a href="#sec.filesystems.glossary"><span class="number">1.1 </span><span class="name">Terminology</span></a></span></dt><dt><span class="sect1"><a href="#sec.filesystems.major.btrfs"><span class="number">1.2 </span><span class="name">Btrfs</span></a></span></dt><dt><span class="sect1"><a href="#sec.filesystems.major.xfs"><span class="number">1.3 </span><span class="name">XFS</span></a></span></dt><dt><span class="sect1"><a href="#sec.filesystems.major.ext2"><span class="number">1.4 </span><span class="name">Ext2</span></a></span></dt><dt><span class="sect1"><a href="#sec.filesystems.major.ext3"><span class="number">1.5 </span><span class="name">Ext3</span></a></span></dt><dt><span class="sect1"><a href="#sec.filesystems.major.ext4"><span class="number">1.6 </span><span class="name">Ext4</span></a></span></dt><dt><span class="sect1"><a href="#sec.filesystems.major.reiser"><span class="number">1.7 </span><span class="name">ReiserFS</span></a></span></dt><dt><span class="sect1"><a href="#sec.filesystems.other"><span class="number">1.8 </span><span class="name">Other Supported File Systems</span></a></span></dt><dt><span class="sect1"><a href="#sec.filesystems.lfs"><span class="number">1.9 </span><span class="name">Large File Support in Linux</span></a></span></dt><dt><span class="sect1"><a href="#sect.filesystems.stor_limits"><span class="number">1.10 </span><span class="name">Linux Kernel Storage Limitations</span></a></span></dt><dt><span class="sect1"><a href="#sect.filesystems.trouble"><span class="number">1.11 </span><span class="name">Troubleshooting File Systems</span></a></span></dt><dt><span class="sect1"><a href="#sec_filesystems_info"><span class="number">1.12 </span><span class="name">Additional Information</span></a></span></dt></dl></div></div><p>
  With SUSE Linux Enterprise 12, Btrfs is the default file system for the operating system and
  XFS is the default for all other use cases. SUSE also continues to support
  the Ext family of file systems, and OCFS2. By default, the Btrfs
  file system will be set up with subvolumes. Snapshots will be automatically
  enabled for the root file system using the snapper infrastructure. For more
  information about snapper, refer to <span class="intraxref">Book “<em class="citetitle ">Administration Guide</em>”, Chapter 7 “System Recovery and Snapshot Management with Snapper”</span>.
 </p><p>
  Professional high-performance setups might require a highly available storage
  system. To meet the requirements of high-performance clustering scenarios,
  <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> includes OCFS2 (Oracle Cluster File System 2) and the
  Distributed Replicated Block Device (DRBD) in the High Availability Extension add-on. These
  advanced storage systems are not covered in this guide. For information, see
  the <em class="citetitle ">SUSE Linux Enterprise High Availability Extension <em class="citetitle ">Administration Guide</em></em> at
  <a class="link" href="http://www.suse.com/doc" target="_blank">http://www.suse.com/doc</a>.
 </p><p>
  It is very important to remember that no file system best suits all kinds of
  applications. Each file system has its particular strengths and weaknesses,
  which must be taken into account. In addition, even the most sophisticated
  file system cannot replace a reasonable backup strategy.
 </p><p>
  The terms <span class="emphasis"><em>data integrity</em></span> and <span class="emphasis"><em>data
  consistency</em></span>, when used in this section, do not refer to the
  consistency of the user space data (the data your application writes to its
  files). Whether this data is consistent must be controlled by the application
  itself.
 </p><p>
  Unless stated otherwise in this section, all the steps required to set up or
  change partitions and file systems can be performed by using the YaST
  Partitioner (which is also strongly recommended). For information, see
  <span class="intraxref">Book “<em class="citetitle ">Deployment Guide</em>”, Chapter 9 “Expert Partitioner”</span>.
 </p><div class="sect1 " id="sec.filesystems.glossary"><div class="titlepage"><div><div><h2 class="title" id="sec.filesystems.glossary"><span class="number">1.1 </span><span class="name">Terminology</span> <a title="Permalink" class="permalink" href="#sec.filesystems.glossary">#</a></h2></div></div></div><div class="variablelist "><dl class="variablelist"><dt id="idm139787671153936"><span class="term ">metadata</span></dt><dd><p>
      A data structure that is internal to the file system. It ensures that all
      of the on-disk data is properly organized and accessible. Essentially, it
      is <span class="quote">“<span class="quote">data about the data.</span>”</span> Almost every file system has its
      own structure of metadata, which is one reason the file systems show
      different performance characteristics. It is extremely important to
      maintain metadata intact, because otherwise all data on the file system
      could become inaccessible.
     </p></dd><dt id="idm139787671151248"><span class="term ">inode</span></dt><dd><p>
      A data structure on a file system that contains a variety of information
      about a file, including size, number of links, pointers to the disk
      blocks where the file contents are actually stored, and date and time of
      creation, modification, and access.
     </p></dd><dt id="idm139787671149184"><span class="term ">journal</span></dt><dd><p>
      In the context of a file system, a journal is an on-disk structure
      containing a type of log in which the file system stores what it is about
      to change in the file system’s metadata. Journaling greatly reduces the
      recovery time of a file system because it has no need for the lengthy
      search process that checks the entire file system at system start-up.
      Instead, only the journal is replayed.
     </p></dd></dl></div></div><div class="sect1 " id="sec.filesystems.major.btrfs"><div class="titlepage"><div><div><h2 class="title" id="sec.filesystems.major.btrfs"><span class="number">1.2 </span><span class="name">Btrfs</span> <a title="Permalink" class="permalink" href="#sec.filesystems.major.btrfs">#</a></h2></div></div></div><p>
   Btrfs is a copy-on-write (COW) file system developed by Chris Mason. It is
   based on COW-friendly B-trees developed by Ohad Rodeh. Btrfs is a
   logging-style file system. Instead of journaling the block changes, it
   writes them in a new location, then links the change in. Until the last
   write, the new changes are not committed.
  </p><div class="sect2 " id="sec.filesystems.major.btrfs.features"><div class="titlepage"><div><div><h3 class="title" id="sec.filesystems.major.btrfs.features"><span class="number">1.2.1 </span><span class="name">Key Features</span> <a title="Permalink" class="permalink" href="#sec.filesystems.major.btrfs.features">#</a></h3></div></div></div><p>
    Btrfs provides fault tolerance, repair, and easy management features, such
    as the following:
   </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
      Writable snapshots that allow you to easily roll back your system if
      needed after applying updates, or to back up files.
     </p></li><li class="listitem "><p>
      Subvolume support: Btrfs creates a default subvolume in its assigned pool
      of space. It allows you to create additional subvolumes that act as
      individual file systems within the same pool of space. The number of
      subvolumes is limited only by the space allocated to the pool.
     </p></li><li class="listitem "><p>
      The online check and repair functionality <code class="command">scrub</code> is
      available as part of the Btrfs command line tools. It verifies the
      integrity of data and metadata, assuming the tree structure is fine. You
      can run scrub periodically on a mounted file system; it runs as a
      background process during normal operation.
     </p></li><li class="listitem "><p>
      Different RAID levels for metadata and user data.
     </p></li><li class="listitem "><p>
      Different checksums for metadata and user data to improve error
      detection.
     </p></li><li class="listitem "><p>
      Integration with Linux Logical Volume Manager (LVM) storage objects.
     </p></li><li class="listitem "><p>
      Integration with the YaST Partitioner and AutoYaST on <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span>. This
      also includes creating a Btrfs file system on Multiple Devices (MD) and
      Device Mapper (DM) storage configurations.
     </p></li><li class="listitem "><p>
      Offline migration from existing Ext2, Ext3, and Ext4 file systems.
     </p></li><li class="listitem "><p>
      Boot loader support for <code class="filename">/boot</code>, allowing to boot from
      a Btrfs partition.
     </p></li><li class="listitem "><p>
      Multivolume Btrfs is supported in RAID0, RAID1, and RAID10 profiles in
      <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> <span class="productnumber"><span class="phrase">15</span></span>. Higher RAID levels are not supported yet,
      but might be enabled with a future service pack.
     </p></li><li class="listitem "><p>
      Use Btrfs commands to set up transparent compression.
     </p></li></ul></div></div><div class="sect2 " id="sec.filesystems.major.btrfs.suse"><div class="titlepage"><div><div><h3 class="title" id="sec.filesystems.major.btrfs.suse"><span class="number">1.2.2 </span><span class="name">The Root File System Setup on <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span></span> <a title="Permalink" class="permalink" href="#sec.filesystems.major.btrfs.suse">#</a></h3></div></div></div><p>
    By default, <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> is set up using Btrfs and snapshots for the root
    partition. Snapshots allow you to easily roll back your system if needed
    after applying updates, or to back up files. Snapshots can easily be
    managed with the SUSE Snapper infrastructure as explained in
    <span class="intraxref">Book “<em class="citetitle ">Administration Guide</em>”, Chapter 7 “System Recovery and Snapshot Management with Snapper”</span>. For general information about the SUSE
    Snapper project, see the Snapper Portal wiki at OpenSUSE.org
    (<a class="link" href="http://snapper.io" target="_blank">http://snapper.io</a>).
   </p><p>
    When using a snapshot to roll back the system, it must be ensured that data
    such as user's home directories, Web and FTP server contents or log files
    do not get lost or overwritten during a roll back. This is achieved by
    using Btrfs subvolumes on the root file system. Subvolumes can be excluded
    from snapshots. The default root file system setup on <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> as
    proposed by YaST during the installation contains the following
    subvolumes. They are excluded from snapshots for the reasons given below.
   </p><div class="variablelist "><dl class="variablelist"><dt id="idm139787671098896"><span class="term "><code class="filename">/boot/grub2/i386-pc</code>,
   <code class="filename">/boot/grub2/x86_64-efi</code>,
   <code class="filename">/boot/grub2/powerpc-ieee1275</code>,
   <code class="filename">/boot/grub2/s390x-emu</code>
  </span></dt><dd><p>
    A rollback of the boot loader configuration is not supported. The
    directories listed above are architecture-specific. The first two
    directories are present on AMD64/Intel 64 machines, the latter two on IBM
    POWER and on IBM Z, respectively.
   </p></dd><dt id="idm139787671095216"><span class="term "><code class="filename">/home</code>
  </span></dt><dd><p>
    If <code class="filename">/home</code> does not reside on a separate partition, it
    is excluded to avoid data loss on rollbacks.
   </p></dd><dt id="idm139787671373744"><span class="term "><code class="filename">/opt</code>, <code class="filename">/var/opt</code>
  </span></dt><dd><p>
    Third-party products usually get installed to <code class="filename">/opt</code>. It
    is excluded to avoid uninstalling these applications on rollbacks.
   </p></dd><dt id="idm139787671370768"><span class="term "><code class="filename">/srv</code>
  </span></dt><dd><p>
    Contains data for Web and FTP servers. It is excluded to avoid data loss on
    rollbacks.
   </p></dd><dt id="idm139787671368608"><span class="term "><code class="filename">/tmp</code>, <code class="filename">/var/tmp</code>,
   <code class="filename">/var/cache</code>, <code class="filename">/var/crash</code>
  </span></dt><dd><p>
    All directories containing temporary files and caches are excluded from
    snapshots.
   </p></dd><dt id="idm139787671365104"><span class="term "><code class="filename">/usr/local</code>
  </span></dt><dd><p>
    This directory is used when manually installing software. It is excluded to
    avoid uninstalling these installations on rollbacks.
   </p></dd><dt id="idm139787671362896"><span class="term "><code class="filename">/var/lib/libvirt/images</code>
  </span></dt><dd><p>
    The default location for virtual machine images managed with libvirt.
    Excluded to ensure virtual machine images are not replaced with older
    versions during a rollback. By default, this subvolume is created with the
    option <code class="literal">no copy on write</code>.
   </p></dd><dt id="idm139787671360144"><span class="term "><code class="filename">/var/lib/mailman</code>, <code class="filename">/var/spool</code>
  </span></dt><dd><p>
    Directories containing mails or mail queues are excluded to avoid a loss of
    mails after a rollback.
   </p></dd><dt id="idm139787671935232"><span class="term "><code class="filename">/var/lib/named</code>
  </span></dt><dd><p>
    Contains zone data for the DNS server. Excluded from snapshots to ensure a
    name server can operate after a rollback.
   </p></dd><dt id="idm139787671933040"><span class="term "><code class="filename">/var/lib/mariadb</code>,
   <code class="filename">/var/lib/mysql</code>, <code class="filename">/var/lib/pgqsl</code>
  </span></dt><dd><p>
    These directories contain database data. By default, these subvolumes are
    created with the option <code class="literal">no copy on write</code>.
   </p></dd><dt id="idm139787671929520"><span class="term "><code class="filename">/var/log</code>
  </span></dt><dd><p>
    Log file location. Excluded from snapshots to allow log file analysis after
    the rollback of a broken system.
   </p></dd></dl></div><div id="idm139787671927040" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.png" /><h6>Warning: Support for Rollbacks</h6><p>
     Rollbacks are only supported by the SUSE support if you do not remove
     any of the preconfigured subvolumes. You may, however, add additional
     subvolumes using the YaST Partitioner.
    </p></div><div class="sect3 " id="sec.filesystems.major.btrfs.compress"><div class="titlepage"><div><div><h4 class="title" id="sec.filesystems.major.btrfs.compress"><span class="number">1.2.2.1 </span><span class="name">Mounting Compressed Btrfs File Systems</span> <a title="Permalink" class="permalink" href="#sec.filesystems.major.btrfs.compress">#</a></h4></div></div></div><div id="idm139787671924064" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.png" /><h6>Note: GRUB 2 and LZO Compressed Root</h6><p>
      GRUB 2 cannot read an lzo compressed root. You need a separate
      <code class="filename">/boot</code> partition to use compression.
     </p></div><p>
     Since SLE12 SP1, compression for Btrfs file systems is supported. Use
     the <code class="option">compress</code> or <code class="option">compress-force</code> option
     and select the compression algorithm, <code class="literal">lzo</code> or
     <code class="literal">zlib</code> (the default). The zlib compression has a higher
     compression ratio while lzo is faster and takes less CPU load.
    </p><p>
     For example:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root">root # </code>mount -o compress /dev/sdx /mnt</pre></div><p>
     In case you create a file, write to it, and the compressed result is
     greater or equal to the uncompressed size, Btrfs will skip compression for
     future write operations forever for this file. If you do not like this
     behavior, use the <code class="option">compress-force</code> option. This can be
     useful for files that have some initial uncompressible data.
    </p><p>
     Note, compression takes effect for new files only. Files that were written
     without compression are not compressed when the file system is mounted
     with the <code class="option">compress</code> or <code class="option">compress-force</code>
     option. Furthermore, files with the <code class="option">nodatacow</code> attribute
     never get their extents compressed:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root">root # </code><code class="command">chattr</code> +C <em class="replaceable ">FILE</em>
<code class="prompt root">root # </code><code class="command">mount</code> -o nodatacow  /dev/sdx /mnt</pre></div><p>
     In regard to encryption, this is independent from any compression. After
     you have written some data to this partition, print the details:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root">root # </code>btrfs filesystem show /mnt
btrfs filesystem show /mnt
Label: 'Test-Btrfs'  uuid: 62f0c378-e93e-4aa1-9532-93c6b780749d
        Total devices 1 FS bytes used 3.22MiB
      devid    1 size 2.00GiB used 240.62MiB path /dev/sdb1</pre></div><p>
     If you want this to be permanent, add the <code class="option">compress</code> or
     <code class="option">compress-force</code> option into the
     <code class="filename">/etc/fstab</code> configuration file. For example:
    </p><div class="verbatim-wrap"><pre class="screen">UUID=1a2b3c4d /home btrfs subvol=@/home,<span class="strong"><strong>compress</strong></span> 0 0</pre></div></div><div class="sect3 " id="sec.filesystems.major.btrfs.suse.mount"><div class="titlepage"><div><div><h4 class="title" id="sec.filesystems.major.btrfs.suse.mount"><span class="number">1.2.2.2 </span><span class="name">Mounting Subvolumes</span> <a title="Permalink" class="permalink" href="#sec.filesystems.major.btrfs.suse.mount">#</a></h4></div></div></div><p>
     A system rollback from a snapshot on <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> is performed by booting
     from the snapshot first. This allows you to check the snapshot while
     running before doing the rollback. Being able to boot from snapshots is
     achieved by mounting the subvolumes (which would normally not be
     necessary).
    </p><p>
     In addition to the subvolumes listed in
     <a class="xref" href="#sec.filesystems.major.btrfs.suse" title="1.2.2. The Root File System Setup on SUSE Linux Enterprise Server">Section 1.2.2, “The Root File System Setup on <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span>”</a> a volume named
     <code class="literal">@</code> exists. This is the default subvolume that will be
     mounted as the root partition (<code class="filename">/</code>). The other
     subvolumes will be mounted into this volume.
    </p><p>
     When booting from a snapshot, not the <code class="literal">@</code> subvolume will
     be used, but rather the snapshot. The parts of the file system included in
     the snapshot will be mounted read-only as <code class="filename">/</code>. The
     other subvolumes will be mounted writable into the snapshot. This state is
     temporary by default: the previous configuration will be restored with the
     next reboot. To make it permanent, execute the <code class="command">snapper
     rollback</code> command. This will make the snapshot that is currently
     booted the new <span class="emphasis"><em>default</em></span> subvolume, which will be used
     after a reboot.
    </p></div><div class="sect3 " id="sec.filesystems.major.btrfs.suse.space"><div class="titlepage"><div><div><h4 class="title" id="sec.filesystems.major.btrfs.suse.space"><span class="number">1.2.2.3 </span><span class="name">Checking for Free Space</span> <a title="Permalink" class="permalink" href="#sec.filesystems.major.btrfs.suse.space">#</a></h4></div></div></div><p>
     File system usage is usually checked by running the <code class="command">df</code>
     command. On a Btrfs file system, the output of <code class="command">df</code> can
     be misleading, because in addition to the space the raw data allocates, a
     Btrfs file system also allocates and uses space for metadata.
    </p><p>
     Consequently a Btrfs file system may report being out of space even though
     it seems that plenty of space is still available. In that case, all space
     allocated for the metadata is used up. Use the following commands to check
     for used and available space on a Btrfs file system:
    </p><div class="variablelist "><dl class="variablelist"><dt id="idm139787671833648"><span class="term "><code class="command">btrfs filesystem show</code>
      </span></dt><dd><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> btrfs filesystem show /
Label: 'ROOT'  uuid: 52011c5e-5711-42d8-8c50-718a005ec4b3
        Total devices 1 FS bytes used 10.02GiB
        devid    1 size 20.02GiB used 13.78GiB path /dev/sda3</pre></div><p>
        Shows the total size of the file system and its usage. If these two
        values in the last line match, all space on the file system has been
        allocated.
       </p></dd><dt id="idm139787671830208"><span class="term "><code class="command">btrfs filesystem df</code>
      </span></dt><dd><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> btrfs filesystem df /
Data, single: total=13.00GiB, used=9.61GiB
System, single: total=32.00MiB, used=16.00KiB
Metadata, single: total=768.00MiB, used=421.36MiB
GlobalReserve, single: total=144.00MiB, used=0.00B</pre></div><p>
        Shows values for allocated (<code class="literal">total</code>) and used space of
        the file system. If the values for <code class="literal">total</code> and
        <code class="literal">used</code> for the metadata are almost equal, all space
        for metadata has been allocated.
       </p></dd><dt id="idm139787671240208"><span class="term "><code class="command">btrfs filesystem usage</code>
      </span></dt><dd><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> btrfs filesystem usage /
Overall:
    Device size:                  20.02GiB
    Device allocated:             13.78GiB
    Device unallocated:            6.24GiB
    Device missing:                  0.00B
    Used:                         10.02GiB
    Free (estimated):              9.63GiB      (min: 9.63GiB)
    Data ratio:                       1.00
    Metadata ratio:                   1.00
    Global reserve:              144.00MiB      (used: 0.00B)

             Data     Metadata  System
Id Path      single   single    single   Unallocated
-- --------- -------- --------- -------- -----------
 1 /dev/sda3 13.00GiB 768.00MiB 32.00MiB     6.24GiB
-- --------- -------- --------- -------- -----------
   Total     13.00GiB 768.00MiB 32.00MiB     6.24GiB
   Used       9.61GiB 421.36MiB 16.00KiB</pre></div><p>
        Shows data similar to that of the two previous commands combined.
       </p></dd></dl></div><p>
     For more information refer to <code class="command">man 8 btrfs-filesystem</code>
     and <a class="link" href="https://btrfs.wiki.kernel.org/index.php/FAQ" target="_blank">https://btrfs.wiki.kernel.org/index.php/FAQ</a>.
    </p></div></div><div class="sect2 " id="sec.filesystems.major.btrfs.migrate"><div class="titlepage"><div><div><h3 class="title" id="sec.filesystems.major.btrfs.migrate"><span class="number">1.2.3 </span><span class="name">Migration from ReiserFS and Ext File Systems to Btrfs</span> <a title="Permalink" class="permalink" href="#sec.filesystems.major.btrfs.migrate">#</a></h3></div></div></div><p>
    You can migrate data volumes from existing ReiserFS or Ext (Ext2, Ext3, or
    Ext4) to the Btrfs file system using the <code class="command">btrfs-convert</code>
    tool. It allows you to do an in-place conversion of unmounted (offline)
    file systems, which may require a bootable install media with the
    <code class="command">btrfs-convert</code> tool. The tool constructs a Btrfs file
    system within the free space of the original file system, directly linking
    to the data contained in it.  There must be enough free space on the device
    to create the metadata or the conversion will fail. The original file system
    will be intact and no free space will be occupied by the Btrfs file system.
    The amount of space required is dependent on the content of the file system
    and can vary based on the number of file system objects (such as files,
    directories, extended attributes) contained in it. Since the data is
    directly referenced, the amount of data on the file system does not impact
    the space required for conversion, except for files that utilize tail
    packing and are larger than about 2KiB in size.
   </p><p>
    To convert the original file system to the Btrfs file system, run:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root">root # </code>btrfs-convert /path/to/device</pre></div><div id="idm139787671229376" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.png" /><h6>Important: Check <code class="filename">/etc/fstab</code></h6><p>
     After the conversion, you need to ensure that any references to the
     original file system in <code class="filename">/etc/fstab</code> have been adjusted
     to indicate that the device contains a Btrfs file system.
    </p></div><p>
    Once converted, the contents of the Btrfs file system will reflect the
    contents of the source file system. The source file system will be preserved
    until you remove the related read-only image created at
    <code class="filename"><em class="replaceable ">fs_root</em>/reiserfs_saved/image</code>.
    The image file is effectively a 'snapshot' of the ReiserFS file system prior
    to conversion and will not be modified as the Btrfs file system is modified.
    To remove the image file, remove the <code class="filename">reiserfs_saved</code>
    subvolume:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root">root # </code>btrfs subvolume delete <em class="replaceable ">fs_root</em>/reiserfs_saved&gt;</pre></div><p>
    To revert the file system back to the original one, use the following
    command:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root">root # </code>btrfs-convert -r /path/to/device</pre></div><div id="idm139787671962576" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.png" /><h6>Warning: Lost Changes</h6><p>
     Any changes you made to the file system while it was mounted as a Btrfs file
     system will be lost. A balance operation must not have been performed in
     the interim, or the file system will not be restored correctly.
    </p></div></div><div class="sect2 " id="sec.filesystems.major.btrfs.admin"><div class="titlepage"><div><div><h3 class="title" id="sec.filesystems.major.btrfs.admin"><span class="number">1.2.4 </span><span class="name">Btrfs Administration</span> <a title="Permalink" class="permalink" href="#sec.filesystems.major.btrfs.admin">#</a></h3></div></div></div><p>
    Btrfs is integrated in the YaST Partitioner and AutoYaST. It is available
    during the installation to allow you to set up a solution for the root file
    system. You can use the YaST Partitioner after the installation to view
    and manage Btrfs volumes.
   </p><p>
    Btrfs administration tools are provided in the
    <code class="filename">btrfsprogs</code> package. For information about using Btrfs
    commands, see the <code class="command">man 8 btrfs</code>, <code class="command">man 8
    btrfsck</code>, and <code class="command">man 8 mkfs.btrfs</code> commands. For
    information about Btrfs features, see the <em class="citetitle ">Btrfs wiki</em>
    at <a class="link" href="http://btrfs.wiki.kernel.org" target="_blank">http://btrfs.wiki.kernel.org</a>.
   </p></div><div class="sect2 " id="sec.filesystems.major.btrfs.quota"><div class="titlepage"><div><div><h3 class="title" id="sec.filesystems.major.btrfs.quota"><span class="number">1.2.5 </span><span class="name">Btrfs Quota Support for Subvolumes</span> <a title="Permalink" class="permalink" href="#sec.filesystems.major.btrfs.quota">#</a></h3></div></div></div><p>
    The Btrfs root file system subvolumes <code class="filename">/var/log</code>,
    <code class="filename">/var/crash</code> and <code class="filename">/var/cache</code> can use
    all of the available disk space during normal operation, and cause a system
    malfunction. To help avoid this situation, <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> now offers Btrfs
    quota support for subvolumes. If you set up the root file system by using
    the respective YaST proposal, it is prepared accordingly: quota groups
    (<code class="literal">qgroup</code>) for all subvolumes are already set up. To set a
    quota for a subvolume in the root file system, proceed as follows:
   </p><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
      Enable quota support:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> btrfs quota enable /</pre></div></li><li class="step "><p>
      Get a list of subvolumes:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> btrfs subvolume list /</pre></div><p>
      Quotas can only be set for existing subvolumes.
     </p></li><li class="step "><p>
      Set a quota for one of the subvolumes that was listed in the previous
      step. A subvolume can either be identified by path (for example
      <code class="filename">/var/tmp</code>) or by <code class="literal">0/<em class="replaceable ">SUBVOLUME
      ID</em></code> (for example <code class="literal">0/272</code>). The
      following example sets a quota of five GB for
      <code class="filename">/var/tmp</code>.
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> btrfs qgroup limit 5G /var/tmp</pre></div><p>
      The size can either be specified in bytes (5000000000), kilobytes
      (5000000K), megabytes (5000M), or gigabytes (5G). The resulting values in
      bytes slightly differ, since 1024 Bytes = 1 KiB, 1024 KiB = 1 MiB, etc.
     </p></li><li class="step "><p>
      To list the existing quotas, use the following command. The column
      <code class="literal">max_rfer</code> shows the quota in bytes.
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> btrfs qgroup show -r /</pre></div></li></ol></div></div><div id="idm139787671903296" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.png" /><h6>Tip: Nullifying a Quota</h6><p>
     In case you want to nullify an existing quota, set a quota size of
     <code class="literal">none</code>:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> btrfs qgroup limit none /var/tmp</pre></div><p>
     To disable quota support for a partition and all its subvolumes, use
     <code class="command">btrfs quota disable</code>:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> btrfs quota disable /</pre></div></div><p>
    See the <code class="command">man 8 btrfs-qgroup</code> and <code class="command">man 8
    btrfs-quota</code> for more details. The <em class="citetitle ">UseCases</em>
    page on the Btrfs wiki
    (<a class="link" href="https://btrfs.wiki.kernel.org/index.php/UseCases" target="_blank">https://btrfs.wiki.kernel.org/index.php/UseCases</a>)
    also provides more information.
   </p></div><div class="sect2 " id="sec.filesystems.major.btrfs.s-r"><div class="titlepage"><div><div><h3 class="title" id="sec.filesystems.major.btrfs.s-r"><span class="number">1.2.6 </span><span class="name">Btrfs send/receive</span> <a title="Permalink" class="permalink" href="#sec.filesystems.major.btrfs.s-r">#</a></h3></div></div></div><p>
    Btrfs allows to make snapshots to capture the state of the file system.
    Snapper, for example, uses this feature to create snapshots before and
    after system changes, allowing a rollback. However, together with the
    send/receive feature, snapshots can also be used to create and maintain
    copies of a file system in a remote location. This feature can, for
    example, be used to do incremental backups.
   </p><p>
    A <code class="command">btrfs send</code> operation calculates the difference between
    two read-only snapshots from the same subvolume and sends it to a file or
    to STDOUT. A <code class="command">btrfs receive</code> operation takes the result of
    the send command and applies it to a snapshot.
   </p><div class="sect3 " id="sec.filesystems.major.btrfs.s-r.requires"><div class="titlepage"><div><div><h4 class="title" id="sec.filesystems.major.btrfs.s-r.requires"><span class="number">1.2.6.1 </span><span class="name">Prerequisites</span> <a title="Permalink" class="permalink" href="#sec.filesystems.major.btrfs.s-r.requires">#</a></h4></div></div></div><p>
     To use Btrfs's send/receive feature, the following requirements need to be
     met:
    </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
       A Btrfs file system is required on the source side
       (<code class="literal">send</code>) and on the target side
       (<code class="literal">receive</code>).
      </p></li><li class="listitem "><p>
       Btrfs send/receive operates on snapshots, therefore the respective data
       needs to reside in a Btrfs subvolume.
      </p></li><li class="listitem "><p>
       Snapshots on the source side need to be read-only.
      </p></li><li class="listitem "><p>
       SUSE Linux Enterprise 12 SP2 or better. Earlier versions of SUSE Linux Enterprise do not support
       send/receive.
      </p></li></ul></div></div><div class="sect3 " id="sec.filesystems.major.btrfs.s-r.backup"><div class="titlepage"><div><div><h4 class="title" id="sec.filesystems.major.btrfs.s-r.backup"><span class="number">1.2.6.2 </span><span class="name">Incremental Backups</span> <a title="Permalink" class="permalink" href="#sec.filesystems.major.btrfs.s-r.backup">#</a></h4></div></div></div><p>
     The following procedure shows the basic usage of Btrfs send/receive using
     the example of creating incremental backups of <code class="filename">/data</code>
     (source side) in <code class="filename">/backup/data</code> (target side).
     <code class="filename">/data</code> needs to be a subvolume.
    </p><div class="procedure " id="idm139787671294384"><div class="procedure-title-wrap"><h6 class="procedure-title"><span class="number">Procedure 1.1: </span><span class="name">Initial Setup </span><a title="Permalink" class="permalink" href="#idm139787671294384">#</a></h6></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
       Create the initial snapshot (called <code class="literal">snapshot_0</code> in
       this example) on the source side and make sure it is written to the
       disk:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> btrfs subvolume snapshot -r /data /data/bkp_data
sync</pre></div><p>
       A new subvolume <code class="filename">/data/bkp_data</code> is created. It will
       be used as the basis for the next incremental backup and should be kept
       as a reference.
      </p></li><li class="step "><p>
       Send the initial snapshot to the target side. Since this is the initial
       send/receive operation, the complete snapshot needs to be sent:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> bash -c 'btrfs send /data/bkp_data | btrfs receive /backup'</pre></div><p>
       A new subvolume <code class="filename">/backup/bkp_data</code> is created on the
       target side.
      </p></li></ol></div></div><p>
     When the initial setup has been finished, you can create incremental
     backups and send the differences between the current and previous
     snapshots to the target side. The procedure is always the same:
    </p><div class="orderedlist "><ol class="orderedlist" type="1"><li class="listitem "><p>
       Create a new snapshot on the source side.
      </p></li><li class="listitem "><p>
       Send the differences to the target side.
      </p></li><li class="listitem "><p>
       Optional: Rename and/or clean up snapshots on both sides.
      </p></li></ol></div><div class="procedure " id="idm139787671996912"><div class="procedure-title-wrap"><h6 class="procedure-title"><span class="number">Procedure 1.2: </span><span class="name">Performing an Incremental Backup </span><a title="Permalink" class="permalink" href="#idm139787671996912">#</a></h6></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
       Create a new snapshot on the source side and make sure it is written to
       the disk. In the following example the snapshot is named
       bkp_data_<em class="replaceable ">CURRENT_DATE</em>:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> btrfs subvolume snapshot -r /data /data/bkp_data_$(date +%F)
sync</pre></div><p>
       A new subvolume, for example
       <code class="filename">/data/bkp_data_2016-07-07</code>, is created.
      </p></li><li class="step "><p>
       Send the difference between the previous snapshot and the one you have
       created to the target side. This is achieved by specifying the
       previous snapshot with the option <code class="option">-p
       <em class="replaceable ">SNAPSHOT</em></code>.
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> bash -c 'btrfs send -p /data/bkp_data /data/bkp_data_2016-07-07 \
| btrfs receive /backup'</pre></div><p>
       A new subvolume <code class="filename">/backup/bkp_data_2016-07-07</code> is
       created.
      </p></li><li class="step "><p>
       As a result four snapshots, two on each side, exist:
      </p><table border="0" summary="Simple list" class="simplelist "><tr><td><code class="filename">/data/bkp_data</code>
       </td></tr><tr><td><code class="filename">/data/bkp_data_2016-07-07</code>
       </td></tr><tr><td><code class="filename">/backup/bkp_data</code>
       </td></tr><tr><td><code class="filename">/backup/bkp_data_2016-07-07</code>
       </td></tr></table><p>
       Now you have three options for how to proceed:
      </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
         Keep all snapshots on both sides. With this option you can roll back
         to any snapshot on both sides while having all data duplicated at the
         same time. No further action is required. When doing the next
         incremental backup, keep in mind to use the next-to-last snapshot as
         parent for the send operation.
        </p></li><li class="listitem "><p>
         Only keep the last snapshot on the source side and all snapshots on
         the target side. Also allows to roll back to any snapshot on both
         sides—to do a rollback to a specific snapshot on the source
         side, perform a send/receive operation of a complete snapshot from the
         target side to the source side. Do a delete/move operation on the
         source side.
        </p></li><li class="listitem "><p>
         Only keep the last snapshot on both sides. This way you have a backup
         on the target side that represents the state of the last snapshot made
         on the source side. It is not possible to roll back to other
         snapshots. Do a delete/move operation on the source and the target
         side.
        </p></li></ul></div><ol type="a" class="substeps "><li class="step "><p>
         To only keep the last snapshot on the source side, perform the
         following commands:
        </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> btrfs subvolume delete /data/bkp_data
<code class="prompt user">tux &gt; </code><code class="command">sudo</code> mv /data/bkp_data_2016-07-07 /data/bkp_data</pre></div><p>
         The first command will delete the previous snapshot, the second
         command renames the current snapshot to
         <code class="filename">/data/bkp_data</code>. This ensures that the last
         snapshot that was backed up is always named
         <code class="filename">/data/bkp_data</code>. As a consequence, you can also
         always use this subvolume name as a parent for the incremental send
         operation.
        </p></li><li class="step "><p>
         To only keep the last snapshot on the target side, perform the
         following commands:
        </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> btrfs subvolume delete /backup/bkp_data
<code class="prompt user">tux &gt; </code><code class="command">sudo</code> mv /backup/bkp_data_2016-07-07 /backup/bkp_data</pre></div><p>
         The first command will delete the previous backup snapshot, the second
         command renames the current backup snapshot to
         <code class="filename">/backup/bkp_data</code>. This ensures that the latest
         backup snapshot is always named <code class="filename">/backup/bkp_data</code>.
        </p></li></ol></li></ol></div></div><div id="idm139787671665648" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.png" /><h6>Tip: Sending to a Remote Target Side</h6><p>
      To send the snapshots to a remote machine, use SSH:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code>btrfs send /data/bkp_data | ssh root@jupiter.example.com 'btrfs receive /backup'</pre></div></div></div></div><div class="sect2 " id="sec.filesystems.major.btrfs.deduplication"><div class="titlepage"><div><div><h3 class="title" id="sec.filesystems.major.btrfs.deduplication"><span class="number">1.2.7 </span><span class="name">Data Deduplication Support</span> <a title="Permalink" class="permalink" href="#sec.filesystems.major.btrfs.deduplication">#</a></h3></div></div></div><p>
    Btrfs supports data deduplication by replacing identical blocks in the file
    system with logical links to a single copy of the block in a common storage
    location. <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> provides the tool <code class="command">duperemove</code> for
    scanning the file system for identical blocks. When used on a Btrfs file
    system, it can also be used to deduplicate these blocks.
    <code class="command">duperemove</code> is not installed by default. To make it
    available, install the package
    <span class="package">duperemove</span>
    .
   </p><div id="idm139787671658864" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.png" /><h6>Note: Use Cases</h6><p>
     As of <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> <span class="productnumber"><span class="phrase">15</span></span> duperemove is not suited to
     deduplicate the entire file system. It is intended to be used to
     deduplicate a set of 10 to 50 large files that possibly have lots of
     blocks in common, such as virtual machine images.
    </p></div><p>
    <code class="command">duperemove</code> can either operate on a list of files or
    recursively scan a directory:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> duperemove <em class="replaceable ">OPTIONS</em> file1 file2 file3
<code class="prompt user">tux &gt; </code><code class="command">sudo</code> duperemove -r <em class="replaceable ">OPTIONS</em> directory</pre></div><p>
    It operates in two modes: read-only and de-duping. When run in read-only
    mode (that is without the <code class="option">-d</code> switch), it scans the given
    files or directories for duplicated blocks and prints them. This works
    on any file system.
   </p><p>
    Running <code class="command">duperemove</code> in de-duping mode is only supported
    on Btrfs file systems. After having scanned the given files or directories,
    the duplicated blocks will be submitted for deduplication.
   </p><p>
    For more information see <code class="command">man 8 duperemove</code>.
   </p></div></div><div class="sect1 " id="sec.filesystems.major.xfs"><div class="titlepage"><div><div><h2 class="title" id="sec.filesystems.major.xfs"><span class="number">1.3 </span><span class="name">XFS</span> <a title="Permalink" class="permalink" href="#sec.filesystems.major.xfs">#</a></h2></div></div></div><p>
   Originally intended as the file system for their IRIX OS, SGI started XFS
   development in the early 1990s. The idea behind XFS was to create a
   high-performance 64-bit journaling file system to meet extreme computing
   challenges. XFS is very good at manipulating large files and performs well
   on high-end hardware.

   XFS is the default file system for data partitions in <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span>.
  </p><p>
   A quick review of XFS’s key features explains why it might prove to be a
   strong competitor for other journaling file systems in high-end computing.
  </p><div class="sect2 " id="sec.filesystems.major.xfs.scalability"><div class="titlepage"><div><div><h3 class="title" id="sec.filesystems.major.xfs.scalability"><span class="number">1.3.1 </span><span class="name">High Scalability by Using Allocation Groups</span> <a title="Permalink" class="permalink" href="#sec.filesystems.major.xfs.scalability">#</a></h3></div></div></div><p>
    At the creation time of an XFS file system, the block device underlying the
    file system is divided into eight or more linear regions of equal size.
    Those are called <span class="emphasis"><em>allocation groups</em></span>. Each allocation
    group manages its own inodes and free disk space. Practically, allocation
    groups can be seen as file systems in a file system. Because allocation
    groups are rather independent of each other, more than one of them can be
    addressed by the kernel simultaneously. This feature is the key to XFS’s
    great scalability. Naturally, the concept of independent allocation groups
    suits the needs of multiprocessor systems.
   </p></div><div class="sect2 " id="sec.filesystems.major.xfs.mgmt"><div class="titlepage"><div><div><h3 class="title" id="sec.filesystems.major.xfs.mgmt"><span class="number">1.3.2 </span><span class="name">High Performance through Efficient Management of Disk Space</span> <a title="Permalink" class="permalink" href="#sec.filesystems.major.xfs.mgmt">#</a></h3></div></div></div><p>
    Free space and inodes are handled by B<sup>+</sup> trees
    inside the allocation groups. The use of B<sup>+</sup>
    trees greatly contributes to XFS’s performance and scalability. XFS uses
    <span class="emphasis"><em>delayed allocation</em></span>, which handles allocation by
    breaking the process into two pieces. A pending transaction is stored in
    RAM and the appropriate amount of space is reserved. XFS still does not
    decide where exactly (in file system blocks) the data should be stored.
    This decision is delayed until the last possible moment. Some short-lived
    temporary data might never make its way to disk, because it is obsolete by
    the time XFS decides where actually to save it. In this way, XFS increases
    write performance and reduces file system fragmentation. Because delayed
    allocation results in less frequent write events than in other file
    systems, it is likely that data loss after a crash during a write is more
    severe.
   </p></div><div class="sect2 " id="sec.filesystems.major.prealloc"><div class="titlepage"><div><div><h3 class="title" id="sec.filesystems.major.prealloc"><span class="number">1.3.3 </span><span class="name">Preallocation to Avoid File System Fragmentation</span> <a title="Permalink" class="permalink" href="#sec.filesystems.major.prealloc">#</a></h3></div></div></div><p>
    Before writing the data to the file system, XFS
    <span class="emphasis"><em>reserves</em></span> (preallocates) the free space needed for a
    file. Thus, file system fragmentation is greatly reduced. Performance is
    increased because the contents of a file are not distributed all over the
    file system.
   </p><div id="idm139787671213456" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.png" /><h6>Note: The new XFS On-disk Format</h6><p>
     Starting with version 12, <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> supports the new <span class="quote">“<span class="quote">on-disk
     format</span>”</span> (v5) of the XFS file system. XFS file systems created by
     YaST will use this new format. The main advantages of this format are
     automatic checksums of all XFS metadata, file type support, and support
     for a larger number of access control lists for a file.
    </p><p>
     Note that this format is <span class="emphasis"><em>not</em></span> supported by SUSE Linux Enterprise
     kernels older than version 3.12, by xfsprogs older than version 3.2.0, and
     GRUB 2 versions released before SUSE Linux Enterprise 12. This will be problematic if the
     file system should also be used from systems not meeting these
     prerequisites.
    </p><p>
     If you require interoperability of the XFS file system with older SUSE
     systems or other Linux distributions, format the file system manually
     using the <code class="command">mkfs.xfs</code> command. This will create an XFS
     file system in the old format (unless you use the <code class="option">-m
     crc=1</code> option).
    </p></div></div></div><div class="sect1 " id="sec.filesystems.major.ext2"><div class="titlepage"><div><div><h2 class="title" id="sec.filesystems.major.ext2"><span class="number">1.4 </span><span class="name">Ext2</span> <a title="Permalink" class="permalink" href="#sec.filesystems.major.ext2">#</a></h2></div></div></div><p>
   The origins of Ext2 go back to the early days of Linux history. Its
   predecessor, the Extended File System, was implemented in April 1992 and
   integrated in Linux 0.96c. The Extended File System underwent several
   modifications and, as Ext2, became the most popular Linux file system for
   years. With the creation of journaling file systems and their short recovery
   times, Ext2 became less important.
  </p><p>
   A brief summary of Ext2’s strengths might help understand why it
   was—and in some areas still is—the favorite Linux file system of
   many Linux users.
  </p><div class="variablelist "><dl class="variablelist"><dt id="idm139787671204224"><span class="term ">Solidity and Speed</span></dt><dd><p>
      Being an <span class="quote">“<span class="quote">old-timer</span>”</span>, Ext2 underwent many improvements and
      was heavily tested. This might be the reason people often refer to it as
      rock-solid. After a system outage when the file system could not be
      cleanly unmounted, e2fsck starts to analyze the file system data.
      Metadata is brought into a consistent state and pending files or data
      blocks are written to a designated directory (called
      <code class="filename">lost+found</code>). In contrast to journaling file systems,
      e2fsck analyzes the entire file system and not only the recently modified
      bits of metadata. This takes significantly longer than checking the log
      data of a journaling file system. Depending on file system size, this
      procedure can take half an hour or more. Therefore, it is not desirable
      to choose Ext2 for any server that needs high availability. However,
      because Ext2 does not maintain a journal and uses less memory, it is
      sometimes faster than other file systems.
     </p></dd><dt id="idm139787671200608"><span class="term ">Easy Upgradability</span></dt><dd><p>
      Because Ext3 is based on the Ext2 code and shares its on-disk format and
      its metadata format, upgrades from Ext2 to Ext3 are very easy.
     </p></dd></dl></div></div><div class="sect1 " id="sec.filesystems.major.ext3"><div class="titlepage"><div><div><h2 class="title" id="sec.filesystems.major.ext3"><span class="number">1.5 </span><span class="name">Ext3</span> <a title="Permalink" class="permalink" href="#sec.filesystems.major.ext3">#</a></h2></div></div></div><p>
   Ext3 was designed by Stephen Tweedie. Unlike all other next-generation file
   systems, Ext3 does not follow a completely new design principle. It is based
   on Ext2. These two file systems are very closely related to each other. An
   Ext3 file system can be easily built on top of an Ext2 file system. The most
   important difference between Ext2 and Ext3 is that Ext3 supports journaling.
   In summary, Ext3 has three major advantages to offer:
  </p><div class="sect2 " id="sec.filesystems.major.ext3.upgrade"><div class="titlepage"><div><div><h3 class="title" id="sec.filesystems.major.ext3.upgrade"><span class="number">1.5.1 </span><span class="name">Easy and Highly Reliable Upgrades from Ext2</span> <a title="Permalink" class="permalink" href="#sec.filesystems.major.ext3.upgrade">#</a></h3></div></div></div><p>
    The code for Ext2 is the strong foundation on which Ext3 could become a
    highly acclaimed next-generation file system. Its reliability and solidity
    are elegantly combined in Ext3 with the advantages of a journaling file
    system. Unlike transitions to other journaling file systems, such as
    XFS, which can be quite tedious (making backups of the entire
    file system and re-creating it from scratch), a transition to Ext3 is a
    matter of minutes. It is also very safe, because re-creating an entire file
    system from scratch might not work flawlessly. Considering the number of
    existing Ext2 systems that await an upgrade to a journaling file system,
    you can easily see why Ext3 might be of some importance to many system
    administrators. Downgrading from Ext3 to Ext2 is as easy as the upgrade.
    Perform a clean unmount of the Ext3 file system and remount it as an Ext2
    file system.
   </p></div><div class="sect2 " id="sec.filesystems.major.ext3.performance"><div class="titlepage"><div><div><h3 class="title" id="sec.filesystems.major.ext3.performance"><span class="number">1.5.2 </span><span class="name">Reliability and Performance</span> <a title="Permalink" class="permalink" href="#sec.filesystems.major.ext3.performance">#</a></h3></div></div></div><p>
    Some other journaling file systems follow the <span class="quote">“<span class="quote">metadata-only</span>”</span>
    journaling approach. This means your metadata is always kept in a
    consistent state, but this cannot be automatically guaranteed for the file
    system data itself. Ext3 is designed to take care of both metadata and
    data. The degree of <span class="quote">“<span class="quote">care</span>”</span> can be customized. Enabling Ext3 in
    the <code class="option">data=journal</code> mode offers maximum security (data
    integrity), but can slow down the system because both metadata and data are
    journaled. A relatively new approach is to use the
    <code class="option">data=ordered</code> mode, which ensures both data and metadata
    integrity, but uses journaling only for metadata. The file system driver
    collects all data blocks that correspond to one metadata update. These data
    blocks are written to disk before the metadata is updated. As a result,
    consistency is achieved for metadata and data without sacrificing
    performance. A third option to use is <code class="option">data=writeback</code>,
    which allows data to be written to the main file system after its metadata
    has been committed to the journal. This option is often considered the best
    in performance. It can, however, allow old data to reappear in files after
    crash and recovery while internal file system integrity is maintained. Ext3
    uses the <code class="option">data=ordered</code> option as the default.
   </p></div><div class="sect2 " id="sec.filesystems.major.ext3.ext22ext3a"><div class="titlepage"><div><div><h3 class="title" id="sec.filesystems.major.ext3.ext22ext3a"><span class="number">1.5.3 </span><span class="name">Converting an Ext2 File System into Ext3</span> <a title="Permalink" class="permalink" href="#sec.filesystems.major.ext3.ext22ext3a">#</a></h3></div></div></div><p>
    To convert an Ext2 file system to Ext3:
   </p><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
      Create an Ext3 journal by running <code class="command">tune2fs -j</code> as the
      <code class="systemitem">root</code> user.
     </p><p>
      This creates an Ext3 journal with the default parameters.
     </p><p>
      To specify how large the journal should be and on which device it should
      reside, run <code class="command">tune2fs</code> <code class="option">-J</code> instead
      together with the desired journal options <code class="option">size=</code> and
      <code class="option">device=</code>. More information about the
      <code class="command">tune2fs</code> program is available in the
      <code class="command">tune2fs</code> man page.
     </p></li><li class="step "><p>
      Edit the file <code class="filename">/etc/fstab</code> as the <code class="systemitem">root</code> user to
      change the file system type specified for the corresponding partition
      from <code class="literal">ext2</code> to <code class="literal">ext3</code>, then save the
      changes.
     </p><p>
      This ensures that the Ext3 file system is recognized as such. The change
      takes effect after the next reboot.
     </p></li><li class="step "><p>
      To boot a root file system that is set up as an Ext3 partition, add the
      modules <code class="literal">ext3</code> and <code class="literal">jbd</code> in the
      <code class="filename">initrd</code>. Do so by
     </p><ol type="a" class="substeps "><li class="step "><p>
        adding the following line to
        <code class="filename">/etc/dracut.conf.d/01-dist.conf</code>:
       </p><div class="verbatim-wrap"><pre class="screen">force_drivers+="ext3 jbd"</pre></div></li><li class="step "><p>
        and running the <code class="command">dracut</code> <code class="option">-f</code> command.
       </p></li></ol></li><li class="step "><p>
      Reboot the system.
     </p></li></ol></div></div></div><div class="sect2 " id="sec.filesystems.major.ext3.inodesize"><div class="titlepage"><div><div><h3 class="title" id="sec.filesystems.major.ext3.inodesize"><span class="number">1.5.4 </span><span class="name">Ext3 File System Inode Size and Number of Inodes</span> <a title="Permalink" class="permalink" href="#sec.filesystems.major.ext3.inodesize">#</a></h3></div></div></div><p>
    An inode stores information about the file and its block location in the
    file system. To allow space in the inode for extended attributes and ACLs,
    the default inode size for Ext3 was increased from 128 bytes on SLES 10 to
    256 bytes on SLES 11. As compared to SLES 10, when you make a new Ext3 file
    system on SLES 11, the default amount of space preallocated for the same
    number of inodes is doubled, and the usable space for files in the file
    system is reduced by that amount. Thus, you must use larger partitions to
    accommodate the same number of inodes and files than were possible for an
    Ext3 file system on SLES 10.
   </p><p>
    When you create a new Ext3 file system, the space in the inode table is
    preallocated for the total number of inodes that can be created. The
    bytes-per-inode ratio and the size of the file system determine how many
    inodes are possible. When the file system is made, an inode is created for
    every bytes-per-inode bytes of space:
   </p><div class="verbatim-wrap"><pre class="screen">number of inodes = total size of the file system divided by the number of bytes per inode</pre></div><p>
    The number of inodes controls the number of files you can have in the file
    system: one inode for each file. To address the increased inode size and
    reduced usable space available, the default for the bytes-per-inode ratio
    was increased from 8192 bytes on SLES 10 to 16384 bytes on SLES 11. The
    doubled ratio means that the number of files that can be created is
    one-half of the number of files possible for an Ext3 file system on SLES
    10.
   </p><div id="idm139787671696944" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.png" /><h6>Important: Changing the Inode Size of an Existing Ext3 File System</h6><p>
     After the inodes are allocated, you cannot change the settings for the
     inode size or bytes-per-inode ratio. No new inodes are possible without
     re-creating the file system with different settings, or unless the file
     system gets extended. When you exceed the maximum number of inodes, no new
     files can be created on the file system until some files are deleted.
    </p></div><p>
    When you make a new Ext3 file system, you can specify the inode size and
    bytes-per-inode ratio to control inode space usage and the number of files
    possible on the file system. If the blocks size, inode size, and
    bytes-per-inode ratio values are not specified, the default values in the
    <code class="filename">/etc/mked2fs.conf</code> file are applied. For information,
    see the <code class="filename">mke2fs.conf(5)</code> man page.
   </p><p>
    Use the following guidelines:
   </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p><span class="formalpara-title">Inode size: </span>
       The default inode size is 256 bytes. Specify a value in bytes that is a
       power of 2 and equal to 128 or larger in bytes and up to the block size,
       such as 128, 256, 512, and so on. Use 128 bytes only if you do not use
       extended attributes or ACLs on your Ext3 file systems.
      </p></li><li class="listitem "><p><span class="formalpara-title">Bytes-per-inode ratio: </span>
       The default bytes-per-inode ratio is 16384 bytes. Valid bytes-per-inode
       ratio values must be a power of 2 equal to 1024 or greater in bytes,
       such as 1024, 2048, 4096, 8192, 16384, 32768, and so on. This value
       should not be smaller than the block size of the file system, because
       the block size is the smallest chunk of space used to store data. The
       default block size for the Ext3 file system is 4 KB.
      </p><p>
      In addition, you should consider the number of files and the size of
      files you need to store. For example, if your file system will have many
      small files, you can specify a smaller bytes-per-inode ratio, which
      increases the number of inodes. If your file system will have very large
      files, you can specify a larger bytes-per-inode ratio, which reduces the
      number of possible inodes.
     </p><p>
      Generally, it is better to have too many inodes than to run out of them.
      If you have too few inodes and very small files, you could reach the
      maximum number of files on a disk that is practically empty. If you have
      too many inodes and very large files, you might have free space reported
      but be unable to use it because you cannot create new files in space
      reserved for inodes.
     </p></li></ul></div><p>
    If you do not use extended attributes or ACLs on your Ext3 file systems,
    you can restore the SLES 10 behavior specifying 128 bytes as the inode size
    and 8192 bytes as the bytes-per-inode ratio when you make the file system.
    Use any of the following methods to set the inode size and bytes-per-inode
    ratio:
   </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p><span class="formalpara-title">Modifying the default settings for all new Ext3 files: </span>
       In a text editor, modify the <code class="literal">defaults</code> section of the
       <code class="filename">/etc/mke2fs.conf</code> file to set the
       <code class="literal">inode_size</code> and <code class="literal">inode_ratio</code> to the
       desired default values. The values apply to all new Ext3 file systems.
       For example:
      </p><div class="verbatim-wrap"><pre class="screen">blocksize = 4096
inode_size = 128
inode_ratio = 8192</pre></div></li><li class="listitem "><p><span class="formalpara-title">At the command line: </span>
       Pass the inode size (<code class="literal">-I 128</code>) and the bytes-per-inode
       ratio (<code class="literal">-i 8192</code>) to the
       <code class="command">mkfs.ext3(8)</code> command or the
       <code class="command">mke2fs(8)</code> command when you create a new Ext3 file
       system. For example, use either of the following commands:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> mkfs.ext3 -b 4096 -i 8092 -I 128 /dev/sda2
<code class="prompt user">tux &gt; </code><code class="command">sudo</code> mke2fs -t ext3 -b 4096 -i 8192 -I 128 /dev/sda2</pre></div></li><li class="listitem "><p><span class="formalpara-title">During installation with YaST: </span>
       Pass the inode size and bytes-per-inode ratio values when you create a
       new Ext3 file system during the installation. In the YaST Partitioner
       on the <span class="guimenu">Edit Partition</span> page under<span class="guimenu"> Formatting
       Options</span>, select <span class="guimenu">Format
       partition</span><span class="guimenu">Ext3</span>, then click
       <span class="guimenu">Options</span>. In the <span class="guimenu">File system
       options</span> dialog, select the desired values from the
       <span class="guimenu">Block Size in Bytes</span>,
       <span class="guimenu">Bytes-per-inode</span>, and <span class="guimenu">Inode Size</span>
       drop-down box.
      </p><p>
      For example, select 4096 for the <span class="guimenu">Block Size in Bytes</span>
      drop-down box, select 8192 from the <span class="guimenu">Bytes per inode</span>
      drop-down box, select 128 from the <span class="guimenu">Inode Size</span>
      drop-down box, then click <span class="guimenu">OK</span>.
     </p><div class="informalfigure"><div class="mediaobject"><a xmlns="" href="images/ext3_inode_yast_a.png"><img src="images/ext3_inode_yast_a.png" width="" /></a></div></div></li><li class="listitem "><p><span class="formalpara-title">During installation with AutoYaST: </span>
       In an AutoYaST profile, you can use the <code class="literal">fs_options </code>tag to
       set the <code class="literal">opt_bytes_per_inode</code> ratio value of 8192 for
       -i and the <code class="literal">opt_inode_density</code> value of 128 for -I:
      </p><div class="verbatim-wrap"><pre class="screen">&lt;partitioning config:type="list"&gt;
  &lt;drive&gt;
    &lt;device&gt;/dev/sda&lt;/device&gt;
    &lt;initialize config:type="boolean"&gt;true&lt;/initialize&gt;
    &lt;partitions config:type="list"&gt;
      &lt;partition&gt;
        &lt;filesystem config:type="symbol"&gt;ext3&lt;/filesystem&gt;
        &lt;format config:type="boolean"&gt;true&lt;/format&gt;
        &lt;fs_options&gt;
          &lt;opt_bytes_per_inode&gt;
            &lt;option_str&gt;-i&lt;/option_str&gt;
            &lt;option_value&gt;8192&lt;/option_value&gt;
          &lt;/opt_bytes_per_inode&gt;
          &lt;opt_inode_density&gt;
            &lt;option_str&gt;-I&lt;/option_str&gt;
            &lt;option_value&gt;128&lt;/option_value&gt;
          &lt;/opt_inode_density&gt;
        &lt;/fs_options&gt;
        &lt;mount&gt;/&lt;/mount&gt;
        &lt;partition_id config:type="integer"&gt;131&lt;/partition_id&gt;
        &lt;partition_type&gt;primary&lt;/partition_type&gt;
        &lt;size&gt;25G&lt;/size&gt;
      &lt;/partition&gt;
    &lt;/partitions&gt;
  &lt;/drive&gt;
&lt;partitioning&gt;</pre></div></li></ul></div><p>
    For information, see
    <a class="link" href="http://www.suse.com/support/kb/doc.php?id=7009075" target="_blank">http://www.suse.com/support/kb/doc.php?id=7009075</a>
    (<em class="citetitle ">SLES11 ext3 partitions can only store 50% of the files that can
    be stored on SLES10</em> [Technical Information Document 7009075]).
   </p></div></div><div class="sect1 " id="sec.filesystems.major.ext4"><div class="titlepage"><div><div><h2 class="title" id="sec.filesystems.major.ext4"><span class="number">1.6 </span><span class="name">Ext4</span> <a title="Permalink" class="permalink" href="#sec.filesystems.major.ext4">#</a></h2></div></div></div><p>
   In 2006, Ext4 started as a fork from Ext3. It eliminates some storage
   limitations of Ext3 by supporting volumes with a size of up to 1 exbibyte,
   files with a size of up to 16 tebibytes and an unlimited number of
   subdirectories. It also introduces several performance enhancements such as
   delayed block allocation and a much faster file system checking routine.
   Ext4 is also more reliable by supporting journal checksums and by providing
   time stamps measured in nanoseconds. Ext4 is fully backward compatible to
   Ext2 and Ext3—both file systems can be mounted as Ext4.
  </p></div><div class="sect1 " id="sec.filesystems.major.reiser"><div class="titlepage"><div><div><h2 class="title" id="sec.filesystems.major.reiser"><span class="number">1.7 </span><span class="name">ReiserFS</span> <a title="Permalink" class="permalink" href="#sec.filesystems.major.reiser">#</a></h2></div></div></div><p>
   ReiserFS support was completely removed with <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> 15. To migrate
   your existing partitions to Btrfs, refer to <a class="xref" href="#sec.filesystems.major.btrfs.migrate" title="1.2.3. Migration from ReiserFS and Ext File Systems to Btrfs">Section 1.2.3, “Migration from ReiserFS and Ext File Systems to Btrfs”</a>.
  </p></div><div class="sect1 " id="sec.filesystems.other"><div class="titlepage"><div><div><h2 class="title" id="sec.filesystems.other"><span class="number">1.8 </span><span class="name">Other Supported File Systems</span> <a title="Permalink" class="permalink" href="#sec.filesystems.other">#</a></h2></div></div></div><p class="intro">
   <a class="xref" href="#tab.filesystems.other" title="File System Types in Linux">Table 1.1, “File System Types in Linux”</a> summarizes
   some other file systems supported by Linux. They are supported mainly to
   ensure compatibility and interchange of data with different kinds of media
   or foreign operating systems.
  </p><div class="table" id="tab.filesystems.other"><div class="table-title-wrap"><h6 class="table-title"><span class="number">Table 1.1: </span><span class="name">File System Types in Linux </span><a title="Permalink" class="permalink" href="#tab.filesystems.other">#</a></h6></div><div class="table-contents"><table summary="File System Types in Linux" border="1"><colgroup><col class="1" /><col class="2" /></colgroup><thead><tr><th>
       <p>
        File System Type
       </p>
      </th><th>
       <p>
        Description
       </p>
      </th></tr></thead><tbody><tr><td>
       <p>
        <code class="systemitem">cramfs</code>
       </p>
      </td><td>
       <p>
        Compressed ROM file system: A compressed read-only file system for
        ROMs.
       </p>
      </td></tr><tr><td>
       <p>
        <code class="systemitem">hpfs</code>
       </p>
      </td><td>
       <p>
        High Performance File System: The IBM OS/2 standard file system. Only
        supported in read-only mode.
       </p>
      </td></tr><tr><td>
       <p>
        <code class="systemitem">iso9660</code>
       </p>
      </td><td>
       <p>
        Standard file system on CD-ROMs.
       </p>
      </td></tr><tr><td>
       <p>
        <code class="systemitem">minix</code>
       </p>
      </td><td>
       <p>
        This file system originated from academic projects on operating systems
        and was the first file system used in Linux. Today, it is used as a
        file system for floppy disks.
       </p>
      </td></tr><tr><td>
       <p>
        <code class="systemitem">msdos</code>
       </p>
      </td><td>
       <p>
        <code class="filename">fat</code>, the file system originally used by DOS, is
        today used by various operating systems.
       </p>
      </td></tr><tr><td>
       <p>
        <code class="systemitem">nfs</code>
       </p>
      </td><td>
       <p>
        Network File System: Here, data can be stored on any machine in a
        network and access might be granted via a network.
       </p>
      </td></tr><tr><td>
       <p>
        <code class="systemitem">ntfs</code>
       </p>
      </td><td>
       <p>
        Windows NT file system; read-only.
       </p>
      </td></tr><tr><td>
       <p>
        <code class="systemitem">smbfs</code>
       </p>
      </td><td>
       <p>
        Server Message Block is used by products such as Windows to enable file
        access over a network.
       </p>
      </td></tr><tr><td>
       <p>
        <code class="systemitem">sysv</code>
       </p>
      </td><td>
       <p>
        Used on SCO Unix, Xenix, and Coherent (commercial Unix systems for
        PCs).
       </p>
      </td></tr><tr><td>
       <p>
        <code class="systemitem">ufs</code>
       </p>
      </td><td>
       <p>
        Used by BSD, SunOS, and NextStep. Only supported in read-only mode.
       </p>
      </td></tr><tr><td>
       <p>
        <code class="systemitem">umsdos</code>
       </p>
      </td><td>
       <p>
        Unix on MS-DOS: Applied on top of a standard <code class="filename">fat</code>
        file system, achieves Unix functionality (permissions, links, long file
        names) by creating special files.
       </p>
      </td></tr><tr><td>
       <p>
        <code class="systemitem">vfat</code>
       </p>
      </td><td>
       <p>
        Virtual FAT: Extension of the <code class="literal">fat</code> file system
        (supports long file names).
       </p>
      </td></tr></tbody></table></div></div></div><div class="sect1 " id="sec.filesystems.lfs"><div class="titlepage"><div><div><h2 class="title" id="sec.filesystems.lfs"><span class="number">1.9 </span><span class="name">Large File Support in Linux</span> <a title="Permalink" class="permalink" href="#sec.filesystems.lfs">#</a></h2></div></div></div><p>
   Originally, Linux supported a maximum file size of 2 GiB
   (2<sup>31</sup> bytes). Unless a file system comes with
   large file support, the maximum file size on a 32-bit system is 2 GiB.
  </p><p>
   Currently, all of our standard file systems have LFS (large file support),
   which gives a maximum file size of 2<sup>63</sup> bytes in
   theory. <a class="xref" href="#tab.filesystems.maxsize" title="Maximum Sizes of Files and File Systems (On-Disk Format, 4 KiB Block Size)">Table 1.2, “Maximum Sizes of Files and File Systems (On-Disk Format, 4 KiB Block Size)”</a>
   offers an overview of the current on-disk format limitations of Linux files
   and file systems. The numbers in the table assume that the file systems are
   using 4 KiB block size, which is a common standard. When using different
   block sizes, the results are different. The maximum file sizes in
   <a class="xref" href="#tab.filesystems.maxsize" title="Maximum Sizes of Files and File Systems (On-Disk Format, 4 KiB Block Size)">Table 1.2, “Maximum Sizes of Files and File Systems (On-Disk Format, 4 KiB Block Size)”</a> can be
   larger than the file system's actual size when using sparse blocks.
  </p><div id="idm139787672080224" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.png" /><h6>Note: Binary Multiples</h6><p>
    In this document: 1024 Bytes = 1 KiB; 1024 KiB = 1 MiB; 1024 MiB = 1 GiB;
    1024 GiB = 1 TiB; 1024 TiB = 1 PiB; 1024 PiB = 1 EiB (see also
    <a class="link" href="http://physics.nist.gov/cuu/Units/binary.html" target="_blank"><em class="citetitle ">NIST:
    Prefixes for Binary Multiples</em></a>.
   </p></div><div class="table" id="tab.filesystems.maxsize"><div class="table-title-wrap"><h6 class="table-title"><span class="number">Table 1.2: </span><span class="name">Maximum Sizes of Files and File Systems (On-Disk Format, 4 KiB Block Size) </span><a title="Permalink" class="permalink" href="#tab.filesystems.maxsize">#</a></h6></div><div class="table-contents"><table summary="Maximum Sizes of Files and File Systems (On-Disk Format, 4 KiB Block Size)" border="1"><colgroup><col class="1" /><col class="2" /><col class="3" /></colgroup><thead><tr><th>
       <p>
        File System (4 KiB Block Size)
       </p>
      </th><th>
       <p>
        Maximum File System Size
       </p>
      </th><th>
       <p>
        Maximum File Size
       </p>
      </th></tr></thead><tbody><tr><td>
       <p>
        Btrfs
       </p>
      </td><td>
       <p>
        16 EiB
       </p>
      </td><td>
       <p>
        16 EiB
       </p>
      </td></tr><tr><td>
       <p>
        Ext3
       </p>
      </td><td>
       <p>
        16 TiB
       </p>
      </td><td>
       <p>
        2 TiB
       </p>
      </td></tr><tr><td>
       <p>
        Ext4
       </p>
      </td><td>
       <p>
        1 EiB
       </p>
      </td><td>
       <p>
        16 TiB
       </p>
      </td></tr><tr><td>
       <p>
        OCFS2 (a cluster-aware file system available in the High Availability
        Extension)
       </p>
      </td><td>
       <p>
        16 TiB
       </p>
      </td><td>
       <p>
        1 EiB
       </p>
      </td></tr><tr><td>
       <p>
        XFS
       </p>
      </td><td>
       <p>
        8 EiB
       </p>
      </td><td>
       <p>
        8 EiB
       </p>
      </td></tr><tr><td>
       <p>
        NFSv2 (client side)
       </p>
      </td><td>
       <p>
        8 EiB
       </p>
      </td><td>
       <p>
        2 GiB
       </p>
      </td></tr><tr><td>
       <p>
        NFSv3/NFSv4 (client side)
       </p>
      </td><td>
       <p>
        8 EiB
       </p>
      </td><td>
       <p>
        8 EiB
       </p>
      </td></tr></tbody></table></div></div><div id="idm139787672123008" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.png" /><h6>Important: Limitations</h6><p>
    <a class="xref" href="#tab.filesystems.maxsize" title="Maximum Sizes of Files and File Systems (On-Disk Format, 4 KiB Block Size)">Table 1.2, “Maximum Sizes of Files and File Systems (On-Disk Format, 4 KiB Block Size)”</a> describes
    the limitations regarding the on-disk format. The Linux kernel imposes its
    own limits on the size of files and file systems handled by it. These are
    as follows:
   </p><div class="variablelist "><dl class="variablelist"><dt id="idm139787672120528"><span class="term ">File Size</span></dt><dd><p>
       On 32-bit systems, files cannot exceed 2 TiB
       (2<sup>41</sup> bytes).
      </p></dd><dt id="idm139787672118240"><span class="term ">File System Size</span></dt><dd><p>
       File systems can be up to 2<sup>73</sup> bytes in size.
       However, this limit is still out of reach for the currently available
       hardware.
      </p></dd></dl></div></div></div><div class="sect1 " id="sect.filesystems.stor_limits"><div class="titlepage"><div><div><h2 class="title" id="sect.filesystems.stor_limits"><span class="number">1.10 </span><span class="name">Linux Kernel Storage Limitations</span> <a title="Permalink" class="permalink" href="#sect.filesystems.stor_limits">#</a></h2></div></div></div><p>
   <a class="xref" href="#tab.filesystems.stor_limits" title="Storage Limitations">Table 1.3, “Storage Limitations”</a>
   summarizes the kernel limits for storage associated with <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span>.
  </p><div class="table" id="tab.filesystems.stor_limits"><div class="table-title-wrap"><h6 class="table-title"><span class="number">Table 1.3: </span><span class="name">Storage Limitations </span><a title="Permalink" class="permalink" href="#tab.filesystems.stor_limits">#</a></h6></div><div class="table-contents"><table summary="Storage Limitations" border="1"><colgroup><col class="1" /><col class="2" /></colgroup><thead><tr><th>
       <p>
        Storage Feature
       </p>
      </th><th>
       <p>
        Limitation
       </p>
      </th></tr></thead><tbody><tr><td>
       <p>
        Maximum number of LUNs supported
       </p>
      </td><td>
       <p>
        16384 LUNs per target.
       </p>
      </td></tr><tr><td>
       <p>
        Maximum number of paths per single LUN
       </p>
      </td><td>
       <p>
        No limit by default. Each path is treated as a normal LUN.
       </p>
       <p>
        The actual limit is given by the number of LUNs per target and the
        number of targets per HBA (16777215 for a Fibre Channel HBA).
       </p>
      </td></tr><tr><td>
       <p>
        Maximum number of HBAs
       </p>
      </td><td>
       <p>
        Unlimited. The actual limit is determined by the amount of PCI slots of
        the system.
       </p>
      </td></tr><tr><td>
       <p>
        Maximum number of paths with device-mapper-multipath (in total) per
        operating system
       </p>
      </td><td>
       <p>
        Approximately 1024. The actual number depends on the length of the
        device number strings. It is a compile-time variable within
        multipath-tools, which can be raised if this limit poses a problem.
       </p>
      </td></tr><tr><td>
       <p>
        Maximum size per block device
       </p>
      </td><td>
       <p>
        Up to 8 EiB.
       </p>
      </td></tr></tbody></table></div></div></div><div class="sect1 " id="sect.filesystems.trouble"><div class="titlepage"><div><div><h2 class="title" id="sect.filesystems.trouble"><span class="number">1.11 </span><span class="name">Troubleshooting File Systems</span> <a title="Permalink" class="permalink" href="#sect.filesystems.trouble">#</a></h2></div></div></div><p>
   This section describes some known issues and possible solutions for file
   systems.
  </p><div class="sect2 " id="sect.filesystems.trouble.btrfs_volfull"><div class="titlepage"><div><div><h3 class="title" id="sect.filesystems.trouble.btrfs_volfull"><span class="number">1.11.1 </span><span class="name">Btrfs Error: No space is left on device</span> <a title="Permalink" class="permalink" href="#sect.filesystems.trouble.btrfs_volfull">#</a></h3></div></div></div><p>
    The root (<code class="filename">/</code>) partition using the Btrfs file system
    stops accepting data. You receive the error <span class="quote">“<span class="quote"><code class="literal">No space left
    on device</code></span>”</span>.
   </p><p>
    See the following sections for information about possible causes and
    prevention of this issue.
   </p><div class="sect3 " id="sect.filesystems.trouble.btrfs_volfull.snapshots"><div class="titlepage"><div><div><h4 class="title" id="sect.filesystems.trouble.btrfs_volfull.snapshots"><span class="number">1.11.1.1 </span><span class="name">Disk Space Consumed by Snapper Snapshots</span> <a title="Permalink" class="permalink" href="#sect.filesystems.trouble.btrfs_volfull.snapshots">#</a></h4></div></div></div><p>
     If Snapper is running for the Btrfs file system, the <span class="quote">“<span class="quote"><code class="literal">No
     space left on device</code></span>”</span> problem is typically caused by
     having too much data stored as snapshots on your system.
    </p><p>
     You can remove some snapshots from Snapper, however, the snapshots are not
     deleted immediately and might not free up as much space as you need.
    </p><p>
     To delete files from Snapper:
    </p><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
       Open a terminal console.
      </p></li><li class="step "><p>
       At the command prompt, enter <code class="command">btrfs filesystem show</code>,
       for example:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> btrfs filesystem show
Label: none uuid: 40123456-cb2c-4678-8b3d-d014d1c78c78
 Total devices 1 FS bytes used 20.00GB
 devid 1 size 20.00GB used 20.00GB path /dev/sda3</pre></div></li><li class="step "><p>
       Enter
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> btrfs fi balance start <em class="replaceable ">MOUNTPOINT</em> -dusage=5</pre></div><p>
       This command attempts to relocate data in empty or near-empty data
       chunks, allowing the space to be reclaimed and reassigned to metadata.
       This can take a while (many hours for 1 TB) although the system is
       otherwise usable during this time.
      </p></li><li class="step "><p>
       List the snapshots in Snapper. Enter
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> snapper -c root list</pre></div></li><li class="step "><p>
       Delete one or more snapshots from Snapper. Enter
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> snapper -c root delete <em class="replaceable ">SNAPSHOT_NUMBER(S)</em></pre></div><p>
       Ensure that you delete the oldest snapshots first. The older a snapshot
       is, the more disk space it occupies.
      </p></li></ol></div></div><p>
     To help prevent this problem, you can change the Snapper cleanup
     algorithms. See <span class="intraxref">Book “<em class="citetitle ">Administration Guide</em>”, Chapter 7 “System Recovery and Snapshot Management with Snapper”, Section 7.5.1.2 “Cleanup-algorithms”</span> for
     details. The configuration values controlling snapshot cleanup are
     <code class="envar">EMPTY_*</code>, <code class="envar">NUMBER_*</code>, and
     <code class="envar">TIMELINE_*</code>.
    </p><p>
     If you use Snapper with Btrfs on the file system disk, it is advisable to
     reserve twice the amount of disk space than the standard storage proposal.
     The YaST Partitioner automatically proposes twice the standard disk
     space in the Btrfs storage proposal for the root file system.
    </p></div><div class="sect3 " id="sect.filesystems.trouble.btrfs_volfull.var"><div class="titlepage"><div><div><h4 class="title" id="sect.filesystems.trouble.btrfs_volfull.var"><span class="number">1.11.1.2 </span><span class="name">Disk Space Consumed by Log, Crash, and Cache Files</span> <a title="Permalink" class="permalink" href="#sect.filesystems.trouble.btrfs_volfull.var">#</a></h4></div></div></div><p>
     If the system disk is filling up with data, you can try deleting files
     from <code class="filename">/var/log</code>, <code class="filename">/var/crash</code>,
     <code class="filename">/var/lib/systemd/coredump</code> and
     <code class="filename">/var/cache</code>.
    </p><p>
     The Btrfs <code class="systemitem">root</code> file system subvolumes <code class="filename">/var/log</code>,
     <code class="filename">/var/crash</code> and <code class="filename">/var/cache</code> can
     use all of the available disk space during normal operation, and cause a
     system malfunction. To help avoid this situation, <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> offers
     Btrfs quota support for subvolumes. See
     <a class="xref" href="#sec.filesystems.major.btrfs.quota" title="1.2.5. Btrfs Quota Support for Subvolumes">Section 1.2.5, “Btrfs Quota Support for Subvolumes”</a> for details.
    </p><p>
     On test and development machines, especially if you have frequent crashes
     of applications, you may also want to have a look at
     <code class="filename">/var/lib/systemd/coredump</code> where the coredumps are
     stored.
    </p></div></div><div class="sect2 " id="sect.filesystems.trouble.trim"><div class="titlepage"><div><div><h3 class="title" id="sect.filesystems.trouble.trim"><span class="number">1.11.2 </span><span class="name">Freeing Unused File System Blocks</span> <a title="Permalink" class="permalink" href="#sect.filesystems.trouble.trim">#</a></h3></div></div></div><p>
    On solid-state drives (SSDs) and thinly provisioned volumes it is useful to
    trim blocks not in use by the file system. <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> fully supports
    <code class="literal">unmap</code> or <code class="literal">trim</code> operations on all file
    systems supporting these methods.
   </p><p>
    The recommended way to trim a supported file system (except Btrfs) on
    <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> is to run <code class="command">/sbin/wiper.sh</code>. Make sure to read
    <code class="filename">/usr/share/doc/packages/hdparm/README.wiper</code> before
    running this script. For most desktop and server systems the sufficient
    trimming frequency is once a week. Mounting a file system with <code class="option">-o
     discard</code> comes with a performance penalty and may negatively affect
    the lifetime of SSDs and is not recommended.
   </p><div id="idm139787671507376" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.png" /><h6>Warning: Do Not Use <code class="command">wiper.sh</code> on Btrfs</h6><p>
     The <code class="command">wiper.sh</code> script trims read-write mounted ext4 and
     xfs file systems, and for read-only mounted/unmounted ext2, ext3, ext4, and
     xfs file systems. Do <span class="emphasis"><em>not</em></span> use
     <code class="command">wiper.sh</code> on the Btrfs file system as it may damage your
     data. Instead, use
     <code class="command">/usr/share/btrfsmaintenance/btrfs-trim.sh</code> which is part
     of the <code class="systemitem">btrfsmaintenance</code> package.
    </p></div></div></div><div class="sect1 " id="sec_filesystems_info"><div class="titlepage"><div><div><h2 class="title" id="sec_filesystems_info"><span class="number">1.12 </span><span class="name">Additional Information</span> <a title="Permalink" class="permalink" href="#sec_filesystems_info">#</a></h2></div></div></div><p>
   Each of the file system projects described above maintains its own home page
   on which to find mailing list information, further documentation, and FAQs:
  </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
     The Btrfs Wiki on Kernel.org:
     <a class="link" href="https://btrfs.wiki.kernel.org/" target="_blank">https://btrfs.wiki.kernel.org/</a>
    </p></li><li class="listitem "><p>
     E2fsprogs: Ext2/3/4 File System Utilities:
     <a class="link" href="http://e2fsprogs.sourceforge.net/" target="_blank">http://e2fsprogs.sourceforge.net/</a>
    </p></li><li class="listitem "><p>
     Introducing Ext3:
     <a class="link" href="http://www.ibm.com/developerworks/linux/library/l-fs7/" target="_blank">http://www.ibm.com/developerworks/linux/library/l-fs7/</a>
    </p></li><li class="listitem "><p>
     XFS: A High-Performance Journaling File System:
     <a class="link" href="http://oss.sgi.com/projects/xfs/" target="_blank">http://oss.sgi.com/projects/xfs/</a>
    </p></li><li class="listitem "><p>
     The OCFS2 Project:
     <a class="link" href="http://oss.oracle.com/projects/ocfs2/" target="_blank">http://oss.oracle.com/projects/ocfs2/</a>
    </p></li></ul></div><p>
   A comprehensive multi-part tutorial about Linux file systems can be found at
   IBM developerWorks in the <em class="citetitle ">Advanced File System
   Implementor’s Guide</em>
   (<a class="link" href="https://www.ibm.com/developerworks/linux/library/l-fs/" target="_blank">https://www.ibm.com/developerworks/linux/library/l-fs/</a>).
  </p><p>
   An in-depth comparison of file systems (not only Linux file systems) is
   available from the Wikipedia project in Comparison of File Systems
   (<a class="link" href="http://en.wikipedia.org/wiki/Comparison_of_file_systems#Comparison" target="_blank">http://en.wikipedia.org/wiki/Comparison_of_file_systems#Comparison</a>).
  </p></div></div><div xml:lang="en" class="chapter " id="cha.resize_fs" lang="en"><div class="titlepage"><div><div><h2 class="title"><span class="number">2 </span><span class="name">Resizing File Systems</span> <a title="Permalink" class="permalink" href="#cha.resize_fs">#</a></h2><div class="doc-status"><ul><li><span class="ds-label">Filename: </span>storage_fs-resizing.xml</li><li><span class="ds-label">ID: </span>cha.resize_fs</li></ul></div></div></div></div><div class="line"><div class="toc"><dl><dt><span class="sect1"><a href="#sec.resize_fs.usecases"><span class="number">2.1 </span><span class="name">Use Cases</span></a></span></dt><dt><span class="sect1"><a href="#sec.resize_fs.guidelines"><span class="number">2.2 </span><span class="name">Guidelines for Resizing</span></a></span></dt><dt><span class="sect1"><a href="#sec.resize_fs.btrfs"><span class="number">2.3 </span><span class="name">Changing the Size of a Btrfs File System</span></a></span></dt><dt><span class="sect1"><a href="#sec.resize_fs.xfs"><span class="number">2.4 </span><span class="name">Changing the Size of an XFS File System</span></a></span></dt><dt><span class="sect1"><a href="#sec.resize_fs.ext"><span class="number">2.5 </span><span class="name">Changing the Size of an Ext2, Ext3, or Ext4 File System</span></a></span></dt></dl></div></div><p>
  Resizing file systems—not to be confused with resizing partitions or
  volumes—can be used to make space available on physical volumes or to
  use additional space available on a physical volume.
 </p><div class="sect1 " id="sec.resize_fs.usecases"><div class="titlepage"><div><div><h2 class="title" id="sec.resize_fs.usecases"><span class="number">2.1 </span><span class="name">Use Cases</span> <a title="Permalink" class="permalink" href="#sec.resize_fs.usecases">#</a></h2></div></div></div><p>
   It is strongly recommended to use the YaST Partitioner to resize
   partitions or logical volumes. When doing so, the file system will
   automatically be adjusted to the new size of the partition or volume.
   However, there are some cases where you need to resize the file system
   manually, because they are not supported by YaST:
  </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
     After having resized a virtual disk of a VM Guest.
    </p></li><li class="listitem "><p>
     After having resized a volume from a network-attached storage.
    </p></li><li class="listitem "><p>
     After having manually resized partitions (for example by using
     <code class="command">fdisk</code> or <code class="command">parted</code>) or logical volumes
     (for example by using <code class="command">lvresize</code>).
    </p></li><li class="listitem "><p>
     When wanting to shrink Btrfs file systems (as of <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> 12, YaST
     only supports growing Btrfs file systems).
    </p></li></ul></div></div><div class="sect1 " id="sec.resize_fs.guidelines"><div class="titlepage"><div><div><h2 class="title" id="sec.resize_fs.guidelines"><span class="number">2.2 </span><span class="name">Guidelines for Resizing</span> <a title="Permalink" class="permalink" href="#sec.resize_fs.guidelines">#</a></h2></div></div></div><p>
   Resizing any file system involves some risks that can potentially result in
   losing data.
  </p><div id="idm139787671473072" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.png" /><h6>Warning: Back Up your Data</h6><p>
    To avoid data loss, ensure that you back up your data before you begin any
    resizing task.
   </p></div><p>
   Consider the following guidelines when planning to resize a file system.
  </p><div class="sect2 " id="sec.resize_fs.guidelines.support"><div class="titlepage"><div><div><h3 class="title" id="sec.resize_fs.guidelines.support"><span class="number">2.2.1 </span><span class="name">File Systems that Support Resizing</span> <a title="Permalink" class="permalink" href="#sec.resize_fs.guidelines.support">#</a></h3></div></div></div><p>
    The file system must support resizing to take advantage of increases in
    available space for the volume. In <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span>, file system resizing
    utilities are available for file systems Ext2, Ext3, and Ext4.
    The utilities support increasing and decreasing the size as follows:
   </p><div class="table" id="idm139787671468144"><div class="table-title-wrap"><h6 class="table-title"><span class="number">Table 2.1: </span><span class="name">File System Support for Resizing </span><a title="Permalink" class="permalink" href="#idm139787671468144">#</a></h6></div><div class="table-contents"><table summary="File System Support for Resizing" border="1"><colgroup><col class="1" /><col class="2" /><col class="3" /><col class="4" /></colgroup><thead><tr><th>
        <p>
         File System
        </p>
       </th><th>
        <p>
         Utility
        </p>
       </th><th>
        <p>
         Increase Size (Grow)
        </p>
       </th><th>
        <p>
         Decrease Size (Shrink)
        </p>
       </th></tr></thead><tbody><tr><td>
        <p>
         Btrfs
        </p>
       </td><td>
        <p>
         <code class="command">btrfs filesystem resize</code>
        </p>
       </td><td>
        <p>
         Online
        </p>
       </td><td>
        <p>
         Online
        </p>
       </td></tr><tr><td>
        <p>
         XFS
        </p>
       </td><td>
        <p>
         <code class="command">xfs_growfs</code>
        </p>
       </td><td>
        <p>
         Online
        </p>
       </td><td>
        <p>
         Not supported
        </p>
       </td></tr><tr><td>
        <p>
         Ext2
        </p>
       </td><td>
        <p>
         <code class="command">resize2fs</code>
        </p>
       </td><td>
        <p>
         Online or offline
        </p>
       </td><td>
        <p>
         Offline only
        </p>
       </td></tr><tr><td>
        <p>
         Ext3
        </p>
       </td><td>
        <p>
         <code class="command">resize2fs</code>
        </p>
       </td><td>
        <p>
         Online or offline
        </p>
       </td><td>
        <p>
         Offline only
        </p>
       </td></tr><tr><td>
        <p>
         Ext4
        </p>
       </td><td>
        <p>
         <code class="command">resize2fs</code>
        </p>
       </td><td>
        <p>
         Online or offline
        </p>
       </td><td>
        <p>
         Offline only
        </p>
       </td></tr></tbody></table></div></div></div><div class="sect2 " id="sec.resize_fs.guidelines.increase"><div class="titlepage"><div><div><h3 class="title" id="sec.resize_fs.guidelines.increase"><span class="number">2.2.2 </span><span class="name">Increasing the Size of a File System</span> <a title="Permalink" class="permalink" href="#sec.resize_fs.guidelines.increase">#</a></h3></div></div></div><p>
    You can grow a file system to the maximum space available on the device, or
    specify an exact size. Ensure that you grow the size of the device or
    logical volume before you attempt to increase the size of the file system.
   </p><p>
    When specifying an exact size for the file system, ensure that the new size
    satisfies the following conditions:
   </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
      The new size must be greater than the size of the existing data;
      otherwise, data loss occurs.
     </p></li><li class="listitem "><p>
      The new size must be equal to or less than the current device size
      because the file system size cannot extend beyond the space available.
     </p></li></ul></div></div><div class="sect2 " id="sec.resize_fs.guidelines.decrease"><div class="titlepage"><div><div><h3 class="title" id="sec.resize_fs.guidelines.decrease"><span class="number">2.2.3 </span><span class="name">Decreasing the Size of a File System</span> <a title="Permalink" class="permalink" href="#sec.resize_fs.guidelines.decrease">#</a></h3></div></div></div><p>
    When decreasing the size of the file system on a device, ensure that the
    new size satisfies the following conditions:
   </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
      The new size must be greater than the size of the existing data;
      otherwise, data loss occurs.
     </p></li><li class="listitem "><p>
      The new size must be equal to or less than the current device size
      because the file system size cannot extend beyond the space available.
     </p></li></ul></div><p>
    If you plan to also decrease the size of the logical volume that holds the
    file system, ensure that you decrease the size of the file system before
    you attempt to decrease the size of the device or logical volume.
   </p><div id="idm139787671847824" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.png" /><h6>Important: XFS</h6><p>
     Decreasing the size of a file system formatted with XFS is not possible,
     since such a feature is not supported by XFS.
    </p></div></div></div><div class="sect1 " id="sec.resize_fs.btrfs"><div class="titlepage"><div><div><h2 class="title" id="sec.resize_fs.btrfs"><span class="number">2.3 </span><span class="name">Changing the Size of a Btrfs File System</span> <a title="Permalink" class="permalink" href="#sec.resize_fs.btrfs">#</a></h2></div></div></div><p>
   The size of a Btrfs file system can be changed by using the <code class="command">btrfs
   filesystem resize</code> command when the file system is mounted.
   Increasing and decreasing the size are both supported while the file system
   is mounted.
  </p><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
     Open a terminal console.
    </p></li><li class="step "><p>
     Make sure the file system you want to change is mounted.
    </p></li><li class="step "><p>
     Change the size of the file system using the <code class="command">btrfs filesystem
     resize</code> command with one of the following methods:
    </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
       To extend the file system size to the maximum available size of the
       device, enter
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> btrfs filesystem resize max /mnt</pre></div></li><li class="listitem "><p>
       To extend the file system to a specific size, enter
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> btrfs filesystem resize <em class="replaceable ">SIZE</em> /mnt</pre></div><p>
       Replace <em class="replaceable ">SIZE</em> with the desired size in bytes.
       You can also specify units on the value, such as 50000K (kilobytes),
       250M (megabytes), or 2G (gigabytes). Alternatively, you can specify an
       increase or decrease to the current size by prefixing the value with a
       plus (<code class="literal">+</code>) or a minus (<code class="literal">-</code>) sign,
       respectively:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> btrfs filesystem resize +<em class="replaceable ">SIZE</em> /mnt
sudo btrfs filesystem resize -<em class="replaceable ">SIZE</em> /mnt</pre></div></li></ul></div></li><li class="step "><p>
     Check the effect of the resize on the mounted file system by entering
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code>df -h</pre></div><p>
     The Disk Free (<code class="command">df</code>) command shows the total size of the
     disk, the number of blocks used, and the number of blocks available on the
     file system. The -h option prints sizes in human-readable format, such as
     1K, 234M, or 2G.
    </p></li></ol></div></div></div><div class="sect1 " id="sec.resize_fs.xfs"><div class="titlepage"><div><div><h2 class="title" id="sec.resize_fs.xfs"><span class="number">2.4 </span><span class="name">Changing the Size of an XFS File System</span> <a title="Permalink" class="permalink" href="#sec.resize_fs.xfs">#</a></h2></div></div></div><p>
   The size of an XFS file system can be increased by using the
   <code class="command">xfs_growfs</code> command when the file system is mounted.
   Reducing the size of an XFS file system is not possible.
  </p><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
     Open a terminal console.
    </p></li><li class="step "><p>
     Make sure the file system you want to change is mounted.
    </p></li><li class="step "><p>
     Increase the size of the file system using the
     <code class="command">xfs_growfs</code> command. The following example expands the
     size of the file system to the maximum value available. See <code class="command">man 8
     xfs_growfs</code> for more options.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> xfs_growfs -d /mnt</pre></div></li><li class="step "><p>
     Check the effect of the resize on the mounted file system by entering
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code>df -h</pre></div><p>
     The Disk Free (<code class="command">df</code>) command shows the total size of the
     disk, the number of blocks used, and the number of blocks available on the
     file system. The -h option prints sizes in human-readable format, such as
     1K, 234M, or 2G.
    </p></li></ol></div></div></div><div class="sect1 " id="sec.resize_fs.ext"><div class="titlepage"><div><div><h2 class="title" id="sec.resize_fs.ext"><span class="number">2.5 </span><span class="name">Changing the Size of an Ext2, Ext3, or Ext4 File System</span> <a title="Permalink" class="permalink" href="#sec.resize_fs.ext">#</a></h2></div></div></div><p>
   The size of Ext2, Ext3, and Ext4 file systems can be increased by using the
   <code class="command">resize2fs</code> command, regardless of whether the respective
   partition is mounted or not. To decrease the size of an Ext file system it
   needs to be unmounted.
  </p><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
     Open a terminal console.
    </p></li><li class="step "><p>
     If the file system size should be decreased, unmount it.
    </p></li><li class="step "><p>
     Change the size of the file system using one of the following methods:
    </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
       To extend the file system size to the maximum available size of the
       device called <code class="filename">/dev/sda1</code>, enter
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> resize2fs /dev/sda1</pre></div><p>
       If a size parameter is not specified, the size defaults to the size of
       the partition.
      </p></li><li class="listitem "><p>
       To change the file system to a specific size, enter
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> resize2fs /dev/sda1 <em class="replaceable ">SIZE</em></pre></div><p>
       The <em class="replaceable ">SIZE</em> parameter specifies the requested
       new size of the file system. If no units are specified, the unit of the
       size parameter is the block size of the file system. Optionally, the
       size parameter can be suffixed by one of the following unit designators:
       <code class="literal">s</code> for 512 byte sectors; <code class="literal">K</code> for
       kilobytes (1 kilobyte is 1024 bytes); <code class="literal">M</code> for
       megabytes; or <code class="literal">G</code> for gigabytes.
      </p></li></ul></div><p>
     Wait until the resizing is completed before continuing.
    </p></li><li class="step "><p>
     If the file system is not mounted, mount it now.
    </p></li><li class="step "><p>
     Check the effect of the resize on the mounted file system by entering
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code>df -h</pre></div><p>
     The Disk Free (<code class="command">df</code>) command shows the total size of the
     disk, the number of blocks used, and the number of blocks available on the
     file system. The -h option prints sizes in human-readable format, such as
     1K, 234M, or 2G.
    </p></li></ol></div></div></div></div><div xml:lang="en" class="chapter " id="cha.uuid" lang="en"><div class="titlepage"><div><div><h2 class="title"><span class="number">3 </span><span class="name">Using UUIDs to Mount Devices</span> <a title="Permalink" class="permalink" href="#cha.uuid">#</a></h2><div class="doc-status"><ul><li><span class="ds-label">Filename: </span>storage_uuids.xml</li><li><span class="ds-label">ID: </span>cha.uuid</li></ul></div></div></div></div><div class="line"><div class="toc"><dl><dt><span class="sect1"><a href="#sec.uuid.udev"><span class="number">3.1 </span><span class="name">Persistent Device Names with udev</span></a></span></dt><dt><span class="sect1"><a href="#sec.uuid.understanduuid"><span class="number">3.2 </span><span class="name">Understanding UUIDs</span></a></span></dt><dt><span class="sect1"><a href="#sec.uuid.moreinfo"><span class="number">3.3 </span><span class="name">Additional Information</span></a></span></dt></dl></div></div><p>
  This section describes the use of UUIDs (Universally Unique Identifiers)
  instead of device names (such as <code class="filename">/dev/sda1</code>) to identify
  file system devices. Starting with <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> 12, UUIDs are used by
  default in the boot loader file and the <code class="filename">/etc/fstab</code> file.
 </p><div class="sect1 " id="sec.uuid.udev"><div class="titlepage"><div><div><h2 class="title" id="sec.uuid.udev"><span class="number">3.1 </span><span class="name">Persistent Device Names with udev</span> <a title="Permalink" class="permalink" href="#sec.uuid.udev">#</a></h2></div></div></div><p>
   Starting with Linux kernel 2.6, <code class="command">udev</code> provides a user
   space solution for
   the dynamic <code class="filename">/dev</code> directory, with persistent device
   naming. As part of the hotplug system, <code class="command">udev</code> is executed
   if a device is added to or removed from the system.
  </p><p>
   A list of rules is used to match against specific device attributes. The
   <code class="command">udev</code> rules infrastructure (defined in the
   <code class="filename">/etc/udev/rules.d</code> directory) provides stable names for
   all disk devices, regardless of their order of recognition or the connection
   used for the device. The <code class="command">udev</code> tools examine every
   appropriate block device that the kernel creates to apply naming rules based
   on certain buses, drive types, or file systems. For information about how to
   define your own rules for <code class="command">udev</code>, see
   <a class="link" href="http://reactivated.net/writing_udev_rules.html" target="_blank"><em class="citetitle ">Writing
   udev Rules</em></a>.
  </p><p>
   Along with the dynamic kernel-provided device node name,
   <code class="command">udev</code> maintains classes of persistent symbolic links
   pointing to the device in the <code class="filename">/dev/disk</code> directory,
   which is further categorized by the <code class="filename">by-id</code>,
   <code class="filename">by-label</code>, <code class="filename">by-path</code>, and
   <code class="filename">by-uuid</code> subdirectories.
  </p><div id="idm139787671421184" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.png" /><h6>Note: UUID Generators</h6><p>
    Other programs besides <code class="command">udev</code>, such as LVM or
    <code class="command">md</code>, might also generate UUIDs, but they are not listed
    in <code class="filename">/dev/disk</code>.
   </p></div></div><div class="sect1 " id="sec.uuid.understanduuid"><div class="titlepage"><div><div><h2 class="title" id="sec.uuid.understanduuid"><span class="number">3.2 </span><span class="name">Understanding UUIDs</span> <a title="Permalink" class="permalink" href="#sec.uuid.understanduuid">#</a></h2></div></div></div><p>
   A UUID (Universally Unique Identifier) is a 128-bit number for a file system
   that is unique on both the local system and across other systems. It is
   randomly generated with system hardware information and time stamps as part
   of its seed. UUIDs are commonly used to uniquely tag devices.
  </p><p>
   Using non-persistent <span class="quote">“<span class="quote">traditional</span>”</span> device names such as
   <code class="filename">/dev/sda1</code> may render the system unbootable when adding
   storage. For example, if root (<code class="filename">/</code>) is assigned to
   <code class="filename">/dev/sda1</code>, it might be reassigned to
   <code class="filename">/dev/sdg1</code> after a SAN has been attached or additional
   hard disks have been applied to the system. In this case the boot loader
   configuration and the <code class="filename">/etc/fstab</code> file need to be
   adjusted, otherwise the system will no longer boot.
  </p><p>
   One way to avoid this problem is to use the UUID in the boot loader and
   <code class="filename">/etc/fstab</code> files for the boot device. This is the
   default in SUSE Linux Enterprise since version 12. The UUID is a property of the file system
   and can change if you reformat the drive. Other alternatives to using UUIDs
   of device names would be to identify devices by ID or label.
  </p><p>
   You can also use the UUID as criterion for assembling and activating
   software RAID devices. When a RAID is created, the <code class="command">md</code>
   driver generates a UUID for the device, and stores the value in the
   <code class="filename">md</code> superblock.
  </p><p>
   You can find the UUID for any block device in the
   <code class="filename">/dev/disk/by-uuid</code> directory. For example, a UUID entry
   looks like this:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code>ls -og /dev/disk/by-uuid/
lrwxrwxrwx 1 10 Dec  5 07:48 e014e482-1c2d-4d09-84ec-61b3aefde77a -&gt; ../../sda1</pre></div></div><div class="sect1 " id="sec.uuid.moreinfo"><div class="titlepage"><div><div><h2 class="title" id="sec.uuid.moreinfo"><span class="number">3.3 </span><span class="name">Additional Information</span> <a title="Permalink" class="permalink" href="#sec.uuid.moreinfo">#</a></h2></div></div></div><p>
   For more information about using <code class="systemitem">udev</code> for managing
   devices, see <span class="intraxref">Book “<em class="citetitle ">Administration Guide</em>”, Chapter 22 “Dynamic Kernel Device Management with <code class="systemitem">udev</code>”</span>.
  </p><p>
   For more information about <code class="systemitem">udev</code> commands, see
   <code class="command">man 7 udev</code>.
  </p></div></div><div xml:lang="en" class="chapter " id="cha.multitiercache" lang="en"><div class="titlepage"><div><div><h2 class="title"><span class="number">4 </span><span class="name">Multi-tier Caching for Block Device Operations</span> <a title="Permalink" class="permalink" href="#cha.multitiercache">#</a></h2><div class="doc-status"><ul><li><span class="ds-label">Filename: </span>storage_multitier-caching.xml</li><li><span class="ds-label">ID: </span>cha.multitiercache</li></ul></div></div></div></div><div class="line"><div class="toc"><dl><dt><span class="sect1"><a href="#sec.multitiercache.terminology"><span class="number">4.1 </span><span class="name">General Terminology</span></a></span></dt><dt><span class="sect1"><a href="#sec.multitiercache.caching_modes"><span class="number">4.2 </span><span class="name">Caching Modes</span></a></span></dt><dt><span class="sect1"><a href="#sec.multitiercache.bcache"><span class="number">4.3 </span><span class="name"><code class="systemitem">bcache</code></span></a></span></dt><dt><span class="sect1"><a href="#sec.multitiercache.lvmcache"><span class="number">4.4 </span><span class="name"><code class="systemitem">lvmcache</code></span></a></span></dt></dl></div></div><p>
  A multi-tier cache is a replicated/distributed cache that consists of at
  least two tiers: one is represented by slower but cheaper rotational block
  devices (hard disks), while the other is more expensive but performs faster
  data operations (for example SSD flash disks).
 </p><p>
  SUSE Linux Enterprise Server implements two different solutions for caching between flash and
  rotational devices: <code class="systemitem">bcache</code> and <code class="systemitem">lvmcache</code>.
 </p><div class="sect1 " id="sec.multitiercache.terminology"><div class="titlepage"><div><div><h2 class="title" id="sec.multitiercache.terminology"><span class="number">4.1 </span><span class="name">General Terminology</span> <a title="Permalink" class="permalink" href="#sec.multitiercache.terminology">#</a></h2></div></div></div><p>
   This section explains several terms often used when describing cache related
   features:
  </p><div class="variablelist "><dl class="variablelist"><dt id="idm139787671394688"><span class="term ">Migration</span></dt><dd><p>
      Movement of the primary copy of a logical block from one device to the
      other.
     </p></dd><dt id="idm139787671392816"><span class="term ">Promotion</span></dt><dd><p>
      Migration from the slow device to the fast device.
     </p></dd><dt id="idm139787671390976"><span class="term ">Demotion</span></dt><dd><p>
      Migration from the fast device to the slow device.
     </p></dd><dt id="idm139787671389136"><span class="term ">Origin device</span></dt><dd><p>
      The big and slower block device. It always contains a copy of the logical
      block, which may be out of date or kept in synchronization with the copy
      on the cache device (depending on policy).
     </p></dd><dt id="idm139787671387152"><span class="term ">Cache device</span></dt><dd><p>
      The small and faster block device.
     </p></dd><dt id="idm139787671385328"><span class="term ">Metadata device</span></dt><dd><p>
      A small device that records which blocks are in the cache, which are
      dirty, and extra hints for use by the policy object. This information
      could be put on the cache device as well, but having it separate allows
      the volume manager to configure it differently, for example as a mirror
      for extra robustness. The metadata device may only be used by a single
      cache device.
     </p></dd><dt id="idm139787671383136"><span class="term ">Dirty block</span></dt><dd><p>
      If some process writes to a block of data which is placed in the cache,
      the cached block is marked as <span class="emphasis"><em>dirty</em></span> because it was
      overwritten in the cache and needs to be written back to the original
      device.
     </p></dd><dt id="idm139787671380704"><span class="term ">Cache miss</span></dt><dd><p>
      A request for I/O operations is pointed to the cached device's cache
      first. If it cannot find the requested values, it looks in the device
      itself, which is slow. This is called a <span class="emphasis"><em>cache miss</em></span>.
     </p></dd><dt id="idm139787671378288"><span class="term ">Cache hit</span></dt><dd><p>
      When a requested value is found in the cached device's cache, it is
      served fast. This is called a <span class="emphasis"><em>cache hit</em></span>.
     </p></dd><dt id="idm139787671375952"><span class="term ">Cold cache</span></dt><dd><p>
      Cache that holds no values (is empty) and causes <span class="emphasis"><em>cache
      misses</em></span>. As the cached block device operations progress, it
      gets filled with data and becomes <span class="emphasis"><em>warm</em></span>.
     </p></dd><dt id="idm139787672060272"><span class="term ">Warm cache</span></dt><dd><p>
      Cache that already holds some values and is likely to result in
      <span class="emphasis"><em>cache hits</em></span>.
     </p></dd></dl></div></div><div class="sect1 " id="sec.multitiercache.caching_modes"><div class="titlepage"><div><div><h2 class="title" id="sec.multitiercache.caching_modes"><span class="number">4.2 </span><span class="name">Caching Modes</span> <a title="Permalink" class="permalink" href="#sec.multitiercache.caching_modes">#</a></h2></div></div></div><p>
   Following are the basic caching modes that multi-tier caches use:
   <span class="emphasis"><em>write-back</em></span>, <span class="emphasis"><em>write-through</em></span>,
   <span class="emphasis"><em>write-around</em></span> and <span class="emphasis"><em>pass-through</em></span>.
  </p><div class="variablelist "><dl class="variablelist"><dt id="idm139787672053920"><span class="term ">write-back</span></dt><dd><p>
      Data written to a block that is cached go to the cache only, and the
      block is marked dirty. This is the default caching mode.
     </p></dd><dt id="idm139787672052000"><span class="term ">write-through</span></dt><dd><p>
      Writing to a cached block will not complete until it has hit both the
      origin and cache devices. Clean blocks remain clean with
      <span class="emphasis"><em>write-through</em></span> cache.
     </p></dd><dt id="idm139787672049632"><span class="term ">write-around</span></dt><dd><p>
      A similar technique to write-through cache, but write I/O is written
      directly to a permanent storage, bypassing the cache. This can prevent
      the cache being flooded with write I/O that will not subsequently be
      re-read, but the disadvantage is that a read request for recently written
      data will create a 'cache miss' and needs to be read from slower bulk
      storage and experience higher latency.
     </p></dd><dt id="idm139787672047424"><span class="term ">pass-through</span></dt><dd><p>
      To enable the <span class="emphasis"><em>pass-through</em></span> mode, the cache needs to
      be clean. Reading is served from the origin device bypassing the cache.
      Writing is forwarded to the origin device and 'invalidates' the cache
      block. <span class="emphasis"><em>Pass-through</em></span> allows a cache device activation
      without having to care about data coherency, which is maintained. The
      cache will gradually become cold as writing takes place. If you can
      verify the coherency of the cache later, or establish it by using the
      <code class="literal">invalidate_cblocks</code> message, you can switch the cache
      device to <span class="emphasis"><em>write-through</em></span> or
      <span class="emphasis"><em>write-back</em></span> mode while it is still warm. Otherwise,
      you can discard the cache contents before switching to the desired
      caching mode.
     </p></dd></dl></div></div><div class="sect1 " id="sec.multitiercache.bcache"><div class="titlepage"><div><div><h2 class="title" id="sec.multitiercache.bcache"><span class="number">4.3 </span><span class="name"><code class="systemitem">bcache</code></span> <a title="Permalink" class="permalink" href="#sec.multitiercache.bcache">#</a></h2></div></div></div><p>
   <code class="systemitem">bcache</code> is a Linux kernel block layer cache. It allows one or more fast
   disk drives (such as SSDs) to act as a cache for one or more slower hard
   disks. <code class="systemitem">bcache</code> supports write-through and write-back, and is independent of
   the file system used. By default it caches random reads and writes only,
   which SSDs excel at. It is suitable for desktops, servers, and high end
   storage arrays as well.
  </p><div class="sect2 " id="sec.multitiercache.bcache.features"><div class="titlepage"><div><div><h3 class="title" id="sec.multitiercache.bcache.features"><span class="number">4.3.1 </span><span class="name">Main Features</span> <a title="Permalink" class="permalink" href="#sec.multitiercache.bcache.features">#</a></h3></div></div></div><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
      A single cache device can be used to cache an arbitrary number of backing
      devices. Backing devices can be attached and detached at runtime, while
      mounted and in use.
     </p></li><li class="listitem "><p>
      Recovers from unclean shutdowns—writes are not completed until the
      cache is consistent with regard to the backing device.
     </p></li><li class="listitem "><p>
      Throttles traffic to the SSD if it becomes congested.
     </p></li><li class="listitem "><p>
      Highly efficient write-back implementation. Dirty data is always written
      out in sorted order.
     </p></li><li class="listitem "><p>
      Stable and reliable—in production use.
     </p></li></ul></div></div><div class="sect2 " id="sec.multitiercache.bcache.setting_bcache_device"><div class="titlepage"><div><div><h3 class="title" id="sec.multitiercache.bcache.setting_bcache_device"><span class="number">4.3.2 </span><span class="name">Setting Up a <code class="systemitem">bcache</code> Device</span> <a title="Permalink" class="permalink" href="#sec.multitiercache.bcache.setting_bcache_device">#</a></h3></div></div></div><p>
    This section describes steps to set up and manage a <code class="systemitem">bcache</code> device.
   </p><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
      Install the <code class="systemitem">bcache-tools</code> package:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> zypper in bcache-tools</pre></div></li><li class="step "><p>
      Create a backing device (typically a mechanical drive). The backing
      device can be a whole device, a partition, or any other standard block
      device.
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> make-bcache -B /dev/sdb</pre></div></li><li class="step "><p>
      Create a cache device (typically an SSD disk).
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> make-bcache -C /dev/sdc</pre></div><p>
      In this example, the default block and bucket sizes of 512 B and 128 KB
      are used. The block size should match the backing device's sector size
      which will usually be either 512 or 4k. The bucket size should match the
      erase block size of the caching device with the intention of reducing
      write amplification. For example, using a hard disk with 4k sectors and
      an SSD with an erase block size of 2 MB this command would look as
      follows:
     </p><div class="verbatim-wrap"><pre class="screen">sudo make-bcache --block 4k --bucket 2M -C /dev/sdc</pre></div><div id="idm139787672020784" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.png" /><h6>Tip: Multi-Device Support</h6><p>
       <code class="command">make-bcache</code> can prepare and register multiple backing
       devices and a cache device at the same time. In this case you do not
       need to manually attach the cache device to the backing device
       afterward:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> make-bcache -B /dev/sda /dev/sdb -C /dev/sdc</pre></div></div></li><li class="step "><p>
      <code class="systemitem">bcache</code> devices show up as
     </p><div class="verbatim-wrap"><pre class="screen">/dev/bcache<em class="replaceable ">N</em></pre></div><p>
      and as
     </p><div class="verbatim-wrap"><pre class="screen">/dev/bcache/by-uuid/<em class="replaceable ">UUID</em>
/dev/bcache/by-label/<em class="replaceable ">LABEL</em></pre></div><p>
      You can normally format and mount <code class="systemitem">bcache</code> devices as usual:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> mkfs.ext4 /dev/bcache0
<code class="prompt user">tux &gt; </code><code class="command">sudo</code> mount /dev/bcache0 /mnt</pre></div><p>
      You can control <code class="systemitem">bcache</code> devices through <code class="systemitem">sysfs</code>
      at
      <code class="filename">/sys/block/bcache<em class="replaceable ">N</em>/bcache</code>.
     </p></li><li class="step "><p>
      After both the cache and backing devices are registered, you need to
      attach the backing device to the related cache set to enable caching:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code>echo <em class="replaceable ">CACHE_SET_UUID</em> &gt; /sys/block/bcache0/bcache/attach</pre></div><p>
      where <em class="replaceable ">CACHE_SET_UUID</em> is found in
      <code class="filename">/sys/fs/bcache</code>.
     </p></li><li class="step "><p>
      By default <code class="systemitem">bcache</code> uses a pass-through caching mode. To change it to for
      example write-back, run
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code>echo writeback &gt; /sys/block/bcache0/bcache/cache_mode</pre></div></li></ol></div></div></div><div class="sect2 " id="sec.multitiercache.bcache.sysfs"><div class="titlepage"><div><div><h3 class="title" id="sec.multitiercache.bcache.sysfs"><span class="number">4.3.3 </span><span class="name"><code class="systemitem">bcache</code> Configuration Using <code class="systemitem">sysfs</code></span> <a title="Permalink" class="permalink" href="#sec.multitiercache.bcache.sysfs">#</a></h3></div></div></div><p>
    <code class="systemitem">bcache</code> devices use the <code class="systemitem">sysfs</code> interface to store
    their runtime configuration values. This way you can change <code class="systemitem">bcache</code>
    backing and cache disks' behavior or see their usage statistics.
   </p><p>
    For the complete list of <code class="systemitem">bcache</code> <code class="systemitem">sysfs</code>
    parameters, see the contents of the
    <code class="filename">/usr/src/linux/Documentation/bcache.txt</code> file, mainly
    the <code class="literal">SYSFS - BACKING DEVICE</code>, <code class="literal">SYSFS - BACKING
    DEVICE STATS</code>, and <code class="literal">SYSFS - CACHE DEVICE</code>
    sections.
   </p></div></div><div class="sect1 " id="sec.multitiercache.lvmcache"><div class="titlepage"><div><div><h2 class="title" id="sec.multitiercache.lvmcache"><span class="number">4.4 </span><span class="name"><code class="systemitem">lvmcache</code></span> <a title="Permalink" class="permalink" href="#sec.multitiercache.lvmcache">#</a></h2></div></div></div><p>
   <code class="systemitem">lvmcache</code> is a caching mechanism consisting of logical volumes (LVs). It
   uses the <code class="literal">dm-cache</code> kernel driver and supports
   write-through (default) and write-back caching modes. <code class="systemitem">lvmcache</code> improves
   performance of a large and slow LV by dynamically migrating some of its data
   to a faster and smaller LV. For more information on LVM, see
   <a class="xref" href="#part.lvm" title="Part II. Logical Volumes (LVM)">Part II, “Logical Volumes (LVM)”</a>.
  </p><p>
   LVM refers to the small, fast LV as a <span class="emphasis"><em>cache pool LV</em></span>.
   The large, slow LV is called the <span class="emphasis"><em>origin LV</em></span>. Because of
   requirements from dm-cache, LVM further splits the cache pool LV into two
   devices: the <span class="emphasis"><em>cache data LV</em></span> and <span class="emphasis"><em>cache
   metadata LV</em></span>. The cache data LV is where copies of data blocks
   are kept from the origin LV to increase speed. The cache metadata LV holds
   the accounting information that specifies where data blocks are stored.
  </p><div class="sect2 " id="sec.multitiercache.lvmcache.configure"><div class="titlepage"><div><div><h3 class="title" id="sec.multitiercache.lvmcache.configure"><span class="number">4.4.1 </span><span class="name">Configuring <code class="systemitem">lvmcache</code></span> <a title="Permalink" class="permalink" href="#sec.multitiercache.lvmcache.configure">#</a></h3></div></div></div><p>
    This section describes steps to create and configure LVM based caching.
   </p><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
      <span class="emphasis"><em>Create the origin LV.</em></span> Create a new LV or use an
      existing LV to become the origin LV:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> lvcreate -n <em class="replaceable ">ORIGIN_LV</em> -L 100G vg <em class="replaceable ">/dev/SLOW_DEV</em></pre></div></li><li class="step "><p>
      <span class="emphasis"><em>Create the cache data LV.</em></span> This LV will hold data
      blocks from the origin LV. The size of this LV is the size of the cache
      and will be reported as the size of the cache pool LV.
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> lvcreate -n <em class="replaceable ">CACHE_DATA_LV</em> -L 10G vg <em class="replaceable ">/dev/FAST</em></pre></div></li><li class="step "><p>
      <span class="emphasis"><em>Create the cache metadata LV.</em></span> This LV will hold
      cache pool metadata. The size of this LV should be approximately 1000
      times smaller than the cache data LV, with a minimum size of 8MB.
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> lvcreate -n <em class="replaceable ">CACHE_METADATA_LV</em> -L 12M vg <em class="replaceable ">/dev/FAST</em></pre></div><p>
      List the volumes you have created so far:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> lvs -a vg
LV                VG   Attr        LSize   Pool Origin
cache_data_lv     vg   -wi-a-----  10.00g
cache_metadata_lv vg   -wi-a-----  12.00m
origin_lv         vg   -wi-a----- 100.00g</pre></div></li><li class="step "><p>
      <span class="emphasis"><em>Create a cache pool LV.</em></span> Combine the data and
      metadata LVs into a cache pool LV. You can set the cache pool LV's
      behavior at the same time.
     </p><p>
      <em class="replaceable ">CACHE_POOL_LV</em> takes the name of
      <em class="replaceable ">CACHE_DATA_LV</em>.
     </p><p>
      <em class="replaceable ">CACHE_DATA_LV</em> is renamed to
      <em class="replaceable ">CACHE_DATA_LV</em>_cdata and becomes hidden.
     </p><p>
      <em class="replaceable ">CACHE_META_LV</em> is renamed to
      <em class="replaceable ">CACHE_DATA_LV</em>_cmeta and becomes hidden.
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> lvconvert --type cache-pool \
 --poolmetadata vg/cache_metadata_lv vg/cache_data_lv</pre></div><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> lvs -a vg
LV                     VG   Attr       LSize   Pool Origin
cache_data_lv          vg   Cwi---C---  10.00g
[cache_data_lv_cdata]  vg   Cwi-------  10.00g
[cache_data_lv_cmeta]  vg   ewi-------  12.00m
origin_lv              vg   -wi-a----- 100.00g</pre></div></li><li class="step "><p>
      <span class="emphasis"><em>Create a cache LV.</em></span> Create a cache LV by linking the
      cache pool LV to the origin LV.
     </p><p>
      The user accessible cache LV takes the name of the origin LV, while the
      origin LV becomes a hidden LV renamed to
      <em class="replaceable ">ORIGIN_LV</em>_corig.
     </p><p>
      CacheLV takes the name of <em class="replaceable ">ORIGIN_LV</em>.
     </p><p>
      <em class="replaceable ">ORIGIN_LV</em> is renamed to
      <em class="replaceable ">ORIGIN_LV</em>_corig and becomes hidden.
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> lvconvert --type cache --cachepool vg/cache_data_lv vg/origin_lv</pre></div><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> lvs -a vg
LV              VG   Attr       LSize   Pool   Origin
cache_data_lv          vg   Cwi---C---  10.00g
[cache_data_lv_cdata]  vg   Cwi-ao----  10.00g
[cache_data_lv_cmeta]  vg   ewi-ao----  12.00m
origin_lv              vg   Cwi-a-C--- 100.00g cache_data_lv [origin_lv_corig]
[origin_lv_corig]      vg   -wi-ao---- 100.00g</pre></div></li></ol></div></div></div><div class="sect2 " id="sec.multitiercache.lvmcache.remove"><div class="titlepage"><div><div><h3 class="title" id="sec.multitiercache.lvmcache.remove"><span class="number">4.4.2 </span><span class="name">Removing a Cache Pool</span> <a title="Permalink" class="permalink" href="#sec.multitiercache.lvmcache.remove">#</a></h3></div></div></div><p>
    There are several ways to turn off the LV cache.
   </p><div class="sect3 " id="sec.multitiercache.lvmcache.remove.detach"><div class="titlepage"><div><div><h4 class="title" id="sec.multitiercache.lvmcache.remove.detach"><span class="number">4.4.2.1 </span><span class="name">Detach a Cache Pool LV from a Cache LV</span> <a title="Permalink" class="permalink" href="#sec.multitiercache.lvmcache.remove.detach">#</a></h4></div></div></div><p>
     You can disconnect a cache pool LV from a cache LV, leaving an unused
     cache pool LV and an uncached origin LV. Data are written back from the
     cache pool to the origin LV when necessary.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> lvconvert --splitcache vg/origin_lv</pre></div></div><div class="sect3 " id="sec.multitiercache.lvmcache.remove.wo_origin"><div class="titlepage"><div><div><h4 class="title" id="sec.multitiercache.lvmcache.remove.wo_origin"><span class="number">4.4.2.2 </span><span class="name">Removing a Cache Pool LV without Removing its Origin LV</span> <a title="Permalink" class="permalink" href="#sec.multitiercache.lvmcache.remove.wo_origin">#</a></h4></div></div></div><p>
     This writes back data from the cache pool to the origin LV when necessary,
     then removes the cache pool LV, leaving the uncached origin LV.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> lvremove vg/cache_data_lv</pre></div><p>
     An alternative command that also disconnects the cache pool from the cache
     LV, and deletes the cache pool:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> lvconvert --uncache vg/origin_lv</pre></div></div><div class="sect3 " id="sec.multitiercache.lvmcache.remove.both"><div class="titlepage"><div><div><h4 class="title" id="sec.multitiercache.lvmcache.remove.both"><span class="number">4.4.2.3 </span><span class="name">Removing Both the Origin LV and the Cache Pool LV</span> <a title="Permalink" class="permalink" href="#sec.multitiercache.lvmcache.remove.both">#</a></h4></div></div></div><p>
     Removing a cache LV removes both the origin LV and the linked cache pool
     LV.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> lvremove vg/origin_lv</pre></div></div><div class="sect3 " id="sec.multitiercache.lvmcache.remove.info"><div class="titlepage"><div><div><h4 class="title" id="sec.multitiercache.lvmcache.remove.info"><span class="number">4.4.2.4 </span><span class="name">For More Information</span> <a title="Permalink" class="permalink" href="#sec.multitiercache.lvmcache.remove.info">#</a></h4></div></div></div><p>
     You can find more <code class="systemitem">lvmcache</code> related topics, such as supported cache
     modes, redundant sub-logical volumes, cache policy, or converting existing
     LVs to cache types, in the <code class="systemitem">lvmcache</code> manual page (<code class="command">man 7
     lvmcache</code>).
    </p></div></div></div></div></div><div class="part" id="part.lvm"><div class="titlepage"><div><div><h1 class="title"><span class="number">Part II </span><span class="name">Logical Volumes (LVM) </span><a title="Permalink" class="permalink" href="#part.lvm">#</a></h1></div></div></div><div class="toc"><dl><dt><span class="chapter"><a href="#cha.lvm"><span class="number">5 </span><span class="name">LVM Configuration</span></a></span></dt><dd class="toc-abstract"><p>
    This chapter describes the principles behind Logical Volume Manager
    (LVM) and its basic features that make it useful under many circumstances.
    The YaST LVM configuration can be reached from the YaST Expert
    Partitioner. This partitioning tool enables you to edit and delete existing
    partitions and create new ones that should be used with LVM.
   </p></dd><dt><span class="chapter"><a href="#cha.lvm_snapshots"><span class="number">6 </span><span class="name">LVM Volume Snapshots</span></a></span></dt><dd class="toc-abstract"><p>A Logical Volume Manager (LVM) logical volume snapshot is a copy-on-write technology that monitors changes to an existing volume’s data blocks so that when a write is made to one of the blocks, the block’s value at the snapshot time is copied to a snapshot volume. In this way, a point-in-time copy o…</p></dd></dl></div><div xml:lang="en" class="chapter " id="cha.lvm" lang="en"><div class="titlepage"><div><div><h2 class="title"><span class="number">5 </span><span class="name">LVM Configuration</span> <a title="Permalink" class="permalink" href="#cha.lvm">#</a></h2><div class="doc-status"><ul><li><span class="ds-label">Filename: </span>storage_lvm.xml</li><li><span class="ds-label">ID: </span>cha.lvm</li></ul></div></div><div><div class="abstract"><div class="abstract-title-wrap"><h6 class="abstract-title">Abstract<a title="Permalink" class="permalink" href="#idm139787671732592">#</a></h6></div><p>
    This chapter describes the principles behind Logical Volume Manager
    (LVM) and its basic features that make it useful under many circumstances.
    The YaST LVM configuration can be reached from the YaST Expert
    Partitioner. This partitioning tool enables you to edit and delete existing
    partitions and create new ones that should be used with LVM.
   </p></div></div></div></div><div class="line"><div class="toc"><dl><dt><span class="sect1"><a href="#sec.lvm.explained"><span class="number">5.1 </span><span class="name">Understanding the Logical Volume Manager</span></a></span></dt><dt><span class="sect1"><a href="#sec.lvm.vg"><span class="number">5.2 </span><span class="name">Creating Volume Groups</span></a></span></dt><dt><span class="sect1"><a href="#sec.lvm.lv"><span class="number">5.3 </span><span class="name">Creating Logical Volumes</span></a></span></dt><dt><span class="sect1"><a href="#lvm_activate_vgs"><span class="number">5.4 </span><span class="name">Automatically Activating Non-Root LVM Volume Groups</span></a></span></dt><dt><span class="sect1"><a href="#sec.lvm.vg_resize"><span class="number">5.5 </span><span class="name">Resizing an Existing Volume Group</span></a></span></dt><dt><span class="sect1"><a href="#sec.lvm.lv_resize"><span class="number">5.6 </span><span class="name">Resizing a Logical Volume</span></a></span></dt><dt><span class="sect1"><a href="#sec.lvm.delete"><span class="number">5.7 </span><span class="name">Deleting a Volume Group or a Logical Volume</span></a></span></dt><dt><span class="sect1"><a href="#sec.lvm.cli"><span class="number">5.8 </span><span class="name">Using LVM Commands</span></a></span></dt><dt><span class="sect1"><a href="#sec.lvm.tagging"><span class="number">5.9 </span><span class="name">Tagging LVM2 Storage Objects</span></a></span></dt></dl></div></div><div id="idm139787671731184" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.png" /><h6>Warning: Risks</h6><p>
   Using LVM might be associated with increased risk, such as data loss. Risks
   also include application crashes, power failures, and faulty commands. Save
   your data before implementing LVM or reconfiguring volumes. Never work
   without a backup.
  </p></div><div class="sect1 " id="sec.lvm.explained"><div class="titlepage"><div><div><h2 class="title" id="sec.lvm.explained"><span class="number">5.1 </span><span class="name">Understanding the Logical Volume Manager</span> <a title="Permalink" class="permalink" href="#sec.lvm.explained">#</a></h2></div></div></div><p>
   LVM enables flexible distribution of hard disk space over several physical
   volumes (hard disks, partitions, LUNs). It was developed because the need to
   change the segmentation of hard disk space might arise only after the
   initial partitioning has already been done during installation. Because it
   is difficult to modify partitions on a running system, LVM provides a
   virtual pool (volume group or VG) of storage space from which logical
   volumes (LVs) can be created as needed. The operating system accesses these
   LVs instead of the physical partitions. Volume groups can span more than one
   disk, so that several disks or parts of them can constitute one single VG.
   In this way, LVM provides a kind of abstraction from the physical disk space
   that allows its segmentation to be changed in a much easier and safer way
   than through physical repartitioning.
  </p><p>
   <a class="xref" href="#fig.lvm.explain" title="Physical Partitioning versus LVM">Figure 5.1, “Physical Partitioning versus LVM”</a> compares physical
   partitioning (left) with LVM segmentation (right). On the left side, one
   single disk has been divided into three physical partitions (PART), each
   with a mount point (MP) assigned so that the operating system can access
   them. On the right side, two disks have been divided into two and three
   physical partitions each. Two LVM volume groups (VG 1 and VG 2)
   have been defined. VG 1 contains two partitions from DISK 1 and
   one from DISK 2. VG 2 contains the remaining two partitions from
   DISK 2.
  </p><div class="figure" id="fig.lvm.explain"><div class="figure-contents"><div class="mediaobject"><a xmlns="" href="images/lvm.png"><img src="images/lvm.png" width="" alt="Physical Partitioning versus LVM" /></a></div></div><div class="figure-title-wrap"><h6 class="figure-title"><span class="number">Figure 5.1: </span><span class="name">Physical Partitioning versus LVM </span><a title="Permalink" class="permalink" href="#fig.lvm.explain">#</a></h6></div></div><p>
   In LVM, the physical disk partitions that are incorporated in a volume group
   are called physical volumes (PVs). Within the volume groups in
   <a class="xref" href="#fig.lvm.explain" title="Physical Partitioning versus LVM">Figure 5.1, “Physical Partitioning versus LVM”</a>, four logical
   volumes (LV 1 through LV 4) have been defined, which can be used
   by the operating system via the associated mount points (MP). The border
   between different logical volumes need not be aligned with any partition
   border. See the border between LV 1 and LV 2 in this example.
  </p><p>
   LVM features:
  </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
     Several hard disks or partitions can be combined in a large logical
     volume.
    </p></li><li class="listitem "><p>
     Provided the configuration is suitable, an LV (such as
     <code class="filename">/usr</code>) can be enlarged when the free space is
     exhausted.
    </p></li><li class="listitem "><p>
     Using LVM, it is possible to add hard disks or LVs in a running system.
     However, this requires hotpluggable hardware that is capable of such
     actions.
    </p></li><li class="listitem "><p>
     It is possible to activate a <span class="emphasis"><em>striping mode</em></span> that
     distributes the data stream of a logical volume over several physical
     volumes. If these physical volumes reside on different disks, this can
     improve the reading and writing performance like RAID 0.
    </p></li><li class="listitem "><p>
     The snapshot feature enables consistent backups (especially for servers)
     in the running system.
    </p></li></ul></div><div id="idm139787671609808" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.png" /><h6>Note: LVM and RAID</h6><p>
    Even though LVM also supports RAID of 0/1/4/5/6 levels, we
    recommend to use MD RAID (see <a class="xref" href="#cha.raid" title="Chapter 7. Software RAID Configuration">Chapter 7, <em>Software RAID Configuration</em></a>). However,
    LVM works fine with RAID 0 and 1, as RAID 0 is similar to common
    logical volume management (individual logical blocks are mapped onto blocks
    on the physical devices). LVM used on top of RAID 1 can keep
    track of mirror synchronization and is fully able to manage the
    synchronization process. With higher RAID levels you need a management
    daemon that monitors the states of attached disks and can inform
    administrators if there is a problem in the disk array. LVM includes such a
    daemon, but in exceptional situations like a device failure, the daemon
    does not working properly.
   </p></div><div id="idm139787671607216" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.png" /><h6>Warning: IBM Z: LVM Root File System</h6><p>
    If you configure the system with an root file system on LVM or software
    raid array, you must place <code class="filename">/boot</code> on a separate,
    non-LVM or non-Raid partition, otherwise the system will fail to boot.
    The recommended size for such a partition is 500 MB and the
    recommended file system is Ext4.
   </p></div><p>
   With these features, using LVM already makes sense for heavily used home PCs
   or small servers. If you have a growing data stock, as in the case of
   databases, music archives, or user directories, LVM is especially useful. It
   allows file systems that are larger than the physical hard disk. However,
   keep in mind that working with LVM is different from working with
   conventional partitions.
  </p><p>
   You can manage new or existing LVM storage objects by using the YaST
   Partitioner. Instructions and further information about configuring LVM are
   available in the official
   <a class="link" href="http://tldp.org/HOWTO/LVM-HOWTO/" target="_blank"><em class="citetitle ">LVM
   HOWTO</em></a>.
  </p></div><div class="sect1 " id="sec.lvm.vg"><div class="titlepage"><div><div><h2 class="title" id="sec.lvm.vg"><span class="number">5.2 </span><span class="name">Creating Volume Groups</span> <a title="Permalink" class="permalink" href="#sec.lvm.vg">#</a></h2></div></div></div><p>
   An LVM volume group (VG) organizes the Linux LVM partitions into a logical
   pool of space. You can carve out logical volumes from the available space in
   the group. The Linux LVM partitions in a group can be on the same or
   different disks. You can add partitions or entire disks to expand the size
   of the group.
  </p><p>
   To use an entire disk, it must not contain any
   partitions. When using partitions, they must not be mounted. YaST will
   automatically change their partition type to <code class="literal">0x8E Linux
   LVM</code> when adding them to a VG.
  </p><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
     Launch YaST and open the <span class="guimenu">Partitioner</span>.
    </p></li><li class="step "><p>
     In case you need to reconfigure your existing partitioning setup, proceed
     as follows. Refer to <span class="intraxref">Book “<em class="citetitle ">Deployment Guide</em>”, Chapter 9 “Expert Partitioner”, Section 9.1 “Using the Expert Partitioner”</span> for
     details. Skip this step if you only want to use unused disks or partitions
     that already exist.
    </p><div id="idm139787671596080" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.png" /><h6>Warning: Physical Volumes on Unpartitioned Disks</h6><p>
      You can use an unpartitioned disk as a physical volume (PV) if the it is
      <span class="emphasis"><em>not</em></span> the disk where the operating system is installed
      and from which it boots.
     </p><p>
      As unpartitioned disks appear as <span class="emphasis"><em>unused</em></span> on the system
      level, they can easily be overwritten or wrongly accessed.
     </p></div><ol type="a" class="substeps "><li class="step "><p>
       To use an entire hard disk that already contains partitions, delete all
       partitions on that disk.
      </p></li><li class="step "><p>
       To use a partition that is currently mounted, unmount it.
      </p></li></ol></li><li class="step "><p>
     In the left panel, select <span class="guimenu">Volume Management</span>.
    </p><p>
     A list of existing Volume Groups opens in the right panel.
    </p></li><li class="step "><p>
     At the lower left of the Volume Management page, click
     <span class="guimenu">Add</span> › <span class="guimenu">Volume
     Group</span>.
    </p><div class="informalfigure"><div class="mediaobject"><a xmlns="" href="images/yast2_lvm4_a.png"><img src="images/yast2_lvm4_a.png" width="" /></a></div></div></li><li class="step "><p>
     Define the volume group as follows:
    </p><ol type="a" class="substeps "><li class="step "><p>
       Specify the <span class="guimenu">Volume Group Name</span>.
      </p><p>
       If you are creating a volume group at install time, the name
       <code class="literal">system</code> is suggested for a volume group that will
       contain the <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> system files.
      </p></li><li class="step "><p>
       Specify the <span class="guimenu">Physical Extent Size</span>.
      </p><p>
       The <span class="guimenu">Physical Extent Size</span> defines the size of a
       physical block in the volume group. All the disk space in a volume group
       is handled in chunks of this size. Values can be from 1 KB to 16 GB in
       powers of 2. This value is normally set to 4 MB.
      </p><p>
       In LVM1, a 4 MB physical extent allowed a maximum LV size of 256 GB
       because it supports only up to 65534 extents per LV. LVM2, which is used
       on <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span>, does not restrict the number of physical extents.
       Having many extents has no impact on I/O performance to the logical
       volume, but it slows down the LVM tools.
      </p><div id="idm139787671572944" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.png" /><h6>Important: Physical Extent Sizes</h6><p>
        Different physical extent sizes should not be mixed in a single VG. The
        extent should not be modified after the initial setup.
       </p></div></li><li class="step "><p>
       In the <span class="guimenu">Available Physical Volumes</span> list, select the
       Linux LVM partitions that you want to make part of this volume group,
       then click <span class="guimenu">Add</span> to move them to the <span class="guimenu">Selected
       Physical Volumes</span> list.
      </p></li><li class="step "><p>
       Click <span class="guimenu">Finish</span>.
      </p><p>
       The new group appears in the <span class="guimenu">Volume Groups</span> list.
      </p></li></ol></li><li class="step "><p>
     On the Volume Management page, click <span class="guimenu">Next</span>, verify that
     the new volume group is listed, then click <span class="guimenu">Finish</span>.
    </p></li><li class="step "><p>
     To check which physical devices are part of the volume group, open the
     YaST Partitioner at any time in the running system and click
     <span class="guimenu">Volume Management</span> › <span class="guimenu">Edit</span> › <span class="guimenu">Physical Devices</span>. Leave this screen with
     <span class="guimenu">Abort</span>.
    </p><div class="figure" id="fig.yast2.lvm.physical_volumes"><div class="figure-contents"><div class="mediaobject"><a xmlns="" href="images/yast2_lvm5_a.png"><img src="images/yast2_lvm5_a.png" width="" alt="Physical Volumes in the Volume Group Named DATA" /></a></div></div><div class="figure-title-wrap"><h6 class="figure-title"><span class="number">Figure 5.2: </span><span class="name">Physical Volumes in the Volume Group Named DATA </span><a title="Permalink" class="permalink" href="#fig.yast2.lvm.physical_volumes">#</a></h6></div></div></li></ol></div></div></div><div class="sect1 " id="sec.lvm.lv"><div class="titlepage"><div><div><h2 class="title" id="sec.lvm.lv"><span class="number">5.3 </span><span class="name">Creating Logical Volumes</span> <a title="Permalink" class="permalink" href="#sec.lvm.lv">#</a></h2></div></div></div><p>
   A logical volume provides a pool of space similar to what a hard disk does.
   To make this space usable, you need to define logical volumes. A logical
   volume is similar to a regular partition—you can format and mount it.
  </p><p>
   Use The YaST Partitioner to create logical volumes from an existing volume
   group. Assign at least one logical volume to each volume group. You can
   create new logical volumes as needed until all free space in the volume
   group has been exhausted. An LVM logical volume can optionally be thinly
   provisioned, allowing you to create logical volumes with sizes that overbook
   the available free space (see <a class="xref" href="#sec.lvm.lv.thin" title="5.3.1. Thinly Provisioned Logical Volumes">Section 5.3.1, “Thinly Provisioned Logical Volumes”</a> for more
   information).
  </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p><span class="formalpara-title">Normal volume: </span>
      (Default) The volume’s space is allocated immediately.
     </p></li><li class="listitem "><p><span class="formalpara-title">Thin pool: </span>
      The logical volume is a pool of space that is reserved for use with thin
      volumes. The thin volumes can allocate their needed space from it on
      demand.
     </p></li><li class="listitem "><p><span class="formalpara-title">Thin volume: </span>
      The volume is created as a sparse volume. The volume allocates needed
      space on demand from a thin pool.
     </p></li><li class="listitem "><p><span class="formalpara-title">Mirrored volume: </span>
      The volume is created with a defined count of mirrors.
     </p></li></ul></div><div class="procedure " id="pro.lvm.lv"><div class="procedure-title-wrap"><h6 class="procedure-title"><span class="number">Procedure 5.1: </span><span class="name">Setting Up a Logical Volume </span><a title="Permalink" class="permalink" href="#pro.lvm.lv">#</a></h6></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
     Launch YaST and open the <span class="guimenu">Partitioner</span>.
    </p></li><li class="step "><p>
     In the left panel, select <span class="guimenu">Volume Management</span>. A list of
     existing Volume Groups opens in the right panel.
    </p></li><li class="step "><p>
     Select the volume group in which you want to create the volume and choose
     <span class="guimenu">Add</span> › <span class="guimenu">Logical Volume</span>.
    </p></li><li class="step "><p>
     Provide a <span class="guimenu">Name</span> for the volume and choose
     <span class="guimenu">Normal Volume</span> (refer to
     <a class="xref" href="#sec.lvm.lv.thin" title="5.3.1. Thinly Provisioned Logical Volumes">Section 5.3.1, “Thinly Provisioned Logical Volumes”</a> for setting up thinly provisioned
     volumes). Proceed with <span class="guimenu">Next</span>.
    </p><div class="informalfigure"><div class="mediaobject"><a xmlns="" href="images/yast2_lvm9_a.png"><img src="images/yast2_lvm9_a.png" width="" /></a></div></div></li><li class="step "><p>
     Specify the size of the volume and whether to use multiple stripes.
    </p><p>
     Using a striped volume, the data will be distributed among several
     physical volumes. If these physical volumes reside on different hard
     disks, this generally results in a better reading and writing performance
     (like RAID 0). The maximum number of available stripes is equal to
     the number of physical volumes. The default (<code class="literal">1</code> is to
     not use multiple stripes.
    </p><div class="informalfigure"><div class="mediaobject"><a xmlns="" href="images/yast2_lvm10_a.png"><img src="images/yast2_lvm10_a.png" width="" /></a></div></div></li><li class="step "><p>
     Choose a <span class="guimenu">Role</span> for the volume. Your choice here only
     affects the default values for the upcoming dialog. They can be changed in
     the next step. If in doubt, choose <span class="guimenu">Raw Volume
     (Unformatted)</span>.
    </p><div class="informalfigure"><div class="mediaobject"><a xmlns="" href="images/yast2_lvm11_a.png"><img src="images/yast2_lvm11_a.png" width="" /></a></div></div></li><li class="step "><p>
     Under <span class="guimenu">Formatting Options</span>, select <span class="guimenu">Format
     Partition</span>, then select the <span class="guimenu">File system</span>. The
     content of the <span class="guimenu">Options</span> menu depends on the file system.
     Usually there is no need to change the defaults.
    </p><p>
     Under <span class="guimenu">Mounting Options</span>, select <span class="guimenu">Mount
     partition</span>, then select the mount point. Click <span class="guimenu">Fstab
     Options</span> to add special mounting options for the volume.
    </p></li><li class="step "><p>
     Click <span class="guimenu">Finish</span>.
    </p></li><li class="step "><p>
     Click <span class="guimenu">Next</span>, verify that the changes are listed, then
     click <span class="guimenu">Finish</span>.
    </p></li></ol></div></div><div class="sect2 " id="sec.lvm.lv.thin"><div class="titlepage"><div><div><h3 class="title" id="sec.lvm.lv.thin"><span class="number">5.3.1 </span><span class="name">Thinly Provisioned Logical Volumes</span> <a title="Permalink" class="permalink" href="#sec.lvm.lv.thin">#</a></h3></div></div></div><p>
    An LVM logical volume can optionally be thinly provisioned. Thin
    provisioning allows you to create logical volumes with sizes that overbook
    the available free space. You create a thin pool that contains unused space
    reserved for use with an arbitrary number of thin volumes. A thin volume is
    created as a sparse volume and space is allocated from a thin pool as
    needed. The thin pool can be expanded dynamically when needed for
    cost-effective allocation of storage space. Thinly provisioned volumes also
    support snapshots which can be managed with Snapper—see
    <span class="intraxref">Book “<em class="citetitle ">Administration Guide</em>”, Chapter 7 “System Recovery and Snapshot Management with Snapper”</span> for more information.
   </p><p>
    To set up a thinly provisioned logical volume, proceed as described in
    <a class="xref" href="#pro.lvm.lv" title="Setting Up a Logical Volume">Procedure 5.1, “Setting Up a Logical Volume”</a>. When it comes to choosing the volume type, do
    not choose <span class="guimenu">Normal Volume</span>, but rather <span class="guimenu">Thin
    Volume</span> or <span class="guimenu">Thin Pool</span>.
   </p><div class="variablelist "><dl class="variablelist"><dt id="idm139787669890640"><span class="term "><span class="guimenu">Thin pool</span>
     </span></dt><dd><p>
       The logical volume is a pool of space that is reserved for use with thin
       volumes. The thin volumes can allocate their needed space from it on
       demand.
      </p></dd><dt id="idm139787669888400"><span class="term "><span class="guimenu">Thin volume</span>
     </span></dt><dd><p>
       The volume is created as a sparse volume. The volume allocates needed
       space on demand from a thin pool.
      </p></dd></dl></div><div id="idm139787669886048" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.png" /><h6>Important: Thinly Provisioned Volumes in a Cluster</h6><p>
     To use thinly provisioned volumes in a cluster, the thin pool and the thin
     volumes that use it must be managed in a single cluster resource. This
     allows the thin volumes and thin pool to always be mounted exclusively on
     the same node.
    </p></div></div><div class="sect2 " id="lvm.lv.mirror"><div class="titlepage"><div><div><h3 class="title" id="lvm.lv.mirror"><span class="number">5.3.2 </span><span class="name">Creating Mirrored Volumes</span> <a title="Permalink" class="permalink" href="#lvm.lv.mirror">#</a></h3></div></div></div><p>
    A logical volume can be created with several mirrors. LVM ensures that data
    written to an underlying physical volume is mirrored onto a different
    physical volume. Thus even though a physical volume crashes, you can still
    access the data on the logical volume. LVM also keeps a log file to manage
    the synchronization process. The log contains information about which
    volume regions are currently undergoing synchronization with mirrors. By
    default the log is stored on disk and if possible on a different disk than
    are the mirrors. But you may specify a different location for the log, for
    example volatile memory.
   </p><p>
    Currently there are two types of mirror implementation available:
    "normal" (non-raid) <code class="literal">mirror</code> logical volumes and
    <code class="literal">raid1</code> logical volumes.
   </p><p>
    After you create mirrored logical volumes, you can perform standard
    operations with mirrored logical volumes like activating, extending,
    and removing.
   </p><div class="sect3 " id="mirroring.procedure"><div class="titlepage"><div><div><h4 class="title" id="mirroring.procedure"><span class="number">5.3.2.1 </span><span class="name">Setting Up Mirrored Non-raid Logical Volumes</span> <a title="Permalink" class="permalink" href="#mirroring.procedure">#</a></h4></div></div></div><p>
     To create a mirrored volume use the <code class="command">lvcreate</code> command.
     The following example creates a 500 GB logical volume with two mirrors
     called <span class="emphasis"><em>lv1</em></span> which uses a volume group
     <span class="emphasis"><em>vg1</em></span>.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> lvcreate -L 500G -m 2 -n lv1 vg1</pre></div><p>
     Such a logical volume is a linear volume (without striping) that provides
     three copies of the file system. The <code class="literal">m</code> option specifies
     the count of mirrors. The <code class="literal">L</code> option specifies the size
     of the logical volumes.
    </p><p>
     The logical volume is divided into regions of the 512 KB default size. If
     you need a different size of regions, use the <code class="literal">-R</code> option
     followed by the desired region size in megabytes. Or you can configure the
     preferred region size by editing the <code class="literal">mirror_region_size</code>
     option in the <code class="filename">lvm.conf</code> file.
    </p></div><div class="sect3 " id="raid1.lvm.mirroring"><div class="titlepage"><div><div><h4 class="title" id="raid1.lvm.mirroring"><span class="number">5.3.2.2 </span><span class="name">Setting Up <code class="literal">raid1</code> Logical Volumes</span> <a title="Permalink" class="permalink" href="#raid1.lvm.mirroring">#</a></h4></div></div></div><p>
     As LVM supports RAID you can implement mirroring by using RAID1. Such
     implementation provides the following advantages compared to the non-raid
     mirrors:
    </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
       LVM maintains a fully redundant bitmap area for each mirror image, which
       increases its fault handling capabilities.
      </p></li><li class="listitem "><p>
       Mirror images can be temporarily split from the array and then merged
       back.
      </p></li><li class="listitem "><p>
       The array can handle transient failures.
      </p></li><li class="listitem "><p>
       The LVM RAID 1 implementation supports snapshots.
      </p></li></ul></div><p>
     On the other hand, this type of mirroring implementation does not enable
     to create a logical volume in a clustered volume group.
    </p><p>
     To create a mirror volume by using RAID, issue the command
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> lvcreate --type raid1 -m 1 -L 1G -n lv1 vg1</pre></div><p>
     where the options/parameters have the following meanings:
    </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
       <code class="literal">--type</code> - you need to specify
       <code class="literal">raid1</code>, otherwise the command uses the implicit
       segment type <code class="literal">mirror</code> and creates a non-raid mirror.
      </p></li><li class="listitem "><p>
       <code class="literal">-m</code> - specifies the count of mirrors.
      </p></li><li class="listitem "><p>
       <code class="literal">-L</code> - specifies the size of the logical volume.
      </p></li><li class="listitem "><p>
       <code class="literal">-n</code> - by using this option you specify a name of the
       logical volume.
      </p></li><li class="listitem "><p>
       <code class="literal">vg1</code> - is a name of the volume group used by the
       logical volume.
      </p></li></ul></div><p>
     LVM creates a logical volume of one extent size for each data volume in
     the array. If you have two mirrored volumes, LVM creates another two
     volumes that stores metadata.
    </p><p>
     After you create a RAID logical volume, you can use the volume in the same
     way as a common logical volume. You can activate it, extend it, etc.
    </p></div></div></div><div class="sect1 " id="lvm_activate_vgs"><div class="titlepage"><div><div><h2 class="title" id="lvm_activate_vgs"><span class="number">5.4 </span><span class="name">Automatically Activating Non-Root LVM Volume Groups</span> <a title="Permalink" class="permalink" href="#lvm_activate_vgs">#</a></h2></div></div></div><p>
   Activation behavior for non-root LVM volume groups is controlled in the
   <code class="literal">/etc/lvm/lvm.conf</code> file and by the
   <em class="parameter ">auto_activation_volume_list</em> parameter. By default,
   the parameter is empty and all volumes are activated. To activate only some
   volume groups, add the names in quotes and separate them with commas, for
   example:
  </p><div class="verbatim-wrap"><pre class="screen">auto_activation_volume_list = [ "vg1", "vg2/lvol1", "@tag1", "@*" ]</pre></div><p>
   If you have defined a list in the
   <em class="parameter ">auto_activation_volume_list</em> parameter, the following
   will happen:

  </p><div class="orderedlist "><ol class="orderedlist" type="1"><li class="listitem "><p>
     Each logical volume is first checked against this list.
    </p></li><li class="listitem "><p>
     If it does not match, the logical volume will not be activated.
    </p></li></ol></div><p>
   By default, non-root LVM volume groups are automatically activated on system
   restart by Dracut. This parameter allows you to activate all volume groups
   on system restart, or to activate only specified non-root LVM volume groups.
  </p></div><div class="sect1 " id="sec.lvm.vg_resize"><div class="titlepage"><div><div><h2 class="title" id="sec.lvm.vg_resize"><span class="number">5.5 </span><span class="name">Resizing an Existing Volume Group</span> <a title="Permalink" class="permalink" href="#sec.lvm.vg_resize">#</a></h2></div></div></div><p>
   The space provided by a volume group can be expanded at any time in the
   running system without service interruption by adding more physical volumes.
   This will allow you to add logical volumes to the group or to expand the
   size of existing volumes as described in
   <a class="xref" href="#sec.lvm.lv_resize" title="5.6. Resizing a Logical Volume">Section 5.6, “Resizing a Logical Volume”</a>.
  </p><p>
   It is also possible to reduce the size of the volume group by removing
   physical volumes. YaST only allows to remove physical volumes that are
   currently unused. To find out which physical volumes are currently in use,
   run the following command. The partitions (physical volumes) listed in the
   <code class="literal">PE Ranges</code> column are the ones in use:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> pvs -o vg_name,lv_name,pv_name,seg_pe_ranges
root's password:
  VG   LV    PV         PE Ranges
             /dev/sda1
  DATA DEVEL /dev/sda5  /dev/sda5:0-3839
  DATA       /dev/sda5
  DATA LOCAL /dev/sda6  /dev/sda6:0-2559
  DATA       /dev/sda7
  DATA       /dev/sdb1
  DATA       /dev/sdc1</pre></div><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
     Launch YaST and open the <span class="guimenu">Partitioner</span>.
    </p></li><li class="step "><p>
     In the left panel, select <span class="guimenu">Volume Management</span>. A list of
     existing Volume Groups opens in the right panel.
    </p></li><li class="step "><p>
     Select the volume group you want to change, then click
     <span class="guimenu">Resize</span>.
    </p><div class="informalfigure"><div class="mediaobject"><a xmlns="" href="images/yast2_lvm8_a.png"><img src="images/yast2_lvm8_a.png" width="" /></a></div></div></li><li class="step "><p>
     Do one of the following:
    </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p><span class="formalpara-title">Add: </span>
        Expand the size of the volume group by moving one or more physical
        volumes (LVM partitions) from the <span class="guimenu">Available Physical
        Volumes</span> list to the <span class="guimenu">Selected Physical
        Volumes</span> list.
       </p></li><li class="listitem "><p><span class="formalpara-title">Remove: </span>
        Reduce the size of the volume group by moving one or more physical
        volumes (LVM partitions) from the <span class="guimenu">Selected Physical
        Volumes</span> list to the <span class="guimenu">Available Physical
        Volumes</span> list.
       </p></li></ul></div></li><li class="step "><p>
     Click <span class="guimenu">Finish</span>.
    </p></li><li class="step "><p>
     Click <span class="guimenu">Next</span>, verify that the changes are listed, then
     click <span class="guimenu">Finish</span>.
    </p></li></ol></div></div></div><div class="sect1 " id="sec.lvm.lv_resize"><div class="titlepage"><div><div><h2 class="title" id="sec.lvm.lv_resize"><span class="number">5.6 </span><span class="name">Resizing a Logical Volume</span> <a title="Permalink" class="permalink" href="#sec.lvm.lv_resize">#</a></h2></div></div></div><p>
   In case there is unused free space available in the volume group, you can
   enlarge a logical volume to provide more usable space. You may also reduce
   the size of a volume to free space in the volume group that can be used by
   other logical volumes.
  </p><div id="idm139787669818752" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.png" /><h6>Note: <span class="quote">“<span class="quote">Online</span>”</span> Resizing</h6><p>
    When reducing the size of a volume, YaST automatically resizes its file
    system, too. Whether a volume that is currently mounted can be resized
    <span class="quote">“<span class="quote">online</span>”</span> (that is while being mounted), depends on its file
    system. Growing the file system online is supported by Btrfs, XFS, Ext3,
    and Ext4.
   </p><p>
    Shrinking the file system online is only supported by Btrfs. To shrink the
    Ext2/3/4 file systems, you need to unmount them. Shrinking volumes formatted
    with XFS is not possible, since XFS does not support file system shrinking.
   </p></div><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
     Launch YaST and open the <span class="guimenu">Partitioner</span>.
    </p></li><li class="step "><p>
     In the left panel, select <span class="guimenu">Volume Management</span>. A list of
     existing Volume Groups opens in the right panel.
    </p></li><li class="step "><p>
     Select the logical volume you want to change, then click
     <span class="guimenu">Resize</span>.
    </p><div class="informalfigure"><div class="mediaobject"><a xmlns="" href="images/yast2_lvm12_a.png"><img src="images/yast2_lvm12_a.png" width="" /></a></div></div></li><li class="step "><p>
     Set the intended size by using one of the following options:
    </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p><span class="formalpara-title">Maximum Size. </span>
        Expand the size of the logical volume to use all space left in the
        volume group.
       </p></li><li class="listitem "><p><span class="formalpara-title">Minimum Size. </span>
        Reduce the size of the logical volume to the size occupied by the data
        and the file system metadata.
       </p></li><li class="listitem "><p><span class="formalpara-title">Custom Size. </span>
        Specify the new size for the volume. The value must be within the range
        of the minimum and maximum values listed above. Use K, M, G, T for
        Kilobytes, Megabytes, Gigabytes and Terabytes (for example
        <code class="literal">20G</code>).
       </p></li></ul></div></li><li class="step "><p>
     Click <span class="guimenu">OK</span>.
    </p></li><li class="step "><p>
     Click <span class="guimenu">Next</span>, verify that the change is listed, then
     click <span class="guimenu">Finish</span>.
    </p></li></ol></div></div></div><div class="sect1 " id="sec.lvm.delete"><div class="titlepage"><div><div><h2 class="title" id="sec.lvm.delete"><span class="number">5.7 </span><span class="name">Deleting a Volume Group or a Logical Volume</span> <a title="Permalink" class="permalink" href="#sec.lvm.delete">#</a></h2></div></div></div><div id="idm139787669793872" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.png" /><h6>Warning: Data Loss</h6><p>
    Deleting a volume group destroys all of the data in each of its member
    partitions. Deleting a logical volume destroys all data stored on the
    volume.
   </p></div><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
     Launch YaST and open the <span class="guimenu">Partitioner</span>.
    </p></li><li class="step "><p>
     In the left panel, select <span class="guimenu">Volume Management</span>. A list of
     existing volume groups opens in the right panel.
    </p></li><li class="step "><p>
     Select the volume group or the logical volume you want to remove and click
     <span class="guimenu">Delete</span>.
    </p></li><li class="step "><p>
     Depending on your choice warning dialogs are shown. Confirm them with
     <span class="guimenu">Yes</span>.
    </p></li><li class="step "><p>
     Click <span class="guimenu">Next</span>, verify that the deleted volume group is
     listed (deletion is indicated by a red colored font), then click
     <span class="guimenu">Finish</span>.
    </p></li></ol></div></div></div><div class="sect1 " id="sec.lvm.cli"><div class="titlepage"><div><div><h2 class="title" id="sec.lvm.cli"><span class="number">5.8 </span><span class="name">Using LVM Commands</span> <a title="Permalink" class="permalink" href="#sec.lvm.cli">#</a></h2></div></div></div><p>
   For information about using LVM commands, see the man pages for the commands
   described in the following table. All commands need to be executed with
   <code class="systemitem">root</code> privileges. Either use <code class="command">sudo</code>
   <em class="replaceable ">COMMAND</em> (recommended) or execute them directly as
   <code class="systemitem">root</code>.
  </p><div class="variablelist "><div class="variablelist-title-wrap"><h6 class="variablelist-title"><span class="name">LVM Commands </span><a title="Permalink" class="permalink" href="#idm139787669780160">#</a></h6></div><dl class="variablelist"><dt id="idm139787669779424"><span class="term "><code class="command">pvcreate <em class="replaceable ">DEVICE</em></code></span></dt><dd><p>
      Initializes a device (such as <code class="filename">/dev/sdb1</code>) for use by
      LVM as a physical volume. If there is any file system on the specified
      device, a warning appears. Bear in mind that <code class="command">pvcreate</code>
      checks for existing file systems only if <code class="command">blkid</code> is
      installed (which is done by default). If <code class="command">blkid</code> is not
      available, <code class="command">pvcreate</code> will not produce any warning and
      you may lose your file system without any warning.
     </p></dd><dt id="idm139787669774672"><span class="term "><code class="command">pvdisplay <em class="replaceable ">DEVICE</em></code></span></dt><dd><p>
      Displays information about the LVM physical volume, such as whether it is
      currently being used in a logical volume.
     </p></dd><dt id="idm139787669772352"><span class="term ">
     <code class="command">vgcreate -c y <em class="replaceable ">VG_NAME</em> <em class="replaceable ">DEV1</em> [<em class="replaceable ">DEV2</em>...]</code>
    </span></dt><dd><p>
      Creates a clustered volume group with one or more specified devices.
     </p></dd><dt id="idm139787669768704"><span class="term ">
     <code class="command">vgcreate --activationmode <em class="replaceable ">ACTIVATION_MODE</em> <em class="replaceable ">VG_NAME</em></code>
    </span></dt><dd><p>
      Configures the mode of volume group activation. You can specify one of
      the following values:
     </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
        <code class="literal">complete</code> - only the logical volumes that are not
        affected by missing physical volumes can be activated, even though the
        particular logical volume can tolerate such a failure.
       </p></li><li class="listitem "><p>
        <code class="literal">degraded</code> - is the default activation mode. If there
        is a sufficient level of redundancy to activate a logical volume, the
        logical volume can be activated even though some physical volumes are
        missing.
       </p></li><li class="listitem "><p>
        <code class="literal">partial</code> - the LVM tries to activate the volume group
        even though some physical volumes are missing. If a non-redundant
        logical volume is missing important physical volumes, then the logical
        volume usually cannot be activated and is handled as an error target.
       </p></li></ul></div></dd><dt id="idm139787669760480"><span class="term ">
     <code class="command">vgchange -a [ey|n] <em class="replaceable ">VG_NAME</em></code>
    </span></dt><dd><p>
      Activates (<code class="literal">-a ey</code>) or deactivates (<code class="literal">-a
      n</code>) a volume group and its logical volumes for input/output.
     </p><p>
      When activating a volume in a cluster, ensure that you use the
      <code class="literal">ey</code> option. This option is used by default in the load
      script.
     </p></dd><dt id="idm139787669756000"><span class="term "><code class="command">vgremove <em class="replaceable ">VG_NAME</em></code></span></dt><dd><p>
      Removes a volume group. Before using this command, remove the logical
      volumes, then deactivate the volume group.
     </p></dd><dt id="idm139787669753680"><span class="term ">
     <code class="command">vgdisplay <em class="replaceable ">VG_NAME</em></code>
    </span></dt><dd><p>
      Displays information about a specified volume group.
     </p><p>
      To find the total physical extent of a volume group, enter
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code>vgdisplay <em class="replaceable ">VG_NAME</em> | grep "Total PE"</pre></div></dd><dt id="idm139787669749424"><span class="term ">
     <code class="command">lvcreate -L <em class="replaceable ">SIZE</em> -n
     <em class="replaceable ">LV_NAME</em>
     <em class="replaceable ">VG_NAME</em></code>
    </span></dt><dd><p>
      Creates a logical volume of the specified size.
     </p></dd><dt id="idm139787669745952"><span class="term ">
     <code class="command">lvcreate -L <em class="replaceable ">SIZE</em> --thinpool
     <em class="replaceable ">POOL_NAME</em>
     <em class="replaceable ">VG_NAME</em></code>
    </span></dt><dd><p>
      Creates a thin pool named <code class="literal">myPool</code> of the specified
      size from the volume group <em class="replaceable ">VG_NAME</em>.
     </p><p>
      The following example creates a thin pool with a size of 5 GB from the
      volume group <code class="literal">LOCAL</code>:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> lvcreate -L 5G --thinpool myPool LOCAL</pre></div></dd><dt id="idm139787669739568"><span class="term ">
     <code class="command">lvcreate -T
     <em class="replaceable ">VG_NAME</em>/<em class="replaceable ">POOL_NAME</em> -V
     <em class="replaceable ">SIZE</em> -n
     <em class="replaceable ">LV_NAME</em></code>
    </span></dt><dd><p>
      Creates a thin logical volume within the pool
      <em class="replaceable ">POOL_NAME</em>. The following example creates a 1GB
      thin volume named <code class="literal">myThin1</code> from the pool
      <code class="literal">myPool</code> on the volume group <code class="literal">LOCAL</code>:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> lvcreate -T LOCAL/myPool -V 1G -n myThin1</pre></div></dd><dt id="idm139787669732752"><span class="term ">
     <code class="command">lvcreate -T
     <em class="replaceable ">VG_NAME</em>/<em class="replaceable ">POOL_NAME</em> -V
     <em class="replaceable ">SIZE</em> -L <em class="replaceable ">SIZE</em> -n
     <em class="replaceable ">LV_NAME</em></code>
    </span></dt><dd><p>
      It is also possible to combine thin pool and thin logical volume
      creation in one command:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> lvcreate -T LOCAL/myPool -V 1G -L 5G -n myThin1</pre></div></dd><dt id="idm139787669727280"><span class="term ">
     <code class="command">lvcreate --activationmode
     <em class="replaceable ">ACTIVATION_MODE</em>
     <em class="replaceable ">LV_NAME</em></code>
    </span></dt><dd><p>
      Configures the mode of logical volume activation. You can specify one
      of the following values:
     </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
        <code class="literal">complete</code> - the logical volume can be activated
        only if all its physical volumes are active.
       </p></li><li class="listitem "><p>
        <code class="literal">degraded</code> - is the default activation mode. If
        there is a sufficient level of redundancy to activate a logical
        volume, the logical volume can be activated even though some physical
        volumes are missing.
       </p></li><li class="listitem "><p>
        <code class="literal">partial</code> - the LVM tries to activate the volume
        even though some physical volumes are missing. In this case part of
        the logical volume may be unavailable and it might cause data
        loss. This option is typically not used, but might be useful when
        restoring data.
       </p></li></ul></div><p>
      You can specify the activation mode also in
      <code class="filename">/etc/lvm/lvm.conf</code> by specifying one of the above
      described values of the <code class="literal">activation_mode</code>
      configuration option.
     </p></dd><dt id="idm139787669717696"><span class="term ">
     <code class="command">lvcreate -s [-L <em class="replaceable ">SIZE</em>] -n
    <em class="replaceable ">SNAP_VOLUME</em>
    <em class="replaceable ">SOURCE_VOLUME_PATH</em>
     <em class="replaceable ">VG_NAME</em></code>
    </span></dt><dd><p>
      Creates a snapshot volume for the specified logical volume. If the size
      option (<code class="option">-L</code> or <code class="option">--size</code>) is not
      included, the snapshot is created as a thin snapshot.
     </p></dd><dt id="idm139787669712784"><span class="term ">
     <code class="command">lvremove
     /dev/<em class="replaceable ">VG_NAME</em>/<em class="replaceable ">LV_NAME</em></code>
    </span></dt><dd><p>
      Removes a logical volume.
     </p><p>
      Before using this command, close the logical volume by unmounting it
      with the <code class="command">umount</code> command.
     </p></dd><dt id="idm139787669708816"><span class="term ">
     <code class="command">lvremove <em class="replaceable ">SNAP_VOLUME_PATH</em></code>
    </span></dt><dd><p>
      Removes a snapshot volume.
     </p></dd><dt id="idm139787669706272"><span class="term ">
     <code class="command">lvconvert --merge
     <em class="replaceable ">SNAP_VOLUME_PATH</em></code>
    </span></dt><dd><p>
      Reverts the logical volume to the version of the snapshot.
     </p></dd><dt id="idm139787669703696"><span class="term ">
     <code class="command">vgextend <em class="replaceable ">VG_NAME</em>
     <em class="replaceable ">DEVICE</em></code>
    </span></dt><dd><p>
      Adds the specified device (physical volume) to an existing volume
      group.
     </p></dd><dt id="idm139787669700640"><span class="term ">
     <code class="command">vgreduce <em class="replaceable ">VG_NAME</em>
     <em class="replaceable ">DEVICE</em></code>
    </span></dt><dd><p>
      Removes a specified physical volume from an existing volume group.
     </p><p>
      Ensure that the physical volume is not currently being used by a
      logical volume. If it is, you must move the data to another physical
      volume by using the <code class="command">pvmove</code> command.
     </p></dd><dt id="idm139787669696544"><span class="term ">
     <code class="command">lvextend -L <em class="replaceable ">SIZE</em>
     /dev/<em class="replaceable ">VG_NAME</em>/<em class="replaceable ">LV_NAME</em></code>
    </span></dt><dd><p>
      Extends the size of a specified logical volume. Afterward, you must also
      expand the file system to take advantage of the newly available
      space. See <a class="xref" href="#cha.resize_fs" title="Chapter 2. Resizing File Systems">Chapter 2, <em>Resizing File Systems</em></a> for details.
     </p></dd><dt id="idm139787669692416"><span class="term ">
     <code class="command">lvreduce -L <em class="replaceable ">SIZE</em>
     /dev/<em class="replaceable ">VG_NAME</em>/<em class="replaceable ">LV_NAME</em></code>
    </span></dt><dd><p>
      Reduces the size of a specified logical volume.
     </p><p>
      Ensure that you reduce the size of the file system first before
      shrinking the volume, otherwise you risk losing data. See
      <a class="xref" href="#cha.resize_fs" title="Chapter 2. Resizing File Systems">Chapter 2, <em>Resizing File Systems</em></a> for details.
     </p></dd><dt id="idm139787669687808"><span class="term ">
     <code class="command">lvrename
     /dev/<em class="replaceable ">VG_NAME</em>/<em class="replaceable ">LV_NAME</em>
     /dev/<em class="replaceable ">VG_NAME</em>/<em class="replaceable ">NEW_LV_NAME</em></code>
    </span></dt><dd><p>
      Renames an existing LVM logical volume. It does not change the volume
      group name.
     </p></dd></dl></div><div id="idm139787669683696" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.png" /><h6>Tip: Bypassing udev on Volume Creation</h6><p>
    In case you want to manage LV device nodes and symbolic links by using LVM
    instead of by using udev rules, you can achieve this by disabling
    notifications from udev with one of the following methods:
   </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
      Configure <code class="literal">activation/udev_rules = 0</code> and
      <code class="literal">activation/udev_sync = 0</code> in
      <code class="filename">/etc/lvm/lvm.conf</code>.
     </p><p>
      Note that specifying <code class="option">--nodevsync</code> with the
      <code class="command">lvcreate</code> command has the same effect as
      <code class="literal">activation/udev_sync = 0</code>; setting
      <code class="literal">activation/udev_rules = 0</code> is still required.
     </p></li><li class="listitem "><p>
      Setting the environment variable <code class="envar">DM_DISABLE_UDEV</code>:
     </p><div class="verbatim-wrap"><pre class="screen">export DM_DISABLE_UDEV=1</pre></div><p>
      This will also disable notifications from udev. In addition, all udev
      related settings from <code class="filename">/etc/lvm/lvm.conf</code> will be
      ignored.
     </p></li></ul></div></div><div class="sect2 " id="sec.lvm.cli.resize"><div class="titlepage"><div><div><h3 class="title" id="sec.lvm.cli.resize"><span class="number">5.8.1 </span><span class="name">Resizing a Logical Volume with Commands</span> <a title="Permalink" class="permalink" href="#sec.lvm.cli.resize">#</a></h3></div></div></div><p>
    The <code class="command">lvresize</code>, <code class="command">lvextend</code>, and
    <code class="command">lvreduce</code> commands are used to resize logical volumes.
    See the man pages for each of these commands for syntax and options
    information. To extend an LV there must be enough unallocated space
    available on the VG.
   </p><p>
    The recommended way to grow or shrink a logical volume is to use the YaST
    Partitioner. When using YaST, the size of the file system in the volume
    will automatically be adjusted, too.
   </p><p>
    LVs can be extended or shrunk manually while they are being used, but this
    may not be true for a file system on them. Extending or shrinking the LV
    does not automatically modify the size of file systems in the volume. You
    must use a different command to grow the file system afterward. For
    information about resizing file systems, see
    <a class="xref" href="#cha.resize_fs" title="Chapter 2. Resizing File Systems">Chapter 2, <em>Resizing File Systems</em></a>.
   </p><p>
    Ensure that you use the right sequence when manually resizing an LV:
   </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
      If you extend an LV, you must extend the LV before you attempt to grow
      the file system.
     </p></li><li class="listitem "><p>
      If you shrink an LV, you must shrink the file system before you attempt
      to shrink the LV.
     </p></li></ul></div><p>
    To extend the size of a logical volume:
   </p><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
      Open a terminal console.
     </p></li><li class="step "><p>
      If the logical volume contains an Ext2 or Ext4 file system, which do not
      support online growing, dismount it. In case it contains file systems
      that are hosted for a virtual machine (such as a Xen VM), shut down the
      VM first.
     </p></li><li class="step "><p>
      At the terminal console prompt, enter the following command to grow the
      size of the logical volume:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> lvextend -L +<em class="replaceable ">SIZE</em> /dev/<em class="replaceable ">VG_NAME</em>/<em class="replaceable ">LV_NAME</em></pre></div><p>
      For <em class="replaceable ">SIZE</em>, specify the amount of space you want
      to add to the logical volume, such as 10 GB. Replace
      <code class="filename">/dev/<em class="replaceable ">VG_NAME</em>/<em class="replaceable ">LV_NAME</em></code>
      with the Linux path to the logical volume, such as
      <code class="filename">/dev/LOCAL/DATA</code>. For example:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> lvextend -L +10GB /dev/vg1/v1<em class="replaceable "></em></pre></div></li><li class="step "><p>
      Adjust the size of the file system. See <a class="xref" href="#cha.resize_fs" title="Chapter 2. Resizing File Systems">Chapter 2, <em>Resizing File Systems</em></a>
      for details.
     </p></li><li class="step "><p>
      In case you have dismounted the file system, mount it again.
     </p></li></ol></div></div><p>
    For example, to extend an LV with a (mounted and active) Btrfs on it by 10
    GB:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> lvextend −L +10G /dev/LOCAL/DATA
<code class="prompt user">tux &gt; </code><code class="command">sudo</code> btrfs filesystem resize +10G /dev/LOCAL/DATA</pre></div><p>
    To shrink the size of a logical volume:
   </p><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
      Open a terminal console.
     </p></li><li class="step "><p>
      If the logical volume does not contain a Btrfs file system, dismount it.
      In case it contains file systems that are hosted for a virtual machine
      (such as a Xen VM), shut down the VM first. Note that volumes with the
      XFS file system cannot be reduced in size.
     </p></li><li class="step "><p>
      Adjust the size of the file system. See <a class="xref" href="#cha.resize_fs" title="Chapter 2. Resizing File Systems">Chapter 2, <em>Resizing File Systems</em></a>
      for details.
     </p></li><li class="step "><p>
      At the terminal console prompt, enter the following command to shrink the
      size of the logical volume to the size of the file system:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> lvreduce /dev/<em class="replaceable ">VG_NAME</em>/<em class="replaceable ">LV_NAME</em></pre></div></li><li class="step "><p>
      In case you have unmounted the file system, mount it again.
     </p></li></ol></div></div><p>
    For example, to shrink an LV with a Btrfs on it by 5 GB:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> btrfs filesystem resize -size 5G /dev/LOCAL/DATA
sudo lvreduce /dev/LOCAL/DATA</pre></div><div id="idm139787669640656" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.png" /><h6>Tip: 
     Resizing the Volume and the File System with a Single Command
    </h6><p>
     Starting with <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> 12 SP1, <code class="command">lvextend</code>,
     <code class="command">lvresize</code>, and <code class="command">lvreduce</code> support the
     option <code class="option">--resizefs</code> which will not only change the size of
     the volume, but will also resize the file system. Therefore the examples
     for <code class="command">lvextend</code> and <code class="command">lvreduce</code> shown
     above can alternatively be run as follows:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> lvextend --resizefs −L +10G /dev/LOCAL/DATA
<code class="prompt user">tux &gt; </code><code class="command">sudo</code> lvreduce  --resizefs -L -5G /dev/LOCAL/DATA</pre></div><p>
     Note that the <code class="option">--resizefs</code> is supported for the following
     file systems: ext2/3/4, Btrfs, XFS. Resizing Btrfs with this option is
     currently only available on <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span>, since it is not yet accepted
     upstream.
    </p></div></div><div class="sect2 " id="sec.lvm.cli.lvmetad"><div class="titlepage"><div><div><h3 class="title" id="sec.lvm.cli.lvmetad"><span class="number">5.8.2 </span><span class="name">Dynamic Aggregation of LVM Metadata via <code class="systemitem">lvmetad</code></span> <a title="Permalink" class="permalink" href="#sec.lvm.cli.lvmetad">#</a></h3></div></div></div><p>
    Most LVM commands require an accurate view of the LVM metadata stored on
    the disk devices in the system. With the current LVM design, if this
    information is not available, LVM must scan all the physical disk devices
    in the system. This requires a significant amount of I/O operations in
    systems that have many disks. In case a disk fails to respond, LVM commands
    might run into a timeout while waiting for the disk.
   </p><p>
    Dynamic aggregation of LVM metadata via
    <code class="systemitem">lvmetad</code> provides a solution for
    this problem. The purpose of the
    <code class="systemitem">lvmetad</code> daemon is to eliminate the
    need for this scanning by dynamically aggregating metadata information each
    time the status of a device changes. These events are signaled to
    <code class="systemitem">lvmetad</code> by udev rules. If the
    daemon is not running, LVM performs a scan as it normally would do.
   </p><p>
    This feature is enabled by default. In case it is disabled on your system,
    proceed as follows to enable it:
   </p><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
      Open a terminal console.
     </p></li><li class="step "><p>
      Stop the <code class="systemitem">lvmetad</code> daemon:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> systemctl stop lvm2-lvmetad</pre></div></li><li class="step "><p>
      Edit <code class="filename">/etc/lvm/lvm.conf</code> and set
      <code class="literal">use_lvmetad</code> to <code class="literal">1</code>:
     </p><div class="verbatim-wrap"><pre class="screen">use_lvmetad = 1</pre></div></li><li class="step "><p>
      Restart the <code class="systemitem">lvmetad</code> daemon:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> systemctl start lvm2-lvmetad</pre></div></li></ol></div></div></div><div class="sect2 " id="sec.lvm.cli.lvmcache"><div class="titlepage"><div><div><h3 class="title" id="sec.lvm.cli.lvmcache"><span class="number">5.8.3 </span><span class="name">Using LVM Cache Volumes</span> <a title="Permalink" class="permalink" href="#sec.lvm.cli.lvmcache">#</a></h3></div></div></div><p>
    LVM supports the use of fast block devices (such as an SSD device) as
    write-back or write-through caches for large slower block devices. The
    cache logical volume type uses a small and fast LV to improve the
    performance of a large and slow LV.
   </p><p>
    To set up LVM caching, you need to create two logical volumes on the
    caching device. A large one is used for the caching itself, a smaller
    volume is used to store the caching metadata. These two volumes need to be
    part of the same volume group as the original volume. When these volumes
    are created, they need to be converted into a cache pool which needs to be
    attached to the original volume:
   </p><div class="procedure " id="idm139787669612720"><div class="procedure-title-wrap"><h6 class="procedure-title"><span class="number">Procedure 5.2: </span><span class="name">Setting up a Cached Logical Volume </span><a title="Permalink" class="permalink" href="#idm139787669612720">#</a></h6></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
      Create the original volume (on a slow device) if not already existing.
     </p></li><li class="step "><p>
      Add the physical volume (from a fast device) to the same volume group the
      original volume is part of and create the cache data volume on the
      physical volume.
     </p></li><li class="step "><p>
      Create the cache metadata volume. The size should be 1/1000 of the size
      of the cache data volume, with a minimum size of 8 MB.
     </p></li><li class="step "><p>
      Combine the cache data volume and metadata volume into a cache pool
      volume:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> lvconvert --type cache-pool --poolmetadata <em class="replaceable ">VOLUME_GROUP/METADATA_VOLUME</em> <em class="replaceable ">VOLUME_GROUP/CACHING_VOLUME</em></pre></div></li><li class="step "><p>
      Attach the cache pool to the original volume:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> lvconvert --type cache --cachepool <em class="replaceable ">VOLUME_GROUP/CACHING_VOLUME</em> <em class="replaceable ">VOLUME_GROUP/ORIGINAL_VOLUME</em></pre></div></li></ol></div></div><p>
    For more information on LVM caching, see the lvmcache(7) man page.
   </p></div></div><div class="sect1 " id="sec.lvm.tagging"><div class="titlepage"><div><div><h2 class="title" id="sec.lvm.tagging"><span class="number">5.9 </span><span class="name">Tagging LVM2 Storage Objects</span> <a title="Permalink" class="permalink" href="#sec.lvm.tagging">#</a></h2></div></div></div><p>
   A tag is an unordered keyword or term assigned to the metadata of a storage
   object. Tagging allows you to classify collections of LVM storage objects in
   ways that you find useful by attaching an unordered list of tags to their
   metadata.
  </p><div class="sect2 " id="sec.lvm.tagging.using"><div class="titlepage"><div><div><h3 class="title" id="sec.lvm.tagging.using"><span class="number">5.9.1 </span><span class="name">Using LVM2 Tags</span> <a title="Permalink" class="permalink" href="#sec.lvm.tagging.using">#</a></h3></div></div></div><p>
    After you tag the LVM2 storage objects, you can use the tags in commands to
    accomplish the following tasks:
   </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
      Select LVM objects for processing according to the presence or absence of
      specific tags.
     </p></li><li class="listitem "><p>
      Use tags in the configuration file to control which volume groups and
      logical volumes are activated on a server.
     </p></li><li class="listitem "><p>
      Override settings in a global configuration file by specifying tags in
      the command.
     </p></li></ul></div><p>
    A tag can be used in place of any command line LVM object reference that
    accepts:
   </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
      a list of objects
     </p></li><li class="listitem "><p>
      a single object as long as the tag expands to a single object
     </p></li></ul></div><p>
    Replacing the object name with a tag is not supported everywhere yet. After
    the arguments are expanded, duplicate arguments in a list are resolved by
    removing the duplicate arguments, and retaining the first instance of each
    argument.
   </p><p>
    Wherever there might be ambiguity of argument type, you must prefix a tag
    with the commercial at sign (@) character, such as
    <code class="literal">@mytag</code>. Elsewhere, using the <span class="quote">“<span class="quote">@</span>”</span> prefix is
    optional.
   </p></div><div class="sect2 " id="sec.lvm.tagging.requirements"><div class="titlepage"><div><div><h3 class="title" id="sec.lvm.tagging.requirements"><span class="number">5.9.2 </span><span class="name">Requirements for Creating LVM2 Tags</span> <a title="Permalink" class="permalink" href="#sec.lvm.tagging.requirements">#</a></h3></div></div></div><p>
    Consider the following requirements when using tags with LVM:
   </p><div class="variablelist "><dl class="variablelist"><dt id="idm139787669587088"><span class="term ">Supported Characters</span></dt><dd><p>
       An LVM tag word can contain the ASCII uppercase characters A to Z,
       lowercase characters a to z, numbers 0 to 9, underscore (_), plus (+),
       hyphen (-), and period (.). The word cannot begin with a hyphen. The
       maximum length is 128 characters.
      </p></dd><dt id="idm139787669585040"><span class="term ">Supported Storage Objects</span></dt><dd><p>
       You can tag LVM2 physical volumes, volume groups, logical volumes, and
       logical volume segments. PV tags are stored in its volume group’s
       metadata. Deleting a volume group also deletes the tags in the orphaned
       physical volume. Snapshots cannot be tagged, but their origin can be
       tagged.
      </p><p>
       LVM1 objects cannot be tagged because the disk format does not support
       it.
      </p></dd></dl></div></div><div class="sect2 " id="sec.lvm.tagging.syntax"><div class="titlepage"><div><div><h3 class="title" id="sec.lvm.tagging.syntax"><span class="number">5.9.3 </span><span class="name">Command Line Tag Syntax</span> <a title="Permalink" class="permalink" href="#sec.lvm.tagging.syntax">#</a></h3></div></div></div><div class="variablelist "><dl class="variablelist"><dt id="idm139787669580672"><span class="term "><code class="option">--addtag</code><em class="replaceable ">TAG_INFO</em>
     </span></dt><dd><p>
       Add a tag to (or <span class="emphasis"><em>tag</em></span>) an LVM2 storage object.
       Example:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> vgchange --addtag @db1 vg1</pre></div></dd><dt id="idm139787669576768"><span class="term "><code class="option">--deltag</code><em class="replaceable ">TAG_INFO</em>
     </span></dt><dd><p>
       Remove a tag from (or <span class="emphasis"><em>untag</em></span>) an LVM2 storage
       object. Example:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> vgchange --deltag @db1 vg1</pre></div></dd><dt id="idm139787669572864"><span class="term "><code class="option">--tag</code><em class="replaceable ">TAG_INFO</em>
     </span></dt><dd><p>
       Specify the tag to use to narrow the list of volume groups or logical
       volumes to be activated or deactivated.
      </p><p>
       Enter the following to activate the volume if it has a tag that matches
       the tag provided (example):
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> lvchange -ay --tag @db1 vg1/vol2</pre></div></dd></dl></div></div><div class="sect2 " id="sec.lvm.tagging.config"><div class="titlepage"><div><div><h3 class="title" id="sec.lvm.tagging.config"><span class="number">5.9.4 </span><span class="name">Configuration File Syntax</span> <a title="Permalink" class="permalink" href="#sec.lvm.tagging.config">#</a></h3></div></div></div><p>
    The following sections show example configurations for certain use cases.
   </p><div class="sect3 " id="sec.lvm.tagging.configuration.hostnames_enable"><div class="titlepage"><div><div><h4 class="title" id="sec.lvm.tagging.configuration.hostnames_enable"><span class="number">5.9.4.1 </span><span class="name">Enabling Host Name Tags in the <code class="filename">lvm.conf</code> File</span> <a title="Permalink" class="permalink" href="#sec.lvm.tagging.configuration.hostnames_enable">#</a></h4></div></div></div><p>
     Add the following code to the <code class="filename">/etc/lvm/lvm.conf</code> file
     to enable host tags that are defined separately on host in a
     <code class="filename">/etc/lvm/lvm_&lt;<em class="replaceable ">HOSTNAME</em>&gt;.conf</code>
     file.
    </p><div class="verbatim-wrap"><pre class="screen">tags {
   # Enable hostname tags
   hosttags = 1
}</pre></div><p>
     You place the activation code in the
     <code class="filename">/etc/lvm/lvm_&lt;<em class="replaceable ">HOSTNAME</em>&gt;.conf</code>
     file on the host. See
     <a class="xref" href="#sec.lvm.tagging.configuration.activate" title="5.9.4.3. Defining Activation">Section 5.9.4.3, “Defining Activation”</a>.
    </p></div><div class="sect3 " id="sec.lvm.tagging.configuration.hostnames_define"><div class="titlepage"><div><div><h4 class="title" id="sec.lvm.tagging.configuration.hostnames_define"><span class="number">5.9.4.2 </span><span class="name">Defining Tags for Host Names in the lvm.conf File</span> <a title="Permalink" class="permalink" href="#sec.lvm.tagging.configuration.hostnames_define">#</a></h4></div></div></div><div class="verbatim-wrap"><pre class="screen">tags {

   tag1 { }
      # Tag does not require a match to be set.

   tag2 {
      # If no exact match, tag is not set.
      host_list = [ "hostname1", "hostname2" ]
   }
}</pre></div></div><div class="sect3 " id="sec.lvm.tagging.configuration.activate"><div class="titlepage"><div><div><h4 class="title" id="sec.lvm.tagging.configuration.activate"><span class="number">5.9.4.3 </span><span class="name">Defining Activation</span> <a title="Permalink" class="permalink" href="#sec.lvm.tagging.configuration.activate">#</a></h4></div></div></div><p>
     You can modify the <code class="filename">/etc/lvm/lvm.conf</code> file to activate
     LVM logical volumes based on tags.
    </p><p>
     In a text editor, add the following code to the file:
    </p><div class="verbatim-wrap"><pre class="screen">  activation {
      volume_list = [ "vg1/lvol0", "@database" ]
  }</pre></div><p>
     Replace <code class="literal">@database</code> with your tag. Use
     <code class="literal">"@*"</code> to match the tag against any tag set on the host.
    </p><p>
     The activation command matches against <em class="replaceable ">VGNAME</em>,
     <em class="replaceable ">VGNAME/LVNAME</em>, or
     @<em class="replaceable ">TAG</em> set in the metadata of volume groups and
     logical volumes. A volume group or logical volume is activated only if a
     metadata tag matches. The default if there is no match, is not to
     activate.
    </p><p>
     If <code class="literal">volume_list</code> is not present and tags are defined on
     the host, then it activates the volume group or logical volumes only if a
     host tag matches a metadata tag.
    </p><p>
     If <code class="literal">volume_list</code> is defined, but empty, and no tags are
     defined on the host, then it does not activate.
    </p><p>
     If volume_list is undefined, it imposes no limits on LV activation (all
     are allowed).
    </p></div><div class="sect3 " id="sec.lvm.tagging.configuration.activate_multi"><div class="titlepage"><div><div><h4 class="title" id="sec.lvm.tagging.configuration.activate_multi"><span class="number">5.9.4.4 </span><span class="name">Defining Activation in Multiple Host Name Configuration Files</span> <a title="Permalink" class="permalink" href="#sec.lvm.tagging.configuration.activate_multi">#</a></h4></div></div></div><p>
     You can use the activation code in a host’s configuration file
     (<code class="filename">/etc/lvm/lvm_&lt;<em class="replaceable ">HOST_TAG</em>&gt;.conf</code>)
     when host tags are enabled in the <code class="filename">lvm.conf</code> file. For
     example, a server has two configuration files in the
     <code class="filename">/etc/lvm/</code> directory:
    </p><table border="0" summary="Simple list" class="simplelist "><tr><td><code class="filename">lvm.conf</code>
     </td></tr><tr><td><code class="filename">lvm_&lt;<em class="replaceable ">HOST_TAG</em>&gt;.conf</code>
     </td></tr></table><p>
     At start-up, load the <code class="filename">/etc/lvm/lvm.conf</code> file, and
     process any tag settings in the file. If any host tags were defined, it
     loads the related
     <code class="filename">/etc/lvm/lvm_&lt;<em class="replaceable ">HOST_TAG</em>&gt;.conf</code>
     file. When it searches for a specific configuration file entry, it
     searches the host tag file first, then the <code class="filename">lvm.conf
     </code>file, and stops at the first match. Within the
     <code class="filename">lvm_&lt;<em class="replaceable ">HOST_TAG</em>&gt;.conf</code>
     file, use the reverse order that tags were set in. This allows the file
     for the last tag set to be searched first. New tags set in the host tag
     file will trigger additional configuration file loads.
    </p></div></div><div class="sect2 " id="sec.lvm.tagging.activate_cluster"><div class="titlepage"><div><div><h3 class="title" id="sec.lvm.tagging.activate_cluster"><span class="number">5.9.5 </span><span class="name">Using Tags for a Simple Activation Control in a Cluster</span> <a title="Permalink" class="permalink" href="#sec.lvm.tagging.activate_cluster">#</a></h3></div></div></div><p>
    You can set up a simple host name activation control by enabling the
    <code class="literal">hostname_tags</code> option in the
    <code class="filename">/etc/lvm/lvm.conf</code> file. Use the same file on every
    machine in a cluster so that it is a global setting.
   </p><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
      In a text editor, add the following code to the
      <code class="filename">/etc/lvm/lvm.conf</code> file:
     </p><div class="verbatim-wrap"><pre class="screen">tags {
   hostname_tags = 1
}</pre></div></li><li class="step "><p>
      Replicate the file to all hosts in the cluster.
     </p></li><li class="step "><p>
      From any machine in the cluster, add <code class="literal">db1</code> to the list
      of machines that activate <code class="filename">vg1/lvol2</code>:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> lvchange --addtag @db1 vg1/lvol2</pre></div></li><li class="step "><p>
      On the <code class="filename">db1</code> server, enter the following to activate
      it:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> lvchange -ay vg1/vol2</pre></div></li></ol></div></div></div><div class="sect2 " id="sec.lvm.tagging.activate_cluster_preferred"><div class="titlepage"><div><div><h3 class="title" id="sec.lvm.tagging.activate_cluster_preferred"><span class="number">5.9.6 </span><span class="name">Using Tags to Activate On Preferred Hosts in a Cluster</span> <a title="Permalink" class="permalink" href="#sec.lvm.tagging.activate_cluster_preferred">#</a></h3></div></div></div><p>
    The examples in this section demonstrate two methods to accomplish the
    following:
   </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
      Activate volume group <code class="filename">vg1</code> only on the database hosts
      <code class="filename">db1</code> and <code class="filename">db2</code>.
     </p></li><li class="listitem "><p>
      Activate volume group <code class="filename">vg2</code> only on the file server
      host <code class="filename">fs1</code>.
     </p></li><li class="listitem "><p>
      Activate nothing initially on the file server backup host
      <code class="filename">fsb1</code>, but be prepared for it to take over from the
      file server host <code class="filename">fs1</code>.
     </p></li></ul></div><div class="sect3 " id="sec.lvm.tagging.activate_cluster_preferred.opt1"><div class="titlepage"><div><div><h4 class="title" id="sec.lvm.tagging.activate_cluster_preferred.opt1"><span class="number">5.9.6.1 </span><span class="name">Option 1: Centralized Admin and Static Configuration Replicated Between Hosts</span> <a title="Permalink" class="permalink" href="#sec.lvm.tagging.activate_cluster_preferred.opt1">#</a></h4></div></div></div><p>
     In the following solution, the single configuration file is replicated
     among multiple hosts.
    </p><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
       Add the <code class="literal">@database</code> tag to the metadata of volume group
       <code class="filename">vg1</code>. In a terminal console, enter
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> vgchange --addtag @database vg1</pre></div></li><li class="step "><p>
       Add the <code class="literal">@fileserver</code> tag to the metadata of volume
       group <code class="filename">vg2</code>. In a terminal console, enter
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> vgchange --addtag @fileserver vg2</pre></div></li><li class="step "><p>
       In a text editor, modify the<code class="filename"> /etc/lvm/lvm.conf</code> file
       with the following code to define the <code class="literal">@database</code>,
       <code class="literal">@fileserver</code>, <code class="literal">@fileserverbackup</code>
       tags.
      </p><div class="verbatim-wrap"><pre class="screen">tags {
   database {
      host_list = [ "db1", "db2" ]
   }
   fileserver {
      host_list = [ "fs1" ]
   }
   fileserverbackup {
      host_list = [ "fsb1" ]
   }
}

activation {
   # Activate only if host has a tag that matches a metadata tag
   volume_list = [ "@*" ]
}</pre></div></li><li class="step "><p>
       Replicate the modified<code class="filename"> /etc/lvm/lvm.conf</code> file to
       the four hosts: <code class="filename">db1</code>, <code class="filename">db2</code>,
       <code class="filename">fs1</code>, and <code class="filename">fsb1</code>.
      </p></li><li class="step "><p>
       If the file server host goes down, <code class="filename">vg2</code> can be
       brought up on <code class="filename">fsb1</code> by entering the following
       commands in a terminal console on any node:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> vgchange --addtag @fileserverbackup vg2
<code class="prompt user">tux &gt; </code><code class="command">sudo</code> vgchange -ay vg2</pre></div></li></ol></div></div></div><div class="sect3 " id="sec.lvm.tagging.activate_cluster_preferred.opt2"><div class="titlepage"><div><div><h4 class="title" id="sec.lvm.tagging.activate_cluster_preferred.opt2"><span class="number">5.9.6.2 </span><span class="name">Option 2: Localized Admin and Configuration</span> <a title="Permalink" class="permalink" href="#sec.lvm.tagging.activate_cluster_preferred.opt2">#</a></h4></div></div></div><p>
     In the following solution, each host holds locally the information about
     which classes of volume to activate.
    </p><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
       Add the <code class="literal">@database</code> tag to the metadata of volume group
       <code class="filename">vg1</code>. In a terminal console, enter
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> vgchange --addtag @database vg1</pre></div></li><li class="step "><p>
       Add the <code class="literal">@fileserver</code> tag to the metadata of volume
       group <code class="filename">vg2</code>. In a terminal console, enter
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> vgchange --addtag @fileserver vg2</pre></div></li><li class="step "><p>
       Enable host tags in the <code class="filename">/etc/lvm/lvm.conf</code> file:
      </p><ol type="a" class="substeps "><li class="step "><p>
         In a text editor, modify the <code class="filename">/etc/lvm/lvm.conf</code>
         file with the following code to enable host tag configuration files.
        </p><div class="verbatim-wrap"><pre class="screen">tags {
   hosttags = 1
}</pre></div></li><li class="step "><p>
         Replicate the modified <code class="filename">/etc/lvm/lvm.conf</code> file to
         the four hosts: <code class="filename">db1</code>, <code class="filename">db2</code>,
         <code class="filename">fs1</code>, and <code class="filename">fsb1</code>.
        </p></li></ol></li><li class="step "><p>
       On host <code class="filename">db1</code>, create an activation configuration
       file for the database host <code class="filename">db1</code>. In a text editor,
       create <code class="filename">/etc/lvm/lvm_db1.conf</code> file and add the
       following code:
      </p><div class="verbatim-wrap"><pre class="screen">activation {
   volume_list = [ "@database" ]
}</pre></div></li><li class="step "><p>
       On host <code class="filename">db2</code>, create an activation configuration
       file for the database host <code class="filename">db2</code>. In a text editor,
       create <code class="filename">/etc/lvm/lvm_db2.conf</code> file and add the
       following code:
      </p><div class="verbatim-wrap"><pre class="screen">activation {
   volume_list = [ "@database" ]
}</pre></div></li><li class="step "><p>
       On host fs1, create an activation configuration file for the file server
       host <code class="filename">fs1</code>. In a text editor, create
       <code class="filename">/etc/lvm/lvm_fs1.conf</code> file and add the following
       code:
      </p><div class="verbatim-wrap"><pre class="screen">activation {
   volume_list = [ "@fileserver" ]
}</pre></div></li><li class="step "><p>
       If the file server host <code class="filename">fs1</code> goes down, to bring up
       a spare file server host fsb1 as a file server:
      </p><ol type="a" class="substeps "><li class="step "><p>
         On host <code class="filename">fsb1</code>, create an activation configuration
         file for the host <code class="filename">fsb1</code>. In a text editor, create
         <code class="filename">/etc/lvm/lvm_fsb1.conf</code> file and add the following
         code:
        </p><div class="verbatim-wrap"><pre class="screen">activation {
   volume_list = [ "@fileserver" ]
}</pre></div></li><li class="step "><p>
         In a terminal console, enter one of the following commands:
        </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> vgchange -ay vg2
<code class="prompt user">tux &gt; </code><code class="command">sudo</code> vgchange -ay @fileserver</pre></div></li></ol></li></ol></div></div></div></div></div></div><div xml:lang="en" class="chapter " id="cha.lvm_snapshots" lang="en"><div class="titlepage"><div><div><h2 class="title"><span class="number">6 </span><span class="name">LVM Volume Snapshots</span> <a title="Permalink" class="permalink" href="#cha.lvm_snapshots">#</a></h2><div class="doc-status"><ul><li><span class="ds-label">Filename: </span>storage_lvm-snapshots.xml</li><li><span class="ds-label">ID: </span>cha.lvm_snapshots</li></ul></div></div></div></div><div class="line"><div class="toc"><dl><dt><span class="sect1"><a href="#sec.lvm_snapshots.intro"><span class="number">6.1 </span><span class="name">Understanding Volume Snapshots</span></a></span></dt><dt><span class="sect1"><a href="#sec.lvm_snapshots.create"><span class="number">6.2 </span><span class="name">Creating Linux Snapshots with LVM</span></a></span></dt><dt><span class="sect1"><a href="#sec.lvm_snapshots.monitor"><span class="number">6.3 </span><span class="name">Monitoring a Snapshot</span></a></span></dt><dt><span class="sect1"><a href="#sec.lvm_snapshots.delete"><span class="number">6.4 </span><span class="name">Deleting Linux Snapshots</span></a></span></dt><dt><span class="sect1"><a href="#sec.lvm_snapshots.xen_host"><span class="number">6.5 </span><span class="name">Using Snapshots for Virtual Machines on a Virtual Host</span></a></span></dt><dt><span class="sect1"><a href="#sec.lvm_snapshots.rollback"><span class="number">6.6 </span><span class="name">Merging a Snapshot with the Source Logical Volume to Revert Changes or Roll Back to a Previous State</span></a></span></dt></dl></div></div><p>
  A Logical Volume Manager (LVM) logical volume snapshot is a copy-on-write
  technology that monitors changes to an existing volume’s data blocks so
  that when a write is made to one of the blocks, the block’s value at the
  snapshot time is copied to a snapshot volume. In this way, a point-in-time
  copy of the data is preserved until the snapshot volume is deleted.
 </p><div class="sect1 " id="sec.lvm_snapshots.intro"><div class="titlepage"><div><div><h2 class="title" id="sec.lvm_snapshots.intro"><span class="number">6.1 </span><span class="name">Understanding Volume Snapshots</span> <a title="Permalink" class="permalink" href="#sec.lvm_snapshots.intro">#</a></h2></div></div></div><p>
   A file system snapshot contains metadata about itself and data blocks from a
   source logical volume that has changed since the snapshot was taken. When
   you access data via the snapshot, you see a point-in-time copy of the source
   logical volume. There is no need to restore data from backup media or to
   overwrite the changed data.
  </p><div id="idm139787669461776" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.png" /><h6>Important: Mounting Volumes with Snapshots</h6><p>
    During the snapshot’s lifetime, the snapshot must be mounted before its
    source logical volume can be mounted.
   </p></div><p>
   LVM volume snapshots allow you to create a backup from a point-in-time view
   of the file system. The snapshot is created instantly and persists until you
   delete it. You can back up the file system from the snapshot while the
   volume itself continues to be available for users. The snapshot initially
   contains some metadata about the snapshot, but no actual data from the
   source logical volume. Snapshot uses copy-on-write technology to detect when
   data changes in an original data block. It copies the value it held when the
   snapshot was taken to a block in the snapshot volume, then allows the new
   data to be stored in the source block. As more blocks change from their
   original value on the source logical volume, the snapshot size grows.
  </p><p>
   When you are sizing the snapshot, consider how much data is expected to
   change on the source logical volume and how long you plan to keep the
   snapshot. The amount of space that you allocate for a snapshot volume can
   vary, depending on the size of the source logical volume, how long you plan
   to keep the snapshot, and the number of data blocks that are expected to
   change during the snapshot’s lifetime. The snapshot volume cannot be
   resized after it is created. As a guide, create a snapshot volume that is
   about 10% of the size of the original logical volume. If you anticipate that
   every block in the source logical volume will change at least one time
   before you delete the snapshot, then the snapshot volume should be at least
   as large as the source logical volume plus some additional space for
   metadata about the snapshot volume. Less space is required if the data
   changes infrequently or if the expected lifetime is sufficiently brief.
  </p><p>
   In LVM2, snapshots are read/write by default. When you write data directly
   to the snapshot, that block is marked in the exception table as used, and
   never gets copied from the source logical volume. You can mount the snapshot
   volume, and test application changes by writing data directly to the
   snapshot volume. You can easily discard the changes by dismounting the
   snapshot, removing the snapshot, and then remounting the source logical
   volume.
  </p><p>
   In a virtual guest environment, you can use the snapshot function for LVM
   logical volumes you create on the server’s disks, as you would on a
   physical server.
  </p><p>
   In a virtual host environment, you can use the snapshot function to back up
   the virtual machine’s storage back-end, or to test changes to a virtual
   machine image, such as for patches or upgrades, without modifying the source
   logical volume. The virtual machine must be using an LVM logical volume as
   its storage back-end, as opposed to using a virtual disk file. You can mount
   the LVM logical volume and use it to store the virtual machine image as a
   file-backed disk, or you can assign the LVM logical volume as a physical
   disk to write to it as a block device.
  </p><p>
   Beginning in SLES 11 SP3, an LVM logical volume snapshot can be thinly
   provisioned. Thin provisioning is assumed if you create a snapshot without a
   specified size. The snapshot is created as a thin volume that uses space as
   needed from a thin pool. A thin snapshot volume has the same characteristics
   as any other thin volume. You can independently activate the volume, extend
   the volume, rename the volume, remove the volume, and even snapshot the
   volume.
  </p><div id="idm139787669454240" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.png" /><h6>Important: Thinly Provisioned Volumes in a Cluster</h6><p>
    To use thinly provisioned snapshots in a cluster, the source logical volume
    and its snapshots must be managed in a single cluster resource. This allows
    the volume and its snapshots to always be mounted exclusively on the same
    node.
   </p></div><p>
   When you are done with the snapshot, it is important to remove it from the
   system. A snapshot eventually fills up completely as data blocks change on
   the source logical volume. When the snapshot is full, it is disabled, which
   prevents you from remounting the source logical volume.
  </p><p>
   If you create multiple snapshots for a source logical volume, remove the
   snapshots in a last created, first deleted order.
  </p></div><div class="sect1 " id="sec.lvm_snapshots.create"><div class="titlepage"><div><div><h2 class="title" id="sec.lvm_snapshots.create"><span class="number">6.2 </span><span class="name">Creating Linux Snapshots with LVM</span> <a title="Permalink" class="permalink" href="#sec.lvm_snapshots.create">#</a></h2></div></div></div><p>
   The Logical Volume Manager (LVM) can be used for creating snapshots of your
   file system.
  </p><p>
   Open a terminal console and enter
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> lvcreate -s [-L <em class="replaceable ">&lt;size</em>&gt;] -n <em class="replaceable ">SNAP_VOLUME</em> <em class="replaceable ">SOURCE_VOLUME_PATH</em></pre></div><p>
   If no size is specified, the snapshot is created as a thin snapshot.
  </p><p>
   For example:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> lvcreate -s -L 1G -n linux01-snap /dev/lvm/linux01</pre></div><p>
   The snapshot is created as the <code class="filename">/dev/lvm/linux01-snap</code>
   volume.
  </p></div><div class="sect1 " id="sec.lvm_snapshots.monitor"><div class="titlepage"><div><div><h2 class="title" id="sec.lvm_snapshots.monitor"><span class="number">6.3 </span><span class="name">Monitoring a Snapshot</span> <a title="Permalink" class="permalink" href="#sec.lvm_snapshots.monitor">#</a></h2></div></div></div><p>
   Open a terminal console and enter
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> lvdisplay <em class="replaceable ">SNAP_VOLUME</em></pre></div><p>
   For example:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> lvdisplay /dev/vg01/linux01-snap

--- Logical volume ---
  LV Name                /dev/lvm/linux01
  VG Name                vg01
  LV UUID                QHVJYh-PR3s-A4SG-s4Aa-MyWN-Ra7a-HL47KL
  LV Write Access        read/write
  LV snapshot status     active destination for /dev/lvm/linux01
  LV Status              available
  # open                 0
  LV Size                80.00 GB
  Current LE             1024
  COW-table size         8.00 GB
  COW-table LE           512
  Allocated to snapshot  30%
  Snapshot chunk size    8.00 KB
  Segments               1
  Allocation             inherit
  Read ahead sectors     0
  Block device           254:5</pre></div></div><div class="sect1 " id="sec.lvm_snapshots.delete"><div class="titlepage"><div><div><h2 class="title" id="sec.lvm_snapshots.delete"><span class="number">6.4 </span><span class="name">Deleting Linux Snapshots</span> <a title="Permalink" class="permalink" href="#sec.lvm_snapshots.delete">#</a></h2></div></div></div><p>
   Open a terminal console and enter
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> lvremove <em class="replaceable ">SNAP_VOLUME_PATH</em></pre></div><p>
   For example:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> lvremove /dev/lvmvg/linux01-snap</pre></div></div><div class="sect1 " id="sec.lvm_snapshots.xen_host"><div class="titlepage"><div><div><h2 class="title" id="sec.lvm_snapshots.xen_host"><span class="number">6.5 </span><span class="name">Using Snapshots for Virtual Machines on a Virtual Host</span> <a title="Permalink" class="permalink" href="#sec.lvm_snapshots.xen_host">#</a></h2></div></div></div><p>
   Using an LVM logical volume for a virtual machine’s back-end storage
   allows flexibility in administering the underlying device, such as making it
   easier to move storage objects, create snapshots, and back up data. You can
   mount the LVM logical volume and use it to store the virtual machine image
   as a file-backed disk, or you can assign the LVM logical volume as a
   physical disk to write to it as a block device. You can create a virtual
   disk image on the LVM logical volume, then snapshot the LVM.
  </p><p>
   You can leverage the read/write capability of the snapshot to create
   different instances of a virtual machine, where the changes are made to the
   snapshot for a particular virtual machine instance. You can create a virtual
   disk image on an LVM logical volume, snapshot the source logical volume, and
   modify the snapshot for a particular virtual machine instance. You can
   create another snapshot of the source logical volume, and modify it for a
   different virtual machine instance. The majority of the data for the
   different virtual machine instances resides with the image on the source
   logical volume.
  </p><p>
   You can also leverage the read/write capability of the snapshot to preserve
   the virtual disk image while testing patches or upgrades in the guest
   environment. You create a snapshot of the LVM volume that contains the
   image, and then run the virtual machine on the snapshot location. The source
   logical volume is unchanged, and all changes for that machine are written to
   the snapshot. To return to the source logical volume of the virtual machine
   image, you power off the virtual machine, then remove the snapshot from the
   source logical volume. To start over, you re-create the snapshot, mount the
   snapshot, and restart the virtual machine on the snapshot image.
  </p><p>
   The following procedure uses a file-backed virtual disk image and the Xen
   hypervisor. You can adapt the procedure in this section for other
   hypervisors that run on the SUSE Linux Enterprise platform, such as KVM. To run a
   file-backed virtual machine image from the snapshot volume:
  </p><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
     Ensure that the source logical volume that contains the file-backed
     virtual machine image is mounted, such as at mount point
     <code class="filename">/var/lib/xen/images/&lt;<em class="replaceable ">IMAGE_NAME</em>&gt;</code>.
    </p></li><li class="step "><p>
     Create a snapshot of the LVM logical volume with enough space to store the
     differences that you expect.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> lvcreate -s -L 20G -n myvm-snap /dev/lvmvg/myvm</pre></div><p>
     If no size is specified, the snapshot is created as a thin snapshot.
    </p></li><li class="step "><p>
     Create a mount point where you will mount the snapshot volume.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> mkdir -p /mnt/xen/vm/myvm-snap</pre></div></li><li class="step "><p>
     Mount the snapshot volume at the mount point you created.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> mount -t auto /dev/lvmvg/myvm-snap /mnt/xen/vm/myvm-snap</pre></div></li><li class="step "><p>
     In a text editor, copy the configuration file for the source virtual
     machine, modify the paths to point to the file-backed image file on the
     mounted snapshot volume, and save the file such as
     <code class="filename">/etc/xen/myvm-snap.cfg</code>.
    </p></li><li class="step "><p>
     Start the virtual machine using the mounted snapshot volume of the virtual
     machine.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> xm create -c /etc/xen/myvm-snap.cfg</pre></div></li><li class="step "><p>
     (Optional) Remove the snapshot, and use the unchanged virtual machine
     image on the source logical volume.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> umount /mnt/xenvms/myvm-snap
<code class="prompt user">tux &gt; </code><code class="command">sudo</code> lvremove -f /dev/lvmvg/mylvm-snap</pre></div></li><li class="step "><p>
     (Optional) Repeat this process as desired.
    </p></li></ol></div></div></div><div class="sect1 " id="sec.lvm_snapshots.rollback"><div class="titlepage"><div><div><h2 class="title" id="sec.lvm_snapshots.rollback"><span class="number">6.6 </span><span class="name">Merging a Snapshot with the Source Logical Volume to Revert Changes or Roll Back to a Previous State</span> <a title="Permalink" class="permalink" href="#sec.lvm_snapshots.rollback">#</a></h2></div></div></div><p>
   Snapshots can be useful if you need to roll back or restore data on a volume
   to a previous state. For example, you might need to revert data changes that
   resulted from an administrator error or a failed or undesirable package
   installation or upgrade.
  </p><p>
   You can use the <code class="command">lvconvert --merge</code> command to revert the
   changes made to an LVM logical volume. The merging begins as follows:
  </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
     If both the source logical volume and snapshot volume are not open, the
     merge begins immediately.
    </p></li><li class="listitem "><p>
     If the source logical volume or snapshot volume are open, the merge starts
     the first time either the source logical volume or snapshot volume are
     activated and both are closed.
    </p></li><li class="listitem "><p>
     If the source logical volume cannot be closed, such as the root file
     system, the merge is deferred until the next time the server reboots and
     the source logical volume is activated.
    </p></li><li class="listitem "><p>
     If the source logical volume contains a virtual machine image, you must
     shut down the virtual machine, deactivate the source logical volume and
     snapshot volume (by dismounting them in that order), and then issue the
     merge command. Because the source logical volume is automatically
     remounted and the snapshot volume is deleted when the merge is complete,
     you should not restart the virtual machine until after the merge is
     complete. After the merge is complete, you use the resulting logical
     volume for the virtual machine.
    </p></li></ul></div><p>
   After a merge begins, the merge continues automatically after server
   restarts until it is complete. A new snapshot cannot be created for the
   source logical volume while a merge is in progress.
  </p><p>
   While the merge is in progress, reads or writes to the source logical volume
   are transparently redirected to the snapshot that is being merged. This
   allows users to immediately view and access the data as it was when the
   snapshot was created. They do not need to wait for the merge to complete.
  </p><p>
   When the merge is complete, the source logical volume contains the same data
   as it did when the snapshot was taken, plus any data changes made after the
   merge began. The resulting logical volume has the source logical volume’s
   name, minor number, and UUID. The source logical volume is automatically
   remounted, and the snapshot volume is removed.
  </p><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
     Open a terminal console and enter
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> lvconvert --merge  [-b] [-i <em class="replaceable ">SECONDS</em>] [<em class="replaceable ">SNAP_VOLUME_PATH</em>[...<em class="replaceable ">snapN</em>]|@<em class="replaceable ">VOLUME_TAG</em>]</pre></div><p>
     You can specify one or multiple snapshots on the command line. You can
     alternatively tag multiple source logical volumes with the same volume tag
     then specify
     <code class="literal">@&lt;<em class="replaceable ">VOLUME_TAG</em>&gt;</code> on the
     command line. The snapshots for the tagged volumes are merged to their
     respective source logical volumes. For information about tagging logical
     volumes, see
     <a class="xref" href="#sec.lvm.tagging" title="5.9. Tagging LVM2 Storage Objects">Section 5.9, “Tagging LVM2 Storage Objects”</a>.
    </p><p>
     The options include:
    </p><div class="variablelist "><dl class="variablelist"><dt id="idm139787669394464"><span class="term ">-b, </span><span class="term ">--background</span></dt><dd><p>
        Run the daemon in the background. This allows multiple specified
        snapshots to be merged concurrently in parallel.
       </p></dd><dt id="idm139787669392096"><span class="term ">-i, </span><span class="term ">--interval &lt;<em class="replaceable ">SECONDS</em>&gt;</span></dt><dd><p>
        Report progress as a percentage at regular intervals. Specify the
        interval in seconds.
       </p></dd></dl></div><p>
     For more information about this command, see the
     <code class="command">lvconvert(8)</code> man page.
    </p><p>
     For example:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> lvconvert --merge /dev/lvmvg/linux01-snap</pre></div><p>
     This command merges <code class="filename">/dev/lvmvg/linux01-snap</code> into its
     source logical volume.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> lvconvert --merge @mytag</pre></div><p>
     If <code class="filename">lvol1</code>, <code class="filename">lvol2</code>, and
     <code class="filename">lvol3</code> are all tagged with <code class="literal">mytag</code>,
     each snapshot volume is merged serially with its respective source logical
     volume; that is: <code class="filename">lvol1</code>, then
     <code class="filename">lvol2</code>, then <code class="filename">lvol3</code>. If the
     <code class="literal">--background</code> option is specified, the snapshots for the
     respective tagged logical volume are merged concurrently in parallel.
    </p></li><li class="step "><p>
     (Optional) If both the source logical volume and snapshot volume are open
     and they can be closed, you can manually deactivate and activate the
     source logical volume to get the merge to start immediately.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> umount <em class="replaceable ">ORIGINAL_VOLUME</em>
<code class="prompt user">tux &gt; </code><code class="command">sudo</code> lvchange -an <em class="replaceable ">ORIGINAL_VOLUME</em>
<code class="prompt user">tux &gt; </code><code class="command">sudo</code> lvchange -ay <em class="replaceable ">ORIGINAL_VOLUME</em>
<code class="prompt user">tux &gt; </code><code class="command">sudo</code> mount <em class="replaceable ">ORIGINAL_VOLUME</em> <em class="replaceable ">MOUNT_POINT</em></pre></div><p>
     For example:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> umount /dev/lvmvg/lvol01
<code class="prompt user">tux &gt; </code><code class="command">sudo</code> lvchange -an /dev/lvmvg/lvol01
<code class="prompt user">tux &gt; </code><code class="command">sudo</code> lvchange -ay /dev/lvmvg/lvol01
<code class="prompt user">tux &gt; </code><code class="command">sudo</code> mount /dev/lvmvg/lvol01 /mnt/lvol01</pre></div></li><li class="step "><p>
     (Optional) If both the source logical volume and snapshot volume are open
     and the source logical volume cannot be closed, such as the <code class="systemitem">root</code>
     file system, you can restart the server and mount the source logical
     volume to get the merge to start immediately after the restart.
    </p></li></ol></div></div></div></div></div><div class="part" id="part.software_raid"><div class="titlepage"><div><div><h1 class="title"><span class="number">Part III </span><span class="name">Software RAID </span><a title="Permalink" class="permalink" href="#part.software_raid">#</a></h1></div></div></div><div class="toc"><dl><dt><span class="chapter"><a href="#cha.raid"><span class="number">7 </span><span class="name">Software RAID Configuration</span></a></span></dt><dd class="toc-abstract"><p>The purpose of RAID (redundant array of independent disks) is to combine several hard disk partitions into one large virtual hard disk to optimize performance, data security, or both. Most RAID controllers use the SCSI protocol because it can address a larger number of hard disks in a more effective…</p></dd><dt><span class="chapter"><a href="#cha.raidroot"><span class="number">8 </span><span class="name">Configuring Software RAID for the Root Partition</span></a></span></dt><dd class="toc-abstract"><p>In SUSE Linux Enterprise Server, the Device Mapper RAID tool has been integrated into the YaST Partitioner. You can use the partitioner at install time to create a software RAID for the system device that contains your root (/) partition. The /boot partition cannot be stored on a RAID partition unle…</p></dd><dt><span class="chapter"><a href="#cha.raid10"><span class="number">9 </span><span class="name">Creating Software RAID 10 Devices</span></a></span></dt><dd class="toc-abstract"><p>This section describes how to set up nested and complex RAID 10 devices. A RAID 10 device consists of nested RAID 1 (mirroring) and RAID 0 (striping) arrays. Nested RAIDs can either be set up as striped mirrors (RAID 1+0) or as mirrored stripes (RAID 0+1). A complex RAID 10 setup also combines mirro…</p></dd><dt><span class="chapter"><a href="#cha.raid_degraded"><span class="number">10 </span><span class="name">Creating a Degraded RAID Array</span></a></span></dt><dd class="toc-abstract"><p>
    A degraded array is one in which some devices are missing. Degraded arrays
    are supported only for RAID 1, RAID 4, RAID 5, and RAID 6. These RAID types
    are designed to withstand some missing devices as part of their
    fault-tolerance features. Typically, degraded arrays occur when a device
    fails. It is possible to create a degraded array on purpose.
   </p></dd><dt><span class="chapter"><a href="#cha.raid_resize"><span class="number">11 </span><span class="name">Resizing Software RAID Arrays with mdadm</span></a></span></dt><dd class="toc-abstract"><p>
    This section describes how to increase or reduce the size of a software
    RAID 1, 4, 5, or 6 device with the Multiple Device Administration
    (<code class="command">mdadm(8)</code>) tool.
   </p></dd><dt><span class="chapter"><a href="#cha.raid_leds"><span class="number">12 </span><span class="name">Storage Enclosure LED Utilities for MD Software RAIDs</span></a></span></dt><dd class="toc-abstract"><p>
    
    Storage enclosure LED Monitoring utility (<code class="command">ledmon</code>) and
    LED Control (<code class="command">ledctl</code>) utility are Linux user space
    applications that use a broad range of interfaces and protocols to control
    storage enclosure LEDs. The primary usage is to visualize the status of
    Linux MD software RAID devices created with the mdadm utility. The
    <code class="systemitem">ledmon</code> daemon monitors the status
    of the drive array and updates the status of the drive LEDs. The
    <code class="command">ledctl</code> utility allows you to set LED patterns for
    specified devices.
   </p></dd></dl></div><div xml:lang="en" class="chapter " id="cha.raid" lang="en"><div class="titlepage"><div><div><h2 class="title"><span class="number">7 </span><span class="name">Software RAID Configuration</span> <a title="Permalink" class="permalink" href="#cha.raid">#</a></h2><div class="doc-status"><ul><li><span class="ds-label">Filename: </span>storage_raid.xml</li><li><span class="ds-label">ID: </span>cha.raid</li></ul></div></div></div></div><div class="line"><div class="toc"><dl><dt><span class="sect1"><a href="#sec.raid.intro"><span class="number">7.1 </span><span class="name">Understanding RAID Levels</span></a></span></dt><dt><span class="sect1"><a href="#sec.raid.yast"><span class="number">7.2 </span><span class="name">Soft RAID Configuration with YaST</span></a></span></dt><dt><span class="sect1"><a href="#sec.raid.trouble"><span class="number">7.3 </span><span class="name">Troubleshooting Software RAIDs</span></a></span></dt><dt><span class="sect1"><a href="#sec.raid.more"><span class="number">7.4 </span><span class="name">For More Information</span></a></span></dt></dl></div></div><p>
  The purpose of RAID (redundant array of independent disks) is to combine
  several hard disk partitions into one large virtual hard disk to optimize
  performance, data security, or both. Most RAID controllers use the SCSI
  protocol because it can address a larger number of hard disks in a more
  effective way than the IDE protocol and is more suitable for parallel
  processing of commands. There are some RAID controllers that support IDE or
  SATA hard disks. Software RAID provides the advantages of RAID systems
  without the additional cost of hardware RAID controllers. However, this
  requires some CPU time and has memory requirements that make it unsuitable
  for real high performance computers.
 </p><div id="idm139787669360896" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.png" /><h6>Important: RAID on Cluster File Systems</h6><p>
   Software RAID underneath clustered file systems needs to be set up using a
   cluster multi-device (Cluster MD). Refer to the High Availability Extension documentation at
   <a class="link" href="https://www.suse.com/documentation/sle-ha-12/book_sleha/data/cha_ha_cluster-md.html" target="_blank">https://www.suse.com/documentation/sle-ha-12/book_sleha/data/cha_ha_cluster-md.html</a>.
  </p></div><p>
  SUSE Linux Enterprise offers the option of combining several hard disks into one soft RAID
  system. RAID implies several strategies for combining several hard disks in a
  RAID system, each with different goals, advantages, and characteristics.
  These variations are commonly known as <span class="emphasis"><em>RAID levels</em></span>.
 </p><div class="sect1 " id="sec.raid.intro"><div class="titlepage"><div><div><h2 class="title" id="sec.raid.intro"><span class="number">7.1 </span><span class="name">Understanding RAID Levels</span> <a title="Permalink" class="permalink" href="#sec.raid.intro">#</a></h2></div></div></div><p>
   This section describes common RAID levels 0, 1, 2, 3, 4, 5, and nested RAID
   levels.
  </p><div class="sect2 " id="sec.raid.intro.raid0"><div class="titlepage"><div><div><h3 class="title" id="sec.raid.intro.raid0"><span class="number">7.1.1 </span><span class="name">RAID 0</span> <a title="Permalink" class="permalink" href="#sec.raid.intro.raid0">#</a></h3></div></div></div><p>
    This level improves the performance of your data access by spreading out
    blocks of each file across multiple disks. Actually, this is not really a
    RAID, because it does not provide data backup, but the name
    <span class="emphasis"><em>RAID 0</em></span> for this type of system has become the
    norm. With RAID 0, two or more hard disks are pooled together. The
    performance is very good, but the RAID system is destroyed and your data
    lost if even one hard disk fails.
   </p></div><div class="sect2 " id="sec.raid.intro.raid1"><div class="titlepage"><div><div><h3 class="title" id="sec.raid.intro.raid1"><span class="number">7.1.2 </span><span class="name">RAID 1</span> <a title="Permalink" class="permalink" href="#sec.raid.intro.raid1">#</a></h3></div></div></div><p>
    This level provides adequate security for your data, because the data is
    copied to another hard disk 1:1. This is known as <span class="emphasis"><em>hard disk
    mirroring</em></span>. If a disk is destroyed, a copy of its contents is
    available on another mirrored disk. All disks except one could be damaged
    without endangering your data. However, if damage is not detected, damaged
    data might be mirrored to the correct disk and the data is corrupted that
    way. The writing performance suffers a little in the copying process
    compared to when using single disk access (10 to 20 percent slower), but
    read access is significantly faster in comparison to any one of the normal
    physical hard disks, because the data is duplicated so can be scanned in
    parallel. RAID 1 generally provides nearly twice the read transaction rate
    of single disks and almost the same write transaction rate as single disks.
   </p></div><div class="sect2 " id="sec.raid.intro.raid23"><div class="titlepage"><div><div><h3 class="title" id="sec.raid.intro.raid23"><span class="number">7.1.3 </span><span class="name">RAID 2 and RAID 3</span> <a title="Permalink" class="permalink" href="#sec.raid.intro.raid23">#</a></h3></div></div></div><p>
    These are not typical RAID implementations. Level 2 stripes data at
    the bit level rather than the block level. Level 3 provides byte-level
    striping with a dedicated parity disk and cannot service simultaneous
    multiple requests. Both levels are rarely used.
   </p></div><div class="sect2 " id="sec.raid.intro.raid4"><div class="titlepage"><div><div><h3 class="title" id="sec.raid.intro.raid4"><span class="number">7.1.4 </span><span class="name">RAID 4</span> <a title="Permalink" class="permalink" href="#sec.raid.intro.raid4">#</a></h3></div></div></div><p>
    Level 4 provides block-level striping like Level 0 combined with
    a dedicated parity disk. If a data disk fails, the parity data is used to
    create a replacement disk. However, the parity disk might create a
    bottleneck for write access. Nevertheless, Level 4 is sometimes used.
   </p></div><div class="sect2 " id="sec.raid.intro.raid5"><div class="titlepage"><div><div><h3 class="title" id="sec.raid.intro.raid5"><span class="number">7.1.5 </span><span class="name">RAID 5</span> <a title="Permalink" class="permalink" href="#sec.raid.intro.raid5">#</a></h3></div></div></div><p>
    RAID 5 is an optimized compromise between Level 0 and
    Level 1 in terms of performance and redundancy. The hard disk space
    equals the number of disks used minus one. The data is distributed over the
    hard disks as with RAID 0. <span class="emphasis"><em>Parity blocks</em></span>, created
    on one of the partitions, are there for security reasons. They are linked
    to each other with XOR, enabling the contents to be reconstructed by the
    corresponding parity block in case of system failure. With RAID 5, no
    more than one hard disk can fail at the same time. If one hard disk fails,
    it must be replaced when possible to avoid the risk of losing data.
   </p></div><div class="sect2 " id="sec.raid.intro.raid6"><div class="titlepage"><div><div><h3 class="title" id="sec.raid.intro.raid6"><span class="number">7.1.6 </span><span class="name">RAID 6</span> <a title="Permalink" class="permalink" href="#sec.raid.intro.raid6">#</a></h3></div></div></div><p>
    RAID 6 is essentially an extension of RAID 5 that allows for
    additional fault tolerance by using a second independent distributed parity
    scheme (dual parity). Even if two of the hard disks fail during the data
    recovery process, the system continues to be operational, with no data
    loss.
   </p><p>
    RAID 6 provides for extremely high data fault tolerance by sustaining
    multiple simultaneous drive failures. It handles the loss of any two
    devices without data loss. Accordingly, it requires N+2 drives to store N
    drives worth of data. It requires a minimum of four devices.
   </p><p>
    The performance for RAID 6 is slightly lower but comparable to
    RAID 5 in normal mode and single disk failure mode. It is very slow in
    dual disk failure mode. A RAID 6 configuration needs a considerable
    amount of CPU time and memory for write operations.
   </p><div class="table" id="idm139787669340016"><div class="table-title-wrap"><h6 class="table-title"><span class="number">Table 7.1: </span><span class="name">Comparison of RAID 5 and RAID 6 </span><a title="Permalink" class="permalink" href="#idm139787669340016">#</a></h6></div><div class="table-contents"><table summary="Comparison of RAID 5 and RAID 6" border="1"><colgroup><col class="1" /><col class="2" /><col class="3" /></colgroup><thead><tr><th>
        <p>
         Feature
        </p>
       </th><th>
        <p>
         RAID 5
        </p>
       </th><th>
        <p>
         RAID 6
        </p>
       </th></tr></thead><tbody><tr><td>
        <p>
         Number of devices
        </p>
       </td><td>
        <p>
         N+1, minimum of 3
        </p>
       </td><td>
        <p>
         N+2, minimum of 4
        </p>
       </td></tr><tr><td>
        <p>
         Parity
        </p>
       </td><td>
        <p>
         Distributed, single
        </p>
       </td><td>
        <p>
         Distributed, dual
        </p>
       </td></tr><tr><td>
        <p>
         Performance
        </p>
       </td><td>
        <p>
         Medium impact on write and rebuild
        </p>
       </td><td>
        <p>
         More impact on sequential write than RAID 5
        </p>
       </td></tr><tr><td>
        <p>
         Fault-tolerance
        </p>
       </td><td>
        <p>
         Failure of one component device
        </p>
       </td><td>
        <p>
         Failure of two component devices
        </p>
       </td></tr></tbody></table></div></div></div><div class="sect2 " id="sec.raid.intro.raid_nested"><div class="titlepage"><div><div><h3 class="title" id="sec.raid.intro.raid_nested"><span class="number">7.1.7 </span><span class="name">Nested and Complex RAID Levels</span> <a title="Permalink" class="permalink" href="#sec.raid.intro.raid_nested">#</a></h3></div></div></div><p>
    Other RAID levels have been developed, such as RAIDn, RAID 10,
    RAID 0+1, RAID 30, and RAID 50. Some are proprietary
    implementations created by hardware vendors. Examples for creating
    RAID 10 configurations can be found in <a class="xref" href="#cha.raid10" title="Chapter 9. Creating Software RAID 10 Devices">Chapter 9, <em>Creating Software RAID 10 Devices</em></a>.
   </p></div></div><div class="sect1 " id="sec.raid.yast"><div class="titlepage"><div><div><h2 class="title" id="sec.raid.yast"><span class="number">7.2 </span><span class="name">Soft RAID Configuration with YaST</span> <a title="Permalink" class="permalink" href="#sec.raid.yast">#</a></h2></div></div></div><p>
   The YaST soft RAID configuration can be reached from the YaST Expert
   Partitioner. This partitioning tool also enables you to edit and delete
   existing partitions and create new ones that should be used with soft RAID.
   These instructions apply on setting up RAID levels 0, 1, 5, and 6. Setting
   up RAID 10 configurations is explained in <a class="xref" href="#cha.raid10" title="Chapter 9. Creating Software RAID 10 Devices">Chapter 9, <em>Creating Software RAID 10 Devices</em></a>.
  </p><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
     Launch YaST and open the <span class="guimenu">Partitioner</span>.
    </p></li><li class="step "><p>
     If necessary, create partitions that should be used with your RAID
     configuration. Do not format them and set the partition type to
     <span class="guimenu">0xFD Linux RAID</span>. When using existing partitions it is
     not necessary to change their partition type—YaST will
     automatically do so. Refer to <span class="intraxref">Book “<em class="citetitle ">Deployment Guide</em>”, Chapter 9 “Expert Partitioner”, Section 9.1 “Using the Expert Partitioner”</span>
     for details.
    </p><p>
     It is strongly recommended to use partitions stored on different hard
     disks to decrease the risk of losing data if one is defective (RAID 1
     and 5) and to optimize the performance of RAID 0.
    </p><p>
     For RAID 0 at least two partitions are needed. RAID 1 requires
     exactly two partitions, while at least three partitions are required for
     RAID 5. A RAID 6 setup requires at least four partitions. It is
     recommended to use only partitions of the same size because each segment
     can contribute only the same amount of space as the smallest sized
     partition.
    </p></li><li class="step "><p>
     In the left panel, select <span class="guimenu">RAID</span>.
    </p><p>
     A list of existing RAID configurations opens in the right panel.
    </p></li><li class="step "><p>
     At the lower left of the RAID page, click <span class="guimenu">Add RAID</span>.
    </p><div class="informalfigure"><div class="mediaobject"><a xmlns="" href="images/yast2_raid2_a.png"><img src="images/yast2_raid2_a.png" width="" /></a></div></div></li><li class="step "><p>
     Select a <span class="guimenu">RAID Type</span> and <span class="guimenu">Add</span> an
     appropriate number of partitions from the <span class="guimenu">Available
     Devices</span> dialog.
    </p><p>
     You can optionally assign a <span class="guimenu">RAID Name</span> to your RAID. It
     will make it available as
     <code class="filename">/dev/md/<em class="replaceable ">NAME</em></code>. See
     <a class="xref" href="#sec.raid.yast.names" title="7.2.1. RAID Names">Section 7.2.1, “RAID Names”</a> for more information.
    </p><div class="figure" id="fig.yast2.raid3"><div class="figure-contents"><div class="mediaobject"><a xmlns="" href="images/yast2_raid3_a.png"><img src="images/yast2_raid3_a.png" width="" alt="Example RAID 5 Configuration" /></a></div></div><div class="figure-title-wrap"><h6 class="figure-title"><span class="number">Figure 7.1: </span><span class="name">Example RAID 5 Configuration </span><a title="Permalink" class="permalink" href="#fig.yast2.raid3">#</a></h6></div></div><p>
     Proceed with <span class="guimenu">Next</span>.
    </p></li><li class="step "><p>
     Select the <span class="guimenu">Chunk Size</span> and, if applicable, the
     <span class="guimenu">Parity Algorithm</span>. The optimal chunk size depends on the
     type of data and the type of RAID. See
     <a class="link" href="https://raid.wiki.kernel.org/index.php/RAID_setup#Chunk_sizes" target="_blank">https://raid.wiki.kernel.org/index.php/RAID_setup#Chunk_sizes</a>
     for more information. More information on parity algorithms can be found
     with <code class="command">man 8 mdadm</code> when searching for the
     <code class="option">--layout</code> option. If unsure, stick with the defaults.
    </p></li><li class="step "><p>
     Choose a <span class="guimenu">Role</span> for the volume. Your choice here only
     affects the default values for the upcoming dialog. They can be changed in
     the next step. If in doubt, choose <span class="guimenu">Raw Volume
     (Unformatted)</span>.
    </p></li><li class="step "><p>
     Under <span class="guimenu">Formatting Options</span>, select <span class="guimenu">Format
     Partition</span>, then select the <span class="guimenu">File system</span>. The
     content of the <span class="guimenu">Options</span> menu depends on the file system.
     Usually there is no need to change the defaults.
    </p><p>
     Under <span class="guimenu">Mounting Options</span>, select <span class="guimenu">Mount
     partition</span>, then select the mount point. Click <span class="guimenu">Fstab
     Options</span> to add special mounting options for the volume.
    </p></li><li class="step "><p>
     Click <span class="guimenu">Finish</span>.
    </p></li><li class="step "><p>
     Click <span class="guimenu">Next</span>, verify that the changes are listed, then
     click <span class="guimenu">Finish</span>.
    </p></li></ol></div></div><div class="sect2 " id="sec.raid.yast.names"><div class="titlepage"><div><div><h3 class="title" id="sec.raid.yast.names"><span class="number">7.2.1 </span><span class="name">RAID Names</span> <a title="Permalink" class="permalink" href="#sec.raid.yast.names">#</a></h3></div></div></div><p>
    By default, software RAID devices have numeric names following the pattern
    <code class="literal">mdN</code>, where <code class="literal">N</code> is a number. As such
    they can be accessed as, for example, <code class="filename">/dev/md127</code> and
    are listed as <code class="literal">md127</code> in <code class="filename">/proc/mdstat</code>
    and <code class="filename">/proc/partitions</code>. Working with these names can be
    clumsy. <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> offers two ways to work around this problem:
   </p><div class="variablelist "><dl class="variablelist"><dt id="idm139787669269472"><span class="term ">Providing a Named Link to the Device</span></dt><dd><p>
       You can optionally specify a name for the RAID device when creating it
       with YaST or on the command line with <code class="command">mdadm --create
       '/dev/md/</code> <em class="replaceable ">NAME</em>'. The device name
       will still be <code class="literal">mdN</code>, but a link
       <code class="filename">/dev/md/<em class="replaceable ">NAME</em></code> will be
       created:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code>ls -og /dev/md
total 0
lrwxrwxrwx 1 8 Dec  9 15:11 myRAID -&gt; ../md127</pre></div><p>
       The device will still be listed as <code class="literal">md127</code> under
       <code class="filename">/proc</code>.
      </p></dd><dt id="idm139787669263248"><span class="term ">Providing a Named Device</span></dt><dd><p>
       In case a named link to the device is not sufficient for your setup, add
       the line CREATE names=yes to <code class="filename">/etc/mdadm.conf</code> by
       running the following command:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> echo "CREATE names=yes" &gt;&gt; /etc/mdadm.conf</pre></div><p>
       It will cause names like <code class="literal">myRAID</code> to be used as a
       <span class="quote">“<span class="quote">real</span>”</span> device name. The device will not only be accessible
       at <code class="filename">/dev/myRAID</code>, but also be listed as
       <code class="literal">myRAID</code> under <code class="filename">/proc</code>. Note that
       this will only apply to RAIDs configured after the change to the
       configuration file. Active RAIDS will continue to use the
       <code class="literal">mdN</code> names until they get stopped and re-assembled.
      </p><div id="idm139787669256720" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.png" /><h6>Warning: Incompatible Tools</h6><p>
        Not all tools may support named RAID devices. In case a tool expects a
        RAID device to be named <code class="literal">mdN</code>, it will fail to
        identify the devices.
       </p></div></dd></dl></div></div></div><div class="sect1 " id="sec.raid.trouble"><div class="titlepage"><div><div><h2 class="title" id="sec.raid.trouble"><span class="number">7.3 </span><span class="name">Troubleshooting Software RAIDs</span> <a title="Permalink" class="permalink" href="#sec.raid.trouble">#</a></h2></div></div></div><p>
   Check the <code class="filename">/proc/mdstat</code> file to find out whether a RAID
   partition has been damaged. If a disk fails, shut down your Linux system and
   replace the defective hard disk with a new one partitioned the same way.
   Then restart your system and enter the command <code class="command">mdadm /dev/mdX --add
   /dev/sdX</code>. Replace <code class="literal">X</code> with your particular device
   identifiers. This integrates the hard disk automatically into the RAID
   system and fully reconstructs it (for all RAID levels except for
   RAID 0).
  </p><p>
   Although you can access all data during the rebuild, you might encounter
   some performance issues until the RAID has been fully rebuilt.
  </p><div class="sect2 " id="sec.raid.trouble.autorecovery"><div class="titlepage"><div><div><h3 class="title" id="sec.raid.trouble.autorecovery"><span class="number">7.3.1 </span><span class="name">Recovery after Failing Disk is Back Again</span> <a title="Permalink" class="permalink" href="#sec.raid.trouble.autorecovery">#</a></h3></div></div></div><p>
    There are several reasons a disk included in a RAID array may fail. Here is
    a list of the most common ones:
   </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
      Problems with the disk media.
     </p></li><li class="listitem "><p>
      Disk drive controller failure.
     </p></li><li class="listitem "><p>
      Broken connection to the disk.
     </p></li></ul></div><p>
    In the case of the disk media or controller failure, the device needs to be
    replaced or repaired. If a hot-spare was not configured within the RAID,
    then manual intervention is required.
   </p><p>
    In the last case, the failed device can be automatically re-added by the
    <code class="command">mdadm</code> command after the connection is repaired (which
    might be automatic).
   </p><p>
    Because <code class="command">md</code>/<code class="command">mdadm</code> cannot reliably
    determine what caused the disk failure, it assumes a serious disk error and
    treats any failed device as faulty until it is explicitly told that the
    device is reliable.
   </p><p>
    Under some circumstances—such as storage devices with the internal
    RAID array— the connection problems are very often the cause of the
    device failure. In such case, you can tell <code class="command">mdadm</code> that it
    is safe to automatically <code class="option">--re-add</code> the device after it
    appears. You can do this by adding the following line to
    <code class="filename">/etc/mdadm.conf</code>:
   </p><div class="verbatim-wrap"><pre class="screen">POLICY action=re-add</pre></div><p>
    Note that the device will be automatically re-added after re-appearing only
    if the <code class="systemitem">udev</code> rules cause <code class="command">mdadm -I
    <em class="replaceable ">DISK_DEVICE_NAME</em></code> to be run on any
    device that spontaneously appears (default behavior), and if write-intent
    bitmaps are configured (they are by default).
   </p><p>
    If you want this policy to only apply to some devices and not to the
    others, then the <code class="literal">path=</code> option can be added to the
    <code class="literal">POLICY</code> line in <code class="filename">/etc/mdadm.conf</code> to
    restrict the non-default action to only selected devices. Wild cards can be
    used to identify groups of devices. See <code class="command">man 5 mdadm.conf</code>
    for more information.
   </p></div></div><div class="sect1 " id="sec.raid.more"><div class="titlepage"><div><div><h2 class="title" id="sec.raid.more"><span class="number">7.4 </span><span class="name">For More Information</span> <a title="Permalink" class="permalink" href="#sec.raid.more">#</a></h2></div></div></div><p>
   Configuration instructions and more details for soft RAID can be found in
   the HOWTOs at:
  </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
     <em class="citetitle ">The Linux RAID wiki</em>:
     <a class="link" href="https://raid.wiki.kernel.org/index.php/Linux_Raid" target="_blank">https://raid.wiki.kernel.org/index.php/Linux_Raid</a>
    </p></li><li class="listitem "><p>
     <em class="citetitle ">The Software RAID HOWTO</em> in the
     <code class="filename">/usr/share/doc/packages/mdadm/Software-RAID.HOWTO.html</code>
     file
    </p></li></ul></div><p>
   Linux RAID mailing lists are also available, such as
   <em class="citetitle ">linux-raid</em> at
   <a class="link" href="http://marc.info/?l=linux-raid" target="_blank">http://marc.info/?l=linux-raid</a>.
  </p></div></div><div xml:lang="en" class="chapter " id="cha.raidroot" lang="en"><div class="titlepage"><div><div><h2 class="title"><span class="number">8 </span><span class="name">Configuring Software RAID for the Root Partition</span> <a title="Permalink" class="permalink" href="#cha.raidroot">#</a></h2><div class="doc-status"><ul><li><span class="ds-label">Filename: </span>storage_raidroot.xml</li><li><span class="ds-label">ID: </span>cha.raidroot</li></ul></div></div></div></div><div class="line"><div class="toc"><dl><dt><span class="sect1"><a href="#sec.raidroot.require"><span class="number">8.1 </span><span class="name">
   Prerequisites for Using a Software RAID Device for the Root Partition
  </span></a></span></dt><dt><span class="sect1"><a href="#sec.raidroot.setup"><span class="number">8.2 </span><span class="name">
   Setting Up the System with a Software RAID Device for the Root
   (<code class="filename">/</code>) Partition
  </span></a></span></dt></dl></div></div><p>
  In <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span>, the Device Mapper RAID tool has been integrated into the
  YaST Partitioner. You can use the partitioner at install time to create a
  software RAID for the system device that contains your root
  (<code class="filename">/</code>) partition. The <code class="filename">/boot</code> partition
  cannot be stored on a RAID partition unless it is RAID 1.
 </p><div class="sect1 " id="sec.raidroot.require"><div class="titlepage"><div><div><h2 class="title" id="sec.raidroot.require"><span class="number">8.1 </span><span class="name">
   Prerequisites for Using a Software RAID Device for the Root Partition
  </span> <a title="Permalink" class="permalink" href="#sec.raidroot.require">#</a></h2></div></div></div><p>
   Ensure that your configuration meets the following requirements:
  </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
     You need two hard disks to create the RAID 1 mirror device. The hard
     disks should be similarly sized. The RAID assumes the size of the smaller
     drive. The block storage devices can be any combination of local (in or
     directly attached to the machine), Fibre Channel storage subsystems, or
     iSCSI storage subsystems.
    </p></li><li class="listitem "><p>
     A separate partition for <code class="filename">/boot</code> is not required if you
     install the boot loader in the MBR. If installing the boot loader in the
     MBR is not an option, <code class="filename">/boot</code> needs to reside on a
     separate partition.
    </p></li><li class="listitem "><p>
     For UEFI machines, you need to set up a dedicated
     <code class="filename">/boot/efi</code> partition. It needs to be VFAT-formatted,
     and may reside on the RAID 1 device to prevent booting problems in case
     the physical disk with <code class="filename">/boot/efi</code> fails.
    </p></li><li class="listitem "><p>
     If you are using hardware RAID devices, do not attempt to run software
     RAIDs on top of it.
    </p></li><li class="listitem "><p>
     If you are using iSCSI target devices, you need to enable the iSCSI
     initiator support before you create the RAID device.
    </p></li><li class="listitem "><p>
     If your storage subsystem provides multiple I/O paths between the server
     and its directly attached local devices, Fibre Channel devices, or iSCSI
     devices that you want to use in the software RAID, you need to enable the
     multipath support before you create the RAID device.
    </p></li></ul></div></div><div class="sect1 " id="sec.raidroot.setup"><div class="titlepage"><div><div><h2 class="title" id="sec.raidroot.setup"><span class="number">8.2 </span><span class="name">
   Setting Up the System with a Software RAID Device for the Root
   (<code class="filename">/</code>) Partition
  </span> <a title="Permalink" class="permalink" href="#sec.raidroot.setup">#</a></h2></div></div></div><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
     Start the installation with YaST and proceed as described in
     <span class="intraxref">Book “<em class="citetitle ">Deployment Guide</em>”, Chapter 8 “Installation Steps”</span> until you reach the <span class="guimenu">Suggested
     Partitioning</span> step.
    </p></li><li class="step "><p>
     Click <span class="guimenu">Expert Partitioner</span> to open the custom
     partitioning tool.
    </p></li><li class="step "><p>
     (Optional) If there are iSCSI target devices that you want to use, you
     need to enable the iSCSI Initiator software by choosing <span class="guimenu">Configure</span> › <span class="guimenu">Configure iSCSI</span> from the lower right section of the screen. Refer to
     <a class="xref" href="#cha.iscsi" title="Chapter 14. Mass Storage over IP Networks: iSCSI">Chapter 14, <em>Mass Storage over IP Networks: iSCSI</em></a> for further details.
    </p></li><li class="step "><p>
     (Optional) If there are multiple I/O paths to the devices that you want to
     use you need to enable multipath support by choosing <span class="guimenu">Configure</span> › <span class="guimenu">Configure Multipath</span> › <span class="guimenu">Yes</span> from the lower right section of the
     screen.
    </p></li><li class="step "><p>
     (Optional) In case you have neither configured iSCSI or Multipath, the
     default proposal settings are shown. Click <span class="guimenu">Rescan
     Devices</span> to delete them.
    </p></li><li class="step "><p>
     Set up the <span class="guimenu">0xFD Linux RAID</span> format for each of the
     devices you want to use for the software RAID. You should use RAID for
     <code class="filename">/</code>, <code class="filename">/boot/efi</code>, or swap
     partitions.
    </p><ol type="a" class="substeps "><li class="step "><p>
       In the left panel, select <span class="guimenu">Hard Disks</span> and select the
       device you want to use, then click <span class="guimenu">Add Partition</span>.
      </p></li><li class="step "><p>
       Under <span class="guimenu">New Partition Type</span>, select <span class="guimenu">Primary
       Partition</span>, then click <span class="guimenu">Next</span>.
      </p></li><li class="step "><p>
       Under <span class="guimenu">New Partition Size</span>, specify the size to use,
       then click <span class="guimenu">Next</span>.
      </p></li><li class="step "><p>
       Under <span class="guimenu">Role</span>, choose <span class="guimenu">Raw Volume
       (unformatted)</span>.
      </p></li><li class="step "><p>
       Select <span class="guimenu">Do not format</span> and set the <span class="guimenu">File
       SystemID</span> to <span class="guimenu">0xFD Linux RAID</span>.
      </p></li><li class="step "><p>
       Click <span class="guimenu">Finish</span> and repeat these instructions for the
       second partition.
      </p><div class="informalfigure"><div class="mediaobject"><a xmlns="" href="images/raid_yast_install2_a.png"><img src="images/raid_yast_install2_a.png" width="" /></a></div></div></li></ol></li><li class="step "><p>
     Create the RAID device for the <code class="filename">/</code> partition.
    </p><ol type="a" class="substeps "><li class="step "><p>
       In the left panel, select <span class="guimenu">RAID</span> and then <span class="guimenu">Add
       RAID</span>.
      </p></li><li class="step "><p>
       Set the desired <span class="guimenu">RAID Type</span> for the
       <code class="filename">/</code> partition and the <span class="guimenu">RAID name</span> to
       <code class="literal">system</code>.
      </p></li><li class="step "><p>
       Select the two RAID devices you prepared in the previous step from the
       <span class="guimenu">Available Devices</span> section and <span class="guimenu">Add</span>
       them.
      </p><div class="informalfigure"><div class="mediaobject"><a xmlns="" href="images/raid_yast_install3_a.png"><img src="images/raid_yast_install3_a.png" width="" /></a></div></div><p>
       Proceed with <span class="guimenu">Next</span>.
      </p></li><li class="step "><p>
       Under <span class="guimenu">RAID Options</span>, select the chunk size from the
       drop-down box. Sticking with the default is a safe choice.
      </p></li><li class="step "><p>
       Under <span class="guimenu">Role</span>, select <span class="guimenu">Operating
       System</span> and proceed with <span class="guimenu">Finish</span>.
      </p></li><li class="step "><p>
       Select the <span class="guimenu">File System</span> and set the mount point to
       <code class="filename">/</code>. Leave the dialog with
       <code class="filename">Finish</code>.
      </p></li></ol></li><li class="step "><p>
     The software RAID device is managed by Device Mapper, and creates a device
     under the <code class="filename">/dev/md/system</code> path.
    </p></li><li class="step "><p>
     Optionally for UEFI machines, use similar steps to create the
     <code class="filename">/boot/efi</code> mounted partition. Remember that only RAID
     1 is supported for <code class="filename">/boot/efi</code>, and the partition needs
     to be formatted with the FAT file system.
    </p><div class="figure" id="idm139787669153440"><div class="figure-contents"><div class="mediaobject"><a xmlns="" href="images/raid_yast_install3_b.png"><img src="images/raid_yast_install3_b.png" width="" alt="/, /boot/efi, and swap on RAIDs" /></a></div></div><div class="figure-title-wrap"><h6 class="figure-title"><span class="number">Figure 8.1: </span><span class="name"><span class="guimenu">/</span>, <span class="guimenu">/boot/efi</span>, and swap on RAIDs </span><a title="Permalink" class="permalink" href="#idm139787669153440">#</a></h6></div></div></li><li class="step "><p>
     Click <span class="guimenu">Accept</span> to leave the partitioner.
    </p><p>
     The new proposal appears on the <span class="guimenu">Suggested Partitioning</span>
     page.
    </p></li><li class="step "><p>
     Continue with the installation. For UEFI machines with a separate
     <code class="filename">/boot/efi</code> partition, click <span class="guimenu">Booting</span>
     on the <span class="guimenu">Installation Settings</span> screen and set
     <span class="guimenu">GRUB2 for EFI</span> as the <span class="guimenu">Boot Loader</span>.
     Check that the <span class="guimenu">Enable Secure Boot Support</span> option is
     activated.
    </p><p>
     Whenever you reboot your server, Device Mapper is started at boot time so
     that the software RAID is automatically recognized, and the operating
     system on the root (/) partition can be started.
    </p></li></ol></div></div></div></div><div xml:lang="en" class="chapter " id="cha.raid10" lang="en"><div class="titlepage"><div><div><h2 class="title"><span class="number">9 </span><span class="name">Creating Software RAID 10 Devices</span> <a title="Permalink" class="permalink" href="#cha.raid10">#</a></h2><div class="doc-status"><ul><li><span class="ds-label">Filename: </span>storage_raid10.xml</li><li><span class="ds-label">ID: </span>cha.raid10</li></ul></div></div></div></div><div class="line"><div class="toc"><dl><dt><span class="sect1"><a href="#sec.raid10.nest"><span class="number">9.1 </span><span class="name">Creating Nested RAID 10 Devices with <code class="command">mdadm</code></span></a></span></dt><dt><span class="sect1"><a href="#sec.raid10.complex"><span class="number">9.2 </span><span class="name">Creating a Complex RAID 10</span></a></span></dt></dl></div></div><p>
  This section describes how to set up nested and complex RAID 10 devices.
  A RAID 10 device consists of nested RAID 1 (mirroring) and RAID 0
  (striping) arrays. Nested RAIDs can either be set up as striped mirrors
  (RAID 1+0) or as mirrored stripes (RAID 0+1). A complex
  RAID 10 setup also combines mirrors and stripes and additional data
  security by supporting a higher data redundancy level.
 </p><div class="sect1 " id="sec.raid10.nest"><div class="titlepage"><div><div><h2 class="title" id="sec.raid10.nest"><span class="number">9.1 </span><span class="name">Creating Nested RAID 10 Devices with <code class="command">mdadm</code></span> <a title="Permalink" class="permalink" href="#sec.raid10.nest">#</a></h2></div></div></div><p>
   A nested RAID device consists of a RAID array that uses another RAID array
   as its basic element, instead of using physical disks. The goal of this
   configuration is to improve the performance and fault tolerance of the RAID.
   Setting up nested RAID levels is not supported by YaST, but can be done by
   using the <code class="command">mdadm</code> command line tool.
  </p><p>
   Based on the order of nesting, two different nested RAIDs can be set up.
   This document uses the following terminology:
  </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p><span class="formalpara-title">RAID 1+0: </span>
      RAID 1 (mirror) arrays are built first, then combined to form a RAID 0
      (stripe) array.
     </p></li><li class="listitem "><p><span class="formalpara-title">RAID 0+1: </span>
      RAID 0 (stripe) arrays are built first, then combined to form a RAID 1
      (mirror) array.
     </p></li></ul></div><p>
   The following table describes the advantages and disadvantages of RAID 10
   nesting as 1+0 versus 0+1. It assumes that the storage objects you use
   reside on different disks, each with a dedicated I/O capability.
  </p><div class="table" id="idm139787669126512"><div class="table-title-wrap"><h6 class="table-title"><span class="number">Table 9.1: </span><span class="name">Nested RAID Levels </span><a title="Permalink" class="permalink" href="#idm139787669126512">#</a></h6></div><div class="table-contents"><table summary="Nested RAID Levels" border="1"><colgroup><col class="1" /><col class="2" /><col class="3" /></colgroup><thead><tr><th>
       <p>
        RAID Level
       </p>
      </th><th>
       <p>
        Description
       </p>
      </th><th>
       <p>
        Performance and Fault Tolerance
       </p>
      </th></tr></thead><tbody><tr><td>
       <p>
        10 (1+0)
       </p>
      </td><td>
       <p>
        RAID 0 (stripe) built with RAID 1 (mirror) arrays
       </p>
      </td><td>
       <p>
        RAID 1+0 provides high levels of I/O performance, data redundancy, and
        disk fault tolerance. Because each member device in the RAID 0 is
        mirrored individually, multiple disk failures can be tolerated and data
        remains available as long as the disks that fail are in different
        mirrors.
       </p>
       <p>
        You can optionally configure a spare for each underlying mirrored
        array, or configure a spare to serve a spare group that serves all
        mirrors.
       </p>
      </td></tr><tr><td>
       <p>
        10 (0+1)
       </p>
      </td><td>
       <p>
        RAID 1 (mirror) built with RAID 0 (stripe) arrays
       </p>
      </td><td>
       <p>
        RAID 0+1 provides high levels of I/O performance and data redundancy,
        but slightly less fault tolerance than a 1+0. If multiple disks fail on
        one side of the mirror, then the other mirror is available. However, if
        disks are lost concurrently on both sides of the mirror, all data is
        lost.
       </p>
       <p>
        This solution offers less disk fault tolerance than a 1+0 solution, but
        if you need to perform maintenance or maintain the mirror on a
        different site, you can take an entire side of the mirror offline and
        still have a fully functional storage device. Also, if you lose the
        connection between the two sites, either site operates independently of
        the other. That is not true if you stripe the mirrored segments,
        because the mirrors are managed at a lower level.
       </p>
       <p>
        If a device fails, the mirror on that side fails because RAID 1 is not
        fault-tolerant. Create a new RAID 0 to replace the failed side, then
        resynchronize the mirrors.
       </p>
      </td></tr></tbody></table></div></div><div class="sect2 " id="sec.raid10.nest.10"><div class="titlepage"><div><div><h3 class="title" id="sec.raid10.nest.10"><span class="number">9.1.1 </span><span class="name">Creating Nested RAID 10 (1+0) with mdadm</span> <a title="Permalink" class="permalink" href="#sec.raid10.nest.10">#</a></h3></div></div></div><p>
    A nested RAID 1+0 is built by creating two or more RAID 1 (mirror) devices,
    then using them as component devices in a RAID 0.
   </p><div id="idm139787669106544" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.png" /><h6>Important: Multipathing</h6><p>
     If you need to manage multiple connections to the devices, you must
     configure multipath I/O before configuring the RAID devices. For
     information, see
     <a class="xref" href="#cha.multipath" title="Chapter 17. Managing Multipath I/O for Devices">Chapter 17, <em>Managing Multipath I/O for Devices</em></a>.
    </p></div><p>
    The procedure in this section uses the device names shown in the following
    table. Ensure that you modify the device names with the names of your own
    devices.
   </p><div class="table" id="idm139787669103600"><div class="table-title-wrap"><h6 class="table-title"><span class="number">Table 9.2: </span><span class="name">Scenario for Creating a RAID 10 (1+0) by Nesting </span><a title="Permalink" class="permalink" href="#idm139787669103600">#</a></h6></div><div class="table-contents"><table summary="Scenario for Creating a RAID 10 (1+0) by Nesting" border="1"><colgroup><col class="1" /><col class="2" /><col class="3" /></colgroup><thead><tr><th>
        <p>
         Raw Devices
        </p>
       </th><th>
        <p>
         RAID 1 (mirror)
        </p>
       </th><th>
        <p>
         RAID 1+0 (striped mirrors)
        </p>
       </th></tr></thead><tbody><tr><td>
        <table border="0" summary="Simple list" class="simplelist "><tr><td><code class="filename">/dev/sdb1</code>
         </td></tr><tr><td><code class="filename">/dev/sdc1</code>
         </td></tr></table>
       </td><td>
        <p>
         <code class="filename">/dev/md0</code>
        </p>
       </td><td rowspan="2">
        
        <p>
         <code class="filename">/dev/md2</code>
        </p>
       </td></tr><tr><td>
        <table border="0" summary="Simple list" class="simplelist "><tr><td><code class="filename">/dev/sdd1</code>
         </td></tr><tr><td><code class="filename">/dev/sde1</code>
         </td></tr></table>
       </td><td>
        <p>
         <code class="filename">/dev/md1</code>
        </p>
       </td></tr></tbody></table></div></div><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
      Open a terminal console.
     </p></li><li class="step "><p>
      If necessary, create four 0xFD Linux RAID partitions of equal size using
      a disk partitioner such as parted.
     </p></li><li class="step "><p>
      Create two software RAID 1 devices, using two different devices for
      each device. At the command prompt, enter these two commands:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> mdadm --create /dev/md0 --run --level=1 --raid-devices=2 /dev/sdb1 /dev/sdc1
sudo mdadm --create /dev/md1 --run --level=1 --raid-devices=2 /dev/sdd1 /dev/sde1</pre></div></li><li class="step "><p>
      Create the nested RAID 1+0 device. At the command prompt, enter the
      following command using the software RAID 1 devices you created in the
      previous step:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> mdadm --create /dev/md2 --run --level=0 --chunk=64 \
--raid-devices=2 /dev/md0 /dev/md1</pre></div><p>
      The default chunk size is 64 KB.
     </p></li><li class="step "><p>
      Create a file system on the RAID 1+0 device
      <code class="filename">/dev/md2</code>, for example an XFS file system:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> mkfs.xfs /dev/md2</pre></div><p>
      Modify the command to use a different file system.
     </p></li><li class="step "><p>
      Edit the <code class="filename">/etc/mdadm.conf</code> file or create it, if it
      does not exist (for example by running <code class="command">sudo vi
      /etc/mdadm.conf</code>). Add the following lines (if the file already
      exists, the first line probably already exists).
     </p><div class="verbatim-wrap"><pre class="screen">DEVICE containers partitions
ARRAY /dev/md0 UUID=<em class="replaceable ">UUID</em>
ARRAY /dev/md1 UUID=<em class="replaceable ">UUID</em>
ARRAY /dev/md2 UUID=<em class="replaceable ">UUID</em></pre></div><p>
      The UUID of each device can be retrieved with the following command:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> mdadm -D /dev/<em class="replaceable ">DEVICE</em> | grep UUID</pre></div></li><li class="step "><p>
      Edit the <code class="filename">/etc/fstab</code> file to add an entry for the
      RAID 1+0 device <code class="filename">/dev/md2</code>. The following example
      shows an entry for a RAID device with the XFS file system and
      <code class="filename">/data</code> as a mount point.
     </p><div class="verbatim-wrap"><pre class="screen">/dev/md2 /data xfs defaults 1 2</pre></div></li><li class="step "><p>
      Mount the RAID device:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> mount /data</pre></div></li></ol></div></div></div><div class="sect2 " id="sec.raid10.nest.01"><div class="titlepage"><div><div><h3 class="title" id="sec.raid10.nest.01"><span class="number">9.1.2 </span><span class="name">Creating Nested RAID 10 (0+1) with mdadm</span> <a title="Permalink" class="permalink" href="#sec.raid10.nest.01">#</a></h3></div></div></div><p>
    A nested RAID 0+1 is built by creating two to four RAID 0 (striping)
    devices, then mirroring them as component devices in a RAID 1.
   </p><div id="idm139787669061888" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.png" /><h6>Important: Multipathing</h6><p>
     If you need to manage multiple connections to the devices, you must
     configure multipath I/O before configuring the RAID devices. For
     information, see
     <a class="xref" href="#cha.multipath" title="Chapter 17. Managing Multipath I/O for Devices">Chapter 17, <em>Managing Multipath I/O for Devices</em></a>.
    </p></div><p>
    In this configuration, spare devices cannot be specified for the underlying
    RAID 0 devices because RAID 0 cannot tolerate a device loss. If a
    device fails on one side of the mirror, you must create a replacement
    RAID 0 device, than add it into the mirror.
   </p><p>
    The procedure in this section uses the device names shown in the following
    table. Ensure that you modify the device names with the names of your own
    devices.
   </p><div class="table" id="idm139787669058240"><div class="table-title-wrap"><h6 class="table-title"><span class="number">Table 9.3: </span><span class="name">Scenario for Creating a RAID 10 (0+1) by Nesting </span><a title="Permalink" class="permalink" href="#idm139787669058240">#</a></h6></div><div class="table-contents"><table summary="Scenario for Creating a RAID 10 (0+1) by Nesting" border="1"><colgroup><col class="1" /><col class="2" /><col class="3" /></colgroup><thead><tr><th>
        <p>
         Raw Devices
        </p>
       </th><th>
        <p>
         RAID 0 (stripe)
        </p>
       </th><th>
        <p>
         RAID 0+1 (mirrored stripes)
        </p>
       </th></tr></thead><tbody><tr><td>
        <table border="0" summary="Simple list" class="simplelist "><tr><td><code class="filename">/dev/sdb1</code>
         </td></tr><tr><td><code class="filename">/dev/sdc1</code>
         </td></tr></table>
       </td><td>
        <p>
         <code class="filename">/dev/md0</code>
        </p>
       </td><td rowspan="2">
        
        <p>
         <code class="filename">/dev/md2</code>
        </p>
       </td></tr><tr><td>
        <table border="0" summary="Simple list" class="simplelist "><tr><td><code class="filename">/dev/sdd1</code>
         </td></tr><tr><td><code class="filename">/dev/sde1</code>
         </td></tr></table>
       </td><td>
        <p>
         <code class="filename">/dev/md1</code>
        </p>
       </td></tr></tbody></table></div></div><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
      Open a terminal console.
     </p></li><li class="step "><p>
      If necessary, create four 0xFD Linux RAID partitions of equal size using
      a disk partitioner such as parted.
     </p></li><li class="step "><p>
      Create two software RAID 0 devices, using two different devices for
      each RAID 0 device. At the command prompt, enter these two commands:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> mdadm --create /dev/md0 --run --level=0 --chunk=64 \
--raid-devices=2 /dev/sdb1 /dev/sdc1
sudo mdadm --create /dev/md1 --run --level=0 --chunk=64 \
--raid-devices=2 /dev/sdd1 /dev/sde1</pre></div><p>
      The default chunk size is 64 KB.
     </p></li><li class="step "><p>
      Create the nested RAID 0+1 device. At the command prompt, enter the
      following command using the software RAID 0 devices you created in
      the previous step:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> mdadm --create /dev/md2 --run --level=1 --raid-devices=2 /dev/md0 /dev/md1</pre></div></li><li class="step "><p>
      Create a file system on the RAID 1+0 device
      <code class="filename">/dev/md2</code>, for example an XFS file system:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> mkfs.xfs /dev/md2</pre></div><p>
      Modify the command to use a different file system.
     </p></li><li class="step "><p>
      Edit the <code class="filename">/etc/mdadm.conf</code> file or create it, if it
      does not exist (for example by running <code class="command">sudo vi
      /etc/mdadm.conf</code>). Add the following lines (if the file exists,
      the first line probably already exists, too).
     </p><div class="verbatim-wrap"><pre class="screen">DEVICE containers partitions
ARRAY /dev/md0 UUID=<em class="replaceable ">UUID</em>
ARRAY /dev/md1 UUID=<em class="replaceable ">UUID</em>
ARRAY /dev/md2 UUID=<em class="replaceable ">UUID</em></pre></div><p>
      The UUID of each device can be retrieved with the following command:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> mdadm -D /dev/<em class="replaceable ">DEVICE</em> | grep UUID</pre></div></li><li class="step "><p>
      Edit the <code class="filename">/etc/fstab</code> file to add an entry for the
      RAID 1+0 device <code class="filename">/dev/md2</code>. The following example
      shows an entry for a RAID device with the XFS file system and
      <code class="filename">/data</code> as a mount point.
     </p><div class="verbatim-wrap"><pre class="screen">/dev/md2 /data xfs defaults 1 2</pre></div></li><li class="step "><p>
      Mount the RAID device:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> mount /data</pre></div></li></ol></div></div></div></div><div class="sect1 " id="sec.raid10.complex"><div class="titlepage"><div><div><h2 class="title" id="sec.raid10.complex"><span class="number">9.2 </span><span class="name">Creating a Complex RAID 10</span> <a title="Permalink" class="permalink" href="#sec.raid10.complex">#</a></h2></div></div></div><p>
   YaST (and <code class="command">mdadm</code> with the <code class="option">--level=10</code>
   option) creates a single complex software RAID 10 that combines
   features of both RAID 0 (striping) and RAID 1 (mirroring). Multiple copies
   of all data blocks are arranged on multiple drives following a striping
   discipline. Component devices should be the same size.
  </p><p>
   The complex RAID 10 is similar in purpose to a nested RAID 10
   (1+0), but differs in the following ways:
  </p><div class="table" id="idm139787669014768"><div class="table-title-wrap"><h6 class="table-title"><span class="number">Table 9.4: </span><span class="name">Complex RAID 10 compared to Nested RAID 10 </span><a title="Permalink" class="permalink" href="#idm139787669014768">#</a></h6></div><div class="table-contents"><table summary="Complex RAID 10 compared to Nested RAID 10" border="1"><colgroup><col class="1" /><col class="2" /><col class="3" /></colgroup><thead><tr><th>
       <p>
        Feature
       </p>
      </th><th>
       <p>
        Complex RAID 10
       </p>
      </th><th>
       <p>
        Nested RAID 10 (1+0)
       </p>
      </th></tr></thead><tbody><tr><td>
       <p>
        Number of devices
       </p>
      </td><td>
       <p>
        Allows an even or odd number of component devices
       </p>
      </td><td>
       <p>
        Requires an even number of component devices
       </p>
      </td></tr><tr><td>
       <p>
        Component devices
       </p>
      </td><td>
       <p>
        Managed as a single RAID device
       </p>
      </td><td>
       <p>
        Manage as a nested RAID device
       </p>
      </td></tr><tr><td>
       <p>
        Striping
       </p>
      </td><td>
       <p>
        Striping occurs in the near or far layout on component devices.
       </p>
       <p>
        The far layout provides sequential read throughput that scales by
        number of drives, rather than number of RAID 1 pairs.
       </p>
      </td><td>
       <p>
        Striping occurs consecutively across component devices
       </p>
      </td></tr><tr><td>
       <p>
        Multiple copies of data
       </p>
      </td><td>
       <p>
        Two or more copies, up to the number of devices in the array
       </p>
      </td><td>
       <p>
        Copies on each mirrored segment
       </p>
      </td></tr><tr><td>
       <p>
        Hot spare devices
       </p>
      </td><td>
       <p>
        A single spare can service all component devices
       </p>
      </td><td>
       <p>
        Configure a spare for each underlying mirrored array, or configure a
        spare to serve a spare group that serves all mirrors.
       </p>
      </td></tr></tbody></table></div></div><div class="sect2 " id="sec.raid10.complex.replicas"><div class="titlepage"><div><div><h3 class="title" id="sec.raid10.complex.replicas"><span class="number">9.2.1 </span><span class="name">Number of Devices and Replicas in the Complex RAID 10</span> <a title="Permalink" class="permalink" href="#sec.raid10.complex.replicas">#</a></h3></div></div></div><p>
    When configuring a complex RAID 10 array, you must specify the number
    of replicas of each data block that are required. The default number of
    replicas is two, but the value can be two to the number of devices in the
    array.
   </p><p>
    You must use at least as many component devices as the number of replicas
    you specify. However, the number of component devices in a RAID 10
    array does not need to be a multiple of the number of replicas of each data
    block. The effective storage size is the number of devices divided by the
    number of replicas.
   </p><p>
    For example, if you specify two replicas for an array created with five
    component devices, a copy of each block is stored on two different devices.
    The effective storage size for one copy of all data is 5/2 or 2.5 times the
    size of a component device.
   </p></div><div class="sect2 " id="sec.raid10.complex.layout"><div class="titlepage"><div><div><h3 class="title" id="sec.raid10.complex.layout"><span class="number">9.2.2 </span><span class="name">Layout</span> <a title="Permalink" class="permalink" href="#sec.raid10.complex.layout">#</a></h3></div></div></div><p>
    The complex RAID 10 setup supports three different layouts which
    define how the data blocks are arranged on the disks. The available layouts
    are near (default), far and offset. They have different performance
    characteristics, so it is important to choose the right layout for your
    workload.
   </p><div class="sect3 " id="sec.raid10.complex.layout.near"><div class="titlepage"><div><div><h4 class="title" id="sec.raid10.complex.layout.near"><span class="number">9.2.2.1 </span><span class="name">Near Layout</span> <a title="Permalink" class="permalink" href="#sec.raid10.complex.layout.near">#</a></h4></div></div></div><p>
     With the near layout, copies of a block of data are striped near each
     other on different component devices. That is, multiple copies of one data
     block are at similar offsets in different devices. Near is the default
     layout for RAID 10. For example, if you use an odd number of
     component devices and two copies of data, some copies are perhaps one
     chunk further into the device.
    </p><p>
     The near layout for the complex RAID 10 yields read and write
     performance similar to RAID 0 over half the number of drives.
    </p><p>
     Near layout with an even number of disks and two replicas:
    </p><div class="verbatim-wrap"><pre class="screen">sda1 sdb1 sdc1 sde1
  0    0    1    1
  2    2    3    3
  4    4    5    5
  6    6    7    7
  8    8    9    9</pre></div><p>
     Near layout with an odd number of disks and two replicas:
    </p><div class="verbatim-wrap"><pre class="screen">sda1 sdb1 sdc1 sde1 sdf1
  0    0    1    1    2
  2    3    3    4    4
  5    5    6    6    7
  7    8    8    9    9
  10   10   11   11   12</pre></div></div><div class="sect3 " id="sec.raid10.complex.layout.far"><div class="titlepage"><div><div><h4 class="title" id="sec.raid10.complex.layout.far"><span class="number">9.2.2.2 </span><span class="name">Far Layout</span> <a title="Permalink" class="permalink" href="#sec.raid10.complex.layout.far">#</a></h4></div></div></div><p>
     The far layout stripes data over the early part of all drives, then
     stripes a second copy of the data over the later part of all drives,
     making sure that all copies of a block are on different drives. The second
     set of values starts halfway through the component drives.
    </p><p>
     With a far layout, the read performance of the complex RAID 10 is
     similar to a RAID 0 over the full number of drives, but write
     performance is substantially slower than a RAID 0 because there is
     more seeking of the drive heads. It is best used for read-intensive
     operations such as for read-only file servers.
    </p><p>
     The speed of the RAID 10 for writing is similar to other mirrored
     RAID types, like RAID 1 and RAID 10 using near layout, as the
     elevator of the file system schedules the writes in a more optimal way
     than raw writing. Using RAID 10 in the far layout is well suited for
     mirrored writing applications.
    </p><p>
     Far layout with an even number of disks and two replicas:
    </p><div class="verbatim-wrap"><pre class="screen">sda1 sdb1 sdc1 sde1
  0    1    2    3
  4    5    6    7
  . . .
  3    0    1    2
  7    4    5    6</pre></div><p class="intro">
     Far layout with an odd number of disks and two replicas:
    </p><div class="verbatim-wrap"><pre class="screen">sda1 sdb1 sdc1 sde1 sdf1
  0    1    2    3    4
  5    6    7    8    9
  . . .
  4    0    1    2    3
  9    5    6    7    8</pre></div></div><div class="sect3 " id="sec.raid10.complex.layout.offset"><div class="titlepage"><div><div><h4 class="title" id="sec.raid10.complex.layout.offset"><span class="number">9.2.2.3 </span><span class="name">Offset Layout</span> <a title="Permalink" class="permalink" href="#sec.raid10.complex.layout.offset">#</a></h4></div></div></div><p>
     The offset layout duplicates stripes so that the multiple copies of a
     given chunk are laid out on consecutive drives and at consecutive offsets.
     Effectively, each stripe is duplicated and the copies are offset by one
     device. This should give similar read characteristics to a far layout if a
     suitably large chunk size is used, but without as much seeking for writes.
    </p><p>
     Offset layout with an even number of disks and two replicas:
    </p><div class="verbatim-wrap"><pre class="screen">sda1 sdb1 sdc1 sde1
  0    1    2    3
  3    0    1    2
  4    5    6    7
  7    4    5    6
  8    9   10   11
 11    8    9   10</pre></div><p>
     Offset layout with an odd number of disks and two replicas:
    </p><div class="verbatim-wrap"><pre class="screen">sda1 sdb1 sdc1 sde1 sdf1
  0    1    2    3    4
  4    0    1    2    3
  5    6    7    8    9
  9    5    6    7    8
 10   11   12   13   14
 14   10   11   12   13</pre></div></div><div class="sect3 " id="sec.raid10.complex.layout.parameter"><div class="titlepage"><div><div><h4 class="title" id="sec.raid10.complex.layout.parameter"><span class="number">9.2.2.4 </span><span class="name">Specifying the number of Replicas and the Layout with YaST and mdadm</span> <a title="Permalink" class="permalink" href="#sec.raid10.complex.layout.parameter">#</a></h4></div></div></div><p>
     The number of replicas and the layout is specified as <span class="guimenu">Parity
     Algorithm</span> in YaST or with the <code class="option">--layout</code>
     parameter for mdadm. The following values are accepted:
    </p><div class="variablelist "><dl class="variablelist"><dt id="idm139787668965152"><span class="term "><code class="literal">n<em class="replaceable ">N</em></code>
      </span></dt><dd><p>
        Specify <code class="literal">n</code> for near layout and replace
        <em class="replaceable ">N</em> with the number of replicas.
        <code class="literal">n2</code> is the default that is used when not configuring
        layout and the number of replicas.
       </p></dd><dt id="idm139787668961376"><span class="term "><code class="literal">f<em class="replaceable ">N</em></code>
      </span></dt><dd><p>
        Specify <code class="literal">f</code> for far layout and replace
        <em class="replaceable ">N</em> with the number of replicas.
       </p></dd><dt id="idm139787668958080"><span class="term "><code class="literal">o<em class="replaceable ">N</em></code>
      </span></dt><dd><p>
        Specify <code class="literal">o</code> for offset layout and replace
        <em class="replaceable ">N</em> with the number of replicas.
       </p></dd></dl></div><div id="idm139787668954624" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.png" /><h6>Note: Number of Replicas</h6><p>
      YaST automatically offers a selection of all possible values for the
      <span class="guimenu">Parity Algorithm</span> parameter.
     </p></div></div></div><div class="sect2 " id="sec.raid10.complex.yast"><div class="titlepage"><div><div><h3 class="title" id="sec.raid10.complex.yast"><span class="number">9.2.3 </span><span class="name">Creating a Complex RAID 10 with the YaST Partitioner</span> <a title="Permalink" class="permalink" href="#sec.raid10.complex.yast">#</a></h3></div></div></div><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
      Launch YaST and open the Partitioner.
     </p></li><li class="step "><p>
      If necessary, create partitions that should be used with your RAID
      configuration. Do not format them and set the partition type to
      <span class="guimenu">0xFD Linux RAID</span>. When using existing partitions it is
      not necessary to change their partition type—YaST will
      automatically do so. Refer to
      <span class="intraxref">Book “<em class="citetitle ">Deployment Guide</em>”, Chapter 9 “Expert Partitioner”, Section 9.1 “Using the Expert Partitioner”</span> for details.
     </p><p>
      For RAID 10 at least four partitions are needed. It is strongly
      recommended to use partitions stored on different hard disks to decrease
      the risk of losing data if one is defective. It is recommended to use
      only partitions of the same size because each segment can contribute only
      the same amount of space as the smallest sized partition.
     </p></li><li class="step "><p>
      In the left panel, select <span class="guimenu">RAID</span>.
     </p><p>
      A list of existing RAID configurations opens in the right panel.
     </p></li><li class="step "><p>
      At the lower left of the RAID page, click <span class="guimenu">Add RAID</span>.
     </p></li><li class="step "><p>
      Under <span class="guimenu">RAID Type</span>, select <span class="guimenu">RAID 10 (Mirroring
      and Striping)</span>.
     </p><p>
      You can optionally assign a <span class="guimenu">RAID Name</span> to your RAID. It
      will make it available as
      <code class="filename">/dev/md/<em class="replaceable ">NAME</em></code>. See
      <a class="xref" href="#sec.raid.yast.names" title="7.2.1. RAID Names">Section 7.2.1, “RAID Names”</a> for more information.
     </p></li><li class="step "><p>
      In the <span class="guimenu">Available Devices</span> list, select the desired
      partitions, then click <span class="guimenu">Add</span> to move them to the
      <span class="guimenu">Selected Devices</span> list.
     </p><div class="informalfigure"><div class="mediaobject"><a xmlns="" href="images/raid10_a.png"><img src="images/raid10_a.png" width="" /></a></div></div></li><li class="step "><p>
      (Optional) Click <span class="guimenu">Classify</span> to specify the preferred
      order of the disks in the RAID array.
     </p><p>
      For RAID types such as RAID 10, where the order of added disks
      matters, you can specify the order in which the devices will be used.
      This will ensure that one half of the array resides on one disk subsystem
      and the other half of the array resides on a different disk subsystem.
      For example, if one disk subsystem fails, the system keeps running from
      the second disk subsystem.
     </p><ol type="a" class="substeps "><li class="step "><p>
        Select each disk in turn and click one of the <span class="guimenu">Class
        X</span> buttons, where X is the letter you want to assign to the
        disk. Available classes are A, B, C, D and E but for many cases fewer
        classes are needed (only A and B, for example). Assign all available
        RAID disks this way.
       </p><p>
        You can press the <span class="keycap">Ctrl</span> or
        <span class="keycap">Shift</span> key to select multiple devices. You
        can also right-click a selected device and choose the appropriate class
        from the context menu.
       </p></li><li class="step "><p>
        Specify the order of the devices by selecting one of the sorting
        options:
       </p><p><span class="formalpara-title"><span class="guimenu">Sorted</span>: </span>
         Sorts all devices of class A before all devices of class B and so on.
         For example: <code class="literal">AABBCC</code>.
        </p><p><span class="formalpara-title"><span class="guimenu">Interleaved</span>: </span>
         Sorts devices by the first device of class A, then first device of
         class B, then all the following classes with assigned devices. Then
         the second device of class A, the second device of class B, and so on
         follows. All devices without a class are sorted to the end of the
         devices list. For example: <code class="literal">ABCABC</code>.
        </p><p><span class="formalpara-title">Pattern File: </span>
         Select an existing file that contains multiple lines, where each is a
         regular expression and a class name (<code class="literal">"sda.* A"</code>).
         All devices that match the regular expression are assigned to the
         specified class for that line. The regular expression is matched
         against the kernel name (<code class="filename">/dev/sda1</code>), the udev
         path name
         (<code class="filename">/dev/disk/by-path/pci-0000:00:1f.2-scsi-0:0:0:0-part1</code>)
         and then the udev ID
         (<code class="filename">dev/disk/by-id/ata-ST3500418AS_9VMN8X8L-part1</code>).
         The first match made determines the class if a device’s name matches
         more than one regular expression.
        </p></li><li class="step "><p>
        At the bottom of the dialog, click <span class="guimenu">OK</span> to confirm the
        order.
       </p><div class="informalfigure"><div class="mediaobject"><a xmlns="" href="images/raid10_classify_a.png"><img src="images/raid10_classify_a.png" width="" /></a></div></div></li></ol></li><li class="step "><p>
      Click <span class="guimenu">Next</span>.
     </p></li><li class="step "><p>
      Under <span class="guimenu">RAID Options</span>, specify the <span class="guimenu">Chunk
      Size</span> and <span class="guimenu">Parity Algorithm</span>, then click
      <span class="guimenu">Next</span>.
     </p><p>
      For a RAID 10, the parity options are n (near), f (far), and o (offset).
      The number indicates the number of replicas of each data block that are
      required. Two is the default. For information, see
      <a class="xref" href="#sec.raid10.complex.layout" title="9.2.2. Layout">Section 9.2.2, “Layout”</a>.
     </p></li><li class="step "><p>
      Add a file system and mount options to the RAID device, then click
      <span class="guimenu">Finish</span>.
     </p></li><li class="step "><p>
      Click <span class="guimenu">Next</span>.
     </p></li><li class="step "><p>
      Verify the changes to be made, then click <span class="guimenu">Finish</span> to
      create the RAID.
     </p></li></ol></div></div></div><div class="sect2 " id="sec.raid10.complex.yast.mdadm"><div class="titlepage"><div><div><h3 class="title" id="sec.raid10.complex.yast.mdadm"><span class="number">9.2.4 </span><span class="name">Creating a Complex RAID 10 with mdadm</span> <a title="Permalink" class="permalink" href="#sec.raid10.complex.yast.mdadm">#</a></h3></div></div></div><p>
    The procedure in this section uses the device names shown in the following
    table. Ensure that you modify the device names with the names of your own
    devices.
   </p><div class="table" id="idm139787668899584"><div class="table-title-wrap"><h6 class="table-title"><span class="number">Table 9.5: </span><span class="name">Scenario for Creating a RAID 10 Using mdadm </span><a title="Permalink" class="permalink" href="#idm139787668899584">#</a></h6></div><div class="table-contents"><table summary="Scenario for Creating a RAID 10 Using mdadm" border="1"><colgroup><col class="1" /><col class="2" /></colgroup><thead><tr><th>
        <p>
         Raw Devices
        </p>
       </th><th>
        <p>
         RAID 10
        </p>
       </th></tr></thead><tbody><tr><td>
        <p>
         <code class="filename">/dev/sdf1</code>
        </p>
        <p>
         <code class="filename">/dev/sdg1</code>
        </p>
        <p>
         <code class="filename">/dev/sdh1</code>
        </p>
        <p>
         <code class="filename">/dev/sdi1</code>
        </p>
       </td><td>
        <p>
         <code class="filename">/dev/md3</code>
        </p>
       </td></tr></tbody></table></div></div><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
      Open a terminal console.
     </p></li><li class="step "><p>
      If necessary, create at least four 0xFD Linux RAID partitions of equal
      size using a disk partitioner such as parted.
     </p></li><li class="step "><p>
      Create a RAID 10 by entering the following command.
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> mdadm --create /dev/md3 --run --level=10 --chunk=32 --raid-devices=4 \
/dev/sdf1 /dev/sdg1 /dev/sdh1 /dev/sdi1</pre></div><p>
      Make sure to adjust the value for <code class="option">--raid-devices</code> and the
      list of partitions according to your setup.
     </p><p>
      The command creates an array with near layout and two replicas. To change
      any of the two values, use the <code class="option">--layout</code> as described in
      <a class="xref" href="#sec.raid10.complex.layout.parameter" title="9.2.2.4. Specifying the number of Replicas and the Layout with YaST and mdadm">Section 9.2.2.4, “Specifying the number of Replicas and the Layout with YaST and mdadm”</a>.
     </p></li><li class="step "><p>
      Create a file system on the RAID 10 device
      <code class="filename">/dev/md3</code>, for example an XFS file system:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> mkfs.xfs /dev/md3</pre></div><p>
      Modify the command to use a different file system.
     </p></li><li class="step "><p>
      Edit the <code class="filename">/etc/mdadm.conf</code> file or create it, if it
      does not exist (for example by running <code class="command">sudo vi
      /etc/mdadm.conf</code>). Add the following lines (if the file exists,
      the first line probably already exists, too) .
     </p><div class="verbatim-wrap"><pre class="screen">DEVICE containers partitions
ARRAY /dev/md3 UUID=<em class="replaceable ">UUID</em></pre></div><p>
      The UUID of the device can be retrieved with the following command:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> mdadm -D /dev/md3 | grep UUID</pre></div></li><li class="step "><p>
      Edit the <code class="filename">/etc/fstab</code> file to add an entry for the
      RAID 10 device <code class="filename">/dev/md3</code>. The following example
      shows an entry for a RAID device with the XFS file system and
      <code class="filename">/data</code> as a mount point.
     </p><div class="verbatim-wrap"><pre class="screen">/dev/md3 /data xfs defaults 1 2</pre></div></li><li class="step "><p>
      Mount the RAID device:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> mount /data</pre></div></li></ol></div></div></div></div></div><div xml:lang="en" class="chapter " id="cha.raid_degraded" lang="en"><div class="titlepage"><div><div><h2 class="title"><span class="number">10 </span><span class="name">Creating a Degraded RAID Array</span> <a title="Permalink" class="permalink" href="#cha.raid_degraded">#</a></h2><div class="doc-status"><ul><li><span class="ds-label">Filename: </span>storage_degraded_raid.xml</li><li><span class="ds-label">ID: </span>cha.raid_degraded</li></ul></div></div><div><div class="abstract"><div class="abstract-title-wrap"><h6 class="abstract-title">Abstract<a title="Permalink" class="permalink" href="#idm139787668864416">#</a></h6></div><p>
    A degraded array is one in which some devices are missing. Degraded arrays
    are supported only for RAID 1, RAID 4, RAID 5, and RAID 6. These RAID types
    are designed to withstand some missing devices as part of their
    fault-tolerance features. Typically, degraded arrays occur when a device
    fails. It is possible to create a degraded array on purpose.
   </p></div></div></div></div><div class="line"></div><div class="informaltable"><table border="1"><colgroup><col class="1" /><col class="2" /><col /></colgroup><thead><tr><th>
      <p>
       RAID Type
      </p>
     </th><th>
      <p>
       Allowable Number of Slots Missing
      </p>
     </th><th> </th></tr></thead><tbody><tr><td>
      <p>
       RAID 1
      </p>
     </td><td>
      <p>
       All but one device
      </p>
     </td><td> </td></tr><tr><td>
      <p>
       RAID 4
      </p>
     </td><td>
      <p>
       One slot
      </p>
     </td><td> </td></tr><tr><td>
      <p>
       RAID 5
      </p>
     </td><td>
      <p>
       One slot
      </p>
     </td><td> </td></tr><tr><td>
      <p>
       RAID 6
      </p>
     </td><td>
      <p>
       One or two slots
      </p>
     </td><td> </td></tr></tbody></table></div><p>
  To create a degraded array in which some devices are missing, simply give the
  word <code class="literal">missing</code> in place of a device name. This causes
  <code class="command">mdadm</code> to leave the corresponding slot in the array empty.
 </p><p>
  When creating a RAID 5 array, <code class="command">mdadm</code> automatically creates
  a degraded array with an extra spare drive. This is because building the
  spare into a degraded array is generally faster than resynchronizing the
  parity on a non-degraded, but not clean, array. You can override this feature
  with the <code class="literal">--force</code> option.
 </p><p>
  Creating a degraded array might be useful if you want create a RAID, but one
  of the devices you want to use already has data on it. In that case, you
  create a degraded array with other devices, copy data from the in-use device
  to the RAID that is running in degraded mode, add the device into the RAID,
  then wait while the RAID is rebuilt so that the data is now across all
  devices. An example of this process is given in the following procedure:
 </p><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
    To create a degraded RAID 1 device <code class="filename">/dev/md0</code>, using one
    single drive <code class="filename">/dev/sd1</code>, enter the following at the
    command prompt:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> mdadm --create /dev/md0 -l 1 -n 2 /dev/sda1 missing</pre></div><p>
    The device should be the same size or larger than the device you plan to
    add to it.
   </p></li><li class="step "><p>
    If the device you want to add to the mirror contains data that you want to
    move to the RAID array, copy it now to the RAID array while it is running
    in degraded mode.
   </p></li><li class="step "><p>
    Add the device you copied the data from to the mirror. For example, to add
    <code class="filename">/dev/sdb1</code> to the RAID, enter the following at the
    command prompt:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> mdadm /dev/md0 -a /dev/sdb1</pre></div><p>
    You can add only one device at a time. You must wait for the kernel to
    build the mirror and bring it fully online before you add another mirror.
   </p></li><li class="step "><p>
    Monitor the build progress by entering the following at the command prompt:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> cat /proc/mdstat</pre></div><p>
    To see the rebuild progress while being refreshed every second, enter
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> watch -n 1 cat /proc/mdstat</pre></div></li></ol></div></div></div><div xml:lang="en" class="chapter " id="cha.raid_resize" lang="en"><div class="titlepage"><div><div><h2 class="title"><span class="number">11 </span><span class="name">Resizing Software RAID Arrays with mdadm</span> <a title="Permalink" class="permalink" href="#cha.raid_resize">#</a></h2><div class="doc-status"><ul><li><span class="ds-label">Filename: </span>storage_mdadm-resize.xml</li><li><span class="ds-label">ID: </span>cha.raid_resize</li></ul></div></div><div><div class="abstract"><div class="abstract-title-wrap"><h6 class="abstract-title">Abstract<a title="Permalink" class="permalink" href="#idm139787668825968">#</a></h6></div><p>
    This section describes how to increase or reduce the size of a software
    RAID 1, 4, 5, or 6 device with the Multiple Device Administration
    (<code class="command">mdadm(8)</code>) tool.
   </p></div></div></div></div><div class="line"><div class="toc"><dl><dt><span class="sect1"><a href="#sec.raid_resize.incr"><span class="number">11.1 </span><span class="name">Increasing the Size of a Software RAID</span></a></span></dt><dt><span class="sect1"><a href="#sec.raid_resize.decr"><span class="number">11.2 </span><span class="name">Decreasing the Size of a Software RAID</span></a></span></dt></dl></div></div><p>
  Resizing an existing software RAID device involves increasing or decreasing
  the space contributed by each component partition. The file system that
  resides on the RAID must also be able to be resized to take advantage of the
  changes in available space on the device. In <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span>, file system
  resizing utilities are available for file systems Btrfs, Ext2, Ext3, Ext4, and
  XFS (increase size only). Refer to <a class="xref" href="#cha.resize_fs" title="Chapter 2. Resizing File Systems">Chapter 2, <em>Resizing File Systems</em></a> for more
  information.
 </p><p>
  The <code class="command">mdadm</code> tool supports resizing only for software RAID
  levels 1, 4, 5, and 6. These RAID levels provide disk fault tolerance so that
  one component partition can be removed at a time for resizing. In principle,
  it is possible to perform a hot resize for RAID partitions, but you must take
  extra care for your data when doing so.
 </p><div id="idm139787668819248" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.png" /><h6>Warning: Back Up your Data Before Resizing</h6><p>
   Resizing any partition or file system involves some risks that can
   potentially result in losing data. To avoid data loss, ensure that you back
   up your data before you begin any resizing task.
  </p></div><p>
  Resizing the RAID involves the following tasks. The order in which these
  tasks are performed depends on whether you are increasing or decreasing its
  size.
 </p><div class="table" id="idm139787668817104"><div class="table-title-wrap"><h6 class="table-title"><span class="number">Table 11.1: </span><span class="name">Tasks Involved in Resizing a RAID </span><a title="Permalink" class="permalink" href="#idm139787668817104">#</a></h6></div><div class="table-contents"><table summary="Tasks Involved in Resizing a RAID" border="1"><colgroup><col class="1" /><col class="2" /><col class="3" /><col class="4" /></colgroup><thead><tr><th>
      <p>
       Tasks
      </p>
     </th><th>
      <p>
       Description
      </p>
     </th><th>
      <p>
       Order If Increasing Size
      </p>
     </th><th>
      <p>
       Order If Decreasing Size
      </p>
     </th></tr></thead><tbody><tr><td>
      <p>
       Resize each of the component partitions.
      </p>
      
     </td><td>
      <p>
       Increase or decrease the active size of each component partition. You
       remove only one component partition at a time, modify its size, then
       return it to the RAID.
      </p>
     </td><td>
      <p>
       1
      </p>
     </td><td>
      <p>
       2
      </p>
     </td></tr><tr><td>
      <p>
       Resize the software RAID itself.
      </p>
     </td><td>
      <p>
       The RAID does not automatically know about the increases or decreases
       you make to the underlying component partitions. You must inform it
       about the new size.
      </p>
     </td><td>
      <p>
       2
      </p>
     </td><td>
      <p>
       3
      </p>
     </td></tr><tr><td>
      <p>
       Resize the file system.
      </p>
     </td><td>
      <p>
       You must resize the file system that resides on the RAID. This is
       possible only for file systems that provide tools for resizing.
      </p>
     </td><td>
      <p>
       3
      </p>
     </td><td>
      <p>
       1
      </p>
     </td></tr></tbody></table></div></div><p>
  The procedures in the following sections use the device names shown in the
  following table. Ensure that you modify the names to use the names of your
  own devices.
 </p><div class="table" id="idm139787668792528"><div class="table-title-wrap"><h6 class="table-title"><span class="number">Table 11.2: </span><span class="name">Scenario for Increasing the Size of Component Partitions </span><a title="Permalink" class="permalink" href="#idm139787668792528">#</a></h6></div><div class="table-contents"><table summary="Scenario for Increasing the Size of Component Partitions" border="1"><colgroup><col class="1" /><col class="2" /></colgroup><thead><tr><th>
      <p>
       RAID Device
      </p>
     </th><th>
      <p>
       Component Partitions
      </p>
     </th></tr></thead><tbody><tr><td>
      <p>
       <code class="filename">/dev/md0</code>
      </p>
     </td><td>
      <p>
       <code class="filename">/dev/sda1</code>
      </p>
      <p>
       <code class="filename">/dev/sdb1</code>
      </p>
      <p>
       <code class="filename">/dev/sdc1</code>
      </p>
     </td></tr></tbody></table></div></div><div class="sect1 " id="sec.raid_resize.incr"><div class="titlepage"><div><div><h2 class="title" id="sec.raid_resize.incr"><span class="number">11.1 </span><span class="name">Increasing the Size of a Software RAID</span> <a title="Permalink" class="permalink" href="#sec.raid_resize.incr">#</a></h2></div></div></div><p>
   Increasing the size of a software RAID involves the following tasks in the
   given order: increase the size of all partitions the RAID consists of,
   increase the size of the RAID itself and, finally, increase the size of the
   file system.
  </p><div id="idm139787668778688" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.png" /><h6>Warning: Potential Data Loss</h6><p>
    If a RAID does not have disk fault tolerance, or it is simply not
    consistent, data loss results if you remove any of its partitions. Be very
    careful when removing partitions, and ensure that you have a backup of your
    data available.
   </p></div><div class="sect2 " id="sec.raid_resize.incr.partitions"><div class="titlepage"><div><div><h3 class="title" id="sec.raid_resize.incr.partitions"><span class="number">11.1.1 </span><span class="name">Increasing the Size of Component Partitions</span> <a title="Permalink" class="permalink" href="#sec.raid_resize.incr.partitions">#</a></h3></div></div></div><p>
    Apply the procedure in this section to increase the size of a RAID 1, 4, 5,
    or 6. For each component partition in the RAID, remove the partition from
    the RAID, modify its size, return it to the RAID, then wait until the RAID
    stabilizes to continue. While a partition is removed, the RAID operates in
    degraded mode and has no or reduced disk fault tolerance. Even for RAIDs
    that can tolerate multiple concurrent disk failures, do not remove more
    than one component partition at a time. To increase the size of the
    component partitions for the RAID, proceed as follows:
   </p><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
      Open a terminal console.
     </p></li><li class="step "><p>
      Ensure that the RAID array is consistent and synchronized by entering
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code>cat /proc/mdstat</pre></div><p>
      If your RAID array is still synchronizing according to the output of this
      command, you must wait until synchronization is complete before
      continuing.
     </p></li><li class="step "><p>
      Remove one of the component partitions from the RAID array. For example,
      to remove <code class="filename">/dev/sda1</code>, enter
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> mdadm /dev/md0 --fail /dev/sda1 --remove /dev/sda1</pre></div><p>
      To succeed, both the fail and remove actions must be specified.
     </p></li><li class="step "><p>
      Increase the size of the partition that you removed in the previous step
      by doing one of the following:
     </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
        Increase the size of the partition, using a disk partitioner such as
        the YaST Partitioner or the command line tool parted. This option is
        the usual choice.
       </p></li><li class="listitem "><p>
        Replace the disk on which the partition resides with a higher-capacity
        device. This option is possible only if no other file systems on the
        original disk are accessed by the system. When the replacement device
        is added back into the RAID, it takes much longer to synchronize the
        data because all of the data that was on the original device must be
        rebuilt.
       </p></li></ul></div></li><li class="step "><p>
      Re-add the partition to the RAID array. For example, to add
      <code class="filename">/dev/sda1</code>, enter
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> mdadm -a /dev/md0 /dev/sda1</pre></div><p>
      Wait until the RAID is synchronized and consistent before continuing with
      the next partition.
     </p></li><li class="step "><p>
      Repeat these steps for each of the remaining component devices in the
      array. Ensure that you modify the commands for the correct component
      partition.
     </p></li><li class="step "><p>
      If you get a message that tells you that the kernel could not re-read the
      partition table for the RAID, you must reboot the computer after all
      partitions have been resized to force an update of the partition table.
     </p></li><li class="step "><p>
      Continue with
      <a class="xref" href="#sec.raid_resize.incr.raid" title="11.1.2. Increasing the Size of the RAID Array">Section 11.1.2, “Increasing the Size of the RAID Array”</a>.
     </p></li></ol></div></div></div><div class="sect2 " id="sec.raid_resize.incr.raid"><div class="titlepage"><div><div><h3 class="title" id="sec.raid_resize.incr.raid"><span class="number">11.1.2 </span><span class="name">Increasing the Size of the RAID Array</span> <a title="Permalink" class="permalink" href="#sec.raid_resize.incr.raid">#</a></h3></div></div></div><p>
    After you have resized each of the component partitions in the RAID (see
    <a class="xref" href="#sec.raid_resize.incr.partitions" title="11.1.1. Increasing the Size of Component Partitions">Section 11.1.1, “Increasing the Size of Component Partitions”</a>),
    the RAID array configuration continues to use the original array size until
    you force it to be aware of the newly available space. You can specify a
    size for the RAID or use the maximum available space.
   </p><p>
    The procedure in this section uses the device name
    <code class="filename">/dev/md0</code> for the RAID device. Ensure that you modify
    the name to use the name of your own device.
   </p><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
      Open a terminal console.
     </p></li><li class="step "><p>
      Ensure that the RAID array is consistent and synchronized by entering
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code>cat /proc/mdstat</pre></div><p>
      If your RAID array is still synchronizing according to the output of this
      command, you must wait until synchronization is complete before
      continuing.
     </p></li><li class="step "><p>
      Check the size of the array and the device size known to the array by
      entering
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> mdadm -D /dev/md0 | grep -e "Array Size" -e "Dev Size"</pre></div></li><li class="step "><p>
      Do one of the following:
     </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
        Increase the size of the array to the maximum available size by
        entering
       </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> mdadm --grow /dev/md0 -z max</pre></div></li><li class="listitem "><p>
        Increase the size of the array to the maximum available size by
        entering
       </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> mdadm --grow /dev/md0 -z max --assume-clean</pre></div><p>
        The array uses any space that has been added to the devices, but this
        space will not be synchronized. This is recommended for RAID 1
        because the synchronization is not needed. It can be useful for other
        RAID levels if the space that was added to the member devices was
        pre-zeroed.
       </p></li><li class="listitem "><p>
        Increase the size of the array to a specified value by entering
       </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> mdadm --grow /dev/md0 -z <em class="replaceable ">SIZE</em></pre></div><p>
        Replace <em class="replaceable ">SIZE</em> with an integer value in
        kilobytes (a kilobyte is 1024 bytes) for the desired size.
       </p></li></ul></div></li><li class="step "><p>
      Recheck the size of your array and the device size known to the array by
      entering
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> mdadm -D /dev/md0 | grep -e "Array Size" -e "Dev Size"</pre></div></li><li class="step "><p>
      Do one of the following:
     </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
        If your array was successfully resized, continue with
        <a class="xref" href="#sec.raid_resize.incr.fs" title="11.1.3. Increasing the Size of the File System">Section 11.1.3, “Increasing the Size of the File System”</a>.
       </p></li><li class="listitem "><p>
        If your array was not resized as you expected, you must reboot, then
        try this procedure again.
       </p></li></ul></div></li></ol></div></div></div><div class="sect2 " id="sec.raid_resize.incr.fs"><div class="titlepage"><div><div><h3 class="title" id="sec.raid_resize.incr.fs"><span class="number">11.1.3 </span><span class="name">Increasing the Size of the File System</span> <a title="Permalink" class="permalink" href="#sec.raid_resize.incr.fs">#</a></h3></div></div></div><p>
    After you increase the size of the array (see
    <a class="xref" href="#sec.raid_resize.incr.raid" title="11.1.2. Increasing the Size of the RAID Array">Section 11.1.2, “Increasing the Size of the RAID Array”</a>),
    you are ready to resize the file system.
   </p><p>
    You can increase the size of the file system to the maximum space available
    or specify an exact size. When specifying an exact size for the file
    system, ensure that the new size satisfies the following conditions:
   </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
      The new size must be greater than the size of the existing data;
      otherwise, data loss occurs.
     </p></li><li class="listitem "><p>
      The new size must be equal to or less than the current RAID size because
      the file system size cannot extend beyond the space available.
     </p></li></ul></div><p>
    Refer to <a class="xref" href="#cha.resize_fs" title="Chapter 2. Resizing File Systems">Chapter 2, <em>Resizing File Systems</em></a> for detailed instructions.
   </p></div></div><div class="sect1 " id="sec.raid_resize.decr"><div class="titlepage"><div><div><h2 class="title" id="sec.raid_resize.decr"><span class="number">11.2 </span><span class="name">Decreasing the Size of a Software RAID</span> <a title="Permalink" class="permalink" href="#sec.raid_resize.decr">#</a></h2></div></div></div><p>
   Decreasing the Size of a Software RAID involves the following tasks in the
   given order: decrease the size of the file system, decrease the size of all
   partitions the RAID consists of, and finally decrease the size of the RAID
   itself.
  </p><div id="idm139787668720928" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.png" /><h6>Warning: Potential Data Loss</h6><p>
    If a RAID does not have disk fault tolerance, or it is simply not
    consistent, data loss results if you remove any of its partitions. Be very
    careful when removing partitions, and ensure that you have a backup of your
    data available.
   </p></div><div id="idm139787668719344" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.png" /><h6>Important: XFS</h6><p>
    Decreasing the size of a file system formatted with XFS is not possible,
    since such a feature is not supported by XFS. As a consequence, the size of
    a RAID that uses the XFS file system cannot be decreased.
   </p></div><div class="sect2 " id="sec.raid_resize.decr.fs"><div class="titlepage"><div><div><h3 class="title" id="sec.raid_resize.decr.fs"><span class="number">11.2.1 </span><span class="name">Decreasing the Size of the File System</span> <a title="Permalink" class="permalink" href="#sec.raid_resize.decr.fs">#</a></h3></div></div></div><p>
    When decreasing the size of the file system on a RAID device, ensure that
    the new size satisfies the following conditions:
   </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
      The new size must be greater than the size of the existing data;
      otherwise, data loss occurs.
     </p></li><li class="listitem "><p>
      The new size must be equal to or less than the current RAID size because
      the file system size cannot extend beyond the space available.
     </p></li></ul></div><p>
    Refer to <a class="xref" href="#cha.resize_fs" title="Chapter 2. Resizing File Systems">Chapter 2, <em>Resizing File Systems</em></a> for detailed instructions.
   </p></div><div class="sect2 " id="sec.raid_resize.decr.raid"><div class="titlepage"><div><div><h3 class="title" id="sec.raid_resize.decr.raid"><span class="number">11.2.2 </span><span class="name">Decreasing the Size of the RAID Array</span> <a title="Permalink" class="permalink" href="#sec.raid_resize.decr.raid">#</a></h3></div></div></div><p>
    After you have resized the file system (see
    <a class="xref" href="#sec.raid_resize.decr.fs" title="11.2.1. Decreasing the Size of the File System">Section 11.2.1, “Decreasing the Size of the File System”</a>), the
    RAID array configuration continues to use the original array size until you
    force it to reduce the available space. Use the <code class="command">mdadm
    --grow</code> mode to force the RAID to use a smaller segment size. To
    do this, you must use the -z option to specify the amount of space in
    kilobytes to use from each device in the RAID. This size must be a multiple
    of the chunk size, and it must leave about 128 KB of space for the RAID
    superblock to be written to the device.
   </p><p>
    The procedure in this section uses the device name
    <code class="filename">/dev/md0</code> for the RAID device. Ensure that you modify
    commands to use the name of your own device.
   </p><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
      Open a terminal console.
     </p></li><li class="step "><p>
      Check the size of the array and the device size known to the array by
      entering
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> mdadm -D /dev/md0 | grep -e "Array Size" -e "Dev Size"</pre></div></li><li class="step "><p>
      Decrease the array’s device size to a specified value by entering
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> mdadm --grow /dev/md0 -z <em class="replaceable ">SIZE</em></pre></div><p>
      Replace <em class="replaceable ">SIZE</em> with an integer value in
      kilobytes for the desired size. (A kilobyte is 1024 bytes.)
     </p><p>
      For example, the following command sets the segment size for each RAID
      device to about 40 GB where the chunk size is 64 KB. It includes 128 KB
      for the RAID superblock.
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> mdadm --grow /dev/md2 -z 41943168</pre></div></li><li class="step "><p>
      Recheck the size of your array and the device size known to the array by
      entering
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> mdadm -D /dev/md0 | grep -e "Array Size" -e "Device Size"</pre></div></li><li class="step "><p>
      Do one of the following:
     </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
        If your array was successfully resized, continue with
        <a class="xref" href="#sec.raid_resize.decr.partitions" title="11.2.3. Decreasing the Size of Component Partitions">Section 11.2.3, “Decreasing the Size of Component Partitions”</a>.
       </p></li><li class="listitem "><p>
        If your array was not resized as you expected, you must reboot, then
        try this procedure again.
       </p></li></ul></div></li></ol></div></div></div><div class="sect2 " id="sec.raid_resize.decr.partitions"><div class="titlepage"><div><div><h3 class="title" id="sec.raid_resize.decr.partitions"><span class="number">11.2.3 </span><span class="name">Decreasing the Size of Component Partitions</span> <a title="Permalink" class="permalink" href="#sec.raid_resize.decr.partitions">#</a></h3></div></div></div><p>
    After you decrease the segment size that is used on each device in the RAID
    (see
    <a class="xref" href="#sec.raid_resize.decr.raid" title="11.2.2. Decreasing the Size of the RAID Array">Section 11.2.2, “Decreasing the Size of the RAID Array”</a>),
    the remaining space in each component partition is not used by the RAID.
    You can leave partitions at their current size to allow for the RAID to
    grow at a future time, or you can reclaim this now unused space.
   </p><p>
    To reclaim the space, you decrease the component partitions one at a time.
    For each component partition, you remove it from the RAID, reduce its
    partition size, return the partition to the RAID, then wait until the RAID
    stabilizes. To allow for metadata, you should specify a slightly larger
    size than the size you specified for the RAID in
    <a class="xref" href="#sec.raid_resize.decr.raid" title="11.2.2. Decreasing the Size of the RAID Array">Section 11.2.2, “Decreasing the Size of the RAID Array”</a>.
   </p><p>
    While a partition is removed, the RAID operates in degraded mode and has no
    or reduced disk fault tolerance. Even for RAIDs that can tolerate multiple
    concurrent disk failures, you should never remove more than one component
    partition at a time. To decrease the size of the component partitions for
    the RAID, proceed as follows:
   </p><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
      Open a terminal console.
     </p></li><li class="step "><p>
      Ensure that the RAID array is consistent and synchronized by entering
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code>cat /proc/mdstat</pre></div><p>
      If your RAID array is still synchronizing according to the output of this
      command, you must wait until synchronization is complete before
      continuing.
     </p></li><li class="step "><p>
      Remove one of the component partitions from the RAID array. For example,
      to remove <code class="filename">/dev/sda1</code>, enter
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> mdadm /dev/md0 --fail /dev/sda1 --remove /dev/sda1</pre></div><p>
      To succeed, both the fail and remove actions must be specified.
     </p></li><li class="step "><p>
      Decrease the size of the partition that you removed in the previous step
      to a size that is slightly larger than the size you set for the segment
      size. The size should be a multiple of the chunk size and allow 128 KB
      for the RAID superblock. Use a disk partitioner such as the YaST
      partitioner or the command line tool parted to decrease the size of the
      partition.
     </p></li><li class="step "><p>
      Re-add the partition to the RAID array. For example, to add
      <code class="filename">/dev/sda1</code>, enter
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> mdadm -a /dev/md0 /dev/sda1</pre></div><p>
      Wait until the RAID is synchronized and consistent before continuing with
      the next partition.
     </p></li><li class="step "><p>
      Repeat these steps for each of the remaining component devices in the
      array. Ensure that you modify the commands for the correct component
      partition.
     </p></li><li class="step "><p>
      If you get a message that tells you that the kernel could not re-read the
      partition table for the RAID, you must reboot the computer after resizing
      all of its component partitions.
     </p></li><li class="step "><p>
      (Optional) Expand the size of the RAID and file system to use the maximum
      amount of space in the now smaller component partitions and increase the
      size of the file system afterward. Refer to
      <a class="xref" href="#sec.raid_resize.incr.raid" title="11.1.2. Increasing the Size of the RAID Array">Section 11.1.2, “Increasing the Size of the RAID Array”</a> for instructions.
     </p></li></ol></div></div></div></div></div><div xml:lang="en" class="chapter " id="cha.raid_leds" lang="en"><div class="titlepage"><div><div><h2 class="title"><span class="number">12 </span><span class="name">Storage Enclosure LED Utilities for MD Software RAIDs</span> <a title="Permalink" class="permalink" href="#cha.raid_leds">#</a></h2><div class="doc-status"><ul><li><span class="ds-label">Filename: </span>storage_raid-leds.xml</li><li><span class="ds-label">ID: </span>cha.raid_leds</li></ul></div></div><div><div class="abstract"><div class="abstract-title-wrap"><h6 class="abstract-title">Abstract<a title="Permalink" class="permalink" href="#idm139787668668912">#</a></h6></div><p>
    
    Storage enclosure LED Monitoring utility (<code class="command">ledmon</code>) and
    LED Control (<code class="command">ledctl</code>) utility are Linux user space
    applications that use a broad range of interfaces and protocols to control
    storage enclosure LEDs. The primary usage is to visualize the status of
    Linux MD software RAID devices created with the mdadm utility. The
    <code class="systemitem">ledmon</code> daemon monitors the status
    of the drive array and updates the status of the drive LEDs. The
    <code class="command">ledctl</code> utility allows you to set LED patterns for
    specified devices.
   </p></div></div></div></div><div class="line"><div class="toc"><dl><dt><span class="sect1"><a href="#sec.raid_leds.ledmon"><span class="number">12.1 </span><span class="name">The Storage Enclosure LED Monitor Service</span></a></span></dt><dt><span class="sect1"><a href="#sec.raid_leds.ledctl"><span class="number">12.2 </span><span class="name">The Storage Enclosure LED Control Application</span></a></span></dt><dt><span class="sect1"><a href="#sec.raid_leds.info"><span class="number">12.3 </span><span class="name">Additional Information</span></a></span></dt></dl></div></div><p>
  These LED utilities use the SGPIO (Serial General Purpose Input/Output)
  specification (Small Form Factor (SFF) 8485) and the SCSI Enclosure Services
  (SES) 2 protocol to control LEDs. They implement the International Blinking
  Pattern Interpretation (IBPI) patterns of the SFF-8489 specification for
  SGPIO. The IBPI defines how the SGPIO standards are interpreted as states for
  drives and slots on a backplane and how the backplane should visualize the
  states with LEDs.
 </p><p>
  Some storage enclosures do not adhere strictly to the SFF-8489 specification.
  An enclosure processor might accept an IBPI pattern but not blink the LEDs
  according to the SFF-8489 specification, or the processor might support only
  a limited number of the IBPI patterns.
 </p><p>
  LED management (AHCI) and SAF-TE protocols are not supported by the
  <code class="command">ledmon</code> and <code class="command">ledctl</code> utilities.
 </p><p>
  The <code class="systemitem">ledmon</code> and
  <code class="command">ledctl</code> applications have been verified to work with Intel
  storage controllers such as the Intel AHCI controller and Intel SAS
  controller. They also support PCIe-SSD (solid-state drive) enclosure LEDs to
  control the storage enclosure status (OK, Fail, Rebuilding) LEDs of PCIe-SSD
  devices that are part of an MD software RAID volume. The applications might
  also work with the IBPI-compliant storage controllers of other vendors
  (especially SAS/SCSI controllers); however, other vendors’ controllers have
  not been tested.
 </p><p>
  <code class="systemitem">ledmon</code> and <code class="command">ledctl</code>
  are part of the <code class="systemitem">ledmon</code> package,
  which is not installed by default. Run <code class="command">sudo zypper in
  ledmon</code> to install it.
 </p><div class="sect1 " id="sec.raid_leds.ledmon"><div class="titlepage"><div><div><h2 class="title" id="sec.raid_leds.ledmon"><span class="number">12.1 </span><span class="name">The Storage Enclosure LED Monitor Service</span> <a title="Permalink" class="permalink" href="#sec.raid_leds.ledmon">#</a></h2></div></div></div><p>
   The <code class="systemitem">ledmon</code> application is a daemon
   process that constantly monitors the state of MD software RAID devices or
   the state of block devices in a storage enclosure or drive bay. Only a
   single instance of the daemon should be running at a time. The
   <code class="systemitem">ledmon</code> daemon is part of Intel
   Enclosure LED Utilities.
  </p><p>
   The state is visualized on LEDs associated with each slot in a storage array
   enclosure or a drive bay. The application monitors all software RAID devices
   and visualizes their state. It does not provide a way to monitor only
   selected software RAID volumes.
  </p><p>
   The <code class="systemitem">ledmon</code> daemon supports two types
   of LED systems: A two-LED system (Activity LED and Status LED) and a
   three-LED system (Activity LED, Locate LED, and Fail LED). This tool has the
   highest priority when accessing the LEDs.
  </p><p>
   To start <code class="systemitem">ledmon</code>, enter
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> ledmon [options]</pre></div><p>
   where [options] is one or more of the following:
  </p><div class="variablelist "><div class="variablelist-title-wrap"><h6 class="variablelist-title"><span class="name">Options for <code class="systemitem">ledmon</code> </span><a title="Permalink" class="permalink" href="#idm139787668647520">#</a></h6></div><dl class="variablelist"><dt id="idm139787668646224"><span class="term "><code class="option">-c <em class="replaceable ">PATH</em></code>
    , </span><span class="term "><code class="option">--confg=<em class="replaceable ">PATH</em></code>
    </span></dt><dd><p>
      The configuration is read from <code class="filename">~/.ledctl</code> or from
      <code class="filename">/etc/ledcfg.conf</code> if existing. Use this option to
      specify an alternative configuration file.
     </p><p>
      Currently this option has no effect, since support for configuration
      files has not been implemented yet. See <code class="command">man 5
      ledctl.conf</code> for details.
     </p></dd><dt id="idm139787668640848"><span class="term ">-l <em class="replaceable ">PATH</em>
    , </span><span class="term ">--log=<em class="replaceable ">PATH</em>
    </span></dt><dd><p>
      Sets a path to local log file. If this user-defined file is specified,
      the global log file <code class="filename">/var/log/ledmon.log</code> is not used.
     </p></dd><dt id="idm139787668637168"><span class="term "><code class="option">-t <em class="replaceable ">SECONDS</em></code>
    , </span><span class="term "><code class="option">--interval=<em class="replaceable ">SECONDS</em></code>
    </span></dt><dd><p>
      Sets the time interval between scans of <code class="filename">sysfs</code>. The
      value is given in seconds. The minimum is 5 seconds. The maximum is not
      specified.
     </p></dd><dt id="idm139787668633200"><span class="term "><code class="option">--quiet</code>, <code class="option">--error</code>,
    <code class="option">--warning</code>, <code class="option">--info</code>,
    <code class="option">--debug</code>, <code class="option">--all</code>
    </span></dt><dd><p>
      Specifies the verbosity level. The level options are specified in the
      order of no information to the most information. Use the
      <code class="option">--quiet</code> option for no logging. Use the
      <code class="option">--all</code> option to log everything. If you specify more than
      one verbose option, the last option in the command applies.
     </p></dd><dt id="idm139787668627728"><span class="term "><code class="option">-h</code>
    , </span><span class="term "><code class="option">--help</code>
    </span></dt><dd><p>
      Prints the command information to the console, then exits.
     </p></dd><dt id="idm139787668624864"><span class="term "><code class="option">-v</code>
    , </span><span class="term "><code class="option">--version</code>
    </span></dt><dd><p>
      Displays version of <code class="command">ledmon</code> and information about the
      license, then exits.
     </p></dd></dl></div><div id="idm139787668621376" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.png" /><h6>Note: Known Issues</h6><p>
    The <code class="command">ledmon</code> daemon does not recognize the PFA (Predicted
    Failure Analysis) state from the SFF-8489 specification. Thus, the PFA
    pattern is not visualized.
   </p></div></div><div class="sect1 " id="sec.raid_leds.ledctl"><div class="titlepage"><div><div><h2 class="title" id="sec.raid_leds.ledctl"><span class="number">12.2 </span><span class="name">The Storage Enclosure LED Control Application</span> <a title="Permalink" class="permalink" href="#sec.raid_leds.ledctl">#</a></h2></div></div></div><p>
   The Enclosure LED Application (<code class="command">ledctl</code>) is a user space
   application that controls LEDs associated with each slot in a storage
   enclosure or a drive bay. The <code class="command">ledctl</code> application is a
   part of Intel Enclosure LED Utilities.
  </p><p>
   When you issue the command, the LEDs of the specified devices are set to a
   specified pattern and all other LEDs are turned off. This application needs
   to be run with <code class="systemitem">root</code> privileges. Because the
   <code class="systemitem">ledmon</code> application has the
   highest priority when accessing LEDs, some patterns set by
   <code class="command">ledctl</code> might have no effect if the
   <code class="systemitem">ledmon</code> daemon is running (except for
   the Locate pattern).
  </p><p>
   The <code class="command">ledctl</code> application supports two types of LED systems:
   A two-LED system (Activity LED and Status LED) and a three-LED system
   (Activity LED, Fail LED, and Locate LED).
  </p><p>
   To start <code class="command">ledctl</code>, enter
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> [options] <em class="replaceable ">PATTERN_NAME</em>=list_of_devices</pre></div><p>
   where [options] is one or more of the following:
  </p><div class="variablelist "><dl class="variablelist"><dt id="idm139787668609008"><span class="term "><code class="option">-c <em class="replaceable ">PATH</em></code>
    , </span><span class="term "><code class="option">--confg=<em class="replaceable ">PATH</em></code>
    </span></dt><dd><p>
      Sets a path to local configuration file. If this option is specified, the
      global configuration file and user configuration file have no effect.
     </p></dd><dt id="idm139787668605472"><span class="term ">-l <em class="replaceable ">PATH</em>
    , </span><span class="term ">--log=<em class="replaceable ">PATH</em>
    </span></dt><dd><p>
      Sets a path to local log file. If this user-defined file is specified,
      the global log file <code class="filename">/var/log/ledmon.log</code> is not used.
     </p></dd><dt id="idm139787668601792"><span class="term "><code class="option">--quiet</code>
    </span></dt><dd><p>
      Turns off all messages sent to <code class="filename">stdout</code> or
      <code class="filename">stderr</code> out. The messages are still logged to local
      file and the <code class="filename">syslog</code> facility.
     </p></dd><dt id="idm139787668598304"><span class="term "><code class="option">-h</code>
    , </span><span class="term "><code class="option">--help</code>
    </span></dt><dd><p>
      Prints the command information to the console, then exits.
     </p></dd><dt id="idm139787668595440"><span class="term "><code class="option">-v</code>
    , </span><span class="term "><code class="option">--version</code>
    </span></dt><dd><p>
      Displays version of <code class="command">ledctl</code> and information about the
      license, then exits.
     </p></dd></dl></div><div class="sect2 " id="sec.raid_leds.ledctl.patterns"><div class="titlepage"><div><div><h3 class="title" id="sec.raid_leds.ledctl.patterns"><span class="number">12.2.1 </span><span class="name">Pattern Names</span> <a title="Permalink" class="permalink" href="#sec.raid_leds.ledctl.patterns">#</a></h3></div></div></div><p>
    The <code class="command">ledctl</code> application accepts the following names for
    <span class="guimenu">pattern_name</span> argument, according to the SFF-8489
    specification.
   </p><div class="variablelist "><dl class="variablelist"><dt id="idm139787668588992"><span class="term "><code class="literal">locate</code>
     </span></dt><dd><p>
       Turns on the Locate LED associated with the specified devices or empty
       slots. This state is used to identify a slot or drive.
      </p></dd><dt id="idm139787668586784"><span class="term "><code class="literal">locate_off</code>
     </span></dt><dd><p>
       Turns off the Locate LED associated with the specified devices or empty
       slots.
      </p></dd><dt id="idm139787668584624"><span class="term "><code class="literal">normal</code>
     </span></dt><dd><p>
       Turns off the Status LED, Failure LED, and Locate LED associated with
       the specified devices.
      </p></dd><dt id="idm139787668582448"><span class="term "><code class="literal">off</code>
     </span></dt><dd><p>
       Turns off only the Status LED and Failure LED associated with the
       specified devices.
      </p></dd><dt id="idm139787668580272"><span class="term "><code class="literal">ica</code>
     , </span><span class="term "><code class="literal">degraded</code>
     </span></dt><dd><p>
       Visualizes the <code class="literal">In a Critical Array</code> pattern.
      </p></dd><dt id="idm139787668577008"><span class="term "><code class="literal">rebuild</code>
     , </span><span class="term "><code class="literal">rebuild_p</code>
     </span></dt><dd><p>
       Visualizes the <code class="literal">Rebuild</code> pattern. This supports both of
       the rebuild states for compatibility and legacy reasons.
      </p></dd><dt id="idm139787668573664"><span class="term "><code class="literal">ifa</code>
     , </span><span class="term "><code class="literal">failed_array</code>
     </span></dt><dd><p>
       Visualizes the <code class="literal">In a Failed Array</code> pattern.
      </p></dd><dt id="idm139787668570400"><span class="term "><code class="literal">hotspare</code>
     </span></dt><dd><p>
       Visualizes the <code class="literal">Hotspare</code> pattern.
      </p></dd><dt id="idm139787668567872"><span class="term "><code class="literal">pfa</code>
     </span></dt><dd><p>
       Visualizes the <code class="literal">Predicted Failure Analysis</code> pattern.
      </p></dd><dt id="idm139787668565376"><span class="term "><code class="literal">failure</code>
     , </span><span class="term "><code class="literal">disk_failed</code>
     </span></dt><dd><p>
       Visualizes the <code class="literal">Failure</code> pattern.
      </p></dd><dt id="idm139787668562112"><span class="term ">ses_abort</span></dt><dd><p>
       SES-2 R/R ABORT
      </p></dd><dt id="idm139787668560304"><span class="term "><code class="literal">ses_rebuild</code>
     </span></dt><dd><p>
       SES-2 REBUILD/REMAP
      </p></dd><dt id="idm139787668558208"><span class="term "><code class="literal">ses_ifa</code>
     </span></dt><dd><p>
       SES-2 IN FAILED ARRAY
      </p></dd><dt id="idm139787668556112"><span class="term "><code class="literal">ses_ica</code>
     </span></dt><dd><p>
       SES-2 IN CRITICAL ARRAY
      </p></dd><dt id="idm139787668554016"><span class="term "><code class="literal">ses_cons_check</code>
     </span></dt><dd><p>
       SES-2 CONS CHECK
      </p></dd><dt id="idm139787668551920"><span class="term "><code class="literal">ses_hotspare</code>
     </span></dt><dd><p>
       SES-2 HOTSPARE
      </p></dd><dt id="idm139787668549824"><span class="term "><code class="literal">ses_rsvd_dev</code>
     </span></dt><dd><p>
       SES-2 RSVD DEVICE
      </p></dd><dt id="idm139787668547728"><span class="term "><code class="literal">ses_ok</code>
     </span></dt><dd><p>
       SES-2 OK
      </p></dd><dt id="idm139787668545648"><span class="term "><code class="literal">ses_ident</code>
     </span></dt><dd><p>
       SES-2 IDENT
      </p></dd><dt id="idm139787668543552"><span class="term "><code class="literal">ses_rm</code>
     </span></dt><dd><p>
       SES-2 REMOVE
      </p></dd><dt id="idm139787668541456"><span class="term "><code class="literal">ses_insert</code>
     </span></dt><dd><p>
       SES-2 INSERT
      </p></dd><dt id="idm139787668539360"><span class="term "><code class="literal">ses_missing</code>
     </span></dt><dd><p>
       SES-2 MISSING
      </p></dd><dt id="idm139787668537264"><span class="term "><code class="literal">ses_dnr</code>
     </span></dt><dd><p>
       SES-2 DO NOT REMOVE
      </p></dd><dt id="idm139787668535168"><span class="term "><code class="literal">ses_active</code>
     </span></dt><dd><p>
       SES-2 ACTIVE
      </p></dd><dt id="idm139787668533072"><span class="term "><code class="literal">ses_enable_bb</code>
     </span></dt><dd><p>
       SES-2 ENABLE BYP B
      </p></dd><dt id="idm139787668530976"><span class="term "><code class="literal">ses_enable_ba</code>
     </span></dt><dd><p>
       SES-2 ENABLE BYP A
      </p></dd><dt id="idm139787668528880"><span class="term "><code class="literal">ses_devoff</code>
     </span></dt><dd><p>
       SES-2 DEVICE OFF
      </p></dd><dt id="idm139787668526784"><span class="term "><code class="literal">ses_fault</code>
     </span></dt><dd><p>
       SES-2 FAULT
      </p></dd></dl></div><p>
    When a non-SES-2 pattern is sent to a device in an enclosure, the pattern
    is automatically translated to the SCSI Enclosure Services (SES) 2 pattern
    as shown above.
   </p><div class="table" id="idm139787668523920"><div class="table-title-wrap"><h6 class="table-title"><span class="number">Table 12.1: </span><span class="name">Translation between Non-SES-2 Patterns and SES-2 Patterns </span><a title="Permalink" class="permalink" href="#idm139787668523920">#</a></h6></div><div class="table-contents"><table summary="Translation between Non-SES-2 Patterns and SES-2 Patterns" border="1"><colgroup><col class="1" /><col class="2" /></colgroup><thead><tr><th>
        <p>
         Non-SES-2 Pattern
        </p>
       </th><th>
        <p>
         SES-2 Pattern
        </p>
       </th></tr></thead><tbody><tr><td>
        <p>
         locate
        </p>
       </td><td>
        <p>
         ses_ident
        </p>
       </td></tr><tr><td>
        <p>
         locate_off
        </p>
       </td><td>
        <p>
         ses_ident
        </p>
       </td></tr><tr><td>
        <p>
         normal
        </p>
       </td><td>
        <p>
         ses_ok
        </p>
       </td></tr><tr><td>
        <p>
         off
        </p>
       </td><td>
        <p>
         ses_ok
        </p>
       </td></tr><tr><td>
        <p>
         ica
        </p>
       </td><td>
        <p>
         ses_ica
        </p>
       </td></tr><tr><td>
        <p>
         degraded
        </p>
       </td><td>
        <p>
         ses_ica
        </p>
       </td></tr><tr><td>
        <p>
         rebuild
        </p>
       </td><td>
        <p>
         ses_rebuild
        </p>
       </td></tr><tr><td>
        <p>
         rebuild_p
        </p>
       </td><td>
        <p>
         ses_rebuild
        </p>
       </td></tr><tr><td>
        <p>
         ifa
        </p>
       </td><td>
        <p>
         ses_ifa
        </p>
       </td></tr><tr><td>
        <p>
         failed_array
        </p>
       </td><td>
        <p>
         ses_ifa
        </p>
       </td></tr><tr><td>
        <p>
         hotspare
        </p>
       </td><td>
        <p>
         ses_hotspare
        </p>
       </td></tr><tr><td>
        <p>
         pfa
        </p>
       </td><td>
        <p>
         ses_rsvd_dev
        </p>
       </td></tr><tr><td>
        <p>
         failure
        </p>
       </td><td>
        <p>
         ses_fault
        </p>
       </td></tr><tr><td>
        <p>
         disk_failed
        </p>
       </td><td>
        <p>
         ses_fault
        </p>
       </td></tr></tbody></table></div></div></div><div class="sect2 " id="sec.raid_leds.ledctl.devices"><div class="titlepage"><div><div><h3 class="title" id="sec.raid_leds.ledctl.devices"><span class="number">12.2.2 </span><span class="name">List of Devices</span> <a title="Permalink" class="permalink" href="#sec.raid_leds.ledctl.devices">#</a></h3></div></div></div><p>
    When you issue the <code class="command">ledctl</code> command, the LEDs of the
    specified devices are set to the specified pattern and all other LEDs are
    turned off. The list of devices can be provided in one of two formats:
   </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
      A list of devices separated by a comma and no spaces
     </p></li><li class="listitem "><p>
      A list in curly braces with devices separated by a space
     </p></li></ul></div><p>
    If you specify multiple patterns in the same command, the device list for
    each pattern can use the same or different format. For examples that show
    the two list formats, see
    <a class="xref" href="#sec.raid_leds.ledctl.examples" title="12.2.3. Examples">Section 12.2.3, “Examples”</a>.
   </p><p>
    A device is a path to file in the <code class="filename">/dev</code> directory or in
    the <code class="filename">/sys/block</code> directory. The path can identify a
    block device, an MD software RAID device, or a container device. For a
    software RAID device or a container device, the reported LED state is set
    for all of the associated block devices.
   </p><p>
    The LEDs of devices listed in list_of_devices are set to the given pattern
    pattern_name and all other LEDs are turned off.
   </p></div><div class="sect2 " id="sec.raid_leds.ledctl.examples"><div class="titlepage"><div><div><h3 class="title" id="sec.raid_leds.ledctl.examples"><span class="number">12.2.3 </span><span class="name">Examples</span> <a title="Permalink" class="permalink" href="#sec.raid_leds.ledctl.examples">#</a></h3></div></div></div><p>
    To locate a single block device:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> ledctl locate=/dev/sda</pre></div><p>
    To turn off the Locate LED for a single block device:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> ledctl locate_off=/dev/sda</pre></div><p>
    To locate disks of an MD software RAID device and to set a rebuild pattern
    for two of its block devices at the same time:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> ledctl locate=/dev/md127 rebuild={ /sys/block/sd[a-b] }</pre></div><p>
    To turn off the Status LED and Failure LED for the specified devices:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> ledctl off={ /dev/sda /dev/sdb }</pre></div><p>
    To locate three block devices run one of the following commends (both are
    equivalent):
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> ledctl locate=/dev/sda,/dev/sdb,/dev/sdc
<code class="prompt user">tux &gt; </code><code class="command">sudo</code> ledctl locate={ /dev/sda /dev/sdb /dev/sdc }</pre></div></div></div><div class="sect1 " id="sec.raid_leds.info"><div class="titlepage"><div><div><h2 class="title" id="sec.raid_leds.info"><span class="number">12.3 </span><span class="name">Additional Information</span> <a title="Permalink" class="permalink" href="#sec.raid_leds.info">#</a></h2></div></div></div><p>
   See the following resources for details about the LED patterns and
   monitoring tools:
  </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
     <a class="link" href="http://sourceforge.net/projects/ledmon/" target="_blank">LEDMON open
     source project on Sourceforge.net</a>
    </p></li><li class="listitem "><p>
     <a class="link" href="ftp://ftp.seagate.com/sff/SFF-8485.PDF" target="_blank">SGPIO
     specification SFF-8485</a>
    </p></li><li class="listitem "><p>
     <a class="link" href="ftp://ftp.seagate.com/sff/SFF-8489.PDF" target="_blank">IBPI
     specification SFF-8489</a>
    </p></li></ul></div></div></div></div><div class="part" id="part.net_storage"><div class="titlepage"><div><div><h1 class="title"><span class="number">Part IV </span><span class="name">Network Storage </span><a title="Permalink" class="permalink" href="#part.net_storage">#</a></h1></div></div></div><div class="toc"><dl><dt><span class="chapter"><a href="#cha.isns"><span class="number">13 </span><span class="name">iSNS for Linux</span></a></span></dt><dd class="toc-abstract"><p>
  Storage area networks (SANs) can contain many disk drives that are dispersed
  across complex networks. This can make device discovery and device ownership
  difficult. iSCSI initiators must be able to identify storage resources in the
  SAN and determine whether they have access to them.
 </p></dd><dt><span class="chapter"><a href="#cha.iscsi"><span class="number">14 </span><span class="name">Mass Storage over IP Networks: iSCSI</span></a></span></dt><dd class="toc-abstract"><p>One of the primary tasks of a computer center, or any site that supports servers, is to provide adequate disk capacity. Fibre Channel is often used for this purpose. iSCSI (Internet SCSI) solutions provide a lower-cost alternative to Fibre Channel that can leverage commodity servers and Ethernet net…</p></dd><dt><span class="chapter"><a href="#cha.fcoe"><span class="number">15 </span><span class="name">Fibre Channel Storage over Ethernet Networks: FCoE</span></a></span></dt><dd class="toc-abstract"><p>Many enterprise data centers rely on Ethernet for their LAN and data traffic, and on Fibre Channel networks for their storage infrastructure. Open Fibre Channel over Ethernet (FCoE) Initiator software allows servers with Ethernet adapters to connect to a Fibre Channel storage subsystem over an Ether…</p></dd><dt><span class="chapter"><a href="#cha.nvmeof"><span class="number">16 </span><span class="name">NVMe over Fabric</span></a></span></dt><dd class="toc-abstract"><p>
    This chapter describes how to set up an NVMe over Fabric host and target.
   </p></dd><dt><span class="chapter"><a href="#cha.multipath"><span class="number">17 </span><span class="name">Managing Multipath I/O for Devices</span></a></span></dt><dd class="toc-abstract"><p>
  This section describes how to manage failover and path load balancing for
  multiple paths between the servers and block storage devices by using
  Multipath I/O (MPIO).
 </p></dd><dt><span class="chapter"><a href="#cha.nfs4_acls"><span class="number">18 </span><span class="name">Managing Access Control Lists over NFSv4</span></a></span></dt><dd class="toc-abstract"><p>There is no single standard for Access Control Lists (ACLs) in Linux beyond the simple read, write, and execute (rwx) flags for user, group, and others (ugo). One option for finer control is the Draft POSIX ACLs, which were never formally standardized by POSIX. Another is the NFSv4 ACLs, which were …</p></dd></dl></div><div xml:lang="en" class="chapter " id="cha.isns" lang="en"><div class="titlepage"><div><div><h2 class="title"><span class="number">13 </span><span class="name">iSNS for Linux</span> <a title="Permalink" class="permalink" href="#cha.isns">#</a></h2><div class="doc-status"><ul><li><span class="ds-label">Filename: </span>storage_isns.xml</li><li><span class="ds-label">ID: </span>cha.isns</li></ul></div></div></div></div><div class="line"><div class="toc"><dl><dt><span class="sect1"><a href="#sec.isns.overview"><span class="number">13.1 </span><span class="name">How iSNS Works</span></a></span></dt><dt><span class="sect1"><a href="#sec.isns.install"><span class="number">13.2 </span><span class="name">Installing iSNS Server for Linux</span></a></span></dt><dt><span class="sect1"><a href="#sec.isns.domains"><span class="number">13.3 </span><span class="name">Configuring iSNS Discovery Domains</span></a></span></dt><dt><span class="sect1"><a href="#sec.isns.start"><span class="number">13.4 </span><span class="name">Starting the iSNS Service</span></a></span></dt><dt><span class="sect1"><a href="#sec.isns.info"><span class="number">13.5 </span><span class="name">For More Information</span></a></span></dt></dl></div></div><p>
  Storage area networks (SANs) can contain many disk drives that are dispersed
  across complex networks. This can make device discovery and device ownership
  difficult. iSCSI initiators must be able to identify storage resources in the
  SAN and determine whether they have access to them.
 </p><p>
  Internet Storage Name Service (iSNS) is a standards-based service that
  simplifies the automated discovery, management, and configuration of iSCSI
  devices on a TCP/IP network. iSNS provides intelligent storage discovery and
  management services comparable to those found in Fibre Channel networks.
 </p><div id="idm139787668450832" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.png" /><h6>Important: Security Considerations</h6><p>
   iSNS should be used only in secure internal networks.
  </p></div><div class="sect1 " id="sec.isns.overview"><div class="titlepage"><div><div><h2 class="title" id="sec.isns.overview"><span class="number">13.1 </span><span class="name">How iSNS Works</span> <a title="Permalink" class="permalink" href="#sec.isns.overview">#</a></h2></div></div></div><p>
   For an iSCSI initiator to discover iSCSI targets, it needs to identify which
   devices in the network are storage resources and what IP addresses it needs
   to access them. A query to an iSNS server returns a list of iSCSI targets
   and the IP addresses that the initiator has permission to access.
  </p><p>
   Using iSNS, you create iSNS discovery domains into which you then group or
   organize iSCSI targets and initiators. By dividing storage nodes into
   domains, you can limit the discovery process of each host to the most
   appropriate subset of targets registered with iSNS, which allows the storage
   network to scale by reducing the number of unnecessary discoveries and by
   limiting the amount of time each host spends establishing discovery
   relationships. This lets you control and simplify the number of targets and
   initiators that must be discovered.
  </p><div class="figure" id="idm139787668446592"><div class="figure-contents"><div class="mediaobject"><a xmlns="" href="images/isns_a.png"><img src="images/isns_a.png" width="" alt="iSNS Discovery Domains" /></a></div></div><div class="figure-title-wrap"><h6 class="figure-title"><span class="number">Figure 13.1: </span><span class="name">iSNS Discovery Domains </span><a title="Permalink" class="permalink" href="#idm139787668446592">#</a></h6></div></div><p>
   Both iSCSI targets and iSCSI initiators use iSNS clients to initiate
   transactions with iSNS servers by using the iSNS protocol. They then
   register device attribute information in a common discovery domain, download
   information about other registered clients, and receive asynchronous
   notification of events that occur in their discovery domain.
  </p><p>
   iSNS servers respond to iSNS protocol queries and requests made by iSNS
   clients using the iSNS protocol. iSNS servers initiate iSNS protocol state
   change notifications and store properly authenticated information submitted
   by a registration request in an iSNS database.
  </p><p>
   Benefits provided by iSNS for Linux include:
  </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
     Provides an information facility for registration, discovery, and
     management of networked storage assets.
    </p></li><li class="listitem "><p>
     Integrates with the DNS infrastructure.
    </p></li><li class="listitem "><p>
     Consolidates registration, discovery, and management of iSCSI storage.
    </p></li><li class="listitem "><p>
     Simplifies storage management implementations.
    </p></li><li class="listitem "><p>
     Improves scalability compared to other discovery methods.
    </p></li></ul></div><p>
   An example of the benefits iSNS provides can be better understood through
   the following scenario:
  </p><p>
   Suppose you have a company that has 100 iSCSI initiators and 100 iSCSI
   targets. Depending on your configuration, all iSCSI initiators could
   potentially try to discover and connect to any of the 100 iSCSI targets.
   This could create discovery and connection difficulties. By grouping
   initiators and targets into discovery domains, you can prevent iSCSI
   initiators in one department from discovering the iSCSI targets in another
   department. The result is that the iSCSI initiators in a specific department
   only discover those iSCSI targets that are part of the department's
   discovery domain.
  </p></div><div class="sect1 " id="sec.isns.install"><div class="titlepage"><div><div><h2 class="title" id="sec.isns.install"><span class="number">13.2 </span><span class="name">Installing iSNS Server for Linux</span> <a title="Permalink" class="permalink" href="#sec.isns.install">#</a></h2></div></div></div><p>
   iSNS Server for Linux is included with <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span>, but is not installed
   or configured by default. You need to install the package
   <code class="systemitem">open-isns</code> and configure the iSNS
   service.
  </p><div id="idm139787668428464" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.png" /><h6>Note: iSNS and iSCSI on the Same Server</h6><p>
    iSNS can be installed on the same server where iSCSI target or iSCSI
    initiator software is installed. Installing both the iSCSI target software
    and iSCSI initiator software on the same server is not supported.
   </p></div><p>
   To install iSNS for Linux:
  </p><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
     Start YaST and select <span class="guimenu">Network Services</span> › <span class="guimenu">iSNS Server</span>.
    </p></li><li class="step "><p>
     In case <code class="systemitem">open-isns</code> is not
     installed yet, you are prompted to install it now. Confirm by clicking
     <span class="guimenu">Install</span>.
    </p></li><li class="step "><p>
     The iSNS Service configuration dialog opens automatically to the
     <span class="guimenu">Service</span> tab.
    </p><div class="informalfigure"><div class="mediaobject"><a xmlns="" href="images/isns_config_a.png"><img src="images/isns_config_a.png" width="" /></a></div></div></li><li class="step "><p>
     In <span class="guimenu">Service Start</span>, select one of the following:
    </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p><span class="formalpara-title">When Booting: </span>
        The iSNS service starts automatically on server start-up.
       </p></li><li class="listitem "><p><span class="formalpara-title">Manually (Default): </span>
        The iSNS service must be started manually by entering <code class="command">sudo
        systemctl start isnsd</code> at the server console of the server
        where you install it.
       </p></li></ul></div></li><li class="step "><p>
     Specify the following firewall settings:
    </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p><span class="formalpara-title">Open Port in Firewall: </span>
        Select the check box to open the firewall and allow access to the
        service from remote computers. The firewall port is closed by default.
       </p></li><li class="listitem "><p><span class="formalpara-title">Firewall Details: </span>
        If you open the firewall port, the port is open on all network
        interfaces by default. Click <span class="guimenu">Firewall Details</span> to
        select interfaces on which to open the port, select the network
        interfaces to use, then click <span class="guimenu">OK</span>.
       </p></li></ul></div></li><li class="step "><p>
     Click <span class="guimenu">OK</span> to apply the configuration settings and
     complete the installation.
    </p></li><li class="step "><p>
     Continue with
     <a class="xref" href="#sec.isns.domains" title="13.3. Configuring iSNS Discovery Domains">Section 13.3, “Configuring iSNS Discovery Domains”</a>.
    </p></li></ol></div></div></div><div class="sect1 " id="sec.isns.domains"><div class="titlepage"><div><div><h2 class="title" id="sec.isns.domains"><span class="number">13.3 </span><span class="name">Configuring iSNS Discovery Domains</span> <a title="Permalink" class="permalink" href="#sec.isns.domains">#</a></h2></div></div></div><p>
   For iSCSI initiators and targets to use the iSNS service, they must belong
   to a discovery domain.
  </p><div id="idm139787668397664" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.png" /><h6>Important: The iSNS Service Must be Active</h6><p>
    The iSNS service must be installed and running to configure iSNS discovery
    domains. For information, see
    <a class="xref" href="#sec.isns.start" title="13.4. Starting the iSNS Service">Section 13.4, “Starting the iSNS Service”</a>.
   </p></div><div class="sect2 " id="sec.isns.domains.ddcreate"><div class="titlepage"><div><div><h3 class="title" id="sec.isns.domains.ddcreate"><span class="number">13.3.1 </span><span class="name">Creating iSNS Discovery Domains</span> <a title="Permalink" class="permalink" href="#sec.isns.domains.ddcreate">#</a></h3></div></div></div><p>
    A default discovery domain named <span class="guimenu">default DD</span> is
    automatically created when you install the iSNS service. The existing iSCSI
    targets and initiators that have been configured to use iSNS are
    automatically added to the default discovery domain.
   </p><p>
    To create a new discovery domain:
   </p><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
      Start YaST and under <span class="guimenu">Network Services</span>, select
      <span class="guimenu">iSNS Server</span>.
     </p></li><li class="step "><p>
      Click the <span class="guimenu">Discovery Domains</span> tab.
     </p><p>
      The <span class="guimenu">Discovery Domains</span> area lists all existing
      discovery domains. You can <span class="guimenu">Create Discovery Domains</span>,
      or <span class="guimenu">Delete</span> existing ones. Deleting a domain removes the
      members from the domain, but it does not delete the iSCSI node members.
     </p><p>
      The <span class="guimenu">Discovery Domain Members</span> area lists all iSCSI
      nodes assigned to a selected discovery domain. Selecting a different
      discovery domain refreshes the list with members from that discovery
      domain. You can add and delete iSCSI nodes from a selected discovery
      domain. Deleting an iSCSI node removes it from the domain, but it does
      not delete the iSCSI node.
     </p><p>
      <span class="guimenu">Create iSCSI Node Member</span> allows a node that is not yet
      registered to be added as a member of the discovery domain. When the
      iSCSI initiator or target registers this node, then it becomes part of
      this domain.
     </p><p class="intro">
      When an iSCSI initiator performs a discovery request, the iSNS service
      returns all iSCSI node targets that are members of the same discovery
      domain.
     </p><div class="informalfigure"><div class="mediaobject"><a xmlns="" href="images/isns_discdomains_a.png"><img src="images/isns_discdomains_a.png" width="" /></a></div></div></li><li class="step "><p>
      Click the <span class="guimenu">Create Discovery Domain</span> button.
     </p><p>
      You can also select an existing discovery domain and click the
      <span class="guimenu">Delete</span> button to remove that discovery domain.
     </p></li><li class="step "><p>
      Specify the name of the discovery domain you are creating, then click
      <span class="guimenu">OK</span>.
     </p></li><li class="step "><p>
      Continue with
      <a class="xref" href="#sec.isns.domains.iscsi_nodes" title="13.3.2. Adding iSCSI Nodes to a Discovery Domain">Section 13.3.2, “Adding iSCSI Nodes to a Discovery Domain”</a>.
     </p></li></ol></div></div></div><div class="sect2 " id="sec.isns.domains.iscsi_nodes"><div class="titlepage"><div><div><h3 class="title" id="sec.isns.domains.iscsi_nodes"><span class="number">13.3.2 </span><span class="name">Adding iSCSI Nodes to a Discovery Domain</span> <a title="Permalink" class="permalink" href="#sec.isns.domains.iscsi_nodes">#</a></h3></div></div></div><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
      Start YaST and under <span class="guimenu">Network Services</span>, select
      <span class="guimenu">iSNS Server</span>.
     </p></li><li class="step "><p>
      Click the <span class="guimenu">iSCSI Nodes</span> tab.
     </p><div class="informalfigure"><div class="mediaobject"><a xmlns="" href="images/isns_iscsinodes_a.png"><img src="images/isns_iscsinodes_a.png" width="" /></a></div></div></li><li class="step "><p>
      Review the list of nodes to ensure that the iSCSI targets and initiators
      that you want to use the iSNS service are listed.
     </p><p>
      If an iSCSI target or initiator is not listed, you might need to restart
      the iSCSI service on the node. You can do this by running
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> systemctl restart iscsid.socket
<code class="prompt user">tux &gt; </code><code class="command">sudo</code> systemctl restart iscsi</pre></div><p>
      to restart an initiator or
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> systemctl restart target-isns</pre></div><p>
      to restart a target.
     </p><p>
      You can select an iSCSI node and click the <span class="guimenu">Delete</span>
      button to remove that node from the iSNS database. This is useful if you
      are no longer using an iSCSI node or have renamed it.
     </p><p>
      The iSCSI node is automatically added to the list (iSNS database) again
      when you restart the iSCSI service or reboot the server unless you remove
      or comment out the iSNS portion of the iSCSI configuration file.
     </p></li><li class="step "><p>
      Click the <span class="guimenu">Discovery Domains</span> tab and select the desired
      discovery domain.
     </p></li><li class="step "><p>
      Click <span class="guimenu">Add existing iSCSI Node</span>, select the node you
      want to add to the domain, then click <span class="guimenu">Add Node</span>.
     </p></li><li class="step "><p>
      Repeat the previous step for as many nodes as you want to add to the
      discovery domain, then click <span class="guimenu">Done</span> when you are
      finished adding nodes.
     </p><p>
      Note that an iSCSI node can belong to more than one discovery domain.
     </p></li></ol></div></div></div></div><div class="sect1 " id="sec.isns.start"><div class="titlepage"><div><div><h2 class="title" id="sec.isns.start"><span class="number">13.4 </span><span class="name">Starting the iSNS Service</span> <a title="Permalink" class="permalink" href="#sec.isns.start">#</a></h2></div></div></div><p>
   iSNS must be started at the server where you install it. If you have not
   configured it to be started at boot time (see
   <a class="xref" href="#sec.isns.install" title="13.2. Installing iSNS Server for Linux">Section 13.2, “Installing iSNS Server for Linux”</a> for details), enter the following command
   at a terminal console:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> systemctl start isnsd</pre></div><p>
   You can also use the <code class="command">stop</code>, <code class="command">status</code>, and
   <code class="command">restart</code> options with iSNS.
  </p></div><div class="sect1 " id="sec.isns.info"><div class="titlepage"><div><div><h2 class="title" id="sec.isns.info"><span class="number">13.5 </span><span class="name">For More Information</span> <a title="Permalink" class="permalink" href="#sec.isns.info">#</a></h2></div></div></div><p>
   For information, see the <em class="citetitle ">Linux iSNS for iSCSI project</em>
   at <a class="link" href="http://sourceforge.net/projects/linuxisns/" target="_blank">http://sourceforge.net/projects/linuxisns/</a>. The
   electronic mailing list for this project can be found at
   <a class="link" href="http://sourceforge.net/mailarchive/forum.php?forum_name=linuxisns-discussion" target="_blank">http://sourceforge.net/mailarchive/forum.php?forum_name=linuxisns-discussion</a>.
  </p><p>
   General information about iSNS is available in <em class="citetitle ">RFC 4171: Internet
   Storage Name Service</em> at
   <a class="link" href="http://www.ietf.org/rfc/rfc4171" target="_blank">http://www.ietf.org/rfc/rfc4171</a>.
  </p></div></div><div xml:lang="en" class="chapter " id="cha.iscsi" lang="en"><div class="titlepage"><div><div><h2 class="title"><span class="number">14 </span><span class="name">Mass Storage over IP Networks: iSCSI</span> <a title="Permalink" class="permalink" href="#cha.iscsi">#</a></h2><div class="doc-status"><ul><li><span class="ds-label">Filename: </span>storage_iscsi.xml</li><li><span class="ds-label">ID: </span>cha.iscsi</li></ul></div></div></div></div><div class="line"><div class="toc"><dl><dt><span class="sect1"><a href="#sec.iscsi.install"><span class="number">14.1 </span><span class="name">Installing the iSCSI LIO Target Server and iSCSI Initiator</span></a></span></dt><dt><span class="sect1"><a href="#sec.iscsi.target"><span class="number">14.2 </span><span class="name">Setting Up an iSCSI LIO Target Server</span></a></span></dt><dt><span class="sect1"><a href="#sec.iscsi.initiator"><span class="number">14.3 </span><span class="name">Configuring iSCSI Initiator</span></a></span></dt><dt><span class="sect1"><a href="#sec.iscsi.installation"><span class="number">14.4 </span><span class="name">Using iSCSI Disks when Installing</span></a></span></dt><dt><span class="sect1"><a href="#sec.iscsi.trouble"><span class="number">14.5 </span><span class="name">Troubleshooting iSCSI</span></a></span></dt><dt><span class="sect1"><a href="#sec.iscsi.terminology"><span class="number">14.6 </span><span class="name">iSCSI LIO Target Terminology</span></a></span></dt><dt><span class="sect1"><a href="#sec.iscsi.info"><span class="number">14.7 </span><span class="name">Additional Information</span></a></span></dt></dl></div></div><p>
  One of the primary tasks of a computer center, or any site that supports
  servers, is to provide adequate disk capacity. Fibre Channel is often used
  for this purpose. iSCSI (Internet SCSI) solutions provide a lower-cost
  alternative to Fibre Channel that can leverage commodity servers and Ethernet
  networking equipment. Linux iSCSI provides iSCSI initiator and iSCSI LIO
  target software for connecting Linux servers to central storage systems.
 </p><div class="figure" id="idm139787668335728"><div class="figure-contents"><div class="mediaobject"><a xmlns="" href="images/iscsi_san_a.png"><img src="images/iscsi_san_a.png" width="" alt="iSCSI SAN with an iSNS Server" /></a></div></div><div class="figure-title-wrap"><h6 class="figure-title"><span class="number">Figure 14.1: </span><span class="name">iSCSI SAN with an iSNS Server </span><a title="Permalink" class="permalink" href="#idm139787668335728">#</a></h6></div></div><div id="idm139787668330720" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.png" /><h6>Note: LIO</h6><p>
   LIO (<a class="link" href="http://linux-iscsi.org" target="_blank">http://linux-iscsi.org</a>) is the standard open
   source multiprotocol SCSI target for Linux. LIO replaced the STGT (SCSI
   Target) framework as the standard unified storage target in Linux with Linux
   kernel version 2.6.38 and later. In <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> 12 the iSCSI LIO Target
   Server replaces the iSCSI Target Server from previous versions.
  </p></div><p>
  iSCSI is a storage networking protocol that simplifies data transfers of SCSI
  packets over TCP/IP networks between block storage devices and servers. iSCSI
  target software runs on the target server and defines the logical units as
  iSCSI target devices. iSCSI initiator software runs on different servers and
  connects to the target devices to make the storage devices available on that
  server.
 </p><p>
  The iSCSI LIO target server and iSCSI initiator servers communicate by
  sending SCSI packets at the IP level in your LAN. When an application running
  on the initiator server starts an inquiry for an iSCSI LIO target device, the
  operating system produces the necessary SCSI commands. The SCSI commands are
  then embedded in IP packets and encrypted as necessary by software that is
  commonly known as the <span class="emphasis"><em>iSCSI initiator</em></span>. The packets are
  transferred across the internal IP network to the corresponding iSCSI remote
  station, called the <span class="emphasis"><em>iSCSI LIO target server</em></span>, or simply
  the <span class="emphasis"><em>iSCSI target</em></span>.
 </p><p>
  Many storage solutions provide access over iSCSI, but it is also possible to
  run a Linux server that provides an iSCSI target. In this case, it is
  important to set up a Linux server that is optimized for file system
  services. The iSCSI target accesses block devices in Linux. Therefore, it is
  possible to use RAID solutions to increase disk space and a lot of memory to
  improve data caching. For more information about RAID, also see
  <a class="xref" href="#cha.raid" title="Chapter 7. Software RAID Configuration">Chapter 7, <em>Software RAID Configuration</em></a>.
 </p><div class="sect1 " id="sec.iscsi.install"><div class="titlepage"><div><div><h2 class="title" id="sec.iscsi.install"><span class="number">14.1 </span><span class="name">Installing the iSCSI LIO Target Server and iSCSI Initiator</span> <a title="Permalink" class="permalink" href="#sec.iscsi.install">#</a></h2></div></div></div><p>
   While the iSCSI initiator is installed by default (packages
   <code class="systemitem">open-iscsi</code> and
   <code class="systemitem">yast2-iscsi-client</code>), the iSCSI LIO
   target packages need to be installed manually.
  </p><div id="idm139787668319424" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.png" /><h6>Important: Initiator and Target may not Run on the Same Server</h6><p>
    It is not supported to run iSCSI target software and iSCSI initiator
    software on the same server in a production environment.
   </p></div><p>
   To install the iSCSI LIO Target Server, run the following command in a
   terminal console:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> zypper in yast2-iscsi-lio-server</pre></div><p>
   In case you need to install the iSCSI initiator or any of its dependencies,
   run the command <code class="command">sudo zypper in yast2-iscsi-client</code>.
  </p><p>
   Alternatively, use the YaST Software Management module for installation.
  </p><p>
   Any packages required in addition to the ones mentioned above will either be
   automatically pulled in by the installer, or be installed when you first run
   the respective YaST module.
  </p></div><div class="sect1 " id="sec.iscsi.target"><div class="titlepage"><div><div><h2 class="title" id="sec.iscsi.target"><span class="number">14.2 </span><span class="name">Setting Up an iSCSI LIO Target Server</span> <a title="Permalink" class="permalink" href="#sec.iscsi.target">#</a></h2></div></div></div><p>
   This section describes how to use YaST to configure an iSCSI LIO Target
   Server and set up iSCSI LIO target devices. You can use any iSCSI initiator
   software to access the target devices.
  </p><div class="sect2 " id="sec.iscsi.target.start"><div class="titlepage"><div><div><h3 class="title" id="sec.iscsi.target.start"><span class="number">14.2.1 </span><span class="name">iSCSI LIO Target Service Start-up and Firewall Settings</span> <a title="Permalink" class="permalink" href="#sec.iscsi.target.start">#</a></h3></div></div></div><p>
    The iSCSI LIO Target service is by default configured to be started
    manually. You can configure the service to start automatically at boot
    time. If you use a firewall on the server and you want the iSCSI LIO
    targets to be available to other computers, you must open a port in the
    firewall for each adapter that you want to use for target access. TCP port
    3260 is the port number for the iSCSI protocol, as defined by IANA
    (Internet Assigned Numbers Authority).
   </p><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
      Start YaST and launch <span class="guimenu">Network Services</span> › <span class="guimenu">iSCSI LIO Target</span>.
     </p></li><li class="step "><p>
      Switch to the <span class="guimenu">Service</span> tab.
     </p><div class="informalfigure"><div class="mediaobject"><a xmlns="" href="images/lio_service_a.png"><img src="images/lio_service_a.png" width="" /></a></div></div></li><li class="step "><p>
      Under <span class="guimenu">Service Start</span>, specify how you want the iSCSI
      LIO target service to be started:
     </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p><span class="formalpara-title">When Booting: </span>
         The service starts automatically on server restart.
        </p></li><li class="listitem "><p><span class="formalpara-title">Manually: </span>
         (Default) You must start the service manually after a server restart
         by running <code class="command">sudo systemctl start target</code>. The target
         devices are not available until you start the service.
        </p></li></ul></div></li><li class="step "><p>
      If you use a firewall on the server and you want the iSCSI LIO targets to
      be available to other computers, open port 3260 in the firewall for each
      adapter interface that you want to use for target access. If the port is
      closed for all of the network interfaces, the iSCSI LIO targets are not
      available to other computers.
     </p><p>
      If you do not use a firewall on the server, the firewall settings are
      disabled. In this case skip the following steps and leave the
      configuration dialog with <span class="guimenu">Finish</span> or switch to another
      tab to continue with the configuration.
     </p><ol type="a" class="substeps "><li class="step "><p>
        On the <span class="guimenu">Services</span> tab, select the <span class="guimenu">Open Port
        in Firewall</span> check box to enable the firewall settings.
       </p></li><li class="step "><p>
        Click <span class="guimenu">Firewall Details</span> to view or configure the
        network interfaces to use. All available network interfaces are listed,
        and all are selected by default. Deselect all interfaces on which the
        port should <span class="emphasis"><em>not</em></span> be opened. Save your settings with
        <span class="guimenu">OK</span>.
       </p></li></ol></li><li class="step "><p>
      Click <span class="guimenu">Finish</span> to save and apply the iSCSI LIO Target
      service settings.
     </p></li></ol></div></div></div><div class="sect2 " id="sec.iscsi.target.authenticate"><div class="titlepage"><div><div><h3 class="title" id="sec.iscsi.target.authenticate"><span class="number">14.2.2 </span><span class="name">Configuring Authentication for Discovery of iSCSI LIO Targets and Initiators</span> <a title="Permalink" class="permalink" href="#sec.iscsi.target.authenticate">#</a></h3></div></div></div><p>
    The iSCSI LIO Target Server software supports the PPP-CHAP (Point-to-Point
    Protocol Challenge Handshake Authentication Protocol), a three-way
    authentication method defined in the <em class="citetitle ">Internet Engineering Task
    Force (IETF) RFC 1994</em>
    (<a class="link" href="http://www.ietf.org/rfc/rfc1994.txt" target="_blank">http://www.ietf.org/rfc/rfc1994.txt</a>). The server uses
    this authentication method for the discovery of iSCSI LIO targets and
    initiators, not for accessing files on the targets. If you do not want to
    restrict the access to the discovery, use <span class="guimenu">No
    Authentication</span>. The <span class="guimenu">No Discovery Authentication</span> option
    is enabled by default. Without requiring authentication all iSCSI LIO
    targets on this server can be discovered by any iSCSI initiator on the same
    network.
   </p><p>
    If authentication is needed for a more secure configuration, you can use
    incoming authentication, outgoing authentication, or both.
    <span class="guimenu">Authentication by Initiators</span> requires an iSCSI initiator to
    prove that it has the permissions to run a discovery on the iSCSI LIO
    target. The initiator must provide the incoming user name and password.
    <span class="guimenu">Authentication by Targets</span> requires the iSCSI LIO target to
    prove to the initiator that it is the expected target. The iSCSI LIO target
    must provide the outgoing user name and password to the iSCSI initiator.
    The password needs to be different for incoming and outgoing discovery. If
    authentication for discovery is enabled, its settings apply to all iSCSI
    LIO target groups.
   </p><div id="idm139787668279776" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.png" /><h6>Important: Security</h6><p>
     We recommend that you use authentication for target and initiator
     discovery in production environments for security reasons.
    </p></div><p>
    To configure authentication preferences for iSCSI LIO targets:
   </p><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
      Start YaST and launch <span class="guimenu">Network Services</span> › <span class="guimenu">iSCSI LIO Target</span>.
     </p></li><li class="step "><p>
      Switch to the <span class="guimenu">Global</span> tab.
     </p><div class="informalfigure"><div class="mediaobject"><a xmlns="" href="images/lio_global_noauth_a.png"><img src="images/lio_global_noauth_a.png" width="" /></a></div></div></li><li class="step "><p>
      By default, authentication is disabled (<span class="guimenu">No Discovery
      Authentication</span>). To enable Authentication, select
      <span class="guimenu">Authentication by Initiators</span>, <span class="guimenu">Outgoing
      Authentication</span> or both.
     </p></li><li class="step "><p>
      Provide credentials for the selected authentication method(s). The user
      name and password pair must be different for incoming and outgoing
      discovery.
     </p></li><li class="step "><p>
      Click <span class="guimenu">Finish</span> to save and apply the settings.
     </p></li></ol></div></div></div><div class="sect2 " id="sec.iscsi.target.storage"><div class="titlepage"><div><div><h3 class="title" id="sec.iscsi.target.storage"><span class="number">14.2.3 </span><span class="name">Preparing the Storage Space</span> <a title="Permalink" class="permalink" href="#sec.iscsi.target.storage">#</a></h3></div></div></div><p>
    Before you configure LUNs for your iSCSI Target servers, you must prepare
    the storage you want to use. You can use the entire unformatted block
    device as a single LUN, or you can subdivide a device into unformatted
    partitions and use each partition as a separate LUN. The iSCSI target
    configuration exports the LUNs to iSCSI initiators.
   </p><p>
    You can use the Partitioner in YaST or the command line to set up the
    partitions. Refer to <span class="intraxref">Book “<em class="citetitle ">Deployment Guide</em>”, Chapter 9 “Expert Partitioner”, Section 9.1 “Using the Expert Partitioner”</span> for
    details. iSCSI LIO targets can use unformatted partitions with Linux, Linux
    LVM, or Linux RAID file system IDs.
   </p><div id="idm139787668261072" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.png" /><h6>Important: Do Not Mount iSCSI Target Devices</h6><p>
     After you set up a device or partition for use as an iSCSI target, you
     never access it directly via its local path. Do not mount the partitions
     on the target server.
    </p></div><div class="sect3 " id="sec.iscsi.target.storage.vm"><div class="titlepage"><div><div><h4 class="title" id="sec.iscsi.target.storage.vm"><span class="number">14.2.3.1 </span><span class="name">Partitioning Devices in a Virtual Environment</span> <a title="Permalink" class="permalink" href="#sec.iscsi.target.storage.vm">#</a></h4></div></div></div><p>
     You can use a virtual machine guest server as an iSCSI LIO Target Server.
     This section describes how to assign partitions to a Xen virtual
     machine. You can also use other virtual environments that are supported by
     <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span>.
    </p><p>
     In a Xen virtual environment, you must assign the storage space you want
     to use for the iSCSI LIO target devices to the guest virtual machine, then
     access the space as virtual disks within the guest environment. Each
     virtual disk can be a physical block device, such as an entire disk,
     partition, or volume, or it can be a file-backed disk image where the
     virtual disk is a single image file on a larger physical disk on the Xen
     host server. For the best performance, create each virtual disk from a
     physical disk or a partition. After you set up the virtual disks for the
     guest virtual machine, start the guest server, then configure the new
     blank virtual disks as iSCSI target devices by following the same process
     as for a physical server.
    </p><p>
     File-backed disk images are created on the Xen host server, then
     assigned to the Xen guest server. By default, Xen stores file-backed
     disk images in the
     <code class="filename">/var/lib/xen/images/<em class="replaceable ">VM_NAME</em></code>
     directory, where <code class="filename"><em class="replaceable ">VM_NAME</em></code>
     is the name of the virtual machine.
    </p></div></div><div class="sect2 " id="sec.iscsi.target.target_group"><div class="titlepage"><div><div><h3 class="title" id="sec.iscsi.target.target_group"><span class="number">14.2.4 </span><span class="name">Setting Up an iSCSI LIO Target Group</span> <a title="Permalink" class="permalink" href="#sec.iscsi.target.target_group">#</a></h3></div></div></div><p>
    You can use YaST to configure iSCSI LIO target devices. YaST uses APIs
    provided by the <code class="command">lio-utils</code> software. iSCSI LIO targets
    can use unformatted partitions with Linux, Linux LVM, or Linux RAID file
    system IDs.
   </p><div id="idm139787668250752" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.png" /><h6>Important: Partitions</h6><p>
     Before you begin, create the unformatted partitions that you want to use
     as iSCSI LIO targets as described in
     <a class="xref" href="#sec.iscsi.target.storage" title="14.2.3. Preparing the Storage Space">Section 14.2.3, “Preparing the Storage Space”</a>.
    </p></div><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
      Start YaST and launch <span class="guimenu">Network Services</span> › <span class="guimenu">iSCSI LIO Target</span>.
     </p></li><li class="step "><p>
      Switch to the <span class="guimenu">Targets</span> tab.
     </p><div class="informalfigure"><div class="mediaobject"><a xmlns="" href="images/lio_targets_a.png"><img src="images/lio_targets_a.png" width="" /></a></div></div></li><li class="step "><p>
      Click <span class="guimenu">Add</span>, then define a new iSCSI LIO target group
      and devices:
     </p><p>
      The iSCSI LIO Target software automatically completes the
      <span class="guimenu">Target</span>, <span class="guimenu">Identifier</span>, <span class="guimenu">Portal
      Group</span>, <span class="guimenu">IP Address</span>, and <span class="guimenu">Port
      Number</span> fields. <span class="guimenu">Use Authentication</span> is
      selected by default.
     </p><ol type="a" class="substeps "><li class="step "><p>
        If you have multiple network interfaces, use the IP address drop-down
        box to select the IP address of the network interface to use for this
        target group. To make the server accessible under all addresses, choose
        <span class="guimenu">Bind All IP Addresses</span>.
       </p></li><li class="step "><p>
        Deselect <span class="guimenu">Use Authentication</span> if you do not want to
        require initiator authentication for this target group (not
        recommended).
       </p></li><li class="step "><p>
        Click <span class="guimenu">Add</span>. Enter the path of the device or partition
        or <span class="guimenu">Browse</span> to add it. Optionally specify a name, then
        click <span class="guimenu">OK</span>. The LUN number is automatically generated,
        beginning with 0. A name is automatically generated if you leave the
        field empty.
       </p></li><li class="step "><p>
        (Optional) Repeat the previous steps to add more targets to this target
        group.
       </p></li><li class="step "><p>
        After all desired targets have been added to the group, click
        <span class="guimenu">Next</span>.
       </p></li></ol></li><li class="step "><p>
      On the <span class="guimenu">Modify iSCSI Target Initiator Setup</span> page,
      configure information for the initiators that are permitted to access
      LUNs in the target group:
     </p><div class="informalfigure"><div class="mediaobject"><a xmlns="" href="images/lio_target_client_a.png"><img src="images/lio_target_client_a.png" width="" /></a></div></div><p>
      After you specify at least one initiator for the target group, the
      <span class="guimenu">Edit LUN</span>, <span class="guimenu">Edit Auth</span>,
      <span class="guimenu">Delete</span>, and <span class="guimenu">Copy</span> buttons are
      enabled. You can use <span class="guimenu">Add</span> or <span class="guimenu">Copy</span> to
      add more initiators for the target group:
     </p><div class="itemizedlist " id="il.iscsi.target.target_group.options"><div class="itemizedlist-title-wrap"><h6 class="itemizedlist-title"><span class="name">Modify iSCSI Target: Options </span><a title="Permalink" class="permalink" href="#il.iscsi.target.target_group.options">#</a></h6></div><ul class="itemizedlist"><li class="listitem "><p><span class="formalpara-title">Add: </span>
         Add a new initiator entry for the selected iSCSI LIO target group.
        </p></li><li class="listitem "><p><span class="formalpara-title">Edit LUN: </span>
         Configure which LUNs in the iSCSI LIO target group to map to a
         selected initiator. You can map each of the allocated targets to a
         preferred initiator.
        </p></li><li class="listitem "><p><span class="formalpara-title">Edit Auth: </span>
         Configure the preferred authentication method for a selected
         initiator. You can specify no authentication, or you can configure
         incoming authentication, outgoing authentication, or both.
        </p></li><li class="listitem "><p><span class="formalpara-title">Delete: </span>
         Remove a selected initiator entry from the list of initiators
         allocated to the target group.
        </p></li><li class="listitem "><p><span class="formalpara-title">Copy: </span>
         Add a new initiator entry with the same LUN mappings and
         authentication settings as a selected initiator entry. This allows you
         to easily allocate the same shared LUNs, in turn, to each node in a
         cluster.
        </p></li></ul></div><ol type="a" class="substeps "><li class="step "><p>
        Click <span class="guimenu">Add</span>, specify the initiator name, select or
        deselect the <span class="guimenu">Import LUNs from TPG</span> check box, then
        click <span class="guimenu">OK</span> to save the settings.
       </p></li><li class="step "><p>
        Select an initiator entry, click <span class="guimenu">Edit LUN</span>, modify
        the LUN mappings to specify which LUNs in the iSCSI LIO target group to
        allocate to the selected initiator, then click <span class="guimenu">OK</span> to
        save the changes.
       </p><p>
        If the iSCSI LIO target group consists of multiple LUNs, you can
        allocate one or multiple LUNs to the selected initiator. By default,
        each of the available LUNs in the group are assigned to an initiator
        LUN.
       </p><p>
        To modify the LUN allocation, perform one or more of the following
        actions:
       </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p><span class="formalpara-title">Add: </span>
           Click <span class="guimenu">Add</span> to create a new <span class="guimenu">Initiator
           LUN</span> entry, then use the <span class="guimenu">Change</span>
           drop-down box to map a target LUN to it.
          </p></li><li class="listitem "><p><span class="formalpara-title">Delete: </span>
           Select the <span class="guimenu">Initiator LUN</span> entry, then click
           <span class="guimenu">Delete</span> to remove a target LUN mapping.
          </p></li><li class="listitem "><p><span class="formalpara-title">Change: </span>
           Select the <span class="guimenu">Initiator LUN</span> entry, then use the
           <span class="guimenu">Change</span> drop-down box to select which Target LUN
           to map to it.
          </p></li></ul></div><p>
        Typical allocation plans include the following:
       </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
          A single server is listed as an initiator. All of the LUNs in the
          target group are allocated to it.
         </p><p>
          You can use this grouping strategy to logically group the iSCSI SAN
          storage for a given server.
         </p></li><li class="listitem "><p>
          Multiple independent servers are listed as initiators. One or
          multiple target LUNs are allocated to each server. Each LUN is
          allocated to only one server.
         </p><p>
          You can use this grouping strategy to logically group the iSCSI SAN
          storage for a given department or service category in the data
          center.
         </p></li><li class="listitem "><p>
          Each node of a cluster is listed as an initiator. All of the shared
          target LUNs are allocated to each node. All nodes are attached to the
          devices, but for most file systems, the cluster software locks a
          device for access and mounts it on only one node at a time. Shared
          file systems (such as OCFS2) make it possible for multiple nodes to
          concurrently mount the same file structure and to open the same files
          with read and write access.
         </p><p>
          You can use this grouping strategy to logically group the iSCSI SAN
          storage for a given server cluster.
         </p></li></ul></div></li><li class="step "><p>
        Select an initiator entry, click <span class="guimenu">Edit Auth</span>, specify
        the authentication settings for the initiator, then click
        <span class="guimenu">OK</span> to save the settings.
       </p><p>
        You can require <span class="guimenu">No Discovery Authentication</span>, or you can
        configure <span class="guimenu">Authentication by Initiators</span>, <span class="guimenu">Outgoing
        Authentication</span>, or both. You can specify only one user name
        and password pair for each initiator. The credentials can be different
        for incoming and outgoing authentication for an initiator. The
        credentials can be different for each initiator.
       </p></li><li class="step "><p>
        Repeat the previous steps for each iSCSI initiator that can access this
        target group.
       </p></li><li class="step "><p>
        After the initiator assignments are configured, click
        <span class="guimenu">Next</span>.
       </p></li></ol></li><li class="step "><p>
      Click <span class="guimenu">Finish</span> to save and apply the settings.
     </p></li></ol></div></div></div><div class="sect2 " id="sec.iscsi.target.tg_modify"><div class="titlepage"><div><div><h3 class="title" id="sec.iscsi.target.tg_modify"><span class="number">14.2.5 </span><span class="name">Modifying an iSCSI LIO Target Group</span> <a title="Permalink" class="permalink" href="#sec.iscsi.target.tg_modify">#</a></h3></div></div></div><p>
    You can modify an existing iSCSI LIO target group as follows:
   </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
      Add or remove target LUN devices from a target group
     </p></li><li class="listitem "><p>
      Add or remove initiators for a target group
     </p></li><li class="listitem "><p>
      Modify the initiator LUN-to-target LUN mappings for an initiator of a
      target group
     </p></li><li class="listitem "><p>
      Modify the user name and password credentials for an initiator
      authentication (incoming, outgoing, or both)
     </p></li></ul></div><p>
    To view or modify the settings for an iSCSI LIO target group:
   </p><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
      Start YaST and launch <span class="guimenu">Network Services</span> › <span class="guimenu">iSCSI LIO Target</span>.
     </p></li><li class="step "><p>
      Switch to the <span class="guimenu">Targets</span> tab.
     </p></li><li class="step "><p>
      Select the iSCSI LIO target group to be modified, then click
      <span class="guimenu">Edit</span>.
     </p></li><li class="step "><p>
      On the Modify iSCSI Target LUN Setup page, add LUNs to the target group,
      edit the LUN assignments, or remove target LUNs from the group. After all
      desired changes have been made to the group, click
      <span class="guimenu">Next</span>.
     </p><p>
      For option information, see
      <a class="xref" href="#il.iscsi.target.target_group.options" title="Modify iSCSI Target: Options">Modify iSCSI Target: Options</a>.
     </p></li><li class="step "><p>
      On the Modify iSCSI Target Initiator Setup page, configure information
      for the initiators that are permitted to access LUNs in the target group.
      After all desired changes have been made to the group, click
      <span class="guimenu">Next</span>.
     </p></li><li class="step "><p>
      Click <span class="guimenu">Finish</span> to save and apply the settings.
     </p></li></ol></div></div></div><div class="sect2 " id="sec.iscsi.target.tg_delete"><div class="titlepage"><div><div><h3 class="title" id="sec.iscsi.target.tg_delete"><span class="number">14.2.6 </span><span class="name">Deleting an iSCSI LIO Target Group</span> <a title="Permalink" class="permalink" href="#sec.iscsi.target.tg_delete">#</a></h3></div></div></div><p>
    Deleting an iSCSI LIO target group removes the definition of the group, and
    the related setup for initiators, including LUN mappings and authentication
    credentials. It does not destroy the data on the partitions. To give
    initiators access again, you can allocate the target LUNs to a different or
    new target group, and configure the initiator access for them.
   </p><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
      Start YaST and launch <span class="guimenu">Network Services</span> › <span class="guimenu">iSCSI LIO Target</span>.
     </p></li><li class="step "><p>
      Switch to the <span class="guimenu">Targets</span> tab.
     </p></li><li class="step "><p>
      Select the iSCSI LIO target group to be deleted, then click
      <span class="guimenu">Delete</span>.
     </p></li><li class="step "><p>
      When you are prompted, click <span class="guimenu">Continue</span> to confirm the
      deletion, or click <span class="guimenu">Cancel</span> to cancel it.
     </p></li><li class="step "><p>
      Click <span class="guimenu">Finish</span> to save and apply the settings.
     </p></li></ol></div></div></div></div><div class="sect1 " id="sec.iscsi.initiator"><div class="titlepage"><div><div><h2 class="title" id="sec.iscsi.initiator"><span class="number">14.3 </span><span class="name">Configuring iSCSI Initiator</span> <a title="Permalink" class="permalink" href="#sec.iscsi.initiator">#</a></h2></div></div></div><p>
   The iSCSI initiator can be used to connect to any iSCSI target. This is not
   restricted to the iSCSI target solution explained in
   <a class="xref" href="#sec.iscsi.target" title="14.2. Setting Up an iSCSI LIO Target Server">Section 14.2, “Setting Up an iSCSI LIO Target Server”</a>. The
   configuration of iSCSI initiator involves two major steps: the discovery of
   available iSCSI targets and the setup of an iSCSI session. Both can be done
   with YaST.
  </p><div class="sect2 " id="sec.iscsi.initiator.yast"><div class="titlepage"><div><div><h3 class="title" id="sec.iscsi.initiator.yast"><span class="number">14.3.1 </span><span class="name">Using YaST for the iSCSI Initiator Configuration</span> <a title="Permalink" class="permalink" href="#sec.iscsi.initiator.yast">#</a></h3></div></div></div><p>
    The iSCSI Initiator Overview in YaST is divided into three tabs:
   </p><div class="variablelist "><dl class="variablelist"><dt id="idm139787668141328"><span class="term ">Service:</span></dt><dd><p>
       The <span class="guimenu">Service</span> tab can be used to enable the iSCSI
       initiator at boot time. It also offers to set a unique
       <span class="guimenu">Initiator Name</span> and an iSNS server to use for the
       discovery.
      </p></dd><dt id="idm139787668138496"><span class="term ">Connected Targets:</span></dt><dd><p>
       The <span class="guimenu">Connected Targets</span> tab gives an overview of the
       currently connected iSCSI targets. Like the <span class="guimenu">Discovered
       Targets</span> tab, it also gives the option to add new targets to
       the system.
      </p></dd><dt id="idm139787668135712"><span class="term ">Discovered Targets:</span></dt><dd><p>
       The <span class="guimenu">Discovered Targets</span> tab provides the possibility
       of manually discovering iSCSI targets in the network.
      </p></dd></dl></div><div class="sect3 " id="sec.iscsi.initiator.yast.configuration"><div class="titlepage"><div><div><h4 class="title" id="sec.iscsi.initiator.yast.configuration"><span class="number">14.3.1.1 </span><span class="name">Configuring the iSCSI Initiator</span> <a title="Permalink" class="permalink" href="#sec.iscsi.initiator.yast.configuration">#</a></h4></div></div></div><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
       Start YaST and launch <span class="guimenu">Network Services</span> › <span class="guimenu">iSCSI Initiator</span>.
      </p></li><li class="step "><p>
       Switch to the <span class="guimenu">Services</span> tab.
      </p><div class="informalfigure"><div class="mediaobject"><a xmlns="" href="images/iscsi_init_service_a.png"><img src="images/iscsi_init_service_a.png" width="" /></a></div></div></li><li class="step "><p>
       Under <span class="guimenu">Service Start</span>, specify how you want the iSCSI
       initiator service to be started:
      </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p><span class="formalpara-title">When Booting: </span>
          The service starts automatically on server restart.
         </p></li><li class="listitem "><p><span class="formalpara-title">Manually: </span>
          (Default) You must start the service manually after a server restart
          by running <code class="command">sudo systemctl start iscsi iscsid</code>.
         </p></li></ul></div></li><li class="step "><p>
       Specify or verify the <span class="guimenu">Initiator Name</span>.
      </p><p>
       Specify a well-formed iSCSI qualified name (IQN) for the iSCSI initiator
       on this server. The initiator name must be globally unique on your
       network. The IQN uses the following general format:
      </p><div class="verbatim-wrap"><pre class="screen">iqn.yyyy-mm.com.mycompany:n1:n2</pre></div><p>
       where n1 and n2 are alphanumeric characters. For example:
      </p><div class="verbatim-wrap"><pre class="screen">iqn.1996-04.de.suse:01:a5dfcea717a</pre></div><p>
       The <span class="guimenu">Initiator Name</span> is automatically completed with
       the corresponding value from the
       <code class="filename">/etc/iscsi/initiatorname.iscsi</code> file on the server.
      </p><p>
       If the server has iBFT (iSCSI Boot Firmware Table) support, the
       <span class="guimenu">Initiator Name</span> is completed with the corresponding
       value in the IBFT, and you are not able to change the initiator name in
       this interface. Use the BIOS Setup to modify it instead. The iBFT is a
       block of information containing various parameters useful to the iSCSI
       boot process, including iSCSI target and initiator descriptions for the
       server.
      </p></li><li class="step "><p>
       Use either of the following methods to discover iSCSI targets on the
       network.
      </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p><span class="formalpara-title">iSNS: </span>
          To use iSNS (Internet Storage Name Service) for discovering iSCSI
          targets, continue with
          <a class="xref" href="#sec.iscsi.initiator.yast.isn" title="14.3.1.2. Discovering iSCSI Targets by Using iSNS">Section 14.3.1.2, “Discovering iSCSI Targets by Using iSNS”</a>.
         </p></li><li class="listitem "><p><span class="formalpara-title">Discovered Targets: </span>
          To discover iSCSI target devices manually, continue with
          <a class="xref" href="#sec.iscsi.initiator.yast.discovered" title="14.3.1.3. Discovering iSCSI Targets Manually">Section 14.3.1.3, “Discovering iSCSI Targets Manually”</a>.
         </p></li></ul></div></li></ol></div></div></div><div class="sect3 " id="sec.iscsi.initiator.yast.isn"><div class="titlepage"><div><div><h4 class="title" id="sec.iscsi.initiator.yast.isn"><span class="number">14.3.1.2 </span><span class="name">Discovering iSCSI Targets by Using iSNS</span> <a title="Permalink" class="permalink" href="#sec.iscsi.initiator.yast.isn">#</a></h4></div></div></div><p>
     Before you can use this option, you must have already installed and
     configured an iSNS server in your environment. For information, see
     <a class="xref" href="#cha.isns" title="Chapter 13. iSNS for Linux">Chapter 13, <em>iSNS for Linux</em></a>.
    </p><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
       In YaST, select<span class="guimenu"> iSCSI Initiator</span>, then select the
       <span class="guimenu">Service</span> tab.
      </p></li><li class="step "><p>
       Specify the IP address of the iSNS server and port. The default port is
       3205.
      </p></li><li class="step "><p>
       Click <span class="guimenu">OK</span> to save and apply your changes.
      </p></li></ol></div></div></div><div class="sect3 " id="sec.iscsi.initiator.yast.discovered"><div class="titlepage"><div><div><h4 class="title" id="sec.iscsi.initiator.yast.discovered"><span class="number">14.3.1.3 </span><span class="name">Discovering iSCSI Targets Manually</span> <a title="Permalink" class="permalink" href="#sec.iscsi.initiator.yast.discovered">#</a></h4></div></div></div><p>
     Repeat the following process for each of the iSCSI target servers that you
     want to access from the server where you are setting up the iSCSI
     initiator.
    </p><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
       In YaST, select <span class="guimenu">iSCSI Initiator</span>, then select the
       <span class="guimenu">Discovered Targets</span> tab.
      </p></li><li class="step "><p>
       Click <span class="guimenu">Discovery</span> to open the iSCSI Initiator Discovery
       dialog.
      </p></li><li class="step "><p>
       Enter the IP address and change the port if needed. The default port is
       3260.
      </p></li><li class="step "><p>
       If authentication is required, deselect <span class="guimenu">No Discovery
       Authentication</span>, then specify the credentials for
       <span class="guimenu">Authentication by Initiator</span> or
       <span class="guimenu">Authentication by Targets</span>.
      </p></li><li class="step "><p>
       Click <span class="guimenu">Next</span> to start the discovery and connect to the
       iSCSI target server.
      </p></li><li class="step "><p>
       If credentials are required, after a successful discovery, use
       <span class="guimenu">Connect</span> to activate the target.
      </p><p>
       You are prompted for authentication credentials to use the selected
       iSCSI target.
      </p></li><li class="step "><p>
       Click <span class="guimenu">Next</span> to finish the configuration.
      </p><p>
       The target now appears in <span class="guimenu">Connected Targets</span> and the
       virtual iSCSI device is now available.
      </p></li><li class="step "><p>
       Click <span class="guimenu">OK</span> to save and apply your changes.
      </p></li><li class="step "><p>
       You can find the local device path for the iSCSI target device by using
       the <code class="command">lsscsi</code> command.
      </p></li></ol></div></div></div><div class="sect3 " id="sec.iscsi.initiator.yast.startup"><div class="titlepage"><div><div><h4 class="title" id="sec.iscsi.initiator.yast.startup"><span class="number">14.3.1.4 </span><span class="name">Setting the Start-up Preference for iSCSI Target Devices</span> <a title="Permalink" class="permalink" href="#sec.iscsi.initiator.yast.startup">#</a></h4></div></div></div><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
       In YaST, select<span class="guimenu"> iSCSI Initiator</span>, then select the
       <span class="guimenu">Connected Targets</span> tab to view a list of the iSCSI
       target devices that are currently connected to the server.
      </p></li><li class="step "><p>
       Select the iSCSI target device that you want to manage.
      </p></li><li class="step "><p>
       Click <span class="guimenu">Toggle Start-Up</span> to modify the setting:
      </p><p><span class="formalpara-title">Automatic: </span>
        This option is used for iSCSI targets that are to be connected when the
        iSCSI service itself starts up. This is the typical configuration.
       </p><p><span class="formalpara-title">Onboot: </span>
        This option is used for iSCSI targets that are to be connected during
        boot; that is, when root (<code class="filename">/</code>) is on iSCSI. As such,
        the iSCSI target device will be evaluated from the initrd on server
        boots. This option is ignored on platforms that cannot boot from
        iSCSI, such as IBM Z. Therefore it should not be used on these
        platforms; use <span class="guimenu">Automatic</span> instead.
       </p></li><li class="step "><p>
       Click <span class="guimenu">OK</span> to save and apply your changes.
      </p></li></ol></div></div></div></div><div class="sect2 " id="sec.iscsi.initiator.manually"><div class="titlepage"><div><div><h3 class="title" id="sec.iscsi.initiator.manually"><span class="number">14.3.2 </span><span class="name">Setting Up the iSCSI Initiator Manually</span> <a title="Permalink" class="permalink" href="#sec.iscsi.initiator.manually">#</a></h3></div></div></div><p>
    Both the discovery and the configuration of iSCSI connections require a
    running iscsid. When running the discovery the first time, the internal
    database of the iSCSI initiator is created in the directory
    <code class="filename">/etc/iscsi/</code>.
   </p><p>
    If your discovery is password protected, provide the authentication
    information to iscsid. Because the internal database does not exist when
    doing the first discovery, it cannot be used now. Instead, the
    configuration file <code class="filename">/etc/iscsid.conf</code> must be edited to
    provide the information. To add your password information for the
    discovery, add the following lines to the end of
    <code class="filename">/etc/iscsid.conf</code>:
   </p><div class="verbatim-wrap"><pre class="screen">discovery.sendtargets.auth.authmethod = CHAP
discovery.sendtargets.auth.username = <em class="replaceable ">USERNAME</em>
discovery.sendtargets.auth.password = <em class="replaceable ">PASSWORD</em></pre></div><p>
    The discovery stores all received values in an internal persistent
    database. In addition, it displays all detected targets. Run this discovery
    with the following command:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> iscsiadm <code class="option">-m discovery --type=st --portal=<em class="replaceable ">TARGET_IP</em></code></pre></div><p>
    The output should look like the following:
   </p><div class="verbatim-wrap"><pre class="screen">10.44.171.99:3260,1 iqn.2006-02.com.example.iserv:systems</pre></div><p>
    To discover the available targets on an <code class="literal">iSNS</code> server, use
    the following command:
   </p><div class="verbatim-wrap"><pre class="screen">sudo iscsiadm --mode discovery --type isns --portal <em class="replaceable ">TARGET_IP</em></pre></div><p>
    For each target defined on the iSCSI target, one line appears. For more
    information about the stored data, see
    <a class="xref" href="#sec.iscsi.initiator.database" title="14.3.3. The iSCSI Initiator Databases">Section 14.3.3, “The iSCSI Initiator Databases”</a>.
   </p><p>
    The special <code class="option">--login</code> option of <code class="command">iscsiadm</code>
    creates all needed devices:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> iscsiadm -m node -n iqn.2006-02.com.example.iserv:systems --login</pre></div><p>
    The newly generated devices show up in the output of
    <code class="command">lsscsi</code> and can now be mounted.
   </p></div><div class="sect2 " id="sec.iscsi.initiator.database"><div class="titlepage"><div><div><h3 class="title" id="sec.iscsi.initiator.database"><span class="number">14.3.3 </span><span class="name">The iSCSI Initiator Databases</span> <a title="Permalink" class="permalink" href="#sec.iscsi.initiator.database">#</a></h3></div></div></div><p>
    All information that was discovered by the iSCSI initiator is stored in two
    database files that reside in <code class="filename">/etc/iscsi</code>. There is one
    database for the discovery of targets and one for the discovered nodes.
    When accessing a database, you first must select if you want to get your
    data from the discovery or from the node database. Do this with the
    <code class="option">-m discovery</code> and <code class="option">-m node</code> parameters of
    <code class="command">iscsiadm</code>. Using <code class="command">iscsiadm</code> with one of
    these parameters gives an overview of the stored records:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> iscsiadm -m discovery
10.44.171.99:3260,1 iqn.2006-02.com.example.iserv:systems</pre></div><p>
    The target name in this example is
    <code class="literal">iqn.2006-02.com.example.iserv:systems</code>. This name is
    needed for all actions that relate to this special data set. To examine the
    content of the data record with the ID
    <code class="literal">iqn.2006-02.com.example.iserv:systems</code>, use the following
    command:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> iscsiadm -m node --targetname iqn.2006-02.com.example.iserv:systems
node.name = iqn.2006-02.com.example.iserv:systems
node.transport_name = tcp
node.tpgt = 1
node.active_conn = 1
node.startup = manual
node.session.initial_cmdsn = 0
node.session.reopen_max = 32
node.session.auth.authmethod = CHAP
node.session.auth.username = joe
node.session.auth.password = ********
node.session.auth.username_in = <em class="replaceable ">EMPTY</em>
node.session.auth.password_in = <em class="replaceable ">EMPTY</em>
node.session.timeo.replacement_timeout = 0
node.session.err_timeo.abort_timeout = 10
node.session.err_timeo.reset_timeout = 30
node.session.iscsi.InitialR2T = No
node.session.iscsi.ImmediateData = Yes
....</pre></div><p>
    To edit the value of one of these variables, use the command
    <code class="command">iscsiadm</code> with the <code class="option">update</code> operation. For
    example, if you want iscsid to log in to the iSCSI target when it
    initializes, set the variable <code class="option">node.startup</code> to the value
    <code class="option">automatic</code>:
   </p><div class="verbatim-wrap"><pre class="screen">sudo iscsiadm -m node -n iqn.2006-02.com.example.iserv:systems \
-p ip:port --op=update --name=node.startup --value=automatic</pre></div><p>
    Remove obsolete data sets with the <code class="literal">delete</code> operation. If
    the target <code class="literal">iqn.2006-02.com.example.iserv:systems</code> is no
    longer a valid record, delete this record with the following command:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> iscsiadm -m node -n iqn.2006-02.com.example.iserv:systems \
-p ip:port --op=delete</pre></div><div id="idm139787668036400" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.png" /><h6>Important: No Confirmation</h6><p>
     Use this option with caution because it deletes the record without any
     additional confirmation prompt.
    </p></div><p>
    To get a list of all discovered targets, run the <code class="command">sudo iscsiadm -m
    node</code> command.
   </p></div></div><div class="sect1 " id="sec.iscsi.installation"><div class="titlepage"><div><div><h2 class="title" id="sec.iscsi.installation"><span class="number">14.4 </span><span class="name">Using iSCSI Disks when Installing</span> <a title="Permalink" class="permalink" href="#sec.iscsi.installation">#</a></h2></div></div></div><p>
   Booting from an iSCSI disk on AMD64/Intel 64 and IBM POWER architectures
   is supported when iSCSI-enabled firmware is used.
  </p><p>
   To use iSCSI disks during installation, it is necessary to add the following
   parameter to the boot parameter line:
  </p><div class="verbatim-wrap"><pre class="screen">withiscsi=1</pre></div><p>
   During installation, an additional screen appears that provides the option
   to attach iSCSI disks to the system and use them in the installation
   process.
  </p><div id="idm139787668030416" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.png" /><h6>Note: Mount Point Support</h6><p>iSCSI devices will appear asynchronously during the
    boot process. While the initrd guarantees that those devices are
    set up correctly for the root file system, there are no such
    guarantees for any other file systems or mount points like
    <code class="filename">/usr</code>. Hence any system mount points like
    <code class="filename">/usr</code> or <code class="filename">/var</code> are not
    supported. To use those devices, ensure correct
    synchronization of the respective services and devices.</p></div></div><div class="sect1 " id="sec.iscsi.trouble"><div class="titlepage"><div><div><h2 class="title" id="sec.iscsi.trouble"><span class="number">14.5 </span><span class="name">Troubleshooting iSCSI</span> <a title="Permalink" class="permalink" href="#sec.iscsi.trouble">#</a></h2></div></div></div><p>
   This section describes some known issues and possible solutions for iSCSI
   target and iSCSI initiator issues.
  </p><div class="sect2 " id="sec.iscsi.trouble.no_service"><div class="titlepage"><div><div><h3 class="title" id="sec.iscsi.trouble.no_service"><span class="number">14.5.1 </span><span class="name">Portal Error When Setting Up Target LUNs on an iSCSI LIO Target Server</span> <a title="Permalink" class="permalink" href="#sec.iscsi.trouble.no_service">#</a></h3></div></div></div><p>
    When adding or editing an iSCSI LIO target group, you get an error:
   </p><div class="verbatim-wrap"><pre class="screen">Problem setting network portal <em class="replaceable ">IP_ADDRESS</em>:3260</pre></div><p>
    The <code class="filename">/var/log/YasT2/y2log</code> log file contains the
    following error:
   </p><div class="verbatim-wrap"><pre class="screen">find: `/sys/kernel/config/target/iscsi': No such file or directory</pre></div><p>
    This problem occurs if the iSCSI LIO Target Server software is not
    currently running. To resolve this issue, exit YaST, manually start iSCSI
    LIO at the command line with <code class="command">systemctl start target</code>,
    then try again.
   </p><p>
    You can also enter the following to check if <code class="command">configfs</code>,
    <code class="command">iscsi_target_mod</code>, and <code class="command">target_core_mod</code>
    are loaded. A sample response is shown.
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> lsmod | grep iscsi
iscsi_target_mod      295015  0
target_core_mod       346745  4
iscsi_target_mod,target_core_pscsi,target_core_iblock,target_core_file
configfs               35817  3 iscsi_target_mod,target_core_mod
scsi_mod              231620  16
iscsi_target_mod,target_core_pscsi,target_core_mod,sg,sr_mod,mptctl,sd_mod,
scsi_dh_rdac,scsi_dh_emc,scsi_dh_alua,scsi_dh_hp_sw,scsi_dh,libata,mptspi,
mptscsih,scsi_transport_spi</pre></div></div><div class="sect2 " id="sec.iscsi.trouble.not_visible"><div class="titlepage"><div><div><h3 class="title" id="sec.iscsi.trouble.not_visible"><span class="number">14.5.2 </span><span class="name">iSCSI LIO Targets Are Not Visible from Other Computers</span> <a title="Permalink" class="permalink" href="#sec.iscsi.trouble.not_visible">#</a></h3></div></div></div><p>
    If you use a firewall on the target server, you must open the iSCSI port
    that you are using to allow other computers to see the iSCSI LIO targets.
    For information, see <a class="xref" href="#sec.iscsi.target.start" title="14.2.1. iSCSI LIO Target Service Start-up and Firewall Settings">Section 14.2.1, “iSCSI LIO Target Service Start-up and Firewall Settings”</a>.
   </p></div><div class="sect2 " id="sec.iscsi.trouble.package_loss"><div class="titlepage"><div><div><h3 class="title" id="sec.iscsi.trouble.package_loss"><span class="number">14.5.3 </span><span class="name">Data Packets Dropped for iSCSI Traffic</span> <a title="Permalink" class="permalink" href="#sec.iscsi.trouble.package_loss">#</a></h3></div></div></div><p>
    A firewall might drop packets if it gets too busy. The default for the SUSE
    Firewall is to drop packets after three minutes. If you find that iSCSI
    traffic packets are being dropped, you can consider configuring the SUSE
    Firewall to queue packets instead of dropping them when it gets too busy.
   </p></div><div class="sect2 " id="sec.iscsi.trouble.lvm"><div class="titlepage"><div><div><h3 class="title" id="sec.iscsi.trouble.lvm"><span class="number">14.5.4 </span><span class="name">Using iSCSI Volumes with LVM</span> <a title="Permalink" class="permalink" href="#sec.iscsi.trouble.lvm">#</a></h3></div></div></div><p>
    Use the troubleshooting tips in this section when using LVM on iSCSI
    targets.
   </p><div class="sect3 " id="sec.iscsi.trouble.lvm.boot_initiator"><div class="titlepage"><div><div><h4 class="title" id="sec.iscsi.trouble.lvm.boot_initiator"><span class="number">14.5.4.1 </span><span class="name">Check if the iSCSI Initiator Discovery Occurs at Boot</span> <a title="Permalink" class="permalink" href="#sec.iscsi.trouble.lvm.boot_initiator">#</a></h4></div></div></div><p>
     When you set up the iSCSI Initiator, ensure that you enable discovery at
     boot time so that udev can discover the iSCSI devices at boot time and set
     up the devices to be used by LVM.
    </p></div><div class="sect3 " id="sec.iscsi.trouble.lvm.boot_target"><div class="titlepage"><div><div><h4 class="title" id="sec.iscsi.trouble.lvm.boot_target"><span class="number">14.5.4.2 </span><span class="name">Check that iSCSI Target Discovery Occurs at Boot</span> <a title="Permalink" class="permalink" href="#sec.iscsi.trouble.lvm.boot_target">#</a></h4></div></div></div><p>
     Remember that <code class="filename">udev</code> provides the default setup for
     devices. Ensure that all of the applications that create devices are
     started at boot time so that <code class="command">udev</code> can recognize and
     assign devices for them at system start-up. If the application or service
     is not started until later, <code class="command">udev</code> does not create the
     device automatically as it would at boot time.
    </p></div></div><div class="sect2 " id="sec.iscsi.trouble.mount"><div class="titlepage"><div><div><h3 class="title" id="sec.iscsi.trouble.mount"><span class="number">14.5.5 </span><span class="name">iSCSI Targets Are Mounted When the Configuration File Is Set to Manual</span> <a title="Permalink" class="permalink" href="#sec.iscsi.trouble.mount">#</a></h3></div></div></div><p>
    When Open-iSCSI starts, it can mount the targets even if the
    <code class="literal">node.startup</code> option is set to manual in the
    <code class="filename">/etc/iscsi/iscsid.conf</code> file if you manually modified
    the configuration file.
   </p><p>
    Check the
    <code class="filename">/etc/iscsi/nodes/<em class="replaceable ">TARGET_NAME</em>/<em class="replaceable ">IP_ADDRESS</em>,<em class="replaceable ">PORT</em>/default</code>
    file. It contains a <code class="literal">node.startup</code> setting that overrides
    the <code class="filename">/etc/iscsi/iscsid.conf</code> file. Setting the mount
    option to manual by using the YaST interface also sets
    <code class="literal">node.startup = manual</code> in the
    <code class="filename">/etc/iscsi/nodes/<em class="replaceable ">TARGET_NAME</em>/<em class="replaceable ">IP_ADDRESS</em>,<em class="replaceable ">PORT</em>/default
    </code>files.
   </p></div></div><div class="sect1 " id="sec.iscsi.terminology"><div class="titlepage"><div><div><h2 class="title" id="sec.iscsi.terminology"><span class="number">14.6 </span><span class="name">iSCSI LIO Target Terminology</span> <a title="Permalink" class="permalink" href="#sec.iscsi.terminology">#</a></h2></div></div></div><div class="variablelist "><dl class="variablelist"><dt id="idm139787667994880"><span class="term ">backstore</span></dt><dd><p>
      A physical storage object that provides the actual storage underlying an
      iSCSI endpoint.
     </p></dd><dt id="idm139787667992992"><span class="term ">CDB (command descriptor block)</span></dt><dd><p>
      The standard format for SCSI commands. CDBs are commonly 6, 10, or 12
      bytes long, though they can be 16 bytes or of variable length.
     </p></dd><dt id="idm139787667991056"><span class="term ">CHAP (Challenge Handshake Authentication Protocol)</span></dt><dd><p>
      A point-to-point protocol (PPP) authentication method used to confirm the
      identity of one computer to another. After the Link Control Protocol
      (LCP) connects the two computers, and the CHAP method is negotiated, the
      authenticator sends a random Challenge to the peer. The peer issues a
      cryptographically hashed Response that depends upon the Challenge and a
      secret key. The authenticator verifies the hashed Response against its
      own calculation of the expected hash value, and either acknowledges the
      authentication or terminates the connection. CHAP is defined in the RFC
      1994.
     </p></dd><dt id="idm139787667988608"><span class="term ">CID (connection identifier)</span></dt><dd><p>
      A 16‐bit number, generated by the initiator, that uniquely identifies a
      connection between two iSCSI devices. This number is presented during the
      login phase.
     </p></dd><dt id="idm139787667986624"><span class="term ">endpoint</span></dt><dd><p>
      The combination of an iSCSI Target Name with an iSCSI TPG (IQN + Tag).
     </p></dd><dt id="idm139787667984768"><span class="term ">EUI (extended unique identifier)</span></dt><dd><p>
      A 64‐bit number that uniquely identifies every device in the world. The
      format consists of 24 bits that are unique to a given company, and 40
      bits assigned by the company to each device it builds.
     </p></dd><dt id="idm139787667982752"><span class="term ">initiator</span></dt><dd><p>
      The originating end of an SCSI session. Typically a controlling device
      such as a computer.
     </p></dd><dt id="idm139787667980864"><span class="term ">IPS (Internet Protocol storage)</span></dt><dd><p>
      The class of protocols or devices that use the IP protocol to move data
      in a storage network. FCIP (Fibre Channel over Internet Protocol), iFCP
      (Internet Fibre Channel Protocol), and iSCSI (Internet SCSI) are all
      examples of IPS protocols.
     </p></dd><dt id="idm139787667978800"><span class="term ">IQN (iSCSI qualified name)</span></dt><dd><p>
      A name format for iSCSI that uniquely identifies every device in the
      world (for example:
      <code class="filename">iqn.5886.com.acme.tapedrive.sn‐a12345678</code>).
     </p></dd><dt id="idm139787667976416"><span class="term ">ISID (initiator session identifier)</span></dt><dd><p>
      A 48‐bit number, generated by the initiator, that uniquely identifies a
      session between the initiator and the target. This value is created
      during the login process, and is sent to the target with a Login PDU.
     </p></dd><dt id="idm139787667974384"><span class="term ">MCS (multiple connections per session)</span></dt><dd><p>
      A part of the iSCSI specification that allows multiple TCP/IP connections
      between an initiator and a target.
     </p></dd><dt id="idm139787667972464"><span class="term ">MPIO (multipath I/O)</span></dt><dd><p>
      A method by which data can take multiple redundant paths between a server
      and storage.
     </p></dd><dt id="idm139787667970576"><span class="term ">network portal</span></dt><dd><p>
      The combination of an iSCSI endpoint with an IP address plus a TCP
      (Transmission Control Protocol) port. TCP port 3260 is the port number
      for the iSCSI protocol, as defined by IANA (Internet Assigned Numbers
      Authority).
     </p></dd><dt id="idm139787667968544"><span class="term ">SAM (SCSI architectural model)</span></dt><dd><p>
      A document that describes the behavior of SCSI in general terms, allowing
      for different types of devices communicating over various media.
     </p></dd><dt id="idm139787667966592"><span class="term ">target</span></dt><dd><p>
      The receiving end of an SCSI session, typically a device such as a disk
      drive, tape drive, or scanner.
     </p></dd><dt id="idm139787667964688"><span class="term ">target group (TG)</span></dt><dd><p>
      A list of SCSI target ports that are all treated the same when creating
      views. Creating a view can help simplify LUN (logical unit number)
      mapping. Each view entry specifies a target group, host group, and a LUN.
     </p></dd><dt id="idm139787667962672"><span class="term ">target port</span></dt><dd><p>
      The combination of an iSCSI endpoint with one or more LUNs.
     </p></dd><dt id="idm139787667960816"><span class="term ">target port group (TPG)</span></dt><dd><p>
      A list of IP addresses and TCP port numbers that determines which
      interfaces a specific iSCSI target will listen to.
     </p></dd><dt id="idm139787667958912"><span class="term ">target session identifier (TSID)</span></dt><dd><p>
      A 16‐bit number, generated by the target, that uniquely identifies a
      session between the initiator and the target. This value is created
      during the login process, and is sent to the initiator with a Login
      Response PDU (protocol data units).
     </p></dd></dl></div></div><div class="sect1 " id="sec.iscsi.info"><div class="titlepage"><div><div><h2 class="title" id="sec.iscsi.info"><span class="number">14.7 </span><span class="name">Additional Information</span> <a title="Permalink" class="permalink" href="#sec.iscsi.info">#</a></h2></div></div></div><p>
   The iSCSI protocol has been available for several years. There are many
   reviews comparing iSCSI with SAN solutions, benchmarking performance, and
   there also is documentation describing hardware solutions. For more
   information, see Open-iSCSI project homepage at
   <a class="link" href="http://www.open-iscsi.com/" target="_blank">http://www.open-iscsi.com/</a>.
  </p><p>
   Additionally, see the man pages for
   <code class="command">iscsiadm</code>, <code class="command">iscsid</code>,
   <code class="filename">ietd.conf</code>, and <code class="command">ietd</code> and the example
   configuration file <code class="filename">/etc/iscsid.conf</code>.
  </p></div></div><div xml:lang="en" class="chapter " id="cha.fcoe" lang="en"><div class="titlepage"><div><div><h2 class="title"><span class="number">15 </span><span class="name">Fibre Channel Storage over Ethernet Networks: FCoE</span> <a title="Permalink" class="permalink" href="#cha.fcoe">#</a></h2><div class="doc-status"><ul><li><span class="ds-label">Filename: </span>storage_fcoe.xml</li><li><span class="ds-label">ID: </span>cha.fcoe</li></ul></div></div></div></div><div class="line"><div class="toc"><dl><dt><span class="sect1"><a href="#sec.fcoe.installation"><span class="number">15.1 </span><span class="name">Configuring FCoE Interfaces during the Installation</span></a></span></dt><dt><span class="sect1"><a href="#sec.fcoe.install"><span class="number">15.2 </span><span class="name">Installing FCoE and the YaST FCoE Client</span></a></span></dt><dt><span class="sect1"><a href="#sec.fcoe.yast"><span class="number">15.3 </span><span class="name">Managing FCoE Services with YaST</span></a></span></dt><dt><span class="sect1"><a href="#sec.fcoe.cli"><span class="number">15.4 </span><span class="name">Configuring FCoE with Commands</span></a></span></dt><dt><span class="sect1"><a href="#sec.fcoe.admin"><span class="number">15.5 </span><span class="name">Managing FCoE Instances with the FCoE Administration Tool</span></a></span></dt><dt><span class="sect1"><a href="#sec.fcoe.info"><span class="number">15.6 </span><span class="name">Additional Information</span></a></span></dt></dl></div></div><p>
  Many enterprise data centers rely on Ethernet for their LAN and data traffic,
  and on Fibre Channel networks for their storage infrastructure. Open Fibre
  Channel over Ethernet (FCoE) Initiator software allows servers with Ethernet
  adapters to connect to a Fibre Channel storage subsystem over an Ethernet
  network. This connectivity was previously reserved exclusively for systems
  with Fibre Channel adapters over a Fibre Channel fabric. The FCoE technology
  reduces complexity in the data center by aiding network convergence. This
  helps to preserve your existing investments in a Fibre Channel storage
  infrastructure and to simplify network management.
 </p><div class="figure" id="idm139787667944960"><div class="figure-contents"><div class="mediaobject"><a xmlns="" href="images/fcoe_san_a.png"><img src="images/fcoe_san_a.png" width="" alt="Open Fibre Channel over Ethernet SAN" /></a></div></div><div class="figure-title-wrap"><h6 class="figure-title"><span class="number">Figure 15.1: </span><span class="name">Open Fibre Channel over Ethernet SAN </span><a title="Permalink" class="permalink" href="#idm139787667944960">#</a></h6></div></div><p>
  Open-FCoE allows you to run the Fibre Channel protocols on the host, instead
  of on proprietary hardware on the host bus adapter. It is targeted for 10
  Gbps (gigabit per second) Ethernet adapters, but can work on any Ethernet
  adapter that supports pause frames. The initiator software provides a Fibre
  Channel protocol processing module and an Ethernet-based transport module.
  The Open-FCoE module acts as a low-level driver for SCSI. The Open-FCoE
  transport uses <code class="command">net_device</code> to send and receive packets.
  Data Center Bridging (DCB) drivers provide the quality of service for FCoE.
 </p><p>
  FCoE is an encapsulation protocol that moves the Fibre Channel protocol
  traffic over Ethernet connections without changing the Fibre Channel frame.
  This allows your network security and traffic management infrastructure to
  work the same with FCoE as it does with Fibre Channel.
 </p><p>
  You might choose to deploy FCoE in your enterprise if the following
  conditions exist:
 </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
    Your enterprise already has a Fibre Channel storage subsystem and
    administrators with Fibre Channel skills and knowledge.
   </p></li><li class="listitem "><p>
    You are deploying 10 Gbps Ethernet in the network.
   </p></li></ul></div><p>
  This section describes how to set up FCoE in your network.
 </p><div class="sect1 " id="sec.fcoe.installation"><div class="titlepage"><div><div><h2 class="title" id="sec.fcoe.installation"><span class="number">15.1 </span><span class="name">Configuring FCoE Interfaces during the Installation</span> <a title="Permalink" class="permalink" href="#sec.fcoe.installation">#</a></h2></div></div></div><p>
   The YaST installation for <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> allows you to configure FCoE disks
   during the operating system installation if FCoE is enabled at the switch
   for the connections between the server and the Fibre Channel storage
   infrastructure. Some system BIOS types can automatically detect the FCoE
   disks, and report the disks to the YaST Installation software. However,
   automatic detection of FCoE disks is not supported by all BIOS types. To
   enable automatic detection in this case, you can add the
   <code class="option">withfcoe</code> option to the kernel command line when you begin
   the installation:
  </p><div class="verbatim-wrap"><pre class="screen">withfcoe=1</pre></div><p>
   When the FCoE disks are detected, the YaST installation offers the option
   to configure FCoE instances at that time. On the Disk Activation page,
   select <span class="guimenu">Configure FCoE Interfaces</span> to access the FCoE
   configuration. For information about configuring the FCoE interfaces, see
   <a class="xref" href="#sec.fcoe.yast" title="15.3. Managing FCoE Services with YaST">Section 15.3, “Managing FCoE Services with YaST”</a>.
  </p><div class="informalfigure"><div class="mediaobject"><a xmlns="" href="images/fcoe_inst_disk_activation_a.png"><img src="images/fcoe_inst_disk_activation_a.png" width="" /></a></div></div><div id="idm139787667923040" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.png" /><h6>Note: Mount Point Support</h6><p>FCoE devices will appear asynchronously during the
    boot process. While the initrd guarantees that those devices are
    set up correctly for the root file system, there are no such
    guarantees for any other file systems or mount points like
    <code class="filename">/usr</code>. Hence any system mount points like
    <code class="filename">/usr</code> or <code class="filename">/var</code> are not
    supported. To use those devices, ensure correct
    synchronization of the respective services and devices.</p></div></div><div class="sect1 " id="sec.fcoe.install"><div class="titlepage"><div><div><h2 class="title" id="sec.fcoe.install"><span class="number">15.2 </span><span class="name">Installing FCoE and the YaST FCoE Client</span> <a title="Permalink" class="permalink" href="#sec.fcoe.install">#</a></h2></div></div></div><p>
   You can set up FCoE disks in your storage infrastructure by enabling FCoE at
   the switch for the connections to a server. If FCoE disks are available when
   the <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> operating system is installed, the FCoE Initiator software
   is automatically installed at that time.
  </p><p>
   If the FCoE Initiator software and the YaST FCoE Client software are not
   installed, use the following procedure to manually install them with the
   following command:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> zypper in yast2-fcoe-client fcoe-utils</pre></div><p>
   Alternatively, use the YaST Software Manager to install the packages
   listed above.
  </p></div><div class="sect1 " id="sec.fcoe.yast"><div class="titlepage"><div><div><h2 class="title" id="sec.fcoe.yast"><span class="number">15.3 </span><span class="name">Managing FCoE Services with YaST</span> <a title="Permalink" class="permalink" href="#sec.fcoe.yast">#</a></h2></div></div></div><p>
   You can use the YaST FCoE Client Configuration option to create,
   configure, and remove FCoE interfaces for the FCoE disks in your Fibre
   Channel storage infrastructure. To use this option, the FCoE Initiator
   service (the <code class="systemitem">fcoemon</code> daemon) and the
   Link Layer Discovery Protocol agent daemon
   (<code class="systemitem">llpad</code>) must be installed and
   running, and the FCoE connections must be enabled at the FCoE-capable
   switch.
  </p><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
     Launch YaST and select <span class="guimenu">Network
     Services</span> › <span class="guimenu">FCoE Client
     Configuration</span>.
    </p><div class="informalfigure"><div class="mediaobject"><a xmlns="" href="images/fcoe_services_a.png"><img src="images/fcoe_services_a.png" width="" /></a></div></div></li><li class="step "><p>
     On the <span class="guimenu">Services</span> tab, view or modify the FCoE service
     and Lldpad (Link Layer Discovery Protocol agent daemon) service start time
     as necessary.
    </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p><span class="formalpara-title">FCoE Service Start: </span>
        Specifies whether to start the Fibre Channel over Ethernet service
        <code class="command">fcoemon</code> daemon at the server boot time or manually.
        The daemon controls the FCoE interfaces and establishes a connection
        with the <code class="systemitem">llpad</code> daemon. The
        values are <span class="guimenu">When Booting</span> (default) or
        <span class="guimenu">Manually</span>.
       </p></li><li class="listitem "><p><span class="formalpara-title">Lldpad Service Start: </span>
        Specifies whether to start the Link Layer Discovery Protocol agent
        <code class="systemitem">llpad</code> daemon at the server boot
        time or manually. The <code class="systemitem">llpad</code>
        daemon informs the <code class="command">fcoemon</code> daemon about the Data
        Center Bridging features and the configuration of the FCoE interfaces.
        The values are <span class="guimenu">When Booting</span> (default) or
        <span class="guimenu">Manually</span>.
       </p></li></ul></div><p>
     If you modify a setting, click <span class="guimenu">OK</span> to save and apply the
     change.
    </p></li><li class="step "><p>
     On the <span class="guimenu">Interfaces</span> tab, view information about all of
     the detected network adapters on the server, including information about
     VLAN and FCoE configuration. You can also create an FCoE VLAN interface,
     change settings for an existing FCoE interface, or remove an FCoE
     interface.
    </p><div class="informalfigure"><div class="mediaobject"><a xmlns="" href="images/fcoe_notconfig_interface_a.png"><img src="images/fcoe_notconfig_interface_a.png" width="" /></a></div></div><p>
     Use the <span class="guimenu">FCoE VLAN Interface</span> column to determine whether
     FCoE is available or not:
    </p><div class="variablelist "><dl class="variablelist"><dt id="idm139787667884816"><span class="term "><em class="replaceable ">Interface Name</em>
      </span></dt><dd><p>
        If a name is assigned to the interface, such as
        <code class="filename">eth4.200</code>, FCoE is available on the switch, and the
        FCoE interface is activated for the adapter.
       </p></dd><dt id="idm139787667882160"><span class="term ">Not Configured:</span></dt><dd><p>
        If the status is <span class="guimenu">not configured</span>, FCoE is enabled on
        the switch, but an FCoE interface has not been activated for the
        adapter. Select the adapter, then click <span class="guimenu">Create FCoE VLAN
        Interface</span> to activate the interface on the adapter.
       </p></dd><dt id="idm139787667879280"><span class="term ">Not Available:</span></dt><dd><p>
        If the status is <span class="guimenu">not available</span>, FCoE is not possible
        for the adapter because FCoE has not been enabled for that connection
        on the switch.
       </p></dd></dl></div></li><li class="step "><p>
     To set up an FCoE-enabled adapter that has not yet been configured, select
     it and click <span class="guimenu">Create FCoE VLAN Interface</span>. Confirm the
     query with <span class="guimenu">Yes</span>.
    </p><p>
     The adapter is now listed with an interface name in the <span class="guimenu">FCoE VLAN
     Interface</span> column.
    </p></li><li class="step "><p>
     To change the settings for an adapter that is already configured, select
     it from the list, then click <span class="guimenu">Change Settings</span>.
    </p><p>
     The following options can be configured:
    </p><div class="variablelist "><dl class="variablelist"><dt id="idm139787667871680"><span class="term "><span class="guimenu">FCoE Enable</span>
      </span></dt><dd><p>
        Enable or disable the creation of FCoE instances for the adapter.
       </p></dd><dt id="idm139787667869536"><span class="term "><span class="guimenu">DCB Required</span>
      </span></dt><dd><p>
        Specifies whether Data Center Bridging is required for the adapter
        (usually this is the case).
       </p></dd><dt id="idm139787667867360"><span class="term "><span class="guimenu">Auto VLAN</span>
      </span></dt><dd><p>
        Specifies whether the <code class="systemitem">fcoemon</code>
        daemon creates the VLAN interfaces automatically.
       </p></dd></dl></div><p>
     If you modify a setting, click <span class="guimenu">Next</span> to save and apply
     the change. The settings are written to the
     <code class="filename">/etc/fcoe/cfg-eth<em class="replaceable ">X</em></code> file.
     The <code class="systemitem">fcoemon</code> daemon reads the
     configuration files for each FCoE interface when it is initialized.
    </p></li><li class="step "><p>
     To remove an interface that is already configured, select it from the
     list. Click <span class="guimenu">Remove Interface</span> and
     <span class="guimenu">Continue</span> to confirm. The FCoE Interface value changes
     to <span class="guimenu">not configured</span>.
    </p></li><li class="step "><p>
     On the <span class="guimenu">Configuration</span> tab, view or modify the general
     settings for the FCoE system service. You can enable or disable debugging
     messages from the FCoE service script and the
     <code class="systemitem">fcoemon</code> daemon and specify whether
     messages are sent to the system log.
    </p><div class="informalfigure"><div class="mediaobject"><a xmlns="" href="images/fcoe_configtab_a.png"><img src="images/fcoe_configtab_a.png" width="" /></a></div></div></li><li class="step "><p>
     Click <span class="guimenu">OK</span> to save and apply changes.
    </p></li></ol></div></div></div><div class="sect1 " id="sec.fcoe.cli"><div class="titlepage"><div><div><h2 class="title" id="sec.fcoe.cli"><span class="number">15.4 </span><span class="name">Configuring FCoE with Commands</span> <a title="Permalink" class="permalink" href="#sec.fcoe.cli">#</a></h2></div></div></div><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
     Open a terminal console.
    </p></li><li class="step "><p>
     Use YaST to configure the Ethernet network interface card, such as
     <code class="filename">eth2</code>.
    </p></li><li class="step "><p>
     Start the Link Layer Discovery Protocol agent daemon
     (<code class="systemitem">llpad</code>).
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> systemctl start lldpad</pre></div></li><li class="step "><p class="intro">
     Enable Data Center Bridging on your Ethernet adapter.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code>dcbtool sc eth2 dcb on
  Version:       2
  Command:       Set Config
  Feature:       DCB State
  Port:          eth2
  Status:        Successful</pre></div></li><li class="step "><p>
     Enable and set the Priority Flow Control (PFC) settings for Data Center
     Bridging.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> dcbtool sc eth&lt;x&gt; pfc e:1 a:1 w:1</pre></div><p>
     Argument setting values are:
    </p><div class="variablelist "><dl class="variablelist"><dt id="bynkj1s"><span class="term ">e:&lt;0|1&gt;</span></dt><dd><p>
        Controls feature enablement.
       </p></dd><dt id="bynkjej"><span class="term ">a:&lt;0|1&gt;</span></dt><dd><p>
        Controls whether the feature is advertised via Data Center Bridging
        Exchange protocol to the peer.
       </p></dd><dt id="bynkjy8"><span class="term ">w:&lt;0|1&gt;</span></dt><dd><p>
        Controls whether the feature is willing to change its operational
        configuration based on what is received from the peer.
       </p></dd></dl></div></li><li class="step "><p>
     Enable the Data Center Bridging to accept the switch’s priority setting
     for FCoE.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> dcbtool sc eth2 app:fcoe e:1
  Version:       2
  Command:       Set Config
  Feature:       Application FCoE
  Port:          eth2
  Status:        Successful</pre></div></li><li class="step "><p>
     Copy the default FCoE configuration file to
     <code class="filename">/etc/fcoe/cfg-eth2</code>.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> cp /etc/fcoe/cfg-ethx /etc/fcoe/cfg-eth2</pre></div></li><li class="step "><p>
     Start the FCoE Initiator service.
    </p><div class="verbatim-wrap"><pre class="screen">systemctl start fcoe.service</pre></div></li><li class="step "><p>
     Set up the Link Layer Discovery Protocol agent daemon
     (<code class="systemitem">llpad</code>) and the FCoE Initiator
     service to start when booting.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code>systemctl enable llpad fcoe</pre></div></li></ol></div></div></div><div class="sect1 " id="sec.fcoe.admin"><div class="titlepage"><div><div><h2 class="title" id="sec.fcoe.admin"><span class="number">15.5 </span><span class="name">Managing FCoE Instances with the FCoE Administration Tool</span> <a title="Permalink" class="permalink" href="#sec.fcoe.admin">#</a></h2></div></div></div><p>
   The <code class="command">fcoeadm</code> utility is the Fibre Channel over Ethernet
   (FCoE) management tool. It can be used to create, destroy, and reset an FCoE
   instance on a given network interface. The <code class="command">fcoeadm</code>
   utility sends commands to a running
   <code class="systemitem">fcoemon</code> process via a socket
   interface. For information about <code class="command">fcoemon</code>, see the
   <code class="command">man 8 fcoemon</code>.
  </p><p>
   The <code class="command">fcoeadm</code> utility allows you to query the FCoE
   instances about the following:
  </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
     Interfaces
    </p></li><li class="listitem "><p>
     Target LUNs
    </p></li><li class="listitem "><p>
     Port statistics
    </p></li></ul></div><p>
   The <code class="command">fcoeadm</code> utility is part of the
   <code class="filename">fcoe-utils</code> package. The general syntax for the command
   looks like the following:
  </p><div class="verbatim-wrap"><pre class="screen">fcoeadm
  [-c|--create] [&lt;ethX&gt;]
  [-d|--destroy] [&lt;ethX&gt;]
  [-r|--reset] [&lt;ethX&gt;]
  [-S|--Scan] [&lt;ethX&gt;]
  [-i|--interface] [&lt;ethX&gt;]
  [-t|--target] [&lt;ethX&gt;]
  [-l|--lun] [&lt;ethX&gt;]
  [-s|--stats &lt;ethX&gt;] [&lt;interval&gt;]
  [-v|--version]
  [-h|--help]</pre></div><p>
   Refer to <code class="command">man 8 fcoeadm</code> for details.
  </p><div class="sect1 bridgehead"><h2 class="title" id="idm139787667811552"><span class="name">Examples</span><a title="Permalink" class="permalink" href="#idm139787667811552">#</a></h2></div><div class="variablelist "><dl class="variablelist"><dt id="idm139787667810816"><span class="term "><code class="command">fcoeadm -c eth2.101</code>
    </span></dt><dd><p>
      Create an FCoE instance on eth2.101.
     </p></dd><dt id="idm139787667808704"><span class="term "><code class="command">fcoeadm -d eth2.101</code>
    </span></dt><dd><p>
      Destroy an FCoE instance on eth2.101.
     </p></dd><dt id="idm139787667806592"><span class="term "><code class="command">fcoeadm -i eth3</code>
    </span></dt><dd><p>
      Show information about all of the FCoE instances on interface
      <code class="literal">eth3</code>. If no interface is specified, information for
      all interfaces that have FCoE instances created will be shown. The
      following example shows information on connection eth0.201:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> fcoeadm -i eth0.201
  Description:      82599EB 10-Gigabit SFI/SFP+ Network Connection
  Revision:         01
  Manufacturer:     Intel Corporation
  Serial Number:    001B219B258C
  Driver:           ixgbe 3.3.8-k2
  Number of Ports:  1

      Symbolic Name:     fcoe v0.1 over eth0.201
      OS Device Name:    host8
      Node Name:         0x1000001B219B258E
      Port Name:         0x2000001B219B258E
      FabricName:        0x2001000573D38141
      Speed:             10 Gbit
      Supported Speed:   10 Gbit
      MaxFrameSize:      2112
      FC-ID (Port ID):   0x790003
      State:             Online</pre></div></dd><dt id="idm139787667802208"><span class="term "><code class="command">fcoeadm -l eth3.101</code>
    </span></dt><dd><p>
      Show detailed information about all of the LUNs discovered on connection
      eth3.101. If no connection is specified, information about all of the
      LUNs discovered on all FCoE connections will be shown.
     </p></dd><dt id="idm139787667799920"><span class="term "><code class="command">fcoeadm -r eth2.101</code>
    </span></dt><dd><p>
      Reset the FCoE instance on eth2.101.
     </p></dd><dt id="idm139787667797808"><span class="term "><code class="command">fcoeadm -s eth3 3</code>
    </span></dt><dd><p>
      Show statistical information about a specific eth3 port that has FCoE
      instances, at an interval of three seconds. The statistics are displayed
      one line per time interval. If no interval is given, the default of one
      second is used.
     </p></dd><dt id="idm139787667795488"><span class="term "><code class="command">fcoeadm -t eth3</code>
    </span></dt><dd><p>
      Show information about all of the discovered targets from a given eth3
      port having FCoE instances. After each discovered target, any associated
      LUNs are listed. If no instance is specified, targets from all of the
      ports that have FCoE instances are shown. The following example shows
      information of targets from the eth0.201 connection:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> fcoeadm -t eth0.201
  Interface:        eth0.201
  Roles:            FCP Target
  Node Name:        0x200000D0231B5C72
  Port Name:        0x210000D0231B5C72
  Target ID:        0
  MaxFrameSize:     2048
  OS Device Name:   rport-8:0-7
  FC-ID (Port ID):  0x79000C
  State:            Online

LUN ID  Device Name   Capacity   Block Size  Description
------  -----------  ----------  ----------  ----------------------------
    40  /dev/sdqi     792.84 GB      512     IFT DS S24F-R2840-4 (rev 386C)
    72  /dev/sdpk     650.00 GB      512     IFT DS S24F-R2840-4 (rev 386C)
   168  /dev/sdgy       1.30 TB      512     IFT DS S24F-R2840-4 (rev 386C)</pre></div></dd></dl></div></div><div class="sect1 " id="sec.fcoe.info"><div class="titlepage"><div><div><h2 class="title" id="sec.fcoe.info"><span class="number">15.6 </span><span class="name">Additional Information</span> <a title="Permalink" class="permalink" href="#sec.fcoe.info">#</a></h2></div></div></div><p>
   For information, see the follow documentation:
  </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
     For information about the Open-FCoE service daemon, see the
     <code class="command">fcoemon(8)</code> man page.
    </p></li><li class="listitem "><p>
     For information about the Open-FCoE Administration tool, see the
     <code class="command">fcoeadm(8)</code> man page.
    </p></li><li class="listitem "><p>
     For information about the Data Center Bridging Configuration tool, see the
     <code class="command">dcbtool(8)</code> man page.
    </p></li><li class="listitem "><p>
     For information about the Link Layer Discovery Protocol agent daemon, see
     the <code class="filename">lldpad(8)</code> man page.
    </p></li><li class="listitem "><p>
     For general information, see the Open-FCoE home page:
     <a class="link" href="http://www.open-fcoe.org/dokuwiki/start" target="_blank">http://www.open-fcoe.org/dokuwiki/start</a>.
    </p></li></ul></div></div></div><div xml:lang="en" class="chapter " id="cha.nvmeof" lang="en"><div class="titlepage"><div><div><h2 class="title"><span class="number">16 </span><span class="name">NVMe over Fabric</span> <a title="Permalink" class="permalink" href="#cha.nvmeof">#</a></h2><div class="doc-status"><ul><li><span class="ds-label">Filename: </span>storage_nvmeof.xml</li><li><span class="ds-label">ID: </span>cha.nvmeof</li></ul></div></div><div><div class="abstract"><div class="abstract-title-wrap"><h6 class="abstract-title">Abstract<a title="Permalink" class="permalink" href="#idm139787667776704">#</a></h6></div><p>
    This chapter describes how to set up an NVMe over Fabric host and target.
   </p></div></div></div></div><div class="line"><div class="toc"><dl><dt><span class="sect1"><a href="#cha.nvmeof.overview"><span class="number">16.1 </span><span class="name">Overview</span></a></span></dt><dt><span class="sect1"><a href="#sec.nvmeof.host_configuration"><span class="number">16.2 </span><span class="name">Setting Up an NVMe over Fabric Host</span></a></span></dt><dt><span class="sect1"><a href="#sec.nvmeof.target_configuration"><span class="number">16.3 </span><span class="name">Setting Up an NVMe over Fabric Target</span></a></span></dt><dt><span class="sect1"><a href="#cha.nvmeof.more_information"><span class="number">16.4 </span><span class="name">More Information</span></a></span></dt></dl></div></div><div class="sect1 " id="cha.nvmeof.overview"><div class="titlepage"><div><div><h2 class="title" id="cha.nvmeof.overview"><span class="number">16.1 </span><span class="name">Overview</span> <a title="Permalink" class="permalink" href="#cha.nvmeof.overview">#</a></h2></div></div></div><p>
   <span class="emphasis"><em>NVM Express</em></span> (<span class="emphasis"><em>NVMe</em></span>) is an
   interface standard for accessing non-volatile storage, commonly SSD
   disks. NVMe supports much higher speeds and has a lower latency
   than SATA.
  </p><p>
   <span class="emphasis"><em>NVMe over Fabric</em></span> is an architecture to access NVMe
   storage over different networking fabrics, for example
   <span class="emphasis"><em>RDMA</em></span> or <span class="emphasis"><em>NVMe over Fibre
   Channel</em></span> (<span class="emphasis"><em>FC-NVMe</em></span>). The role of
   NVMe over Fabric is similar to iSCSI. To increase the fault-tolerance,
   NVMe over Fabric has a built-in support for multipathing. The NVMe over Fabric
   multipathing is not based on the traditional DM-Multipathing.
  </p><p>
   The <span class="emphasis"><em>NVMe host</em></span> is the machine that connects to
   an NVMe target. The <span class="emphasis"><em>NVMe target</em></span> is the
   machine that shares it's NVMe block devices.
  </p><p>
   NVMe is supported on SUSE Linux Enterprise Server <span class="productnumber"><span class="phrase">15</span></span>. There are Kernel
   modules available for the NVMe block storage and NVMe over Fabric target
   and host.
  </p></div><div class="sect1 " id="sec.nvmeof.host_configuration"><div class="titlepage"><div><div><h2 class="title" id="sec.nvmeof.host_configuration"><span class="number">16.2 </span><span class="name">Setting Up an NVMe over Fabric Host</span> <a title="Permalink" class="permalink" href="#sec.nvmeof.host_configuration">#</a></h2></div></div></div><p>
   To use NVMe over Fabric, a target must be available with one of the
   supported networking methods. Supported are NVMe over Fibre
   Channel and RDMA. The following sections describe how to connect a
   host to a NVMe target.
  </p><div class="sect2 " id="sec.nvmeof.host_configuration.cli"><div class="titlepage"><div><div><h3 class="title" id="sec.nvmeof.host_configuration.cli"><span class="number">16.2.1 </span><span class="name">Installing Command Line Client</span> <a title="Permalink" class="permalink" href="#sec.nvmeof.host_configuration.cli">#</a></h3></div></div></div><p>
    To use NVMe over Fabric, you need the <code class="command">nvme</code> command line
    tool. Install it with <code class="command">zypper</code>:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> <code class="command">zypper in nvme-cli</code></pre></div><p>
    Use <code class="command">nvme --help</code> to list all available
    subcommands. Man pages are available for <code class="command">nvme</code>
    subcommands. Consult them by executing <code class="command">man
    nvme-<em class="replaceable ">SUBCOMMAND</em></code>. For example,
    to view the man page for the <code class="option">discover</code> subcommand,
    execute <code class="command">man nvme-discover</code>.
   </p></div><div class="sect2 " id="sec.nvmeof.host_configuration.target_discovery"><div class="titlepage"><div><div><h3 class="title" id="sec.nvmeof.host_configuration.target_discovery"><span class="number">16.2.2 </span><span class="name">Discovering NVMe over Fabric Targets</span> <a title="Permalink" class="permalink" href="#sec.nvmeof.host_configuration.target_discovery">#</a></h3></div></div></div><p>
    To list available NVMe subsystems on the NVMe over Fabric target, you need
    the discovery controller address and service ID.
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> <code class="command">nvme discover -t <em class="replaceable ">TRANSPORT</em> -a <em class="replaceable ">DISCOVERY_CONTROLLER_ADDRESS</em> -s <em class="replaceable ">SERVICE_ID</em></code></pre></div><p>
    Replace <em class="replaceable ">TRANSPORT</em> with the underlying
    transport medium: <code class="option">loop</code>, <code class="option">rdma</code> or
    <code class="option">fc</code>. Replace
    <em class="replaceable ">DISCOVERY_CONTROLLER_ADDRESS</em> with the
    address of the discovery controller. For RDMA this should be an
    IPv4 address. Replace <em class="replaceable ">SERVICE_ID</em> with
    the transport service ID. If the service is IP based, like RDMA,
    service ID specifies the port number. For Fibre Channel, the service
    ID is not required.
   </p><p>
    The NVMe hosts only see the subsystems they are allowed to connect
    to.
   </p><p>
    Example:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> <code class="command">nvme discover -t rdma -a 10.0.0.1 -s 4420</code></pre></div><p>
    For more details, see <code class="command">man nvme-discover</code>.
   </p></div><div class="sect2 " id="sec.nvmeof.host_configuration.connect_target"><div class="titlepage"><div><div><h3 class="title" id="sec.nvmeof.host_configuration.connect_target"><span class="number">16.2.3 </span><span class="name">Connecting to NVMe over Fabric Targets</span> <a title="Permalink" class="permalink" href="#sec.nvmeof.host_configuration.connect_target">#</a></h3></div></div></div><p>
    After you have identified the NVMe subsystem, you can connect it
    with the <code class="command">nvme connect</code> command.
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> <code class="command">nvme connect -t <em class="replaceable ">transport</em> -a <em class="replaceable ">DISCOVERY_CONTROLLER_ADDRESS</em> -s <em class="replaceable ">SERVICE_ID</em> -n <em class="replaceable ">SUBSYSTTEM_NQN</em></code></pre></div><p>
    Replace <em class="replaceable ">TRANSPORT</em> with the underlying
    transport medium: <code class="option">loop</code>, <code class="option">rdma</code> or
    <code class="option">fc</code>.
    Replace <em class="replaceable ">DISCOVERY_CONTROLLER_ADDRESS</em> with
    the address of the discovery controller. For RDMA this should be an
    IPv4 address.
    Replace <em class="replaceable ">SERVICE_ID</em> with the transport
    service ID. If the service is IP based, like RDMA, this specifies
    the port number.
    Replace <em class="replaceable ">SUBSYSTTEM_NQN</em> with the NVMe
    qualified name of the desired subsystem as found by the discovery
    command. <span class="emphasis"><em>NQN</em></span> is the abbreviation for <span class="emphasis"><em>
    NVMe Qualified Name</em></span>. The NQN must be unique.
   </p><p>Example:</p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> <code class="command">nvme connect -t rdma -a 10.0.0.1 -s 4420 -n nqn.2014-08.com.example:nvme:nvm-subsystem-sn-d78432</code></pre></div><p>
    Alternatively, use <code class="command">nvme connect-all</code> to connect
    to all discovered namespaces. For advanced usage please see
    <code class="command">man nvme-connect</code> and <code class="command">man
    nvme-connect-all</code>.
   </p></div><div class="sect2 " id="sec.nvmeof.host_configuration.multipathing"><div class="titlepage"><div><div><h3 class="title" id="sec.nvmeof.host_configuration.multipathing"><span class="number">16.2.4 </span><span class="name">Multipathing</span> <a title="Permalink" class="permalink" href="#sec.nvmeof.host_configuration.multipathing">#</a></h3></div></div></div><p>
    NVMe native multipathing is enabled by default. To
    print the layout of the multipath devices, use the command
    <code class="command">nvme list-subsys</code>. To disable NVMe native
    multipathing, add <code class="option">nvme-core.multipath=N</code> as a boot
    parameter.
   </p><p>
    The command <code class="command">multipath -ll</code> has a compatibility
    mode and also displays NVMe multipath devices.
   </p></div></div><div class="sect1 " id="sec.nvmeof.target_configuration"><div class="titlepage"><div><div><h2 class="title" id="sec.nvmeof.target_configuration"><span class="number">16.3 </span><span class="name">Setting Up an NVMe over Fabric Target</span> <a title="Permalink" class="permalink" href="#sec.nvmeof.target_configuration">#</a></h2></div></div></div><div class="sect2 " id="sec.nvmeof.target_configuration.cli"><div class="titlepage"><div><div><h3 class="title" id="sec.nvmeof.target_configuration.cli"><span class="number">16.3.1 </span><span class="name">Installing Command Line Client</span> <a title="Permalink" class="permalink" href="#sec.nvmeof.target_configuration.cli">#</a></h3></div></div></div><p>
    To configure a NVMe over Fabric target, you need the <code class="command">nvmetcli</code> command line
    tool. Install it with <code class="command">zypper</code>:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> <code class="command">zypper in nvmetcli</code></pre></div><p>
    The current documentation for <code class="command">nvmetcli</code> is
    available at <a class="link" href="http://git.infradead.org/users/hch/nvmetcli.git/blob_plain/HEAD:/Documentation/nvmetcli.txt" target="_blank">http://git.infradead.org/users/hch/nvmetcli.git/blob_plain/HEAD:/Documentation/nvmetcli.txt</a>
   </p></div><div class="sect2 " id="sec.nvmeof.target_configuration.steps"><div class="titlepage"><div><div><h3 class="title" id="sec.nvmeof.target_configuration.steps"><span class="number">16.3.2 </span><span class="name">Configuration Steps</span> <a title="Permalink" class="permalink" href="#sec.nvmeof.target_configuration.steps">#</a></h3></div></div></div><p>
    The following procedure provides an example how to set up an
    NVMe over Fabric target.
   </p><p>
    The configuration is stored in a tree structure. Use the command
    <code class="command">cd</code> to navigate. Use <code class="command">ls</code> to
    list objects. You can create new objects with
    <code class="command">create</code>.
   </p><div id="idm139787667718528" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.png" /><h6>Note: Broadcom FC-NVMe Target</h6><p>
     If you are using the <span class="emphasis"><em>Broadcom Emulex LightPulse Fibre
     Channel SCSI</em></span> driver, add a Kernel configuration
     parameter for the <code class="literal">lpfc</code> module:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> <code class="command">echo "options lpfc lpfc_enable_fc4_type=3" &gt; /etc/modprobe.d/lpfc.conf</code></pre></div></div><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
      Start the <code class="command">nvmectli</code> interactive shell.
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> <code class="command">nvmetcli</code></pre></div></li><li class="step "><p>
      Create a new port.
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">(nvmetcli)&gt; </code><code class="command">cd ports</code>
<code class="prompt user">(nvmetcli)&gt; </code><code class="command">create 1</code>
<code class="prompt user">(nvmetcli)&gt; </code><code class="command">ls 1/</code>
o- 1
  o- referrals
  o- subsystems</pre></div></li><li class="step "><p>Create an NVMe subsystem.</p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">(nvmetcli)&gt; </code><code class="command">cd /subsystems</code>
<code class="prompt user">(nvmetcli)&gt; </code><code class="command">create nqn.2014-08.org.nvmexpress:NVMf:uuid:c36f2c23-354d-416c-95de-f2b8ec353a82</code>
<code class="prompt user">(nvmetcli)&gt; </code><code class="command">cd nqn.2014-08.org.nvmexpress:NVMf:uuid:c36f2c23-354d-416c-95de-f2b8ec353a82/</code>
<code class="prompt user">(nvmetcli)&gt; </code><code class="command">ls</code>
o- nqn.2014-08.org.nvmexpress:NVMf:uuid:c36f2c23-354d-416c-95de-f2b8ec353a82
  o- allowed_hosts
  o- namespaces</pre></div></li><li class="step "><p>
      Create a new namespace and set an NVMe device to it.
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">(nvmetcli)&gt; </code><code class="command">cd namespaces</code>
<code class="prompt user">(nvmetcli)&gt; </code><code class="command">create 1</code>
<code class="prompt user">(nvmetcli)&gt; </code><code class="command">cd 1</code>
<code class="prompt user">(nvmetcli)&gt; </code><code class="command">set device path=/dev/nvme0n1</code>
Parameter path is now '/dev/nvme0n1'.</pre></div></li><li class="step "><p>
      Enable the previously created namespace.
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">(nvmetcli)&gt; </code><code class="command">cd ..</code>
<code class="prompt user">(nvmetcli)&gt; </code><code class="command">enable</code>
The Namespace has been enabled.</pre></div></li><li class="step "><p>
      Display the created namespace.
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">(nvmetcli)&gt; </code><code class="command">cd ..</code>
<code class="prompt user">(nvmetcli)&gt; </code><code class="command">ls</code>
o- nqn.2014-08.org.nvmexpress:NVMf:uuid:c36f2c23-354d-416c-95de-f2b8ec353a82
  o- allowed_hosts
  o- namespaces
    o- 1</pre></div></li><li class="step "><p>
      Allow all hosts to use the subsystem. Only do this in secure
      environments.
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">(nvmetcli)&gt; </code><code class="command">set attr allow_any_host=1</code>
Parameter allow_any_host is now '1'.</pre></div><p>
      Alternatively, you can allow only specific hosts to connect:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">(nvmetcli)&gt; </code><code class="command">cd nqn.2014-08.org.nvmexpress:NVMf:uuid:c36f2c23-354d-416c-95de-f2b8ec353a82/allowed_hosts/</code>
<code class="prompt user">(nvmetcli)&gt; </code><code class="command">create hostnqn</code></pre></div></li><li class="step "><p>
      List all created objects:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">(nvmetcli)&gt; </code><code class="command">cd /</code>
<code class="prompt user">(nvmetcli)&gt; </code><code class="command">ls</code>
o- /
  o- hosts
  o- ports
  | o- 1
  |   o- referrals
  |   o- subsystems
  o- subsystems
    o- nqn.2014-08.org.nvmexpress:NVMf:uuid:c36f2c23-354d-416c-95de-f2b8ec353a82
      o- allowed_hosts
      o- namespaces
        o- 1</pre></div></li><li class="step "><p>
      Make the target available via RDMA:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">(nvmetcli)&gt; </code><code class="command">cd ports/1/</code>
<code class="prompt user">(nvmetcli)&gt; </code><code class="command">set addr adrfam=ipv4 trtype=rdma traddr=10.0.0.1 trsvcid=4420</code>
Parameter trtype is now 'rdma'.
Parameter adrfam is now 'ipv4'.
Parameter trsvcid is now '4420'.
Parameter traddr is now '10.0.0.1'.</pre></div><p>
      Alternatively, you can make it available with Fibre Channel:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">(nvmetcli)&gt; </code><code class="command">cd ports/1/</code>
<code class="prompt user">(nvmetcli)&gt; </code><code class="command">set addr adrfam=fc trtype=fc traddr=nn-0x1000000044001123:pn-0x2000000055001123 trsvcid=none</code></pre></div></li></ol></div></div></div><div class="sect2 " id="sec.nvmeof.target_configuration.backup_configuration"><div class="titlepage"><div><div><h3 class="title" id="sec.nvmeof.target_configuration.backup_configuration"><span class="number">16.3.3 </span><span class="name">Back Up and Restore Target Configuration</span> <a title="Permalink" class="permalink" href="#sec.nvmeof.target_configuration.backup_configuration">#</a></h3></div></div></div><p>
    You can save the target configuration in a JSON file with the
    following commands:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> <code class="command">nvmetcli</code>
<code class="prompt user">(nvmetcli)&gt; </code><code class="command">saveconfig nvme-target-backup.json</code></pre></div><p>
     To restore the configuration, use:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">(nvmetcli)&gt; </code><code class="command">restore nvme-target-backup.json</code></pre></div><p>
     You can also wipe the current configuration:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">(nvmetcli)&gt; </code><code class="command">clear</code></pre></div></div></div><div class="sect1 " id="cha.nvmeof.more_information"><div class="titlepage"><div><div><h2 class="title" id="cha.nvmeof.more_information"><span class="number">16.4 </span><span class="name">More Information</span> <a title="Permalink" class="permalink" href="#cha.nvmeof.more_information">#</a></h2></div></div></div><p>
   For more details about the abilities of <code class="command">nvme</code>,
   refer to <code class="command">nvme nvme-help</code>.
  </p><p>
   The following blog posts are recommended for a basic introduction to
   NVMe and NVMe over Fabric:
  </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p><a class="link" href="http://nvmexpress.org/" target="_blank">http://nvmexpress.org/</a></p></li><li class="listitem "><p><a class="link" href="http://www.nvmexpress.org/wp-content/uploads/NVMe_Over_Fabrics.pdf" target="_blank">http://www.nvmexpress.org/wp-content/uploads/NVMe_Over_Fabrics.pdf</a></p></li><li class="listitem "><p><a class="link" href="https://storpool.com/blog/demystifying-what-is-nvmeof" target="_blank">https://storpool.com/blog/demystifying-what-is-nvmeof</a></p></li><li class="listitem "><p><a class="link" href="https://medium.com/@metebalci/a-quick-tour-of-nvm-express-nvme-3da2246ce4ef" target="_blank">https://medium.com/@metebalci/a-quick-tour-of-nvm-express-nvme-3da2246ce4ef</a></p></li></ul></div></div></div><div xml:lang="en" class="chapter " id="cha.multipath" lang="en"><div class="titlepage"><div><div><h2 class="title"><span class="number">17 </span><span class="name">Managing Multipath I/O for Devices</span> <a title="Permalink" class="permalink" href="#cha.multipath">#</a></h2><div class="doc-status"><ul><li><span class="ds-label">Filename: </span>storage_multipath.xml</li><li><span class="ds-label">ID: </span>cha.multipath</li></ul></div></div></div></div><div class="line"><div class="toc"><dl><dt><span class="sect1"><a href="#sec.multipath.intro"><span class="number">17.1 </span><span class="name">Understanding Multipath I/O</span></a></span></dt><dt><span class="sect1"><a href="#sec.multipath.hardware"><span class="number">17.2 </span><span class="name">Hardware Support</span></a></span></dt><dt><span class="sect1"><a href="#sec.multipath.planning"><span class="number">17.3 </span><span class="name">Planning for Multipathing</span></a></span></dt><dt><span class="sect1"><a href="#sec.multipath.mpiotools"><span class="number">17.4 </span><span class="name">Multipath Management Tools</span></a></span></dt><dt><span class="sect1"><a href="#sec.multipath.config"><span class="number">17.5 </span><span class="name">Configuring the System for Multipathing</span></a></span></dt><dt><span class="sect1"><a href="#sec.multipath.conf_file"><span class="number">17.6 </span><span class="name">Creating or Modifying the /etc/multipath.conf File</span></a></span></dt><dt><span class="sect1"><a href="#sec.multipath.policies_default"><span class="number">17.7 </span><span class="name">Configuring Default Policies for Polling, Queuing, and Failback</span></a></span></dt><dt><span class="sect1"><a href="#sec.multipath.blacklist"><span class="number">17.8 </span><span class="name">Blacklisting Non-Multipath Devices</span></a></span></dt><dt><span class="sect1"><a href="#sec.multipath.names"><span class="number">17.9 </span><span class="name">Configuring User-Friendly Names or Alias Names</span></a></span></dt><dt><span class="sect1"><a href="#sec.multipath.policies_failover"><span class="number">17.10 </span><span class="name">Configuring Path Failover Policies and Priorities</span></a></span></dt><dt><span class="sect1"><a href="#sec.multipath.root"><span class="number">17.11 </span><span class="name">Configuring Multipath I/O for the Root Device</span></a></span></dt><dt><span class="sect1"><a href="#sec.multipath.raid"><span class="number">17.12 </span><span class="name">Configuring Multipath I/O for an Existing Software RAID</span></a></span></dt><dt><span class="sect1"><a href="#sec.multipath.lvm"><span class="number">17.13 </span><span class="name">Using LVM2 on Multipath Devices</span></a></span></dt><dt><span class="sect1"><a href="#sec.multipath.best_practice"><span class="number">17.14 </span><span class="name">Best Practice</span></a></span></dt><dt><span class="sect1"><a href="#sec.multipath.trouble"><span class="number">17.15 </span><span class="name">Troubleshooting MPIO</span></a></span></dt></dl></div></div><p>
  This section describes how to manage failover and path load balancing for
  multiple paths between the servers and block storage devices by using
  Multipath I/O (MPIO).
 </p><div class="sect1 " id="sec.multipath.intro"><div class="titlepage"><div><div><h2 class="title" id="sec.multipath.intro"><span class="number">17.1 </span><span class="name">Understanding Multipath I/O</span> <a title="Permalink" class="permalink" href="#sec.multipath.intro">#</a></h2></div></div></div><p>
   Multipathing is the ability of a server to communicate with the same
   physical or logical block storage device across multiple physical paths
   between the host bus adapters in the server and the storage controllers for
   the device, typically in Fibre Channel (FC) or iSCSI SAN environments. You
   can also achieve multiple connections with direct attached storage when
   multiple channels are available.
  </p><p>
   Linux multipathing provides connection fault tolerance and can provide load
   balancing across the active connections. When multipathing is configured and
   running, it automatically isolates and identifies device connection
   failures, and reroutes I/O to alternate connections.
  </p><p>
   Typical connection problems involve faulty adapters, cables, or controllers.
   When you configure multipath I/O for a device, the multipath driver monitors
   the active connection between devices. When the multipath driver detects I/O
   errors for an active path, it fails over the traffic to the device’s
   designated secondary path. When the preferred path becomes healthy again,
   control can be returned to the preferred path.
  </p></div><div class="sect1 " id="sec.multipath.hardware"><div class="titlepage"><div><div><h2 class="title" id="sec.multipath.hardware"><span class="number">17.2 </span><span class="name">Hardware Support</span> <a title="Permalink" class="permalink" href="#sec.multipath.hardware">#</a></h2></div></div></div><p>
   The multipathing drivers and tools support all architectures for which
   <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> is available. They support most storage arrays. The storage
   array that houses the multipathed device must support multipathing to use
   the multipathing drivers and tools. Some storage array vendors provide their
   own multipathing management tools. Consult the vendor’s hardware
   documentation to determine what settings are required.
  </p><div class="sect2 " id="sec.multipath.hardware.autodetect"><div class="titlepage"><div><div><h3 class="title" id="sec.multipath.hardware.autodetect"><span class="number">17.2.1 </span><span class="name">Storage Arrays That Are Automatically Detected for Multipathing</span> <a title="Permalink" class="permalink" href="#sec.multipath.hardware.autodetect">#</a></h3></div></div></div><p>
    The <code class="filename">multipath-tools</code> package automatically detects the
    following storage arrays:
   </p><table border="0" summary="Simple list" class="simplelist "><tr><td>3PARdata VV</td></tr><tr><td>AIX NVDISK</td></tr><tr><td>AIX VDASD</td></tr><tr><td>APPLE Xserve RAID</td></tr><tr><td>COMPELNT Compellent Vol</td></tr><tr><td>COMPAQ/HP HSV101, HSV111, HSV200, HSV210, HSV300, HSV400, HSV 450</td></tr><tr><td>COMPAQ/HP MSA, HSV</td></tr><tr><td>COMPAQ/HP MSA VOLUME</td></tr><tr><td>DataCore SANmelody</td></tr><tr><td>DDN SAN DataDirector</td></tr><tr><td>DEC HSG80</td></tr><tr><td>DELL MD3000</td></tr><tr><td>DELL MD3000i</td></tr><tr><td>DELL MD32xx</td></tr><tr><td>DELL MD32xxi</td></tr><tr><td>DGC</td></tr><tr><td>EMC Clariion</td></tr><tr><td>EMC Invista</td></tr><tr><td>EMC SYMMETRIX</td></tr><tr><td>EUROLOGC FC2502</td></tr><tr><td>FSC CentricStor</td></tr><tr><td>FUJITSU ETERNUS_DX, DXL, DX400, DX8000</td></tr><tr><td>HITACHI DF</td></tr><tr><td>HITACHI/HP OPEN</td></tr><tr><td>HP A6189A</td></tr><tr><td>HP HSVX700</td></tr><tr><td>HP LOGICAL VOLUME</td></tr><tr><td>HP MSA2012fc, MSA 2212fc, MSA2012i</td></tr><tr><td>HP MSA2012sa, MSA2312 fc/i/sa, MCA2324 fc/i/sa, MSA2000s VOLUME</td></tr><tr><td>HP P2000 G3 FC|P2000G3 FC/iSCSI|P2000 G3 SAS|P2000 G3 iSCSI</td></tr><tr><td>IBM 1722-600</td></tr><tr><td>IBM 1724</td></tr><tr><td>IBM 1726</td></tr><tr><td>IBM 1742</td></tr><tr><td>IBM 1745, 1746</td></tr><tr><td>IBM 1750500</td></tr><tr><td>IBM 1814</td></tr><tr><td>IBM 1815</td></tr><tr><td>IBM 1818</td></tr><tr><td>IBM 1820N00</td></tr><tr><td>IBM 2105800</td></tr><tr><td>IBM 2105F20</td></tr><tr><td>IBM 2107900</td></tr><tr><td>IBM 2145</td></tr><tr><td>IBM 2810XIV</td></tr><tr><td>IBM 3303 NVDISK</td></tr><tr><td>IBM 3526</td></tr><tr><td>IBM 3542</td></tr><tr><td>IBM IPR</td></tr><tr><td>IBM Nseries</td></tr><tr><td>IBM ProFibre 4000R</td></tr><tr><td>IBM S/390 DASD ECKD</td></tr><tr><td>IBM S/390 DASD FBA</td></tr><tr><td>Intel Multi-Flex</td></tr><tr><td>LSI/ENGENIO INF-01-00</td></tr><tr><td>NEC DISK ARRAY</td></tr><tr><td>NETAPP LUN</td></tr><tr><td>NEXENTA COMSTAR</td></tr><tr><td>Pillar Axiom</td></tr><tr><td>PIVOT3 RAIGE VOLUME</td></tr><tr><td>SGI IS</td></tr><tr><td>SGI TP9100, TP 9300</td></tr><tr><td>SGI TP9400, TP9500</td></tr><tr><td>STK FLEXLINE 380</td></tr><tr><td>STK OPENstorage D280</td></tr><tr><td>SUN CSM200_R</td></tr><tr><td>SUN LCSM100_[IEFS]</td></tr><tr><td>SUN STK6580, STK6780</td></tr><tr><td>SUN StorEdge 3510, T4</td></tr><tr><td>SUN SUN_6180</td></tr></table><p>
    In general, most other storage arrays should work. When storage arrays are
    automatically detected, the default settings for multipathing apply. If you
    want non-default settings, you must manually create and configure the
    <code class="filename">/etc/multipath.conf</code> file. The same applies for
    hardware that is not automatically detected. For information, see
    <a class="xref" href="#sec.multipath.conf_file" title="17.6. Creating or Modifying the /etc/multipath.conf File">Section 17.6, “Creating or Modifying the /etc/multipath.conf File”</a>.
   </p><p>
    Consider the following caveats:
   </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
      Not all of the storage arrays that are automatically detected have been
      tested on <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span>. Also see
      <a class="xref" href="#sec.multipath.hardware.tested" title="17.2.2. Tested Storage Arrays for Multipathing Support">Section 17.2.2, “Tested Storage Arrays for Multipathing Support”</a>.
     </p></li><li class="listitem "><p>
      Some storage arrays might require specific hardware handlers. A hardware
      handler is a kernel module that performs hardware-specific actions when
      switching path groups and dealing with I/O errors. For information, see
      <a class="xref" href="#sec.multipath.hardware.handlers" title="17.2.3. Storage Arrays that Require Specific Hardware Handlers">Section 17.2.3, “Storage Arrays that Require Specific Hardware Handlers”</a>.
     </p></li><li class="listitem "><p>
      After each modification of the <code class="filename">/etc/multipath.conf</code>
      file, you must run <code class="command">dracut</code> <code class="option">-f</code> to
      re-create the <code class="systemitem">initrd</code> on your system. Reboot
      afterward for the changes to take effect.
     </p></li></ul></div></div><div class="sect2 " id="sec.multipath.hardware.tested"><div class="titlepage"><div><div><h3 class="title" id="sec.multipath.hardware.tested"><span class="number">17.2.2 </span><span class="name">Tested Storage Arrays for Multipathing Support</span> <a title="Permalink" class="permalink" href="#sec.multipath.hardware.tested">#</a></h3></div></div></div><p>
    Storage arrays from the following vendors have been tested with
    <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span>:
   </p><table border="0" summary="Simple list" class="simplelist "><tr><td>EMC</td></tr><tr><td>Hitachi</td></tr><tr><td>Hewlett-Packard/Compaq</td></tr><tr><td>IBM</td></tr><tr><td>NetApp</td></tr><tr><td>SGI</td></tr></table><p>
    Most other vendor storage arrays should also work. Consult your vendor’s
    documentation for guidance. For a list of the default storage arrays
    recognized by the <code class="filename">multipath-tools</code> package, see
    <a class="xref" href="#sec.multipath.hardware.autodetect" title="17.2.1. Storage Arrays That Are Automatically Detected for Multipathing">Section 17.2.1, “Storage Arrays That Are Automatically Detected for Multipathing”</a>.
   </p></div><div class="sect2 " id="sec.multipath.hardware.handlers"><div class="titlepage"><div><div><h3 class="title" id="sec.multipath.hardware.handlers"><span class="number">17.2.3 </span><span class="name">Storage Arrays that Require Specific Hardware Handlers</span> <a title="Permalink" class="permalink" href="#sec.multipath.hardware.handlers">#</a></h3></div></div></div><p>
    Storage arrays that require special commands on failover from one path to
    the other or that require special nonstandard error handling might require
    more extensive support. Therefore, the Device Mapper Multipath service has
    hooks for hardware handlers. For example, one such handler for the EMC
    CLARiiON CX family of arrays is already provided.
   </p><div id="idm139787667598848" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.png" /><h6>Important: For More Information</h6><p>
     Consult the hardware vendor’s documentation to determine if its hardware
     handler must be installed for Device Mapper Multipath.
    </p></div><p>
    The <code class="command">multipath -t</code> command shows an internal table of
    storage arrays that require special handling with specific hardware
    handlers. The displayed list is not an exhaustive list of supported storage
    arrays. It lists only those arrays that require special handling and that
    the <code class="filename">multipath-tools</code> developers had access to during
    the tool development.
   </p><div id="idm139787667595728" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.png" /><h6>Important: Exceptions</h6><p>
     Arrays with true active/active multipath support do not require special
     handling, so they are not listed for the <code class="command">multipath -t</code>
     command.
    </p></div><p>
    A listing in the <code class="command">multipath -t</code> table does not necessarily
    mean that <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> was tested on that specific hardware. For a list of
    tested storage arrays, see
    <a class="xref" href="#sec.multipath.hardware.tested" title="17.2.2. Tested Storage Arrays for Multipathing Support">Section 17.2.2, “Tested Storage Arrays for Multipathing Support”</a>.
   </p></div></div><div class="sect1 " id="sec.multipath.planning"><div class="titlepage"><div><div><h2 class="title" id="sec.multipath.planning"><span class="number">17.3 </span><span class="name">Planning for Multipathing</span> <a title="Permalink" class="permalink" href="#sec.multipath.planning">#</a></h2></div></div></div><p>
   Use the guidelines in this section when planning your multipath I/O
   solution.
  </p><div class="sect2 " id="sec.multipath.planning.prereq"><div class="titlepage"><div><div><h3 class="title" id="sec.multipath.planning.prereq"><span class="number">17.3.1 </span><span class="name">Prerequisites</span> <a title="Permalink" class="permalink" href="#sec.multipath.planning.prereq">#</a></h3></div></div></div><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
      Multipathing is managed at the device level.
     </p></li><li class="listitem "><p>
      The storage array you use for the multipathed device must support
      multipathing. For more information, see
      <a class="xref" href="#sec.multipath.hardware" title="17.2. Hardware Support">Section 17.2, “Hardware Support”</a>.
     </p></li><li class="listitem "><p>
      You need to configure multipathing only if multiple physical paths exist
      between host bus adapters in the server and host bus controllers for the
      block storage device. You configure multipathing for the logical device
      as seen by the server.
     </p></li><li class="listitem "><p>
      For some storage arrays, the vendor provides its own multipathing
      software to manage multipathing for the array’s physical and logical
      devices. In this case, you should follow the vendor’s instructions for
      configuring multipathing for those devices.
     </p></li><li class="listitem "><p>
      When using multipathing in a virtualization environment, the multipathing
      is controlled in the host server environment. Configure multipathing for
      the device before you assign it to a virtual guest machine.
     </p></li></ul></div></div><div class="sect2 " id="sec.multipath.planning.disks"><div class="titlepage"><div><div><h3 class="title" id="sec.multipath.planning.disks"><span class="number">17.3.2 </span><span class="name">Disk Management Tasks</span> <a title="Permalink" class="permalink" href="#sec.multipath.planning.disks">#</a></h3></div></div></div><p>
    Perform the following disk management tasks before you attempt to configure
    multipathing for a physical or logical device that has multiple paths:
   </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
      Use third-party tools to carve physical disks into smaller logical disks.
     </p></li><li class="listitem "><p>
      Use third-party tools to partition physical or logical disks. If you
      change the partitioning in the running system, the Device Mapper
      Multipath (DM-MP) module does not automatically detect and reflect these
      changes. DM-MPIO must be re-initialized, which usually requires a reboot.
     </p></li><li class="listitem "><p>
      Use third-party SAN array management tools to create and configure
      hardware RAID devices.
     </p></li><li class="listitem "><p>
      Use third-party SAN array management tools to create logical devices such
      as LUNs. Logical device types that are supported for a given array depend
      on the array vendor.
     </p></li></ul></div></div><div class="sect2 " id="sec.multipath.planning.raid"><div class="titlepage"><div><div><h3 class="title" id="sec.multipath.planning.raid"><span class="number">17.3.3 </span><span class="name">Software RAIDs</span> <a title="Permalink" class="permalink" href="#sec.multipath.planning.raid">#</a></h3></div></div></div><p>
    The Linux software RAID management software runs on top of multipathing.
    For each device that has multiple I/O paths and that you plan to use in a
    software RAID, you must configure the device for multipathing before you
    attempt to create the software RAID device. Automatic discovery of
    multipathed devices is not available. The software RAID is not aware of the
    multipathing management running underneath.
   </p><p>
    For information about setting up multipathing for existing software RAIDs,
    see <a class="xref" href="#sec.multipath.raid" title="17.12. Configuring Multipath I/O for an Existing Software RAID">Section 17.12, “Configuring Multipath I/O for an Existing Software RAID”</a>.
   </p></div><div class="sect2 " id="sec.multipath.planning.ha"><div class="titlepage"><div><div><h3 class="title" id="sec.multipath.planning.ha"><span class="number">17.3.4 </span><span class="name">High-Availability Solutions</span> <a title="Permalink" class="permalink" href="#sec.multipath.planning.ha">#</a></h3></div></div></div><p>
    High-availability solutions for clustering storage resources run on top of
    the multipathing service on each node. Make sure that the configuration
    settings in the <code class="filename">/etc/multipath.conf</code> file on each node
    are consistent across the cluster.
   </p><p>
    Make sure that multipath devices have the same name across all
    devices. Refer to <a class="xref" href="#sec.multipath.names.ha" title="17.9.1. Multipath Device Names in HA Clusters">Section 17.9.1, “Multipath Device Names in HA Clusters”</a> for details.
   </p><p>
    The Distributed Replicated Block Device (DRBD) high-availability solution
    for mirroring devices across a LAN runs on top of multipathing. For each
    device that has multiple I/O paths and that you plan to use in a DRDB
    solution, you must configure the device for multipathing before you
    configure DRBD.
   </p></div><div class="sect2 " id="sec.multipath.planning.initrd"><div class="titlepage"><div><div><h3 class="title" id="sec.multipath.planning.initrd"><span class="number">17.3.5 </span><span class="name">
    Always Keep the <code class="filename">initrd</code> in Synchronization with the
    System Configuration
   </span> <a title="Permalink" class="permalink" href="#sec.multipath.planning.initrd">#</a></h3></div></div></div><p>
    One of the most important requirements when using Multipath is to make sure
    that the <code class="filename">initrd</code> and the installed system behave the
    same regarding the root file system and all other file systems required to
    boot the system. If Multipath is enabled in the system, it also needs to be
    enabled in the <code class="filename">initrd</code> and vice versa. See <a class="xref" href="#sec.multipath.configuration.start" title="17.5.1. Enabling, Disabling, Starting and Stopping Multipath I/O Services">Section 17.5.1, “Enabling, Disabling, Starting and Stopping Multipath I/O Services”</a> for details.
   </p><p>
    If the <code class="filename">initrd</code> and the system are not synchronized, the
    system will not properly boot and the start-up procedure will result in an
    emergency shell. See <a class="xref" href="#sec.multipath.trouble.root" title="17.15.2. The System Exits to Emergency Shell at Boot When Multipath Is Enabled">Section 17.15.2, “The System Exits to Emergency Shell at Boot When Multipath Is Enabled”</a> for
    instructions on how to avoid or repair such a scenario.
   </p></div></div><div class="sect1 " id="sec.multipath.mpiotools"><div class="titlepage"><div><div><h2 class="title" id="sec.multipath.mpiotools"><span class="number">17.4 </span><span class="name">Multipath Management Tools</span> <a title="Permalink" class="permalink" href="#sec.multipath.mpiotools">#</a></h2></div></div></div><p>
   The multipathing support in <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> is based on the Device Mapper
   Multipath module of the Linux kernel and the
   <code class="systemitem">multipath-tools</code> user space package. You can use the
   Multiple Devices Administration utility (<code class="command">multipath</code>) to
   view the status of multipathed devices.
  </p><div class="sect2 " id="sec.multipath.mpiotools.dm"><div class="titlepage"><div><div><h3 class="title" id="sec.multipath.mpiotools.dm"><span class="number">17.4.1 </span><span class="name">Device Mapper Multipath Module</span> <a title="Permalink" class="permalink" href="#sec.multipath.mpiotools.dm">#</a></h3></div></div></div><p>
    The Device Mapper Multipath (DM-MP) module provides the multipathing
    capability for Linux. DM-MPIO is the preferred solution for multipathing on
    <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span>. It is the only multipathing option shipped with the product
    that is completely supported by SUSE.
   </p><p>
    DM-MPIO features automatic configuration of the multipathing subsystem for
    a large variety of setups. Configurations of up to eight paths to each
    device are supported. Configurations are supported for active/passive (one
    path active, others passive) or active/active (all paths active with
    round-robin load balancing).
   </p><p>
    The DM-MPIO framework is extensible in two ways:
   </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
      Using specific hardware handlers. For information, see
      <a class="xref" href="#sec.multipath.hardware.handlers" title="17.2.3. Storage Arrays that Require Specific Hardware Handlers">Section 17.2.3, “Storage Arrays that Require Specific Hardware Handlers”</a>.
     </p></li><li class="listitem "><p>
      Using load-balancing algorithms that are more sophisticated than the
      round-robin algorithm.
     </p></li></ul></div><p>
    The user space component of DM-MPIO takes care of automatic path discovery
    and grouping, and automated path retesting, so that a previously failed
    path is automatically reinstated when it becomes healthy again. This
    minimizes the need for administrator attention in a production environment.
   </p><p>
    DM-MPIO protects against failures in the paths to the device, and not
    failures in the device itself. If one of the active paths is lost (for
    example, a network adapter breaks or a fiber-optic cable is removed), I/O
    is redirected to the remaining paths. If the configuration is
    active/passive, then the path fails over to one of the passive paths. If
    you are using the round-robin load-balancing configuration, the traffic is
    balanced across the remaining healthy paths. If all active paths fail,
    inactive secondary paths must be woken up, so failover occurs with a delay
    of approximately 30 seconds.
   </p><p>
    If a disk array has more than one storage processor, ensure that the SAN
    switch has a connection to the storage processor that owns the LUNs you
    want to access. On most disk arrays, all LUNs belong to both storage
    processors, so both connections are active.
   </p><div id="idm139787667544944" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.png" /><h6>Note: Storage Processors</h6><p>
     On some disk arrays, the storage array manages the traffic through storage
     processors so that it presents only one storage processor at a time. One
     processor is active and the other one is passive until there is a failure.
     If you are connected to the wrong storage processor (the one with the
     passive path) you might not see the expected LUNs, or you might see the
     LUNs but get errors when you try to access them.
    </p></div><div class="table" id="idm139787667543168"><div class="table-title-wrap"><h6 class="table-title"><span class="number">Table 17.1: </span><span class="name">Multipath I/O Features of Storage Arrays </span><a title="Permalink" class="permalink" href="#idm139787667543168">#</a></h6></div><div class="table-contents"><table summary="Multipath I/O Features of Storage Arrays" border="1"><colgroup><col class="1" /><col class="2" /></colgroup><thead><tr><th>
        <p>
         Features of Storage Arrays
        </p>
       </th><th>
        <p>
         Description
        </p>
       </th></tr></thead><tbody><tr><td>
        <p>
         Active/passive controllers
        </p>
       </td><td>
        <p>
         One controller is active and serves all LUNs. The second controller
         acts as a standby. The second controller also presents the LUNs to the
         multipath component so that the operating system knows about redundant
         paths. If the primary controller fails, the second controller takes
         over, and it serves all LUNs.
        </p>
        <p>
         In some arrays, the LUNs can be assigned to different controllers. A
         given LUN is assigned to one controller to be its active controller.
         One controller does the disk I/O for any LUN at a time, and the second
         controller is the standby for that LUN. The second controller also
         presents the paths, but disk I/O is not possible. Servers that use
         that LUN are connected to the LUN’s assigned controller. If the
         primary controller for a set of LUNs fails, the second controller
         takes over, and it serves all LUNs.
        </p>
       </td></tr><tr><td>
        <p>
         Active/active controllers
        </p>
       </td><td>
        <p>
         Both controllers share the load for all LUNs, and can process disk I/O
         for any LUN. If one controller fails, the second controller
         automatically handles all traffic.
        </p>
       </td></tr><tr><td>
        <p>
         Load balancing
        </p>
       </td><td>
        <p>
         The Device Mapper Multipath driver automatically load balances traffic
         across all active paths.
        </p>
       </td></tr><tr><td>
        <p>
         Controller failover
        </p>
       </td><td>
        <p>
         When the active controller fails over to the passive, or standby,
         controller, the Device Mapper Multipath driver automatically activates
         the paths between the host and the standby, making them the primary
         paths.
        </p>
       </td></tr><tr><td>
        <p>
         Boot/Root device support
        </p>
       </td><td>
        <p>
         Multipathing is supported for the root (<code class="filename">/</code>) device
         in <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> 10 and later. The host server must be connected to
         the currently active controller and storage processor for the boot
         device.
        </p>
        <p>
         Multipathing is supported for the <code class="filename">/boot</code> device in
         <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> 11 and later.
        </p>
       </td></tr></tbody></table></div></div><p>
    Device Mapper Multipath detects every path for a multipathed device as a
    separate SCSI device. The SCSI device names take the form
    <code class="filename">/dev/sd<em class="replaceable ">N</em></code>, where
    <code class="filename"><em class="replaceable ">N</em></code> is an autogenerated
    letter for the device, beginning with a and issued sequentially as the
    devices are created, such as <code class="filename">/dev/sda</code>,
    <code class="filename">/dev/sdb</code>, and so on. If the number of devices exceeds
    26, the letters are duplicated so that the next device after
    <code class="filename">/dev/sdz</code> will be named <code class="filename">/dev/sdaa</code>,
    <code class="filename">/dev/sdab</code>, and so on.
   </p><p>
    If multiple paths are not automatically detected, you can configure them
    manually in the <code class="filename">/etc/multipath.conf</code> file. The
    <code class="filename">multipath.conf</code> file does not exist until you create
    and configure it. For information, see
    <a class="xref" href="#sec.multipath.conf_file" title="17.6. Creating or Modifying the /etc/multipath.conf File">Section 17.6, “Creating or Modifying the /etc/multipath.conf File”</a>.
   </p></div><div class="sect2 " id="sec.multipath.mpiotools.io_management"><div class="titlepage"><div><div><h3 class="title" id="sec.multipath.mpiotools.io_management"><span class="number">17.4.2 </span><span class="name">Multipath I/O Management Tools</span> <a title="Permalink" class="permalink" href="#sec.multipath.mpiotools.io_management">#</a></h3></div></div></div><p>
    The packages <code class="systemitem">multipath-tools</code> and
    <code class="systemitem">kpartx</code> provide tools that take
    care of automatic path discovery and grouping. They automatically test the
    path periodically, so that a previously failed path is automatically
    reinstated when it becomes healthy again. This minimizes the need for
    administrator attention in a production environment.
   </p><div class="table" id="idm139787667508848"><div class="table-title-wrap"><h6 class="table-title"><span class="number">Table 17.2: </span><span class="name">Tools in the multipath-tools Package </span><a title="Permalink" class="permalink" href="#idm139787667508848">#</a></h6></div><div class="table-contents"><table summary="Tools in the multipath-tools Package" border="1"><colgroup><col class="1" /><col class="2" /></colgroup><thead><tr><th>
        <p>
         Tool
        </p>
       </th><th>
        <p>
         Description
        </p>
       </th></tr></thead><tbody><tr><td>
        <p>
         <code class="command">multipath</code>
        </p>
       </td><td>
        <p>
         Scans the system for multipathed devices and assembles them.
        </p>
       </td></tr><tr><td>
        <p>
         <code class="command">multipathd</code>
        </p>
       </td><td>
        <p>
         Waits for maps events, then executes <code class="command">multipath</code>.
        </p>
       </td></tr><tr><td>
        <p>
         <code class="command">kpartx</code>
        </p>
       </td><td>
        <p>
         Maps linear devmaps to partitions on the multipathed device, which
         makes it possible to create multipath monitoring for partitions on the
         device.
        </p>
       </td></tr><tr><td>
        <p>
         <code class="command">mpathpersist</code>
        </p>
       </td><td>
        <p>
         Manages SCSI-persistent reservations on Device Mapper Multipath
         devices.ppc
        </p>
       </td></tr></tbody></table></div></div></div><div class="sect2 " id="sec.multipath.mpiotools.mdadm"><div class="titlepage"><div><div><h3 class="title" id="sec.multipath.mpiotools.mdadm"><span class="number">17.4.3 </span><span class="name">Using MDADM for Multipathed Devices</span> <a title="Permalink" class="permalink" href="#sec.multipath.mpiotools.mdadm">#</a></h3></div></div></div><p>
    Udev is the default device handler, and devices are automatically known to
    the system by the Worldwide ID instead of by the device node name. This
    resolves problems in previous releases of MDADM and LVM where the
    configuration files (<code class="filename">mdadm.conf</code> and
    <code class="filename">lvm.conf)</code> did not properly recognize multipathed
    devices.
   </p><p>
    As with LVM2, MDADM requires that the devices be accessed by the ID rather
    than by the device node path. Therefore, the
    <code class="systemitem">DEVICE</code> entry in
    <code class="filename">/etc/mdadm.conf</code> should be set as follows:
   </p><div class="verbatim-wrap"><pre class="screen">DEVICE /dev/disk/by-id/*</pre></div><p>
    If you are using user-friendly names, specify the path as follows so that
    only the device mapper names are scanned after multipathing is configured:
   </p><div class="verbatim-wrap"><pre class="screen">DEVICE /dev/disk/by-id/dm-uuid-.*-mpath-.*</pre></div></div><div class="sect2 " id="sec.multipath.mpiotools.multipath"><div class="titlepage"><div><div><h3 class="title" id="sec.multipath.mpiotools.multipath"><span class="number">17.4.4 </span><span class="name">The multipath Command</span> <a title="Permalink" class="permalink" href="#sec.multipath.mpiotools.multipath">#</a></h3></div></div></div><p>
    Use the Linux <code class="command">multipath(8)</code> command to configure and
    manage multipathed devices. The general syntax for the command looks like
    the following:
   </p><div class="verbatim-wrap"><pre class="screen">multipath [-v verbosity_level] [-b bindings_file] [-d] [-h|-l|-ll|-f|-F|-B|-c|-q|-r|-w|-W|-t] [-p failover|multibus|group_by_serial|group_by_prio|group_by_node_name] [<em class="replaceable ">DEVICENAME</em>]</pre></div><p>
    Refer to <code class="command">man 8 multipath</code> for details.
   </p><div class="sect1 bridgehead"><h2 class="title" id="idm139787667480016"><span class="name">General Examples</span><a title="Permalink" class="permalink" href="#idm139787667480016">#</a></h2></div><div class="variablelist "><dl class="variablelist"><dt id="idm139787667479280"><span class="term ">multipath</span></dt><dd><p>
       Configures all multipath devices.
      </p></dd><dt id="idm139787667477456"><span class="term ">multipath <em class="replaceable ">DEVICENAME</em>
     </span></dt><dd><p>
       Configures a specific multipath device.
      </p><p>
       Replace <em class="replaceable ">DEVICENAME</em> with the device node name
       such as <code class="filename">/dev/sdb</code> (as shown by udev in the $DEVNAME
       variable), or in the <code class="literal">major:minor</code> format. The device
       may alternatively be a multipath map name.
      </p></dd><dt id="idm139787667473248"><span class="term ">multipath -f</span></dt><dd><p>
       Selectively suppresses a multipath map, and its device-mapped
       partitions.
      </p></dd><dt id="idm139787667471376"><span class="term ">multipath -d</span></dt><dd><p>
       Dry run. Displays potential multipath devices, but does not create any
       devices and does not update device maps.
      </p></dd><dt id="idm139787667469472"><span class="term ">multipath -v2 -d</span></dt><dd><p>
       Displays multipath map information for potential multipath devices in a
       dry run. The -v2 option shows only local disks. This verbosity level
       prints the created or updated multipath names only for use to feed other
       tools like kpartx.
      </p><p>
       There is no output if the device already exists and there are no
       changes. Use <code class="command">multipath -ll</code> to see the status of
       configured multipath devices.
      </p></dd><dt id="idm139787667466400"><span class="term ">multipath -v2 <em class="replaceable ">DEVICENAME</em>
     </span></dt><dd><p>
       Configures a specific potential multipath device and displays multipath
       map information for it. This verbosity level prints only the created or
       updated multipath names for use to feed other tools like
       <code class="command">kpartx</code>.
      </p><p>
       There is no output if the device already exists and there are no
       changes. Use <code class="command">multipath -ll</code> to see the status of
       configured multipath devices.
      </p><p>
       Replace <em class="replaceable ">DEVICENAME</em> with the device node name
       such as <code class="filename">/dev/sdb</code> (as shown by
       <code class="command">udev</code> in the $DEVNAME variable), or in the
       <code class="literal">major:minor</code> format. The device may alternatively be a
       multipath map name.
      </p></dd><dt id="idm139787667460112"><span class="term ">multipath -v3</span></dt><dd><p>
       Configures potential multipath devices and displays multipath map
       information for them. This verbosity level prints all detected paths,
       multipaths, and device maps. Both WWID and <code class="literal">devnode</code>
       blacklisted devices are displayed.
      </p></dd><dt id="idm139787667457648"><span class="term ">multipath -v3 <em class="replaceable ">DEVICENAME</em>
     </span></dt><dd><p>
       Configures a specific potential multipath device and displays
       information for it. The -v3 option shows the full path list. This
       verbosity level prints all detected paths, multipaths, and device maps.
       Both WWID and <code class="literal">devnode</code> blacklisted devices are
       displayed.
      </p><p>
       Replace <em class="replaceable ">DEVICENAME</em> with the device node name
       such as <code class="filename">/dev/sdb</code> (as shown by
       <code class="command">udev</code> in the $DEVNAME variable), or in the
       <code class="literal">major:minor</code> format. The device may alternatively be a
       multipath map name.
      </p></dd><dt id="idm139787667452336"><span class="term ">multipath -ll</span></dt><dd><p>
       Displays the status of all multipath devices.
      </p></dd><dt id="idm139787667450496"><span class="term ">multipath -ll <em class="replaceable ">DEVICENAME</em>
     </span></dt><dd><p>
       Displays the status of a specified multipath device.
      </p><p>
       Replace <em class="replaceable ">DEVICENAME</em> with the device node name
       such as <code class="filename">/dev/sdb</code> (as shown by
       <code class="command">udev</code> in the $DEVNAME variable), or in the
       <code class="literal">major:minor</code> format. The device may alternatively be a
       multipath map name.
      </p></dd><dt id="idm139787667445840"><span class="term ">multipath -F</span></dt><dd><p>
       Flushes all unused multipath device maps. This unresolves the multiple
       paths; it does not delete the devices.
      </p></dd><dt id="idm139787667443936"><span class="term ">multipath -F <em class="replaceable ">DEVICENAME</em>
     </span></dt><dd><p>
       Flushes unused multipath device maps for a specified multipath device.
       This unresolves the multiple paths; it does not delete the device.
      </p><p>
       Replace <em class="replaceable ">DEVICENAME</em> with the device node name
       such as <code class="filename">/dev/sdb</code> (as shown by
       <code class="command">udev</code> in the $DEVNAME variable), or in the
       <code class="literal">major:minor</code> format. The device may alternatively be a
       multipath map name.
      </p></dd><dt id="idm139787667439184"><span class="term ">multipath -p [ failover | multibus | group_by_serial | group_by_prio | group_by_node_name ]</span></dt><dd><p>
       Sets the group policy by specifying one of the group policy options that
       are described in the following table:
      </p><div class="table" id="idm139787667437520"><div class="table-title-wrap"><h6 class="table-title"><span class="number">Table 17.3: </span><span class="name">Group Policy Options for the multipath -p Command </span><a title="Permalink" class="permalink" href="#idm139787667437520">#</a></h6></div><div class="table-contents"><table summary="Group Policy Options for the multipath -p Command" border="1"><colgroup><col class="1" /><col class="2" /></colgroup><thead><tr><th>
           <p>
            Policy Option
           </p>
          </th><th>
           <p>
            Description
           </p>
          </th></tr></thead><tbody><tr><td>
           <p>
            failover
           </p>
          </td><td>
           <p>
            (Default) One path per priority group. You can use only one path at
            a time.
           </p>
          </td></tr><tr><td>
           <p>
            multibus
           </p>
          </td><td>
           <p>
            All paths in one priority group.
           </p>
          </td></tr><tr><td>
           <p>
            group_by_serial
           </p>
          </td><td>
           <p>
            One priority group per detected SCSI serial number (the controller
            node worldwide number).
           </p>
          </td></tr><tr><td>
           <p>
            group_by_prio
           </p>
          </td><td>
           <p>
            One priority group per path priority value. Paths with the same
            priority are in the same priority group. Priorities are determined
            by callout programs specified as a global, per-controller, or
            per-multipath option in the
            <code class="filename">/etc/multipath.conf</code> configuration file.
           </p>
          </td></tr><tr><td>
           <p>
            group_by_node_name
           </p>
          </td><td>
           <p>
            One priority group per target node name. Target node names are
            fetched in the<code class="filename">
            /sys/class/fc_transport/target*/node_name</code> location.
           </p>
          </td></tr></tbody></table></div></div></dd><dt id="idm139787667417360"><span class="term ">multipath -t</span></dt><dd><p>
       Shows internal hardware table and active configuration of
       multipath. Refer to <code class="command">man multipath</code> for details
       about the configuration parameters.
      </p></dd></dl></div></div><div class="sect2 " id="sec.multipath.mpiotools.mpathpersist"><div class="titlepage"><div><div><h3 class="title" id="sec.multipath.mpiotools.mpathpersist"><span class="number">17.4.5 </span><span class="name">The mpathpersist Utility</span> <a title="Permalink" class="permalink" href="#sec.multipath.mpiotools.mpathpersist">#</a></h3></div></div></div><p>
    The <code class="command">mpathpersist</code> utility can be used to manage SCSI
    persistent reservations on Device Mapper Multipath devices. The general
    syntax for the command looks like the following:
   </p><div class="verbatim-wrap"><pre class="screen">mpathpersist [options] [device]</pre></div><p>
    Refer to <code class="command">man 8 mpathpersist</code> for details.
   </p><p>
    Use this utility with the service action reservation key
    (<code class="literal">reservation_key</code> attribute) in the
    <code class="filename">/etc/multipath.conf</code> file to set persistent
    reservations for SCSI devices. The attribute is not used by default. If it
    is not set, the <code class="command">multipathd</code> daemon does not check for
    persistent reservation for newly discovered paths or reinstated paths.
   </p><div class="verbatim-wrap"><pre class="screen">reservation_key &lt;<em class="replaceable ">RESERVATION_KEY</em>&gt;</pre></div><p>
    You can add the attribute to the <code class="literal">defaults</code> section or the
    <code class="literal">multipaths</code> section. For example:
   </p><div class="verbatim-wrap"><pre class="screen">multipaths {
  multipath {
    wwid   XXXXXXXXXXXXXXXX
    alias      yellow
    reservation_key  0x123abc
  }
}</pre></div><p>
    Set the <code class="literal">reservation_key</code> parameter for all mpath devices
    applicable for persistent management, then restart the
    <code class="systemitem">multipathd</code> daemon by running the
    following command:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> systemctl restart multipathd</pre></div><p>
    After it is set up, you can specify the reservation key in the
    <code class="command">mpathpersist</code> commands.
   </p><div class="sect1 bridgehead"><h2 class="title" id="idm139787667402448"><span class="name">Examples</span><a title="Permalink" class="permalink" href="#idm139787667402448">#</a></h2></div><div class="variablelist "><dl class="variablelist"><dt id="idm139787667401712"><span class="term ">mpathpersist --out --register --param-sark=123abc --prout-type=5 -d /dev/mapper/mpath9</span></dt><dd><p>
       Register the Service Action Reservation Key for the
       <code class="filename">/dev/mapper/mpath9</code> device.
      </p></dd><dt id="idm139787667399360"><span class="term ">mpathpersist -i -k -d /dev/mapper/mpath9</span></dt><dd><p>
       Read the Service Action Reservation Key for the
       <code class="filename">/dev/mapper/mpath9</code> device.
      </p></dd><dt id="idm139787667397040"><span class="term ">mpathpersist --out --reserve --param-sark=123abc --prout-type=8 -d /dev/mapper/mpath9</span></dt><dd><p>
       Reserve the Service Action Reservation Key for the
       <code class="filename">/dev/mapper/mpath9</code> device.
      </p></dd><dt id="idm139787667394688"><span class="term ">mpathpersist -i -s -d /dev/mapper/mpath9</span></dt><dd><p>
       Read the reservation status of the
       <code class="filename">/dev/mapper/mpath9</code> device.
      </p></dd></dl></div></div></div><div class="sect1 " id="sec.multipath.config"><div class="titlepage"><div><div><h2 class="title" id="sec.multipath.config"><span class="number">17.5 </span><span class="name">Configuring the System for Multipathing</span> <a title="Permalink" class="permalink" href="#sec.multipath.config">#</a></h2></div></div></div><div class="sect2 " id="sec.multipath.configuration.start"><div class="titlepage"><div><div><h3 class="title" id="sec.multipath.configuration.start"><span class="number">17.5.1 </span><span class="name">Enabling, Disabling, Starting and Stopping Multipath I/O Services</span> <a title="Permalink" class="permalink" href="#sec.multipath.configuration.start">#</a></h3></div></div></div><p>
    To enable multipath services to start at boot time, run the following
    command:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> systemctl enable multipathd</pre></div><p>
    To manually start the service in the running system or to check
    its status, enter one of the following commands:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> systemctl start multipathd
<code class="prompt user">tux &gt; </code><code class="command">sudo</code> systemctl status multipathd</pre></div><p>
    To stop the multipath services in the current session and to disable it, so
    it will not be started the next time the system is booted, run the
    following commands:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> systemctl stop multipathd
<code class="prompt user">tux &gt; </code><code class="command">sudo</code> systemctl disable multipathd</pre></div><div id="ann.multipath.configuration.initrd" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.png" /><h6>Important: Rebuilding the <code class="systemitem">initrd</code></h6><p>
     Whenever you enable or disable the multipath services it is also required
     to rebuild the <code class="systemitem">initrd</code>, otherwise the system may
     not boot anymore. When enabling the multipath services, also run the
     following command to rebuild the initrd:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code>dracut --force --add multipath</pre></div><p>
     When disabling the services, then run the following command to rebuild the
     initrd:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code>dracut --force -o multipath</pre></div><p>
     Additionally and optionally, if you also want to make sure multipath
     devices do not get set up, even when starting multipath manually,
     add the following lines to the end of
     <code class="filename">/etc/multipath.conf</code> before rebuilding the initrd:
    </p><div class="verbatim-wrap"><pre class="screen">blacklist {
    wwid ".*"
}</pre></div></div></div><div class="sect2 " id="sec.multipath.configuration.sandevs"><div class="titlepage"><div><div><h3 class="title" id="sec.multipath.configuration.sandevs"><span class="number">17.5.2 </span><span class="name">Preparing SAN Devices for Multipathing</span> <a title="Permalink" class="permalink" href="#sec.multipath.configuration.sandevs">#</a></h3></div></div></div><p>
    Before configuring multipath I/O for your SAN devices, prepare the SAN
    devices, as necessary, by doing the following:
   </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
      Configure and zone the SAN with the vendor’s tools.
     </p></li><li class="listitem "><p>
      Configure permissions for host LUNs on the storage arrays with the
      vendor’s tools.
     </p></li><li class="listitem "><p>
      Install the Linux HBA driver module. Upon module installation, the driver
      automatically scans the HBA to discover any SAN devices that have
      permissions for the host. It presents them to the host for further
      configuration.
     </p><div id="idm139787667370992" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.png" /><h6>Note: No Native Multipathing</h6><p>
       Make sure that the HBA driver you are using does not have native
       multipathing enabled.
      </p></div><p>
      See the vendor’s specific instructions for more details.
     </p></li><li class="listitem "><p>
      After the driver module is loaded, discover the device nodes assigned to
      specific array LUNs or partitions.
     </p></li><li class="listitem "><p>
      If the SAN device will be used as the root device on the server, modify
      the timeout settings for the device as described in
      <a class="xref" href="#sec.multipath.best_practice.san_timeout" title="17.14.9. SAN Timeout Settings When the Root Device Is Multipathed">Section 17.14.9, “SAN Timeout Settings When the Root Device Is Multipathed”</a>.
     </p></li></ul></div><p>
    If the LUNs are not seen by the HBA driver, <code class="command">lsscsi </code>can
    be used to check whether the SCSI devices are seen correctly by the
    operating system. When the LUNs are not seen by the HBA driver, check the
    zoning setup of the SAN. In particular, check whether LUN masking is active
    and whether the LUNs are correctly assigned to the server.
   </p><p>
    If the LUNs are seen by the HBA driver, but there are no corresponding
    block devices, additional kernel parameters are needed to change the SCSI
    device scanning behavior, such as to indicate that LUNs are not numbered
    consecutively. For information, see <em class="citetitle ">TID 3955167: Troubleshooting
    SCSI (LUN) Scanning Issues</em> in the SUSE Knowledgebase at
    <a class="link" href="https://www.suse.com/support/kb/doc.php?id=3955167" target="_blank">https://www.suse.com/support/kb/doc.php?id=3955167</a>.
   </p></div><div class="sect2 " id="sec.multipath.configuration.partitioning"><div class="titlepage"><div><div><h3 class="title" id="sec.multipath.configuration.partitioning"><span class="number">17.5.3 </span><span class="name">Partitioning Multipath Devices</span> <a title="Permalink" class="permalink" href="#sec.multipath.configuration.partitioning">#</a></h3></div></div></div><p>
    Partitioning devices that have multiple paths is not recommended, but it is
    supported. You can use the <code class="command">kpartx</code> tool to create
    partitions on multipath devices without rebooting. You can also partition
    the device before you attempt to configure multipathing by using the
    Partitioner function in YaST, or by using a third-party partitioning
    tool.
   </p><p>
    Multipath devices are device-mapper devices. Modifying device-mapper
    devices with command line tools (such as parted, kpartx, or fdisk) works,
    but it does not necessarily generate the udev events that are required to
    update other layers. After you partition the device-mapper device, you
    should check the multipath map to make sure the device-mapper devices were
    mapped. If they are missing, you can remap the multipath devices or reboot
    the server to pick up all of the new partitions in the multipath map.
   </p><p>
    The device-mapper device for a partition on a multipath device is not the
    same as an independent device. When you create an LVM logical volume using
    the whole device, you must specify a device that contains no partitions. If
    you specify a multipath partition as the target device for the LVM logical
    volume, LVM recognizes that the underlying physical device is partitioned
    and the create fails. If you need to subdivide a SAN device, you can carve
    LUNs on the SAN device and present each LUN as a separate multipath device
    to the server.
   </p></div></div><div class="sect1 " id="sec.multipath.conf_file"><div class="titlepage"><div><div><h2 class="title" id="sec.multipath.conf_file"><span class="number">17.6 </span><span class="name">Creating or Modifying the /etc/multipath.conf File</span> <a title="Permalink" class="permalink" href="#sec.multipath.conf_file">#</a></h2></div></div></div><p>
   The <code class="filename">/etc/multipath.conf</code> file does not exist unless you
   create it. Default multipath device settings are applied automatically when
   the <code class="command">multipathd</code> daemon runs unless you create the
   multipath configuration file and personalize the settings.
  </p><div id="idm139787667355168" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.png" /><h6>Important: 
    Testing and Permanently Applying Changes from
    <code class="filename">/etc/multipath.conf</code>
   </h6><p>
    Whenever you create or modify the <code class="filename">/etc/multipath.conf</code>
    file, the changes are not automatically applied when you save the
    file. This allows you to perform a dry run to verify your changes
    before they are committed. When you are satisfied with the revised
    settings, you can update the multipath maps as described in <a class="xref" href="#sec.multipath.conf_file.apply" title="17.6.4. Applying the /etc/multipath.conf File Changes to Update the Multipath Maps">Section 17.6.4, “Applying the /etc/multipath.conf File Changes to Update the Multipath Maps”</a>.
   </p></div><div class="sect2 " id="sec.multipath.conf_file.create"><div class="titlepage"><div><div><h3 class="title" id="sec.multipath.conf_file.create"><span class="number">17.6.1 </span><span class="name">Creating the /etc/multipath.conf File</span> <a title="Permalink" class="permalink" href="#sec.multipath.conf_file.create">#</a></h3></div></div></div><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
      Create an empty <code class="filename">/etc/multipath.conf</code> file with an
      editor of your choice.
     </p></li><li class="step "><p>
      Make sure to add an appropriate <code class="literal">device</code> section for
      your SAN. Most vendors provide documentation on the proper setup of the
      <code class="command">device</code> section. Note that different SANs require
      individual <code class="literal">device</code> sections.
     </p><p>
      If you are using a storage subsystem that is automatically detected (see
      <a class="xref" href="#sec.multipath.hardware.autodetect" title="17.2.1. Storage Arrays That Are Automatically Detected for Multipathing">Section 17.2.1, “Storage Arrays That Are Automatically Detected for Multipathing”</a>), adding a <code class="literal">device</code> is not
      required—the default settings for this device will be applied in
      this case.
     </p></li><li class="step "><p>
      Create a <code class="literal">blacklist</code> section containing all
      non-multipath devices of your machine. Refer to <a class="xref" href="#sec.multipath.blacklist" title="17.8. Blacklisting Non-Multipath Devices">Section 17.8, “Blacklisting Non-Multipath Devices”</a> for details.
     </p></li><li class="step "><p>
      If required, add more sections to the configuration file. Refer to <a class="xref" href="#sec.multipath.conf_file.sections" title="17.6.2. Sections in the /etc/multipath.conf File">Section 17.6.2, “Sections in the <code class="filename">/etc/multipath.conf</code> File”</a> for a brief
      introduction. More details are available when running <code class="command">man 5
      multipath.conf</code>.
     </p></li><li class="step "><p>
      When finished, save <code class="filename">/etc/multipath.conf</code> and test
      your settings as described in <a class="xref" href="#sec.multipath.conf_file.verify" title="17.6.3. Verifying the Multipath Setup in the /etc/multipath.conf File">Section 17.6.3, “Verifying the Multipath Setup in the /etc/multipath.conf File”</a>.
     </p></li><li class="step "><p>
      When you have successfully verified the configuration, apply it as
      described in <a class="xref" href="#sec.multipath.conf_file.apply" title="17.6.4. Applying the /etc/multipath.conf File Changes to Update the Multipath Maps">Section 17.6.4, “Applying the /etc/multipath.conf File Changes to Update the Multipath Maps”</a>.
     </p></li></ol></div></div></div><div class="sect2 " id="sec.multipath.conf_file.sections"><div class="titlepage"><div><div><h3 class="title" id="sec.multipath.conf_file.sections"><span class="number">17.6.2 </span><span class="name">Sections in the <code class="filename">/etc/multipath.conf</code> File</span> <a title="Permalink" class="permalink" href="#sec.multipath.conf_file.sections">#</a></h3></div></div></div><p>
    The <code class="filename">/etc/multipath.conf</code> file is organized into the
    following sections. See <code class="command">man 5 multipath.conf</code> for
    details.
   </p><div class="variablelist "><dl class="variablelist"><dt id="idm139787667333648"><span class="term ">defaults</span></dt><dd><p>
       General default settings for multipath I/0. These values are used if no
       values are given in the appropriate device or multipath sections. For
       information, see
       <a class="xref" href="#sec.multipath.policies_default" title="17.7. Configuring Default Policies for Polling, Queuing, and Failback">Section 17.7, “Configuring Default Policies for Polling, Queuing, and Failback”</a>.
      </p></dd><dt id="idm139787667330880"><span class="term ">blacklist</span></dt><dd><p>
       Lists the device names to discard as not multipath candidates. Devices
       can be identified by their device node name
       (<code class="literal">devnode</code>), their WWID (<code class="literal">wwid</code>), or
       their vendor or product strings (<code class="literal">device</code>). You
       can typically ignore non-multipathed devices, such as
       <code class="literal">hpsa</code>, <code class="literal">fd</code>, <code class="literal">hd</code>,
       <code class="literal">md</code>, <code class="literal">dm</code>, <code class="literal">sr</code>,
       <code class="literal">scd</code>, <code class="literal">st</code>, <code class="literal">ram</code>,
       <code class="literal">raw</code>, <code class="literal">loop</code>.
       For more information and examples, see
       <a class="xref" href="#sec.multipath.blacklist" title="17.8. Blacklisting Non-Multipath Devices">Section 17.8, “Blacklisting Non-Multipath Devices”</a>.
      </p></dd><dt id="idm139787667321728"><span class="term ">blacklist_exceptions</span></dt><dd><p>
       Lists the device names of devices to be treated as multipath candidates
       even if they are on the blacklist. Devices can be identified by their
       device node name (<code class="literal">devnode</code>), their WWID
       (<code class="literal">wwid</code>), or their vendor or product strings
       (<code class="literal">device</code>). You must specify the excepted devices by
       using the same keyword that you used in the blacklist. For example, if
       you used the <code class="literal">devnode</code> keyword for devices in the
       blacklist, you use the <code class="literal">devnode</code> keyword to exclude
       some devices in the blacklist exceptions. It is not possible to
       blacklist devices by using the <code class="literal">devnode</code> keyword and to
       exclude some of them by using the <code class="literal">wwid</code> keyword. For
       more information and examples, see
       <a class="xref" href="#sec.multipath.blacklist" title="17.8. Blacklisting Non-Multipath Devices">Section 17.8, “Blacklisting Non-Multipath Devices”</a>.
      </p></dd><dt id="idm139787667315392"><span class="term ">multipaths</span></dt><dd><p>
       Specifies settings for individual multipath devices. Except for settings
       that do not support individual settings, these values overwrite what is
       specified in the <code class="literal">defaults</code> and
       <code class="literal">devices</code> sections of the configuration file.
      </p></dd><dt id="idm139787667312496"><span class="term ">devices</span></dt><dd><p>
       Specifies settings for individual storage controllers. These values
       overwrite values specified in the <code class="filename">defaults</code> section
       of the configuration file. If you use a storage array that is not
       supported by default, you can create a <code class="literal">devices</code>
       subsection to specify the default settings for it. These values can be
       overwritten by settings for individual multipath devices if the keyword
       allows it.
      </p><p>
       For information, see the following:
      </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
         <a class="xref" href="#sec.multipath.names" title="17.9. Configuring User-Friendly Names or Alias Names">Section 17.9, “Configuring User-Friendly Names or Alias Names”</a>
        </p></li><li class="listitem "><p>
         <a class="xref" href="#sec.multipath.best_practice.zseries" title="17.14.6. Configuring Default Settings for IBM Z Devices">Section 17.14.6, “Configuring Default Settings for IBM Z Devices”</a>
        </p></li></ul></div></dd></dl></div></div><div class="sect2 " id="sec.multipath.conf_file.verify"><div class="titlepage"><div><div><h3 class="title" id="sec.multipath.conf_file.verify"><span class="number">17.6.3 </span><span class="name">Verifying the Multipath Setup in the /etc/multipath.conf File</span> <a title="Permalink" class="permalink" href="#sec.multipath.conf_file.verify">#</a></h3></div></div></div><p>
    Whenever you create or modify the <code class="filename">/etc/multipath.conf</code>
    file, the changes are not automatically applied when you save the file. You
    can perform a <span class="quote">“<span class="quote">dry run</span>”</span> of the setup to verify the multipath
    setup before you update the multipath maps.
   </p><p>
    At the server command prompt, enter
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> multipath -v2 -d</pre></div><p>
    This command scans the devices, then displays what the setup would look
    like if you commit the changes. It is assumed that the
    <code class="systemitem">multipathd</code> daemon is already
    running with the old (or default) multipath settings when you modify the
    <code class="filename">/etc/multipath.conf</code> file and perform the dry run. If
    the changes are acceptable, continue with the next step.
   </p><p>
    The output is similar to the following:
   </p><div class="verbatim-wrap"><pre class="screen">26353900f02796769
[size=127 GB]
[features="0"]
[hwhandler="1    emc"]

\_ round-robin 0 [first]
  \_ 1:0:1:2 sdav 66:240  [ready ]
  \_ 0:0:1:2 sdr  65:16   [ready ]

\_ round-robin 0
  \_ 1:0:0:2 sdag 66:0    [ready ]
  \_ 0:0:0:2 sdc   8:32   [ready ]</pre></div><p>
    Paths are grouped into priority groups. Only one priority group is in
    active use at a time. To model an active/active configuration, all paths
    end in the same group. To model an active/passive configuration, the paths
    that should not be active in parallel are placed in several distinct
    priority groups. This normally happens automatically on device discovery.
   </p><p>
    The output shows the order, the scheduling policy used to balance I/O
    within the group, and the paths for each priority group. For each path, its
    physical address (host:bus:target:lun), device node name, major:minor
    number, and state is shown.
   </p><p>
    By using a verbosity level of -v3 in the dry run, you can see all detected
    paths, multipaths, and device maps. Both WWID and device node blacklisted
    devices are displayed.
   </p><p>
    The following is an example of -v3 output on a 64-bit SLES 11 SP2 server
    with two Qlogic HBAs connected to a Xiotech Magnitude 3000 SAN. Some
    multiple entries have been omitted to shorten the example.
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> multipath -v3 d
dm-22: device node name blacklisted
&lt; content omitted &gt;
loop7: device node name blacklisted
&lt; content omitted &gt;
md0: device node name blacklisted
&lt; content omitted &gt;
dm-0: device node name blacklisted
sdf: not found in pathvec
sdf: mask = 0x1f
sdf: dev_t = 8:80
sdf: size = 105005056
sdf: subsystem = scsi
sdf: vendor = XIOtech
sdf: product = Magnitude 3D
sdf: rev = 3.00
sdf: h:b:t:l = 1:0:0:2
sdf: tgt_node_name = 0x202100d0b2028da
sdf: serial = 000028DA0014
sdf: getuid= "/lib/udev/scsi_id --whitelisted --device=/dev/%n" (config file default)
sdf: uid = 200d0b2da28001400 (callout)
sdf: prio = const (config file default)
sdf: const prio = 1
[...]
ram15: device node name blacklisted
[...]
===== paths list =====
uuid              hcil    dev dev_t pri dm_st  chk_st  vend/prod/rev
200d0b2da28001400 1:0:0:2 sdf 8:80  1   [undef][undef] XIOtech,Magnitude 3D
200d0b2da28005400 1:0:0:1 sde 8:64  1   [undef][undef] XIOtech,Magnitude 3D
200d0b2da28004d00 1:0:0:0 sdd 8:48  1   [undef][undef] XIOtech,Magnitude 3D
200d0b2da28001400 0:0:0:2 sdc 8:32  1   [undef][undef] XIOtech,Magnitude 3D
200d0b2da28005400 0:0:0:1 sdb 8:16  1   [undef][undef] XIOtech,Magnitude 3D
200d0b2da28004d00 0:0:0:0 sda 8:0   1   [undef][undef] XIOtech,Magnitude 3D
params = 0 0 2 1 round-robin 0 1 1 8:80 1000 round-robin 0 1 1 8:32 1000
status = 2 0 0 0 2 1 A 0 1 0 8:80 A 0 E 0 1 0 8:32 A 0
sdf: mask = 0x4
sdf: path checker = directio (config file default)
directio: starting new request
directio: async io getevents returns 1 (errno=Success)
directio: io finished 4096/0
sdf: state = 2
[...]</pre></div></div><div class="sect2 " id="sec.multipath.conf_file.apply"><div class="titlepage"><div><div><h3 class="title" id="sec.multipath.conf_file.apply"><span class="number">17.6.4 </span><span class="name">Applying the /etc/multipath.conf File Changes to Update the Multipath Maps</span> <a title="Permalink" class="permalink" href="#sec.multipath.conf_file.apply">#</a></h3></div></div></div><p>
    Changes to the <code class="filename">/etc/multipath.conf</code> file cannot take
    effect when <code class="command">multipathd</code> is running. After you make
    changes, save and close the file, then do the following to apply the
    changes and update the multipath maps:
   </p><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
      Stop the <code class="systemitem">multipathd</code> service:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> systemctl stop multipathd</pre></div></li><li class="step "><p>
      Clear old multipath bindings by entering
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> /sbin/multipath -F</pre></div></li><li class="step "><p>
      Create new multipath bindings by entering
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> /sbin/multipath -v2 -l</pre></div></li><li class="step "><p>
      Restart the <code class="systemitem">multipathd</code> service:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> systemctl start multipathd</pre></div></li><li class="step "><p>
      Run <code class="command">dracut -f</code> to re-create the
      <code class="filename">initrd</code> image on your system, then reboot for the
      changes to take effect.
     </p></li></ol></div></div></div><div class="sect2 " id="sec.multipath.conf_file.wwid"><div class="titlepage"><div><div><h3 class="title" id="sec.multipath.conf_file.wwid"><span class="number">17.6.5 </span><span class="name">Generating a WWID</span> <a title="Permalink" class="permalink" href="#sec.multipath.conf_file.wwid">#</a></h3></div></div></div><p>
    To identify a device over different paths, multipath uses a World Wide
    Identification (WWID) for each device. If the WWID is the same for two
    device paths, they are assumed to represent the same device.  We recommend
    not changing the method of WWID generation, unless there is a compelling
    reason to do so. For more details, see <code class="command">man
    multipath.conf</code>.
   </p></div></div><div class="sect1 " id="sec.multipath.policies_default"><div class="titlepage"><div><div><h2 class="title" id="sec.multipath.policies_default"><span class="number">17.7 </span><span class="name">Configuring Default Policies for Polling, Queuing, and Failback</span> <a title="Permalink" class="permalink" href="#sec.multipath.policies_default">#</a></h2></div></div></div><p>
   The goal of multipath I/O is to provide connectivity fault tolerance between
   the storage system and the server. The desired default behavior depends on
   whether the server is a stand-alone server or a node in a high-availability
   cluster.
  </p><p>
   When you configure multipath I/O for a stand-alone server, the
   <code class="literal">no_path_retry</code> setting protects the server operating
   system from receiving I/O errors as long as possible. It queues messages
   until a multipath failover occurs and provides a healthy connection.
  </p><p>
   When you configure multipath I/O for a node in a high-availability cluster,
   you want multipath to report the I/O failure to trigger the resource
   failover instead of waiting for a multipath failover to be resolved. In
   cluster environments, you must modify the <code class="literal">no_path_retry
   </code>setting so that the cluster node receives an I/O error in relation
   to the cluster verification process (recommended to be 50% of the heartbeat
   tolerance) if the connection is lost to the storage system. In addition, you
   want the multipath I/O fallback to be set to manual to avoid a ping-pong of
   resources because of path failures.
  </p><p>
   The <code class="filename">/etc/multipath.conf</code> file should contain a
   <code class="command">defaults</code> section where you can specify default behaviors
   for polling, queuing, and failback. If the field is not otherwise specified
   in a <code class="command">device</code> section, the default setting is applied for
   that SAN configuration.
  </p><p>
   The following are the compiled default settings. They will be used unless
   you overwrite these values by creating and configuring a personalized
   <code class="filename">/etc/multipath.conf</code> file.
  </p><div class="verbatim-wrap"><pre class="screen">defaults {
  verbosity 2
#  udev_dir is deprecated in SLES 11 SP3
#  udev_dir              /dev
  polling_interval      5
#  path_selector default value is service-time in SLES 11 SP3
#  path_selector         "round-robin 0"
  path selector         "service-time 0"
  path_grouping_policy  failover
#  getuid_callout is deprecated in SLES 11 SP3 and replaced with uid_attribute
#  getuid_callout        "/lib/udev/scsi_id --whitelisted --device=/dev/%n"
#  uid_attribute is new in SLES 11 SP3
  uid_attribute         "ID_SERIAL"
  prio                  "const"
  prio_args             ""
  features              "0"
  path_checker          "tur"
  alias_prefix          "mpath"
  rr_min_io_rq          1
  max_fds               "max"
  rr_weight             "uniform"
  queue_without_daemon  "yes"
  flush_on_last_del     "no"
  user_friendly_names   "no"
  fast_io_fail_tmo      5
  bindings_file         "/etc/multipath/bindings"
  wwids_file            "/etc/multipath/wwids"
  log_checker_err       "always"

  retain_attached_hw_handler  "no"
  detect_prio           "no"
  failback              "manual"
  no_path_retry         "fail"
  }</pre></div><p>
   For information about setting the polling, queuing, and failback policies,
   see the following parameters in
   <a class="xref" href="#sec.multipath.policies_failover" title="17.10. Configuring Path Failover Policies and Priorities">Section 17.10, “Configuring Path Failover Policies and Priorities”</a>:
  </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
     <a class="xref" href="#polling_interval"><code class="literal">polling_interval</code>
      </a>
    </p></li><li class="listitem "><p>
     <a class="xref" href="#no_path_retry"><code class="literal">no_path_retry</code>
      </a>
    </p></li><li class="listitem "><p>
     <a class="xref" href="#failback"><code class="literal">failback</code>
      </a>
    </p></li></ul></div><p>
   After you have modified the <code class="filename">/etc/multipath.conf</code> file,
   you must run <code class="command">dracut</code> <code class="option">-f</code> to re-create the
   <code class="filename">initrd</code> on your system, then restart the server for the
   changes to take effect. See <a class="xref" href="#sec.multipath.conf_file.apply" title="17.6.4. Applying the /etc/multipath.conf File Changes to Update the Multipath Maps">Section 17.6.4, “Applying the /etc/multipath.conf File Changes to Update the Multipath Maps”</a>
   for details.
  </p></div><div class="sect1 " id="sec.multipath.blacklist"><div class="titlepage"><div><div><h2 class="title" id="sec.multipath.blacklist"><span class="number">17.8 </span><span class="name">Blacklisting Non-Multipath Devices</span> <a title="Permalink" class="permalink" href="#sec.multipath.blacklist">#</a></h2></div></div></div><p>
   The <code class="filename">/etc/multipath.conf</code> file can contain a
   <code class="command">blacklist</code> section where all non-multipath devices are
   listed. You can blacklist devices by WWID (<code class="literal">wwid</code> keyword),
   device name (<code class="literal">devnode</code> keyword), or device type
   (<code class="literal">device</code> section). You can also use the
   <code class="literal">blacklist_exceptions</code> section to enable multipath for some
   devices that are blacklisted by the regular expressions used in the
   <code class="literal">blacklist</code> section.
  </p><div id="idm139787667249296" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.png" /><h6>Note: 
    Preferred Blacklisting Methods
   </h6><p>
    The preferred method for blacklisting devices is by <span class="emphasis"><em>WWID</em></span>
    or by <span class="emphasis"><em>vendor and product</em></span>. Blacklisting by
    <span class="emphasis"><em>devnode</em></span> is not recommended, because device nodes
    can change and thus are not useful for persistent device identification.
   </p></div><div id="idm139787667246432" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.png" /><h6>Warning: Regular Expressions in multipath.conf</h6><p>Regular expressions in the <code class="filename">/etc/multipath.conf</code> do
    <span class="emphasis"><em>not</em></span> work in general. They only work if they are
    matched against common strings. However, the standard configuration
    of multipath already contains regular expressions for many devices
    and vendors. Matching regular expressions with other regular
    expressions does not work. Make sure that you are only matching
    against strings shown with <code class="command">multipath -t</code>.
   </p></div><p>
   You can typically ignore non-multipathed devices, such as
   <code class="literal">hpsa</code>, <code class="literal">fd</code>, <code class="literal">hd</code>,
   <code class="literal">md</code>, <code class="literal">dm</code>, <code class="literal">sr</code>,
   <code class="literal">scd</code>, <code class="literal">st</code>, <code class="literal">ram</code>,
   <code class="literal">raw</code>, and <code class="literal">loop</code>.
   For example, local SATA hard disks and flash
   disks do not have multiple paths. If you want
   <code class="command">multipath</code> to ignore single-path devices, put them in the
   <code class="command">blacklist</code> section.
  </p><div id="idm139787667236944" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.png" /><h6>Note: Compatibility</h6><p>
    The keyword <code class="literal">devnode_blacklist</code> has been deprecated and
    replaced with the keyword <code class="literal">blacklist</code>.
   </p><p>
    With SUSE Linux Enterprise Server 12 the glibc-provided regular expressions are used. To match an
    arbitrary string, you must now use <code class="literal">".*"</code> rather than
    <code class="literal">"*"</code>.
   </p></div><p>
   For example, to blacklist local devices and all arrays from the
   <code class="filename">hpsa</code> driver from being managed by multipath, the
   <code class="command">blacklist</code> section looks like this:
  </p><div class="verbatim-wrap"><pre class="screen">blacklist {
      wwid "26353900f02796769"
      devnode "^(ram|raw|loop|fd|md|dm-|sr|scd|st)[0-9]*"
      devnode "^sd[a-z][0-9]*"
}</pre></div><p>
   You can also blacklist only the partitions from a driver instead of the
   entire array. For example, you can use the following regular expression to
   blacklist only partitions from the cciss driver and not the entire array:
  </p><div class="verbatim-wrap"><pre class="screen">blacklist {
      devnode "^cciss!c[0-9]d[0-9]*[p[0-9]*]"
}</pre></div><p>
   You can blacklist by specific device types by adding a
   <code class="literal">device</code> section in the blacklist, and using the
   <code class="literal">vendor</code> and <code class="literal">product</code> keywords.
  </p><div class="verbatim-wrap"><pre class="screen">blacklist {
      device {
           vendor  "DELL"
           product ".*"
       }
}</pre></div><p>
   You can use a <code class="literal">blacklist_exceptions</code> section to enable
   multipath for some devices that were blacklisted by the regular expressions
   used in the <code class="literal">blacklist</code> section. You add exceptions by WWID
   (<code class="literal">wwid</code> keyword), device name (<code class="literal">devnode</code>
   keyword), or device type (<code class="literal">device</code> section). You must
   specify the exceptions in the same way that you blacklisted the
   corresponding devices. That is, <code class="literal">wwid</code> exceptions apply to
   a <code class="literal">wwid</code> blacklist, <code class="literal">devnode</code> exceptions
   apply to a <code class="literal">devnode</code> blacklist, and device type exceptions
   apply to a device type blacklist.
  </p><p>
   For example, you can enable multipath for a desired device type when you
   have different device types from the same vendor. Blacklist all of the
   vendor’s device types in the <code class="literal">blacklist</code> section, and
   then enable multipath for the desired device type by adding a
   <code class="literal">device</code> section in a
   <code class="literal">blacklist_exceptions</code> section.
  </p><div class="verbatim-wrap"><pre class="screen">blacklist {
      devnode "^(ram|raw|loop|fd|md|dm-|sr|scd|st|sda)[0-9]*"
      device {
           vendor  "DELL"
           product ".*"
       }
}

blacklist_exceptions {
      device {
           vendor  "DELL"
           product "MD3220i"
       }
}</pre></div><p>
   You can also use the blacklist_exceptions to enable multipath only for
   specific devices. For example:
  </p><div class="verbatim-wrap"><pre class="screen">blacklist {
      wwid ".*"
}

blacklist_exceptions {
        wwid "3600d0230000000000e13955cc3751234"
        wwid "3600d0230000000000e13955cc3751235"
}</pre></div><p>
   After you have modified the <code class="filename">/etc/multipath.conf</code> file,
   you must run <code class="command">dracut</code> <code class="option">-f</code> to re-create the
   <code class="filename">initrd</code> on your system, then restart the server for the
   changes to take effect. See <a class="xref" href="#sec.multipath.conf_file.apply" title="17.6.4. Applying the /etc/multipath.conf File Changes to Update the Multipath Maps">Section 17.6.4, “Applying the /etc/multipath.conf File Changes to Update the Multipath Maps”</a>
   for details.
  </p><p>
   Following the reboot, the local devices should no longer be listed in the
   multipath maps when you issue the <code class="command">multipath -ll</code> command.
  </p><div id="idm139787667215056" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.png" /><h6>Note: Using the <code class="literal">find_multipaths</code> Option</h6><p>
    Starting with <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> 12 SP2, the multipath tools support the option
    <code class="literal">find_multipaths</code> in the <code class="literal">defaults</code>
    section of <code class="filename">/etc/multipath.conf</code>. Simply put, this
    option prevents multipath and <code class="systemitem">multipathd</code> from setting up multipath maps for
    devices with only a single path (see the <code class="command">man 5
    multipath.conf</code> for details). In certain configurations, this may
    save the administrator from the effort of creating blacklist entries, for
    example for local SATA disks.
   </p><p>
    Convenient as it seems at first, using the
    <code class="literal">find_multipaths</code> option also has disadvantages. It
    complicates and slows down the system boot, because for every device found,
    the boot logic needs to wait until all devices have been discovered to see
    whether a second path exists for the device. Additionally, problems can
    arise when some paths are down or otherwise invisible at boot time—a
    device can be falsely detected as a single-path device and activated,
    causing later addition of more paths to fail.
   </p><p>
    <code class="literal">find_multipaths</code> considers all devices that are listed in
    <code class="filename">/etc/multipath/wwids</code> with matching WWIDs as being
    multipath devices. This is important when
    <code class="literal">find_multipaths</code> is first activated: Unless
    <code class="filename">/etc/multipath/wwids</code> is deleted or edited, activating
    this option has no effect, because all previously existing multipath maps
    (including single-path ones) are listed in the wwids file. On SAN-boot
    systems with a multipathed root file system, make sure to keep
    <code class="filename">/etc/multipath/wwids</code> synchronized between the initial
    RAM disk and the file system.
   </p><p>
    In Summary, using <code class="literal">find_multipaths</code> may be convenient in
    certain use cases, but SUSE still recommends the default configuration
    with a properly configured blacklist and blacklist exceptions.
   </p></div></div><div class="sect1 " id="sec.multipath.names"><div class="titlepage"><div><div><h2 class="title" id="sec.multipath.names"><span class="number">17.9 </span><span class="name">Configuring User-Friendly Names or Alias Names</span> <a title="Permalink" class="permalink" href="#sec.multipath.names">#</a></h2></div></div></div><p>
   A multipath device can be identified by its WWID, by a user-friendly name,
   or by an alias that you assign for it. Device node names in the form of
   <code class="filename">/dev/sdn</code> and <code class="filename">/dev/dm-n</code> can change
   on reboot and might be assigned to different devices each time. A device’s
   WWID, user-friendly name, and alias name persist across reboots, and are the
   preferred way to identify the device.
  </p><div id="idm139787667200768" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.png" /><h6>Important: Using Persistent Names is Recommended</h6><p>
    Because device node names in the form of <code class="filename">/dev/sdn</code> and
    <code class="filename">/dev/dm-n</code> can change on reboot, referring to multipath
    devices by their WWID is preferred. You can also use a user-friendly name
    or alias that is mapped to the WWID to identify the device uniquely across
    reboots.
   </p></div><p>
   The following table describes the types of device names that can be used for
   a device in the <code class="filename">/etc/multipath.conf</code> file. For an
   example of <code class="filename">multipath.conf</code> settings, see the
   <code class="filename">/usr/share/doc/packages/multipath-tools/multipath.conf.synthetic</code>
   file.
  </p><div class="table" id="idm139787667196336"><div class="table-title-wrap"><h6 class="table-title"><span class="number">Table 17.4: </span><span class="name">Comparison of Multipath Device Name Types </span><a title="Permalink" class="permalink" href="#idm139787667196336">#</a></h6></div><div class="table-contents"><table summary="Comparison of Multipath Device Name Types" border="1"><colgroup><col class="1" /><col class="2" /></colgroup><thead><tr><th>
       <p>
        Name Types
       </p>
      </th><th>
       <p>
        Description
       </p>
      </th></tr></thead><tbody><tr><td>
       <p>
        WWID (default)
       </p>
      </td><td>
       <p>
        The serial WWID (Worldwide Identifier) is an identifier for the
        multipath device that is guaranteed to be globally unique and
        unchanging. The default name used in multipathing is the ID of the
        logical unit as found in the <code class="filename">/dev/disk/by-id</code>
        directory. For example, a device with the WWID of
        <code class="literal">3600508e0000000009e6baa6f609e7908</code> is listed as
        <code class="filename">/dev/disk/by-id/scsi-3600508e0000000009e6baa6f609e7908</code>.
       </p>
      </td></tr><tr><td>
       <p>
        User-friendly
       </p>
      </td><td>
       <p>
        The Device Mapper Multipath device names in the
        <code class="filename">/dev/mapper</code> directory also reference the ID of the
        logical unit. These multipath device names are user-friendly names in
        the form of
        <code class="filename">/dev/mapper/mpath<em class="replaceable ">N</em></code>,
        such as <code class="filename">/dev/mapper/mpath0</code>. The names are unique
        and persistent because they use the
        <code class="filename">/var/lib/multipath/bindings</code> file to track the
        association between the UUID and user-friendly names.
       </p>
      </td></tr><tr><td>
       <p>
        Alias
       </p>
      </td><td>
       <p>
        An alias name is a globally unique name that the administrator provides
        for a multipath device. Alias names override the WWID and the
        user-friendly
        <code class="filename">/dev/mapper/mpath<em class="replaceable ">N</em></code>
        names.
       </p>
       <p>
        If you are using user_friendly_names, do not set the alias to
        mpath<em class="replaceable ">N</em> format. This may conflict with an
        automatically assigned user-friendly name, and give you incorrect
        device node names.
       </p>
      </td></tr></tbody></table></div></div><p>
   The global multipath <code class="literal">user_friendly_names</code> option in the
   <code class="filename">/etc/multipath.conf</code> file is used to enable or disable
   the use of user-friendly names for multipath devices. If it is set to
   <code class="literal">no</code> (the default), multipath uses the WWID as the name of
   the device. If it is set to <code class="literal">yes</code>, multipath uses the
   <code class="filename">/var/lib/multipath/bindings</code> file to assign a persistent
   and unique name to the device in the form of
   <code class="filename">mpath&lt;<em class="replaceable ">N</em>&gt;</code> in the
   <code class="filename">/dev/mapper </code>directory. The <code class="literal">bindings
   file</code> option in the <code class="literal">/etc/multipath.conf</code> file can
   be used to specify an alternate location for the
   <code class="filename">bindings</code> file.
  </p><p>
   The global multipath <code class="literal">alias</code> option in the
   <code class="filename">/etc/multipath.conf</code> file is used to explicitly assign a
   name to the device. If an alias name is set up for a multipath device, the
   alias is used instead of the WWID or the user-friendly name.
  </p><p>
   Using the <code class="literal">user_friendly_names</code> option can be problematic
   in the following situations:
  </p><div class="variablelist "><dl class="variablelist"><dt id="idm139787667168032"><span class="term ">Root Device Is Using Multipath:</span></dt><dd><p>
      If the system root device is using multipath and you use the
      <code class="literal">user_friendly_names</code> option, the user-friendly settings
      in the <code class="filename">/var/lib/multipath/bindings</code> file are included
      in the <code class="filename">initrd</code>. If you later change the storage
      setup, such as by adding or removing devices, there is a mismatch between
      the bindings setting inside the <code class="filename">initrd</code> and the
      bindings settings in <code class="filename">/var/lib/multipath/bindings</code>.
     </p><div id="idm139787667164000" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.png" /><h6>Warning: Binding Mismatches</h6><p>
       A bindings mismatch between <code class="filename">initrd</code> and
       <code class="filename">/var/lib/multipath/bindings</code> can lead to a wrong
       assignment of mount points to devices, which can result in file system
       corruption and data loss.
      </p></div><p>
      To avoid this problem, we recommend that you use the default WWID
      settings for the system root device. You should not use aliases for the
      system root device. Because the device name would differ, using an alias
      causes you to lose the ability to seamlessly switch off multipathing via
      the kernel command line.
     </p></dd><dt id="idm139787667160496"><span class="term ">Mounting /var from Another Partition:</span></dt><dd><p>
      The default location of the <code class="literal">user_friendly_names</code>
      configuration file is <code class="filename">/var/lib/multipath/bindings</code>.
      If the <code class="filename">/var</code> data is not located on the system root
      device but mounted from another partition, the
      <code class="filename">bindings</code> file is not available when setting up
      multipathing.
     </p><p>
      Make sure that the <code class="filename">/var/lib/multipath/bindings</code> file
      is available on the system root device and multipath can find it. For
      example, this can be done as follows:
     </p><div class="orderedlist "><ol class="orderedlist" type="1"><li class="listitem "><p>
        Move the <code class="filename">/var/lib/multipath/bindings</code> file to
        <code class="filename">/etc/multipath/bindings</code>.
       </p></li><li class="listitem "><p>
        Set the <code class="literal">bindings_file</code> option in the
        <code class="literal">defaults</code> section of
        /<code class="filename">etc/multipath.conf</code> to this new location. For
        example:
       </p><div class="verbatim-wrap"><pre class="screen">defaults {
               user_friendly_names yes
               bindings_file "/etc/multipath/bindings"
}</pre></div></li></ol></div></dd><dt id="idm139787667150336"><span class="term ">Multipath Is in the initrd:</span></dt><dd><p>
      Even if the system root device is not on multipath, it is possible for
      multipath to be included in the <code class="filename">initrd</code>. For example,
      this can happen if the system root device is on LVM. If you use the
      <code class="literal">user_friendly_names</code> option and multipath is in the
      <code class="filename">initrd</code>, you should boot with the parameter
      <code class="command">multipath=off</code> to avoid problems.
     </p><p>
      This disables multipath only in the <code class="filename">initrd</code> during
      system boots. After the system boots, the
      <code class="filename">boot.multipath</code> and <code class="filename">multipathd</code>
      boot scripts can activate multipathing.
     </p></dd><dt id="idm139787667144592"><span class="term ">Multipathing in HA Clusters:</span></dt><dd><p>
      See <a class="xref" href="#sec.multipath.names.ha" title="17.9.1. Multipath Device Names in HA Clusters">Section 17.9.1, “Multipath Device Names in HA Clusters”</a> for details.
     </p></dd></dl></div><p>
   To enable user-friendly names or to specify aliases:
  </p><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
     Open the <code class="filename">/etc/multipath.conf</code> file in a text editor
     with <code class="systemitem">root</code> privileges.
    </p></li><li class="step "><p>
     (Optional) Modify the location of the
     <code class="filename">/var/lib/multipath/bindings</code> file.
    </p><p>
     The alternate path must be available on the system root device where
     multipath can find it.
    </p><ol type="a" class="substeps "><li class="step "><p>
       Move the <code class="filename">/var/lib/multipath/bindings</code> file to
       <code class="filename">/etc/multipath/bindings</code>.
      </p></li><li class="step "><p>
       Set the <code class="literal">bindings_file</code> option in the
       <code class="literal">defaults</code> section of
       /<code class="filename">etc/multipath.conf</code> to this new location. For
       example:
      </p><div class="verbatim-wrap"><pre class="screen">defaults {
          user_friendly_names yes
          bindings_file "/etc/multipath/bindings"
}</pre></div></li></ol></li><li class="step "><p>
     (Optional, not recommended) Enable user-friendly names:
    </p><ol type="a" class="substeps "><li class="step "><p>
       Uncomment the <code class="literal">defaults</code> section and its ending
       bracket.
      </p></li><li class="step "><p>
       Uncomment the <code class="literal">user_friendly_names option</code>, then change
       its value from No to Yes.
      </p><p>
       For example:
      </p><div class="verbatim-wrap"><pre class="screen">## Use user-friendly names, instead of using WWIDs as names.
defaults {
  user_friendly_names yes
}</pre></div></li></ol></li><li class="step "><p>
     (Optional) Specify your own names for devices by using the
     <code class="command">alias</code> option in the <code class="command">multipath</code>
     section.
    </p><p>
     For example:
    </p><div class="verbatim-wrap"><pre class="screen">## Use alias names, instead of using WWIDs as names.
multipaths {
       multipath {
               wwid           36006048000028350131253594d303030
               alias             blue1
       }
       multipath {
               wwid           36006048000028350131253594d303041
               alias             blue2
       }
       multipath {
               wwid           36006048000028350131253594d303145
               alias             yellow1
       }
       multipath {
               wwid           36006048000028350131253594d303334
               alias             yellow2
       }
}</pre></div><div id="idm139787667123360" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.png" /><h6>Important: WWWID Compared to WWN</h6><p>
      When you define device aliases in the
      <code class="filename">/etc/multipath.conf</code> file, ensure that you use each
      device’s WWID (such as
      <code class="filename">3600508e0000000009e6baa6f609e7908</code>) and not its WWN,
      which replaces the first character of a device ID with
      <code class="filename">0x</code>, such as
      <code class="filename">0x600508e0000000009e6baa6f609e7908</code>.
     </p></div></li><li class="step "><p>
     Save your changes, then close the file.
    </p></li><li class="step "><p>
     After you have modified the <code class="filename">/etc/multipath.conf</code> file,
     you must run <code class="command">dracut</code> <code class="option">-f</code> to re-create
     the <code class="filename">initrd</code> on your system, then restart the server
     for the changes to take effect. See <a class="xref" href="#sec.multipath.conf_file.apply" title="17.6.4. Applying the /etc/multipath.conf File Changes to Update the Multipath Maps">Section 17.6.4, “Applying the /etc/multipath.conf File Changes to Update the Multipath Maps”</a> for details.
    </p></li></ol></div></div><p>
   To use the entire LUN directly (for example, if you are using
   the SAN features to partition your storage), you can use the
   <code class="filename">/dev/disk/by-id/xxx</code> names for <code class="command">mkfs</code>,
   <code class="filename">/etc/fstab</code>, your application, and so on. Partitioned
   devices have <code class="filename">_part&lt;n&gt;</code> appended to the device
   name, such as <code class="filename">/dev/disk/by-id/xxx_part1</code>.
  </p><p>
   In the <code class="filename">/dev/disk/by-id</code> directory, the multipath-mapped
   devices are represented by the device’s <code class="filename">dm-uuid*</code> name
   or alias name (if you assign an alias for it in the
   <code class="filename">/etc/multipath.conf</code> file). The
   <code class="filename">scsi-</code> and <code class="filename">wwn-</code> device names
   represent physical paths to the devices.
  </p><div class="sect2 " id="sec.multipath.names.ha"><div class="titlepage"><div><div><h3 class="title" id="sec.multipath.names.ha"><span class="number">17.9.1 </span><span class="name">Multipath Device Names in HA Clusters</span> <a title="Permalink" class="permalink" href="#sec.multipath.names.ha">#</a></h3></div></div></div><p>
    Make sure that multipath devices have the same name across all devices by
    doing the following:
   </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
      Use UUID and alias names to ensure that multipath device names are
      consistent across all nodes in the cluster. Alias names must be unique
      across all nodes. Copy the <code class="filename">/etc/multipath.conf </code>file
      from the node to the <code class="filename">/etc/</code> directory for all of the
      other nodes in the cluster.
     </p></li><li class="listitem "><p>
      When using links to multipath-mapped devices, ensure that you specify the
      <code class="filename">dm-uuid*</code> name or alias name in the
      <code class="filename">/dev/disk/by-id</code> directory, and not a fixed path
      instance of the device. For information, see
      <a class="xref" href="#sec.multipath.names" title="17.9. Configuring User-Friendly Names or Alias Names">Section 17.9, “Configuring User-Friendly Names or Alias Names”</a>.
     </p></li><li class="listitem "><p>
      Set the <code class="literal">user_friendly_names</code> configuration option to
      <code class="literal">no</code> to disable it. A user-friendly name is unique to a
      node, but a device might not be assigned the same user-friendly name on
      every node in the cluster.
     </p></li></ul></div><div id="idm139787667100192" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.png" /><h6>Note: User-Friendly Names</h6><p>
     If you really need to use user-friendly names, you can force the
     system-defined user-friendly names to be consistent across all nodes in
     the cluster by doing the following:
    </p><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
       In the <code class="filename">/etc/multipath.conf</code> file on one node:
      </p><div class="orderedlist "><ol class="orderedlist" type="1"><li class="listitem "><p>
         Set the <code class="literal">user_friendly_names</code> configuration option to
         <code class="literal">yes</code> to enable it.
        </p><p>
         Multipath uses the <code class="filename">/var/lib/multipath/bindings</code>
         file to assign a persistent and unique name to the device in the form
         of <code class="filename">mpath&lt;<em class="replaceable ">N</em>&gt;</code> in
         the <code class="filename">/dev/mapper </code>directory.
        </p></li><li class="listitem "><p>
         (Optional) Set the <code class="literal">bindings_file</code> option in the
         <code class="literal">defaults</code> section of the
         <code class="literal">/etc/multipath.conf</code> file to specify an alternate
         location for the <code class="filename">bindings</code> file.
        </p><p>
         The default location is
         <code class="filename">/var/lib/multipath/bindings</code>.
        </p></li></ol></div></li><li class="step "><p>
       Set up all of the multipath devices on the node.
      </p></li><li class="step "><p>
       Copy the <code class="filename">/etc/multipath.conf</code> file from the node to
       the <code class="filename">/etc/</code> directory of all the other nodes in the
       cluster.
      </p></li><li class="step "><p>
       Copy the <code class="filename">bindings</code> file from the node to the
       <code class="filename">bindings_file</code> path on all of the other nodes in the
       cluster.
      </p></li><li class="step "><p>
       After you have modified the <code class="filename">/etc/multipath.conf</code>
       file, you must run <code class="command">dracut</code> <code class="option">-f</code> to
       re-create the <code class="filename">initrd</code> on your system, then restart
       the node for the changes to take effect. See <a class="xref" href="#sec.multipath.conf_file.apply" title="17.6.4. Applying the /etc/multipath.conf File Changes to Update the Multipath Maps">Section 17.6.4, “Applying the /etc/multipath.conf File Changes to Update the Multipath Maps”</a> for details. This applies to
       all affected nodes.
      </p></li></ol></div></div></div></div></div><div class="sect1 " id="sec.multipath.policies_failover"><div class="titlepage"><div><div><h2 class="title" id="sec.multipath.policies_failover"><span class="number">17.10 </span><span class="name">Configuring Path Failover Policies and Priorities</span> <a title="Permalink" class="permalink" href="#sec.multipath.policies_failover">#</a></h2></div></div></div><p>
   In a Linux host, when there are multiple paths to a storage controller, each
   path appears as a separate block device, and results in multiple block
   devices for single LUN. The Device Mapper Multipath service detects multiple
   paths with the same LUN ID, and creates a new multipath device with that ID.
   For example, a host with two HBAs attached to a storage controller with two
   ports via a single unzoned Fibre Channel switch sees four block devices:
   <code class="filename">/dev/sda</code>, <code class="filename">/dev/sdb</code>,
   <code class="filename">/dev/sdc</code>, and <code class="filename">/dev/sdd</code>. The Device
   Mapper Multipath service creates a single block device,
   <code class="filename">/dev/mpath/mpath1</code>, that reroutes I/O through those four
   underlying block devices.
  </p><p>
   This section describes how to specify policies for failover and configure
   priorities for the paths. Note that after you have modified the
   <code class="filename">/etc/multipath.conf</code> file, you must run
   <code class="command">dracut</code> <code class="option">-f</code> to re-create the
   <code class="filename">initrd</code> on your system, then restart the server for the
   changes to take effect. See <a class="xref" href="#sec.multipath.conf_file.apply" title="17.6.4. Applying the /etc/multipath.conf File Changes to Update the Multipath Maps">Section 17.6.4, “Applying the /etc/multipath.conf File Changes to Update the Multipath Maps”</a>
   for details.
  </p><div class="sect2 " id="sec.multipath.policies_failover.path"><div class="titlepage"><div><div><h3 class="title" id="sec.multipath.policies_failover.path"><span class="number">17.10.1 </span><span class="name">Configuring the Path Failover Policies</span> <a title="Permalink" class="permalink" href="#sec.multipath.policies_failover.path">#</a></h3></div></div></div><p>
    Use the <code class="command">multipath</code> command with the <code class="option">-p</code>
    option to set the path failover policy:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> multipath <em class="replaceable ">DEVICENAME</em> -p <em class="replaceable ">POLICY</em></pre></div><p>
    Replace <em class="replaceable ">POLICY</em> with one of the following policy
    options:
   </p><div class="table" id="idm139787667067344"><div class="table-title-wrap"><h6 class="table-title"><span class="number">Table 17.5: </span><span class="name">Group Policy Options for the multipath -p Command </span><a title="Permalink" class="permalink" href="#idm139787667067344">#</a></h6></div><div class="table-contents"><table summary="Group Policy Options for the multipath -p Command" border="1"><colgroup><col class="1" /><col class="2" /></colgroup><thead><tr><th>
        <p>
         Policy Option
        </p>
       </th><th>
        <p>
         Description
        </p>
       </th></tr></thead><tbody><tr><td>
        <p>
         failover
        </p>
       </td><td>
        <p>
         (Default) One path per priority group.
        </p>
       </td></tr><tr><td>
        <p>
         multibus
        </p>
       </td><td>
        <p>
         All paths in one priority group.
        </p>
       </td></tr><tr><td>
        <p>
         group_by_serial
        </p>
       </td><td>
        <p>
         One priority group per detected serial number.
        </p>
       </td></tr><tr><td>
        <p>
         group_by_prio
        </p>
       </td><td>
        <p>
         One priority group per path priority value. Priorities are determined
         by callout programs specified as a global, per-controller, or
         per-multipath option in the <code class="filename">/etc/multipath.conf</code>
         configuration file.
        </p>
       </td></tr><tr><td>
        <p>
         group_by_node_name
        </p>
       </td><td>
        <p>
         One priority group per target node name. Target node names are fetched
         in the<code class="filename"> /sys/class/fc_transport/target*/node_name</code>
         location.
        </p>
       </td></tr></tbody></table></div></div></div><div class="sect2 " id="sec.multipath.policies_failover.prio"><div class="titlepage"><div><div><h3 class="title" id="sec.multipath.policies_failover.prio"><span class="number">17.10.2 </span><span class="name">Configuring Failover Priorities</span> <a title="Permalink" class="permalink" href="#sec.multipath.policies_failover.prio">#</a></h3></div></div></div><p>
    You must manually enter the failover priorities for the device in the
    <code class="filename">/etc/multipath.conf</code> file. Examples for all settings
    and options can be found in the
    <code class="filename">/usr/share/doc/packages/multipath-tools/multipath.conf.annotated</code>
    file.
   </p><div class="sect3 " id="sec.multipath.policies_failover.prio.info"><div class="titlepage"><div><div><h4 class="title" id="sec.multipath.policies_failover.prio.info"><span class="number">17.10.2.1 </span><span class="name">Understanding Priority Groups and Attributes</span> <a title="Permalink" class="permalink" href="#sec.multipath.policies_failover.prio.info">#</a></h4></div></div></div><p>
     A <span class="emphasis"><em>priority group</em></span> is a collection of paths that go to
     the same physical LUN. By default, I/O is distributed in a round-robin
     fashion across all paths in the group. The <code class="command">multipath</code>
     command automatically creates priority groups for each LUN in the SAN
     based on the <code class="literal">path_grouping_policy</code> setting for that SAN.
     The <code class="command">multipath</code> command multiplies the number of paths in
     a group by the group’s priority to determine which group is the primary.
     The group with the highest calculated value is the primary. When all paths
     in the primary group are failed, the priority group with the next highest
     value becomes active.
    </p><p>
     A <span class="emphasis"><em>path priority</em></span> is an integer value assigned to a
     path. The higher the value, the higher the priority. An external program
     is used to assign priorities for each path. For a given device, the paths
     with the same priorities belong to the same priority group.
    </p><p>
     The <code class="literal">prio</code> setting is used in the
     <code class="literal">defaults{}</code> or <code class="literal">devices{}</code> section of
     the <code class="filename">/etc/multipath.conf</code> file. It is silently ignored
     when it is specified for an individual <code class="literal">multipath</code>
     definition in the <code class="literal">multipaths{)</code> section. The
     <code class="literal">prio</code> line specifies the prioritizer. If the prioritizer
     requires an argument, you specify the argument by using the
     <code class="literal">prio_args</code> keyword on a second line.
    </p><div class="sect1 bridgehead"><h2 class="title" id="idm139787667035360"><span class="name">PRIO Settings for the Defaults or Devices Sections</span><a title="Permalink" class="permalink" href="#idm139787667035360">#</a></h2></div><div class="variablelist "><dl class="variablelist"><dt id="idm139787667034592"><span class="term ">prio</span></dt><dd><p>
        Specifies the prioritizer program to call to obtain a path priority
        value. Weights are summed for each path group to determine the next
        path group to use in case of failure.
       </p><p>
        Use the <code class="literal">prio_args</code> keyword to specify arguments if
        the specified prioritizer requires arguments.
       </p><p>
        If no <code class="literal">prio</code> keyword is specified, all paths are
        equal. The default setting is <code class="literal">const</code> with a
        <code class="literal">prio_args</code> setting with no value.
       </p><div class="verbatim-wrap"><pre class="screen">prio "const"
prio_args ""</pre></div><p>
        Example prioritizer programs include:
       </p><div class="informaltable"><table border="1"><colgroup><col class="1" /><col class="2" /></colgroup><thead><tr><th>
            <p>
             Prioritizer Program
            </p>
           </th><th>
            <p>
             Description
            </p>
           </th></tr></thead><tbody><tr><td>
            <p>
             <code class="literal">alua</code>
            </p>
           </td><td>
            <p>
             Generates path priorities based on the SCSI-3 ALUA settings.
            </p>
           </td></tr><tr><td>
            <p>
             <code class="literal">const</code>
            </p>
           </td><td>
            <p>
             Generates the same priority for all paths.
            </p>
           </td></tr><tr><td>
            <p>
             <code class="literal">emc</code>
            </p>
           </td><td>
            <p>
             Generates the path priority for EMC arrays.
            </p>
           </td></tr><tr><td>
            <p>
             <code class="literal">hdc</code>
            </p>
           </td><td>
            <p>
             Generates the path priority for Hitachi HDS Modular storage
             arrays.
            </p>
           </td></tr><tr><td>
            <p>
             <code class="literal">hp_sw</code>
            </p>
           </td><td>
            <p>
             Generates the path priority for Compaq/HP controller in
             active/standby mode.
            </p>
           </td></tr><tr><td>
            <p>
             <code class="literal">ontap</code>
            </p>
           </td><td>
            <p>
             Generates the path priority for NetApp arrays.
            </p>
           </td></tr><tr><td>
            <p>
             <code class="literal">random</code>
            </p>
           </td><td>
            <p>
             Generates a random priority for each path.
            </p>
           </td></tr><tr><td>
            <p>
             <code class="literal">rdac</code>
            </p>
           </td><td>
            <p>
             Generates the path priority for LSI/Engenio RDAC controller.
            </p>
           </td></tr><tr><td>
            <p>
             <code class="literal">weightedpath</code>
            </p>
           </td><td>
            <p>
             Generates the path priority based on the weighted values you
             specify in the arguments for <code class="literal">prio_args</code>, such
             as:
            </p>
<div class="verbatim-wrap"><pre class="screen">[hbtl|devname] <em class="replaceable ">REGEX1</em> <em class="replaceable ">PRIO1</em> <em class="replaceable ">REGEX2</em> <em class="replaceable ">PRIO2</em>...</pre></div>
            <p>
             The <code class="literal">hbtl regex</code> argument format uses the SCSI
             <code class="literal">H:B:T:L</code> notation (such as
             <code class="literal">1:0:.:.</code> and <code class="literal">*:0:0:.</code>) with a
             weight value, where H, B, T, L are the host, bus, target, and LUN
             IDs for a device. For example:
            </p>
<div class="verbatim-wrap"><pre class="screen">prio "weightedpath"
prio_args "hbtl 1:.:.:. 2 4:.:.:. 4"</pre></div>
            <p>
             The <code class="literal">devname</code> regular expression argument format
             uses a device node name with a weight value for each device. For
             example:
            </p>
<div class="verbatim-wrap"><pre class="screen">prio "weightedpath"
prio_args "devname sda 50 sde 10 sdc 50 sdf 10"</pre></div>
           </td></tr></tbody></table></div></dd><dt id="idm139787666990304"><span class="term "><code class="literal">prio_args</code>
      </span></dt><dd><p>
        Specifies the arguments for the specified prioritizer program that
        requires arguments. Most <code class="literal">prio</code> programs do not need
        arguments.
       </p><p>
        There is no default. The value depends on the <code class="literal">prio</code>
        setting and whether the prioritizer requires arguments.
       </p></dd></dl></div><div class="sect1 bridgehead"><h2 class="title" id="idm139787666986496"><span class="name">Multipath Attributes</span><a title="Permalink" class="permalink" href="#idm139787666986496">#</a></h2></div><p>
     Multipath attributes are used to control the behavior of multipath I/O for
     devices. You can specify attributes as defaults for all multipath devices.
     You can also specify attributes that apply only to a given multipath
     device by creating an entry for that device in the
     <code class="literal">multipaths</code> section of the multipath configuration file.
    </p><div class="variablelist "><dl class="variablelist"><dt id="idm139787666984544"><span class="term "><code class="literal">user_friendly_names</code>
      </span></dt><dd><p>
        Specifies whether to use world-wide IDs (WWIDs) or to use the
        <code class="filename">/var/lib/multipath/bindings</code> file to assign a
        persistent and unique alias to the multipath devices in the form of
        <code class="filename">/dev/mapper/mpathN</code>.
       </p><p>
        This option can be used in the <code class="literal">devices</code> section and
        the <code class="literal">multipaths</code> section.
       </p><div class="informaltable"><table border="1"><colgroup><col class="1" /><col class="2" /></colgroup><thead><tr><th>
            <p>
             Value
            </p>
           </th><th>
            <p>
             Description
            </p>
           </th></tr></thead><tbody><tr><td>
            <p>
             <code class="literal">no</code>
            </p>
           </td><td>
            <p>
             (Default) Use the WWIDs shown in the
             <code class="filename">/dev/disk/by-id/</code> location.
            </p>
           </td></tr><tr><td>
            <p>
             <code class="literal">yes</code>
            </p>
           </td><td>
            <p>
             Autogenerate user-friendly names as aliases for the multipath
             devices instead of the actual ID.
            </p>
           </td></tr></tbody></table></div></dd><dt id="failback"><span class="term "><code class="literal">failback</code>
      </span></dt><dd><p>
        Specifies whether to monitor the failed path recovery, and indicates
        the timing for group failback after failed paths return to service.
       </p><p>
        When the failed path recovers, the path is added back into the
        multipath-enabled path list based on this setting. Multipath evaluates
        the priority groups, and changes the active priority group when the
        priority of the primary path exceeds the secondary group.
       </p><div class="informaltable"><table border="1"><colgroup><col class="1" /><col class="2" /></colgroup><thead><tr><th>
            <p>
             Value
            </p>
           </th><th>
            <p>
             Description
            </p>
           </th></tr></thead><tbody><tr><td>
            <p>
             <code class="literal">manual</code>
            </p>
           </td><td>
            <p>
             (Default) The failed path is not monitored for recovery. The
             administrator runs the <code class="command">multipath</code> command to
             update enabled paths and priority groups.
            </p>
           </td></tr><tr><td>
            <p>
             <code class="literal">followover</code>
            </p>
           </td><td>
            <p>
             Only perform automatic failback when the first path of a pathgroup
             becomes active. This keeps a node  from  automatically  failing
             back when another node requested the failover.
            </p>
           </td></tr><tr><td>
            <p>
             <code class="literal">immediate</code>
            </p>
           </td><td>
            <p>
             When a path recovers, enable the path immediately.
            </p>
           </td></tr><tr><td>
            <p>
             <code class="literal"><em class="replaceable ">N</em></code>
            </p>
           </td><td>
            <p>
             When the path recovers, wait <em class="replaceable ">N</em> seconds
             before enabling the path. Specify an integer value greater than 0.
            </p>
           </td></tr></tbody></table></div><p>
        We recommend failback setting of <code class="literal">manual</code> for
        multipath in cluster environments to prevent multipath failover
        ping-pong.
       </p><div class="verbatim-wrap"><pre class="screen">failback "manual"</pre></div><div id="idm139787666944160" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.png" /><h6>Important: Verification</h6><p>
         Make sure that you verify the failback setting with your storage
         system vendor. Different storage systems can require different
         settings.
        </p></div></dd><dt id="no_path_retry"><span class="term "><code class="literal">no_path_retry</code>
      </span></dt><dd><p>
        Specifies the behaviors to use on path failure.
       </p><div class="informaltable"><table border="1"><colgroup><col class="1" /><col class="2" /></colgroup><thead><tr><th>
            <p>
             Value
            </p>
           </th><th>
            <p>
             Description
            </p>
           </th></tr></thead><tbody><tr><td>
            <p>
             <code class="literal"><em class="replaceable ">N</em></code>
            </p>
           </td><td>
            <p>
             Specifies the number of retries until <code class="command">multipath</code>
             stops the queuing and fails the path. Specify an integer value
             greater than 0.
            </p>
            <p>
             In a cluster, you can specify a value of “0” to prevent
             queuing and allow resources to fail over.
            </p>
           </td></tr><tr><td>
            <p>
             <code class="literal">fail</code>
            </p>
           </td><td>
            <p>
             Specifies immediate failure (no queuing).
            </p>
           </td></tr><tr><td>
            <p>
             <code class="literal">queue</code>
            </p>
           </td><td>
            <p>
             Never stop queuing (queue forever until the path comes alive).
            </p>
           </td></tr></tbody></table></div><p>
        We recommend a retry setting of <code class="literal">fail</code> or
        <code class="literal">0</code> in the <code class="filename">/etc/multipath.conf</code>
        file when working in a cluster. This causes the resources to fail over
        when the connection is lost to storage. Otherwise, the messages queue
        and the resource failover cannot occur.
       </p><div class="verbatim-wrap"><pre class="screen">no_path_retry "fail"
no_path_retry "0"</pre></div><div id="idm139787666921600" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.png" /><h6>Important: Verification</h6><p>
         Make sure that you verify the retry settings with your storage system
         vendor. Different storage systems can require different settings.
        </p></div></dd><dt id="idm139787666919792"><span class="term "><code class="literal">path_checker</code>
      </span></dt><dd><p>
        Determines the state of the path.
       </p><div class="informaltable"><table border="1"><colgroup><col width="30%" class="1" /><col width="70%" class="2" /></colgroup><thead><tr><th>
            <p>
             Value
            </p>
           </th><th>
            <p>
             Description
            </p>
           </th></tr></thead><tbody><tr><td>
            <p>
             <code class="literal">directio</code>
            </p>
           </td><td>
            <p>
             Reads the first sector that has direct I/O. This is useful for
             DASD devices. Logs failure messages in the <code class="systemitem">systemd</code> journal (see
             <span class="intraxref">Book “<em class="citetitle ">Administration Guide</em>”, Chapter 15 “<code class="command">journalctl</code>: Query the <code class="systemitem">systemd</code> Journal”</span>).
            </p>
           </td></tr><tr><td>
            <p>
             <code class="literal">tur</code>
            </p>
           </td><td>
            <p>
             Issues an SCSI test unit ready command to the device. This is the
             preferred setting if the LUN supports it. On failure, the command
             does not fill up the <code class="systemitem">systemd</code> log journal with messages.
            </p>
           </td></tr><tr><td>
            <p>
             <em class="replaceable ">CUSTOM_VENDOR_VALUE</em>
            </p>
           </td><td>
            <p>
             Some SAN vendors provide custom path_checker options:
            </p>
            <div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p><span class="formalpara-title"><code class="literal">cciss_tur</code>: </span>
                Checks the path state for HP Smart Storage Arrays.
               </p></li><li class="listitem "><p><span class="formalpara-title"><code class="literal">emc_clariion</code>: </span>
                Queries the EMC Clariion EVPD page 0xC0 to determine the path
                state.
               </p></li><li class="listitem "><p><span class="formalpara-title"><code class="literal">hp_sw</code>: </span>
                Checks the path state (Up, Down, or Ghost) for HP storage
                arrays with Active/Standby firmware.
               </p></li><li class="listitem "><p><span class="formalpara-title"><code class="literal">rdac</code>: </span>
                Checks the path state for the LSI/Engenio RDAC storage
                controller.
               </p></li></ul></div>
           </td></tr></tbody></table></div></dd><dt id="idm139787666890976"><span class="term "><code class="literal">path_grouping_policy</code>
      </span></dt><dd><p>
        Specifies the path grouping policy for a multipath device hosted by a
        given controller.
       </p><div class="informaltable"><table border="1"><colgroup><col class="1" /><col class="2" /></colgroup><thead><tr><th>
            <p>
             Value
            </p>
           </th><th>
            <p>
             Description
            </p>
           </th></tr></thead><tbody><tr><td>
            <p>
             <code class="literal">failover</code>
            </p>
           </td><td>
            <p>
             (Default) One path is assigned per priority group so that only one
             path at a time is used.
            </p>
           </td></tr><tr><td>
            <p>
             <code class="literal">multibus</code>
            </p>
           </td><td>
            <p>
             All valid paths are in one priority group. Traffic is
             load-balanced across all active paths in the group.
            </p>
           </td></tr><tr><td>
            <p>
             <code class="literal">group_by_prio</code>
            </p>
           </td><td>
            <p>
             One priority group exists for each path priority value. Paths with
             the same priority are in the same priority group. Priorities are
             assigned by an external program.
            </p>
           </td></tr><tr><td>
            <p>
             <code class="literal">group_by_serial</code>
            </p>
           </td><td>
            <p>
             Paths are grouped by the SCSI target serial number (controller
             node WWN).
            </p>
           </td></tr><tr><td>
            <p>
             <code class="literal">group_by_node_name</code>
            </p>
           </td><td>
            <p>
             One priority group is assigned per target node name. Target node
             names are fetched in
             <code class="filename">/sys/class/fc_transport/target*/node_name</code>.
            </p>
           </td></tr></tbody></table></div></dd><dt id="idm139787666867680"><span class="term "><code class="literal">path_selector</code>
      </span></dt><dd><p>
        Specifies the path-selector algorithm to use for load balancing.
       </p><div class="informaltable"><table border="1"><colgroup><col class="1" /><col class="2" /></colgroup><thead><tr><th>
            <p>
             Value
            </p>
           </th><th>
            <p>
             Description
            </p>
           </th></tr></thead><tbody><tr><td>
            <p>
             <code class="literal">round-robin 0</code>
            </p>
           </td><td>
            <p>
             The load-balancing algorithm used to balance traffic across all
             active paths in a priority group.
            </p>
           </td></tr><tr><td>
            <p>
             <code class="literal">queue-length 0</code>
            </p>
           </td><td>
            <p>
             A dynamic load balancer that balances the number of in-flight I/O
             on paths similar to the least-pending option.
            </p>
           </td></tr><tr><td>
            <p>
             <code class="literal">service-time 0</code>
            </p>
           </td><td>
            <p>
             (Default) A service-time oriented load balancer that balances I/O
             on paths according to the latency.
            </p>
           </td></tr></tbody></table></div></dd><dt id="idm139787666850544"><span class="term ">pg_timeout</span></dt><dd><p>
        Specifies path group timeout handling. No value can be specified; an
        internal default is set.
       </p></dd><dt id="polling_interval"><span class="term "><code class="literal">polling_interval</code>
      </span></dt><dd><p>
        Specifies the time in seconds between the end of one path checking
        cycle and the beginning of the next path checking cycle.
       </p><p>
        Specify an integer value greater than 0. The default value is 5. Make
        sure that you verify the polling_interval setting with your storage
        system vendor. Different storage systems can require different
        settings.
       </p></dd><dt id="idm139787666845328"><span class="term "><code class="literal">rr_min_io_rq</code>
      </span></dt><dd><p>
        Specifies the number of I/O requests to route to a path before
        switching to the next path in the current path group, using
        request-based device-mapper-multipath.
       </p><p>
        Specify an integer value greater than 0. The default value is 1.
       </p><div class="verbatim-wrap"><pre class="screen">rr_min_io_rq "1"</pre></div></dd><dt id="idm139787666842112"><span class="term "><code class="literal">rr_weight</code>
      </span></dt><dd><p>
        Specifies the weighting method to use for paths.
       </p><div class="informaltable"><table border="1"><colgroup><col class="1" /><col class="2" /></colgroup><thead><tr><th>
            <p>
             Value
            </p>
           </th><th>
            <p>
             Description
            </p>
           </th></tr></thead><tbody><tr><td>
            <p>
             <code class="literal">uniform</code>
            </p>
           </td><td>
            <p>
             (Default) All paths have the same round-robin weights.
            </p>
           </td></tr><tr><td>
            <p>
             <code class="literal">priorities</code>
            </p>
           </td><td>
            <p>
             Each path’s weight is determined by the path’s priority times
             the rr_min_io_rq setting.
            </p>
           </td></tr></tbody></table></div></dd><dt id="idm139787666827888"><span class="term "><code class="literal">uid_attribute</code>
      </span></dt><dd><p>
        A udev attribute that provides a unique path identifier. The default
        value is <code class="literal">ID_SERIAL</code>.
       </p></dd></dl></div></div><div class="sect3 " id="sec.multipath.policies_failover.rr"><div class="titlepage"><div><div><h4 class="title" id="sec.multipath.policies_failover.rr"><span class="number">17.10.2.2 </span><span class="name">Configuring for Round-Robin Load Balancing</span> <a title="Permalink" class="permalink" href="#sec.multipath.policies_failover.rr">#</a></h4></div></div></div><p>
     All paths are active. I/O is configured for some number of seconds or some
     number of I/O transactions before moving to the next open path in the
     sequence.
    </p></div><div class="sect3 " id="sec.multipath.policies_failover.prio.single"><div class="titlepage"><div><div><h4 class="title" id="sec.multipath.policies_failover.prio.single"><span class="number">17.10.2.3 </span><span class="name">Configuring for Single Path Failover</span> <a title="Permalink" class="permalink" href="#sec.multipath.policies_failover.prio.single">#</a></h4></div></div></div><p>
     A single path with the highest priority (lowest value setting) is active
     for traffic. Other paths are available for failover, but are not used
     unless failover occurs.
    </p></div><div class="sect3 " id="sec.multipath.policies_failover.prio.rr_grouping"><div class="titlepage"><div><div><h4 class="title" id="sec.multipath.policies_failover.prio.rr_grouping"><span class="number">17.10.2.4 </span><span class="name">Grouping I/O Paths for Round-Robin Load Balancing</span> <a title="Permalink" class="permalink" href="#sec.multipath.policies_failover.prio.rr_grouping">#</a></h4></div></div></div><p>
     Multiple paths with the same priority fall into the active group. When all
     paths in that group fail, the device fails over to the next highest
     priority group. All paths in the group share the traffic load in a
     round-robin load balancing fashion.
    </p></div></div><div class="sect2 " id="sec.multipath.policies_failover.rtpg"><div class="titlepage"><div><div><h3 class="title" id="sec.multipath.policies_failover.rtpg"><span class="number">17.10.3 </span><span class="name">Reporting Target Path Groups</span> <a title="Permalink" class="permalink" href="#sec.multipath.policies_failover.rtpg">#</a></h3></div></div></div><p>
    Use the SCSI Report Target Port Groups (<code class="command">sg_rtpg(8)</code>)
    command. For information, see the man page for
    <code class="command">sg_rtpg(8)</code>.
   </p></div></div><div class="sect1 " id="sec.multipath.root"><div class="titlepage"><div><div><h2 class="title" id="sec.multipath.root"><span class="number">17.11 </span><span class="name">Configuring Multipath I/O for the Root Device</span> <a title="Permalink" class="permalink" href="#sec.multipath.root">#</a></h2></div></div></div><p>
   Device Mapper Multipath I/O (DM-MPIO) is available and supported for
   <code class="filename">/boot</code> and <code class="filename">/root</code> in <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span>.
   In addition, the YaST partitioner in the YaST installer supports
   enabling multipath during the install.
  </p><div class="sect2 " id="sec.multipath.root.install"><div class="titlepage"><div><div><h3 class="title" id="sec.multipath.root.install"><span class="number">17.11.1 </span><span class="name">Enabling Multipath I/O at Install Time</span> <a title="Permalink" class="permalink" href="#sec.multipath.root.install">#</a></h3></div></div></div><p>
    To install the operating system on a multipath device,
    the multipath software must be running at install time. The
    <code class="systemitem">multipathd</code> daemon is not
    automatically active during the system installation. You can start it by
    using the <span class="guimenu">Configure Multipath</span> option in the YaST
    Partitioner.
   </p><div class="sect3 " id="sec.multipath.root.install.aa_lun"><div class="titlepage"><div><div><h4 class="title" id="sec.multipath.root.install.aa_lun"><span class="number">17.11.1.1 </span><span class="name">Enabling Multipath I/O at Install Time on an Active/Active Multipath Storage LUN</span> <a title="Permalink" class="permalink" href="#sec.multipath.root.install.aa_lun">#</a></h4></div></div></div><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
       Choose <span class="guimenu">Expert Partitioner</span> on the <span class="guimenu">Suggested
       Partitioning</span> screen during the installation.
      </p></li><li class="step "><p>
       Select the <span class="guimenu">Hard Disks</span> main icon, click the
       <span class="guimenu">Configure</span> button, then select <span class="guimenu">Configure
       Multipath</span>.
      </p></li><li class="step "><p>
       Start multipath.
      </p><p>
       YaST starts to rescan the disks and shows available multipath devices
       (such as
       <code class="filename">/dev/disk/by-id/dm-uuid-mpath-3600a0b80000f4593000012ae4ab0ae65</code>).
       This is the device that should be used for all further processing.
      </p></li><li class="step "><p>
       Click <span class="guimenu">Next</span> to continue with the installation.
      </p></li></ol></div></div></div><div class="sect3 " id="sec.multipath.root.install.ap_lun"><div class="titlepage"><div><div><h4 class="title" id="sec.multipath.root.install.ap_lun"><span class="number">17.11.1.2 </span><span class="name">Enabling Multipath I/O at Install Time on an Active/Passive Multipath Storage LUN</span> <a title="Permalink" class="permalink" href="#sec.multipath.root.install.ap_lun">#</a></h4></div></div></div><p>
     The <code class="systemitem">multipathd</code> daemon is not
     automatically active during the system installation. You can start it by
     using the <span class="guimenu">Configure Multipath</span> option in the YaST
     Partitioner.
    </p><p>
     To enable multipath I/O at install time for an active/passive multipath
     storage LUN:
    </p><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
       Choose <span class="guimenu">Expert Partitioner</span> on the <span class="guimenu">Suggested
       Partitioning</span> screen during the installation.
      </p></li><li class="step "><p>
       Select the <span class="guimenu">Hard Disks</span> main icon, click the
       <span class="guimenu">Configure</span> button, then select <span class="guimenu">Configure
       Multipath</span>.
      </p></li><li class="step "><p>
       Start multipath.
      </p><p>
       YaST starts to rescan the disks and shows available multipath devices
       (such as
       <code class="filename">/dev/disk/by-id/dm-uuid-mpath-3600a0b80000f4593000012ae4ab0ae65</code>).
       This is the device that should be used for all further processing. Write
       down the device path and UUID; you will need it later.
      </p></li><li class="step "><p>
       Click <span class="guimenu">Next</span> to continue with the installation.
      </p></li><li class="step "><p>
       After all settings are done and the installation is finished, YaST
       starts to write the boot loader information, and displays a countdown to
       restart the system. Stop the counter by clicking the
       <span class="guimenu">Stop</span> button and press
       <span class="keycap">Ctrl</span><span class="key-connector">–</span><span class="keycap">Alt</span><span class="key-connector">–</span><span class="keycap">F5</span>
       to access a console.
      </p></li><li class="step "><p>
       Use the console to determine if a passive path was entered in the
       <code class="filename">/boot/grub2/device.map</code> file for the
       <code class="filename">hd0</code> entry.
      </p><p>
       This is necessary because the installation does not distinguish between
       active and passive paths.
      </p><ol type="a" class="substeps "><li class="step "><p class="intro">
         Mount the root device to <code class="filename">/mnt</code> by entering
        </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> mount /dev/disk/by-id/<em class="replaceable ">UUID</em>;_part2 /mnt</pre></div><p>
         For example, enter
        </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> mount /dev/disk/by-id/dm-uuid-mpath-3600a0b80000f4593000012ae4ab0ae65_part2 /mnt</pre></div></li><li class="step "><p>
         Mount the boot device to <code class="filename">/mnt/boot</code> by entering
        </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> mount /dev/disk/by-id/<em class="replaceable ">UUID</em>_part1 /mnt/boot</pre></div><p>
         For example, enter
        </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> mount /dev/disk/by-id/dm-uuid-mpath-3600a0b80000f4593000012ae4ab0ae65_part2 /mnt/boot</pre></div></li><li class="step "><p>
         In the <code class="filename">/mnt/boot/grub2/device.map</code> file, determine
         if the <code class="filename">hd0</code> entry points to a passive path, then
         do one of the following:
        </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p><span class="formalpara-title">Active path: </span>
            No action is needed. Skip all remaining steps and return to the
            YaST graphical environment by pressing
            <span class="keycap">Ctrl</span><span class="key-connector">–</span><span class="keycap">Alt</span><span class="key-connector">–</span><span class="keycap">F7</span>
            and continue with the installation.
           </p></li><li class="listitem "><p><span class="formalpara-title">Passive path: </span>
            The configuration must be changed and the boot loader must be
            reinstalled.
           </p></li></ul></div></li></ol></li><li class="step "><p class="intro">
       If the <code class="filename">hd0</code> entry points to a passive path, change
       the configuration and reinstall the boot loader:
      </p><ol type="a" class="substeps "><li class="step "><p class="intro">
         Enter the following commands at the console prompt:
        </p><div class="verbatim-wrap"><pre class="screen">          mount -o bind /dev /mnt/dev
          mount -o bind /sys /mnt/sys
          mount -o bind /proc /mnt/proc
          chroot /mnt</pre></div></li><li class="step "><p class="intro">
         At the console, run <code class="command">multipath -ll</code>, then check the
         output to find the active path.
        </p><p>
         Passive paths are flagged as <code class="literal">ghost</code>.
        </p></li><li class="step "><p>
         In the <code class="filename">/boot/grub2/device.map</code> file, change the
         <code class="literal">hd0</code> entry to an active path, save the changes, and
         close the file.
        </p></li><li class="step "><p>
         Reinstall the boot loader by entering
        </p><div class="verbatim-wrap"><pre class="screen">grub-install /dev/disk/by-id/<em class="replaceable ">UUID</em>_part1 /mnt/boot</pre></div><p>
         For example, enter
        </p><div class="verbatim-wrap"><pre class="screen">grub-install /dev/disk/by-id/dm-uuid-mpath-3600a0b80000f4593000012ae4ab0ae65_part2 /mnt/boot</pre></div></li><li class="step "><p>
         Enter the following commands:
        </p><div class="verbatim-wrap"><pre class="screen">exit
umount /mnt/*
umount /mnt</pre></div></li></ol></li><li class="step "><p>
       Return to the YaST graphical environment by pressing
       <span class="keycap">Ctrl</span><span class="key-connector">–</span><span class="keycap">Alt</span><span class="key-connector">–</span><span class="keycap">F7</span>.
      </p></li><li class="step "><p>
       Click <span class="guimenu">OK</span> to continue with the installation reboot.
      </p></li></ol></div></div></div></div><div class="sect2 " id="sec.multipath.root.enable_existing"><div class="titlepage"><div><div><h3 class="title" id="sec.multipath.root.enable_existing"><span class="number">17.11.2 </span><span class="name">Enabling Multipath I/O for an Existing Root Device</span> <a title="Permalink" class="permalink" href="#sec.multipath.root.enable_existing">#</a></h3></div></div></div><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
      Install Linux with only a single path active, preferably one where the
      <code class="filename">by-id</code> symbolic links are listed in the partitioner.
     </p></li><li class="step "><p>
      Mount the devices by using the <code class="filename">/dev/disk/by-id</code> path
      used during the install.
     </p></li><li class="step "><p>
      Add dm-multipath to <code class="filename">/etc/dracut.conf.d/01-dist.conf</code>
      by adding the following line:
     </p><div class="verbatim-wrap"><pre class="screen">force_drivers+="dm-multipath"</pre></div></li><li class="step "><p>
      
      For IBM Z, before running <code class="command">dracut</code>, edit the
      <code class="filename">/etc/zipl.conf</code> file to change the by-path
      information in <code class="filename">zipl.conf</code> with the same by-id
      information that was used in <code class="filename">/etc/fstab</code>.
     </p></li><li class="step "><p>
      Run <code class="command">dracut</code> <code class="option">-f</code> to update the
      <code class="filename">initrd</code> image.
     </p></li><li class="step "><p>
      For IBM Z, after running <code class="command">dracut</code>, run
      <code class="command">zipl</code>.
     </p></li><li class="step "><p>
      Reboot the server.
     </p></li></ol></div></div></div><div class="sect2 " id="sec.multipath.root.disable"><div class="titlepage"><div><div><h3 class="title" id="sec.multipath.root.disable"><span class="number">17.11.3 </span><span class="name">Disabling Multipath I/O on the Root Device</span> <a title="Permalink" class="permalink" href="#sec.multipath.root.disable">#</a></h3></div></div></div><p>
    Add <code class="literal">multipath=off</code> to the kernel command line. This can
    be done with the YaST Boot Loader module. Open <span class="guimenu">Boot
    Loader Installation</span> › <span class="guimenu">Kernel Parameters</span> and add the parameter to both command lines.
   </p><p>
    This affects only the root device. All other devices are not affected.
   </p></div></div><div class="sect1 " id="sec.multipath.raid"><div class="titlepage"><div><div><h2 class="title" id="sec.multipath.raid"><span class="number">17.12 </span><span class="name">Configuring Multipath I/O for an Existing Software RAID</span> <a title="Permalink" class="permalink" href="#sec.multipath.raid">#</a></h2></div></div></div><p>
   Ideally, you should configure multipathing for devices before you use them
   as components of a software RAID device. If you add multipathing after
   creating any software RAID devices, the DM-MPIO service might be starting
   after the <code class="command">multipath</code> service on reboot, which makes
   multipathing appear not to be available for RAIDs. You can use the procedure
   in this section to get multipathing running for a previously existing
   software RAID.
  </p><p>
   For example, you might need to configure multipathing for devices in a
   software RAID under the following circumstances:
  </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
     If you create a new software RAID as part of the Partitioning settings
     during a new install or upgrade.
    </p></li><li class="listitem "><p>
     If you did not configure the devices for multipathing before using them in
     the software RAID as a member device or spare.
    </p></li><li class="listitem "><p>
     If you grow your system by adding new HBA adapters to the server or
     expanding the storage subsystem in your SAN.
    </p></li></ul></div><div id="idm139787666721360" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.png" /><h6>Note: Assumptions</h6><p>
    The following instructions assume the software RAID device is
    <code class="filename">/dev/mapper/mpath0</code>, which is its device name as
    recognized by the kernel. It assumes you have enabled user-friendly names
    in the <code class="filename">/etc/multipath.conf</code> file as described in
    <a class="xref" href="#sec.multipath.names" title="17.9. Configuring User-Friendly Names or Alias Names">Section 17.9, “Configuring User-Friendly Names or Alias Names”</a>.
   </p><p>
    Make sure to modify the instructions for the device name of your
    software RAID.
   </p></div><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p class="intro">
     Open a terminal console.
    </p><p>
     Except where otherwise directed, use this console to enter the commands in
     the following steps.
    </p></li><li class="step "><p>
     If any software RAID devices are currently mounted or running, enter the
     following commands for each device to unmount the device and stop it.
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> umount /dev/mapper/mpath0
<code class="prompt user">tux &gt; </code><code class="command">sudo</code> mdadm --misc --stop /dev/mapper/mpath0</pre></div></li><li class="step "><p>
     Stop the <code class="command">md</code> service by entering
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> systemctl stop mdmonitor</pre></div></li><li class="step "><p>
     Start the <code class="systemitem">multipathd</code> daemon by
     entering the following command:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code>systemctl start multipathd</pre></div></li><li class="step "><p>
     After the multipathing service has been started, verify that the software
     RAID’s component devices are listed in the
     <code class="filename">/dev/disk/by-id</code> directory. Do one of the following:
    </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p><span class="formalpara-title">Devices Are Listed: </span>
        The device names should now have symbolic links to their Device Mapper
        Multipath device names, such as <code class="filename">/dev/dm-1</code>.
       </p></li><li class="listitem "><p><span class="formalpara-title">Devices Are Not Listed: </span>
        Force the multipath service to recognize them by flushing and
        rediscovering the devices by entering
       </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> multipath -F
<code class="prompt user">tux &gt; </code><code class="command">sudo</code> multipath -v0</pre></div><p>
       The devices should now be listed in
       <code class="filename">/dev/disk/by-id</code>, and have symbolic links to their
       Device Mapper Multipath device names. For example:
      </p><div class="verbatim-wrap"><pre class="screen">lrwxrwxrwx 1 root root 10 2011-01-06 11:42 dm-uuid-mpath-36006016088d014007e0d0d2213ecdf11 -&gt; ../../dm-1</pre></div></li></ul></div></li><li class="step "><p>
     Restart the <code class="filename">mdmonitor</code> service and the RAID device by
     entering
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> systemctl start mdmonitor</pre></div></li><li class="step "><p>
     Check the status of the software RAID by entering
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> mdadm --detail /dev/mapper/mpath0</pre></div><p>
     The RAID’s component devices should match their Device Mapper Multipath
     device names that are listed as the symbolic links of devices in the
     <code class="filename">/dev/disk/by-id</code> directory.
    </p></li><li class="step "><p>
     In case the root (<code class="filename">/</code>) device or any
     parts of it (such as <code class="filename">/var</code>, <code class="filename">/etc</code>, <code class="filename">/log</code>) are on the SAN and
     multipath is needed to boot, rebuild the <code class="systemitem">initrd</code>:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code>dracut -f --add-multipath</pre></div></li><li class="step "><p>
     Reboot the server to apply the changes.
    </p></li><li class="step "><p>
     Verify that the software RAID array comes up properly on top of the
     multipathed devices by checking the RAID status. Enter
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> mdadm --detail /dev/mapper/mpath0</pre></div><p>
     For example:
    </p><table border="0" summary="Simple list" class="simplelist "><tr><td><code class="literal">Number Major Minor RaidDevice State</code>
     </td></tr><tr><td><code class="literal">0 253 0 0 active sync /dev/dm-0</code>
     </td></tr><tr><td><code class="literal">1 253 1 1 active sync /dev/dm-1</code>
     </td></tr><tr><td><code class="literal">2 253 2 2 active sync /dev/dm-2</code>
     </td></tr></table></li></ol></div></div><div id="idm139787666681424" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.png" /><h6>Note: Using mdadm with Multipath Devices</h6><p>
    The <code class="command">mdadm</code> tool requires that the devices be accessed by
    the ID rather than by the device node path. Refer to
    <a class="xref" href="#sec.multipath.mpiotools.mdadm" title="17.4.3. Using MDADM for Multipathed Devices">Section 17.4.3, “Using MDADM for Multipathed Devices”</a> for details.
   </p></div></div><div class="sect1 " id="sec.multipath.lvm"><div class="titlepage"><div><div><h2 class="title" id="sec.multipath.lvm"><span class="number">17.13 </span><span class="name">Using LVM2 on Multipath Devices</span> <a title="Permalink" class="permalink" href="#sec.multipath.lvm">#</a></h2></div></div></div><p>
   When using multipath, all paths to a resource are present as devices
   in the device tree. By default LVM checks if there is a multipath
   device on top of any device in the device tree. If LVM finds a
   multipath device on top, it assumes that the device is a multipath
   component and ignores the (underlying) device.
   This is the most likely desired behavior, but it can be changed
   in <code class="filename">/etc/lvm/lvm.conf</code>. When
   multipath_component_detection is set to 0, LVM is scanning multipath
   component devices. The default entry in lvm.conf is:
  </p><div class="verbatim-wrap"><pre class="screen">    # By default, LVM2 will ignore devices used as component paths
    # of device-mapper multipath devices.
    # 1 enables; 0 disables.
    multipath_component_detection = 1</pre></div></div><div class="sect1 " id="sec.multipath.best_practice"><div class="titlepage"><div><div><h2 class="title" id="sec.multipath.best_practice"><span class="number">17.14 </span><span class="name">Best Practice</span> <a title="Permalink" class="permalink" href="#sec.multipath.best_practice">#</a></h2></div></div></div><div class="sect2 " id="sec.multipath.best_practice.scandev"><div class="titlepage"><div><div><h3 class="title" id="sec.multipath.best_practice.scandev"><span class="number">17.14.1 </span><span class="name">Scanning for New Devices without Rebooting</span> <a title="Permalink" class="permalink" href="#sec.multipath.best_practice.scandev">#</a></h3></div></div></div><p>
    If your system has already been configured for multipathing and you later
    need to add more storage to the SAN, you can use the
    <code class="command">rescan-scsi-bus.sh</code> script to scan for the new devices.
    By default, this script scans all HBAs with typical LUN ranges. The general
    syntax for the command looks like the following:
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> rescan-scsi-bus.sh [options] [host [host ...]]</pre></div><p>
    For most storage subsystems, the script can be run successfully without
    options. However, some special cases might need to use one or more options.
    Run <code class="command">rescan-scsi-bus.sh --help</code> for details.
   </p><div id="idm139787666669472" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.png" /><h6>Warning: EMC PowerPath Environments</h6><p>
     In EMC PowerPath environments, do not use the
     <code class="filename">rescan-scsi-bus.sh</code> utility provided with the
     operating system or the HBA vendor scripts for scanning the SCSI buses. To
     avoid potential file system corruption, EMC requires that you follow the
     procedure provided in the vendor documentation for EMC PowerPath for
     Linux.
    </p></div><p>
    Use the following procedure to scan the devices and make them available to
    multipathing without rebooting the system.
   </p><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
      On the storage subsystem, use the vendor’s tools to allocate the device
      and update its access control settings to allow the Linux system access
      to the new storage. Refer to the vendor’s documentation for details.
     </p></li><li class="step "><p>
      Scan all targets for a host to make its new device known to the middle
      layer of the Linux kernel’s SCSI subsystem. At a terminal console
      prompt, enter
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> rescan-scsi-bus.sh</pre></div><p>
      Depending on your setup, you might need to run
      <code class="command">rescan-scsi-bus.sh</code> with optional parameters. Refer to
      <code class="command">rescan-scsi-bus.sh --help</code> for details.
     </p></li><li class="step "><p>
      Check for scanning progress in the <code class="systemitem">systemd</code> journal (see
      <span class="intraxref">Book “<em class="citetitle ">Administration Guide</em>”, Chapter 15 “<code class="command">journalctl</code>: Query the <code class="systemitem">systemd</code> Journal”</span> for details). At a terminal console
      prompt, enter
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> journalctl -r</pre></div><p>
      This command displays the last lines of the log. For example:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> journalctl -r
Feb 14 01:03 kernel: SCSI device sde: 81920000
Feb 14 01:03 kernel: SCSI device sdf: 81920000
Feb 14 01:03 multipathd: sde: path checker registered
Feb 14 01:03 multipathd: sdf: path checker registered
Feb 14 01:03 multipathd: mpath4: event checker started
Feb 14 01:03 multipathd: mpath5: event checker started
Feb 14 01:03:multipathd: mpath4: remaining active paths: 1
Feb 14 01:03 multipathd: mpath5: remaining active paths: 1
[...]</pre></div></li><li class="step "><p>
      Repeat the previous steps to add paths through other HBA adapters on the
      Linux system that are connected to the new device.
     </p></li><li class="step "><p>
      Run the <code class="command">multipath</code> command to recognize the devices for
      DM-MPIO configuration. At a terminal console prompt, enter
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> multipath</pre></div><p>
      You can now configure the new device for multipathing.
     </p></li></ol></div></div></div><div class="sect2 " id="sec.multipath.best_practice.scanpart"><div class="titlepage"><div><div><h3 class="title" id="sec.multipath.best_practice.scanpart"><span class="number">17.14.2 </span><span class="name">Scanning for New Partitioned Devices without Rebooting</span> <a title="Permalink" class="permalink" href="#sec.multipath.best_practice.scanpart">#</a></h3></div></div></div><p>
    Use the example in this section to detect a newly added multipathed LUN
    without rebooting.
   </p><div id="idm139787666650576" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.png" /><h6>Warning: EMC PowerPath Environments</h6><p>
     In EMC PowerPath environments, do not use the
     <code class="filename">rescan-scsi-bus.sh</code> utility provided with the
     operating system or the HBA vendor scripts for scanning the SCSI buses. To
     avoid potential file system corruption, EMC requires that you follow the
     procedure provided in the vendor documentation for EMC PowerPath for
     Linux.
    </p></div><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
      Open a terminal console.
     </p></li><li class="step "><p>
      Scan all targets for a host to make its new device known to the middle
      layer of the Linux kernel’s SCSI subsystem. At a terminal console
      prompt, enter
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code>rescan-scsi-bus.sh</pre></div><p>
      Depending on your setup, you might need to run
      <code class="command">rescan-scsi-bus.sh</code> with optional parameters. Refer to
      <code class="command">rescan-scsi-bus.sh --help</code> for details.
     </p></li><li class="step "><p>
      Verify that the device is seen (such as if the link has a new time stamp)
      by entering
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code>ls -lrt /dev/dm-*</pre></div><p>
      You can also verify the devices in <code class="filename">/dev/disk/by-id</code>
      by entering
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code>ls -l /dev/disk/by-id/</pre></div></li><li class="step "><p>
      Verify the new device appears in the log by entering
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> journalctl -r</pre></div></li><li class="step "><p>
      Use a text editor to add a new alias definition for the device in the
      <code class="filename">/etc/multipath.conf</code> file, such as
      <code class="filename">data_vol3</code>.
     </p><p>
      For example, if the UUID is
      <code class="filename">36006016088d014006e98a7a94a85db11</code>, make the
      following changes:
     </p><div class="verbatim-wrap"><pre class="screen">defaults {
     user_friendly_names   yes
  }
multipaths {
     multipath {
          wwid    36006016088d014006e98a7a94a85db11
          alias  data_vol3
          }
  }</pre></div></li><li class="step "><p>
      Create a partition table for the device by entering
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code>fdisk /dev/disk/by-id/dm-uuid-mpath-&lt;UUID&gt;</pre></div><p>
      Replace UUID with the device WWID, such as
      <code class="filename">36006016088d014006e98a7a94a85db11</code>.
     </p></li><li class="step "><p>
      Trigger udev by entering
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> echo 'add' &gt; /sys/block/<em class="replaceable ">DM_DEVICE</em>/uevent</pre></div><p>
      For example, to generate the device-mapper devices for the partitions on
      <code class="filename">dm-8</code>, enter
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> echo 'add' &gt; /sys/block/dm-8/uevent</pre></div></li><li class="step "><p>
      Create a file system on the device
      <code class="filename">/dev/disk/by-id/dm-uuid-mpath-<em class="replaceable ">UUID_partN</em></code>.
      Depending on your choice for the file system, you may use one of the
      following commands for this purpose: <code class="command">mkfs.btrfs</code>
      <code class="command">mkfs.ext3</code>, <code class="command">mkfs.ext4</code>, or
      <code class="command">mkfs.xfs</code>. Refer to the respective man pages for
      details. Replace <code class="filename">UUID_partN</code> with the actual UUID and
      partition number, such as 36006016088d014006e98a7a94a85db11_part1.
     </p></li><li class="step "><p>
      Create a label for the new partition by entering the following command:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> tune2fs -L <em class="replaceable ">LABELNAME</em> /dev/disk/by-id/dm-uuid-<em class="replaceable ">UUID_partN</em></pre></div><p>
      Replace <code class="filename">UUID_partN</code> with the actual UUID and
      partition number, such as 36006016088d014006e98a7a94a85db11_part1.
      Replace <em class="replaceable ">LABELNAME</em> with a label of your choice.
     </p></li><li class="step "><p>
      Reconfigure DM-MPIO to let it read the aliases by entering
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> multipathd -k'reconfigure'</pre></div></li><li class="step "><p>
      Verify that the device is recognized by
      <code class="systemitem">multipathd</code> by entering
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> multipath -ll</pre></div></li><li class="step "><p>
      Use a text editor to add a mount entry in the
      <code class="filename">/etc/fstab</code> file.
     </p><p>
      At this point, the alias you created in a previous step is not yet in the
      <code class="filename">/dev/disk/by-label</code> directory. Add a mount entry for
      the <code class="filename">/dev/dm-9</code> path, then change the entry before the
      next time you reboot to
     </p><div class="verbatim-wrap"><pre class="screen">LABEL=<em class="replaceable ">LABELNAME</em></pre></div></li><li class="step "><p>
      Create a directory to use as the mount point, then mount the device.
     </p></li></ol></div></div></div><div class="sect2 " id="sec.multipath.best_practice.status"><div class="titlepage"><div><div><h3 class="title" id="sec.multipath.best_practice.status"><span class="number">17.14.3 </span><span class="name">Viewing Multipath I/O Status</span> <a title="Permalink" class="permalink" href="#sec.multipath.best_practice.status">#</a></h3></div></div></div><p>
    Querying the multipath I/O status outputs the current status of the
    multipath maps.
   </p><p>
    The <code class="command">multipath -l</code> option displays the current path status
    as of the last time that the path checker was run. It does not run the path
    checker.
   </p><p>
    The <code class="command">multipath -ll</code> option runs the path checker, updates
    the path information, then displays the current status information. This
    command always displays the latest information about the path status.
   </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> multipath -ll
3600601607cf30e00184589a37a31d911
[size=127 GB][features="0"][hwhandler="1 emc"]

\_ round-robin 0 [active][first]
  \_ 1:0:1:2 sdav 66:240  [ready ][active]
  \_ 0:0:1:2 sdr  65:16   [ready ][active]

\_ round-robin 0 [enabled]
  \_ 1:0:0:2 sdag 66:0    [ready ][active]
  \_ 0:0:0:2 sdc  8:32    [ready ][active]</pre></div><p>
    For each device, it shows the device’s ID, size, features, and hardware
    handlers.
   </p><p>
    Paths to the device are automatically grouped into priority groups on
    device discovery. Only one priority group is active at a time. For an
    active/active configuration, all paths are in the same group. For an
    active/passive configuration, the passive paths are placed in separate
    priority groups.
   </p><p>
    The following information is displayed for each group:
   </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
      Scheduling policy used to balance I/O within the group, such as
      round-robin
     </p></li><li class="listitem "><p>
      Whether the group is active, disabled, or enabled
     </p></li><li class="listitem "><p>
      Whether the group is the first (highest priority) group
     </p></li><li class="listitem "><p>
      Paths contained within the group
     </p></li></ul></div><p>
    The following information is displayed for each path:
   </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
      The physical address as <em class="replaceable ">HOST:BUS:TARGET:LUN</em>,
      such as 1:0:1:2
     </p></li><li class="listitem "><p>
      Device node name, such as <code class="filename">sda</code>
     </p></li><li class="listitem "><p>
      Major:minor numbers
     </p></li><li class="listitem "><p>
      Status of the device
     </p></li></ul></div></div><div class="sect2 " id="sec.multipath.best_practice.io_error"><div class="titlepage"><div><div><h3 class="title" id="sec.multipath.best_practice.io_error"><span class="number">17.14.4 </span><span class="name">Managing I/O in Error Situations</span> <a title="Permalink" class="permalink" href="#sec.multipath.best_practice.io_error">#</a></h3></div></div></div><p>
    You might need to configure multipathing to queue I/O if all paths fail
    concurrently by enabling queue_if_no_path. Otherwise, I/O fails immediately
    if all paths are gone. In certain scenarios, where the driver, the HBA, or
    the fabric experience spurious errors, DM-MPIO should be configured to
    queue all I/O where those errors lead to a loss of all paths, and never
    propagate errors upward.
   </p><p>
    When you use multipathed devices in a cluster, you might choose to disable
    queue_if_no_path. This automatically fails the path instead of queuing the
    I/O, and escalates the I/O error to cause a failover of the cluster
    resources.
   </p><p>
    Because enabling queue_if_no_path leads to I/O being queued indefinitely
    unless a path is reinstated, ensure that <code class="command">multipathd</code> is
    running and works for your scenario. Otherwise, I/O might be stalled
    indefinitely on the affected multipathed device until reboot or until you
    manually return to failover instead of queuing.
   </p><p>
    To test the scenario:
   </p><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
      Open a terminal console.
     </p></li><li class="step "><p>
      Activate queuing instead of failover for the device I/O by entering
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> dmsetup message <em class="replaceable ">DEVICE_ID</em> 0 queue_if_no_path</pre></div><p>
      Replace the <em class="replaceable ">DEVICE_ID</em> with the ID for your
      device. The 0 value represents the sector and is used when sector
      information is not needed.
     </p><p>
      For example, enter:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> dmsetup message 3600601607cf30e00184589a37a31d911 0 queue_if_no_path</pre></div></li><li class="step "><p>
      Return to failover for the device I/O by entering
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> dmsetup message <em class="replaceable ">DEVICE_ID</em> 0 fail_if_no_path</pre></div><p>
      This command immediately causes all queued I/O to fail.
     </p><p>
      Replace the <em class="replaceable ">DEVICE_ID</em> with the ID for your
      device. For example, enter
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> dmsetup message 3600601607cf30e00184589a37a31d911 0 fail_if_no_path</pre></div></li></ol></div></div><p>
    To set up queuing I/O for scenarios where all paths fail:
   </p><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
      Open a terminal console.
     </p></li><li class="step "><p>
      Open the <code class="filename">/etc/multipath.conf</code> file in a text editor.
     </p></li><li class="step "><p>
      Uncomment the defaults section and its ending bracket, then add the
      <code class="literal">default_features</code> setting, as follows:
     </p><div class="verbatim-wrap"><pre class="screen">defaults {
  default_features "1 queue_if_no_path"
}</pre></div></li><li class="step "><p>
      After you modify the <code class="filename">/etc/multipath.conf</code> file, you
      must run <code class="command">dracut</code> <code class="option">-f</code> to re-create the
      <code class="filename">initrd</code> on your system, then reboot for the changes
      to take effect.
     </p></li><li class="step "><p>
      When you are ready to return to failover for the device I/O, enter
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> dmsetup message <em class="replaceable ">MAPNAME</em> 0 fail_if_no_path</pre></div><p>
      Replace the <em class="replaceable ">MAPNAME</em> with the mapped alias name
      or the device ID for the device. The 0 value represents the sector and is
      used when sector information is not needed.
     </p><p>
      This command immediately causes all queued I/O to fail and propagates the
      error to the calling application.
     </p></li></ol></div></div></div><div class="sect2 " id="sec.multipath.best_practice.io_stalled"><div class="titlepage"><div><div><h3 class="title" id="sec.multipath.best_practice.io_stalled"><span class="number">17.14.5 </span><span class="name">Resolving Stalled I/O</span> <a title="Permalink" class="permalink" href="#sec.multipath.best_practice.io_stalled">#</a></h3></div></div></div><p>
    If all paths fail concurrently and I/O is queued and stalled, do the
    following:
   </p><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
      Enter the following command at a terminal console prompt:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> dmsetup message <em class="replaceable ">MAPNAME</em> 0 fail_if_no_path</pre></div><p>
      Replace <code class="literal"><em class="replaceable ">MAPNAME</em></code> with the
      correct device ID or mapped alias name for the device. The 0 value
      represents the sector and is used when sector information is not needed.
     </p><p>
      This command immediately causes all queued I/O to fail and propagates the
      error to the calling application.
     </p></li><li class="step "><p>
      Reactivate queuing by entering the following command:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> dmsetup message <em class="replaceable ">MAPNAME</em> 0 queue_if_no_path</pre></div></li></ol></div></div></div><div class="sect2 " id="sec.multipath.best_practice.zseries"><div class="titlepage"><div><div><h3 class="title" id="sec.multipath.best_practice.zseries"><span class="number">17.14.6 </span><span class="name">Configuring Default Settings for IBM Z Devices</span> <a title="Permalink" class="permalink" href="#sec.multipath.best_practice.zseries">#</a></h3></div></div></div><p>
    Testing of the IBM Z device with multipathing has shown that the
    <code class="literal">dev_loss_tmo</code> parameter should be set to 90 seconds, and
    the <code class="literal">fast_io_fail_tmo</code> parameter should be set to 5
    seconds. If you are using IBM Z devices, modify the
    <code class="filename">/etc/multipath.conf</code> file to specify the values as
    follows:
   </p><div class="verbatim-wrap"><pre class="screen">defaults {
       dev_loss_tmo 90
       fast_io_fail_tmo 5
}</pre></div><p>
    The <code class="literal">dev_loss_tmo</code> parameter sets the number of seconds to
    wait before marking a multipath link as bad. When the path fails, any
    current I/O on that failed path fails. The default value varies according
    to the device driver being used. The valid range of values is 0 to 600
    seconds. To use the driver’s internal timeouts, set the value to zero (0)
    or to any value greater than 600.
   </p><p>
    The <code class="literal">fast_io_fail_tmo</code> parameter sets the length of time
    to wait before failing I/O when a link problem is detected. I/O that
    reaches the driver fails. If I/O is in a blocked queue, the I/O does not
    fail until the <code class="literal">dev_loss_tmo</code> time elapses and the queue
    is unblocked.
   </p><p>
    If you modify the <code class="filename">/etc/multipath.conf</code> file, the
    changes are not applied until you update the multipath maps, or until the
    <code class="systemitem">multipathd</code> daemon is restarted
    (<code class="command">systemctl restart multipathd</code>).
   </p></div><div class="sect2 " id="sec.multipath.best_practice.netapp"><div class="titlepage"><div><div><h3 class="title" id="sec.multipath.best_practice.netapp"><span class="number">17.14.7 </span><span class="name">Using Multipath with NetApp Devices</span> <a title="Permalink" class="permalink" href="#sec.multipath.best_practice.netapp">#</a></h3></div></div></div><p>
    When using multipath for NetApp devices, we recommend the following
    settings in the <code class="filename">/etc/multipath.conf</code> file:
   </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
      Set the default values for the following parameters globally for NetApp
      devices:
     </p><div class="verbatim-wrap"><pre class="screen">max_fds max
queue_without_daemon no</pre></div></li><li class="listitem "><p>
      Set the default values for the following parameters for NetApp devices in
      the hardware table:
     </p><div class="verbatim-wrap"><pre class="screen">dev_loss_tmo infinity
fast_io_fail_tmo 5
features "3 queue_if_no_path pg_init_retries 50"</pre></div></li></ul></div></div><div class="sect2 " id="sec.multipath.best_practice.noflush"><div class="titlepage"><div><div><h3 class="title" id="sec.multipath.best_practice.noflush"><span class="number">17.14.8 </span><span class="name">Using --noflush with Multipath Devices</span> <a title="Permalink" class="permalink" href="#sec.multipath.best_practice.noflush">#</a></h3></div></div></div><p>
    The <code class="option">--noflush</code> option should always be used when running on
    multipath devices.
   </p><p>
    For example, in scripts where you perform a table reload, you use the
    <code class="literal">--noflush</code> option on resume to ensure that any
    outstanding I/O is not flushed, because you need the multipath topology
    information.
   </p><div class="verbatim-wrap"><pre class="screen">load
resume --noflush</pre></div></div><div class="sect2 " id="sec.multipath.best_practice.san_timeout"><div class="titlepage"><div><div><h3 class="title" id="sec.multipath.best_practice.san_timeout"><span class="number">17.14.9 </span><span class="name">SAN Timeout Settings When the Root Device Is Multipathed</span> <a title="Permalink" class="permalink" href="#sec.multipath.best_practice.san_timeout">#</a></h3></div></div></div><p>
    A system with root (<code class="filename">/</code>) on a multipath device might
    stall when all paths have failed and are removed from the system because a
    <code class="literal">dev_loss_tmo</code> timeout is received from the storage
    subsystem (such as Fibre Channel storage arrays).
   </p><p>
    If the system device is configured with multiple paths and the multipath
    <code class="literal">no_path_retry</code> setting is active, you should modify the
    storage subsystem’s <code class="literal">dev_loss_tmo</code> setting accordingly
    to ensure that no devices are removed during an all-paths-down scenario. We
    strongly recommend that you set the <code class="literal">dev_loss_tmo</code> value
    to be equal to or higher than the <code class="literal">no_path_retry</code> setting
    from multipath.
   </p><p>
    The recommended setting for the storage subsystem’s
    <code class="literal">dev_los_tmo</code> is
   </p><div class="verbatim-wrap"><pre class="screen">&lt;dev_loss_tmo&gt; = &lt;no_path_retry&gt; * &lt;polling_interval&gt;</pre></div><p>
    where the following definitions apply for the multipath values:
   </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
      <code class="literal">no_path_retry</code> is the number of retries for multipath
      I/O until the path is considered to be lost, and queuing of IO is
      stopped.
     </p></li><li class="listitem "><p>
      <code class="literal">polling_interval</code> is the time in seconds between path
      checks.
     </p></li></ul></div><p>
    Each of these multipath values should be set from the
    <code class="filename">/etc/multipath.conf</code> configuration file. For
    information, see
    <a class="xref" href="#sec.multipath.conf_file" title="17.6. Creating or Modifying the /etc/multipath.conf File">Section 17.6, “Creating or Modifying the /etc/multipath.conf File”</a>.
   </p></div></div><div class="sect1 " id="sec.multipath.trouble"><div class="titlepage"><div><div><h2 class="title" id="sec.multipath.trouble"><span class="number">17.15 </span><span class="name">Troubleshooting MPIO</span> <a title="Permalink" class="permalink" href="#sec.multipath.trouble">#</a></h2></div></div></div><p>
   This section describes some known issues and possible solutions for MPIO.
  </p><div class="sect2 " id="sec.multipath.trouble.grub2"><div class="titlepage"><div><div><h3 class="title" id="sec.multipath.trouble.grub2"><span class="number">17.15.1 </span><span class="name">Installing GRUB2 on Multipath Devices</span> <a title="Permalink" class="permalink" href="#sec.multipath.trouble.grub2">#</a></h3></div></div></div><p>
    On legacy BIOS systems with Btrfs, <code class="command">grub2-install</code>
    can fail with a <span class="emphasis"><em>permission denied</em></span>. To fix
    this, make sure that the
    <code class="filename">/boot/grub2/<em class="replaceable ">SUBDIR</em>/</code>
    subvolume is mounted in read-write (rw) mode.
    <em class="replaceable ">SUBDIR</em> can be
    <code class="literal">x86_64-efi</code> or <code class="literal">i386-pc</code>.
   </p></div><div class="sect2 " id="sec.multipath.trouble.root"><div class="titlepage"><div><div><h3 class="title" id="sec.multipath.trouble.root"><span class="number">17.15.2 </span><span class="name">The System Exits to Emergency Shell at Boot When Multipath Is Enabled</span> <a title="Permalink" class="permalink" href="#sec.multipath.trouble.root">#</a></h3></div></div></div><p>
    During boot the system exits into the emergency shell with messages similar
    to the following:
   </p><div class="verbatim-wrap"><pre class="screen">[  OK  ] Listening on multipathd control socket.
         Starting Device-Mapper Multipath Device Controller...
[  OK  ] Listening on Device-mapper event daemon FIFOs.
         Starting Device-mapper event daemon...
         Expecting device dev-disk-by\x2duuid-34be48b2\x2dc21...32dd9.device...
         Expecting device dev-sda2.device...
[  OK  ] Listening on udev Kernel Socket.
[  OK  ] Listening on udev Control Socket.
         Starting udev Coldplug all Devices...
         Expecting device dev-disk-by\x2duuid-1172afe0\x2d63c...5d0a7.device...
         Expecting device dev-disk-by\x2duuid-c4a3d1de\x2d4dc...ef77d.device...
[  OK  ] Started Create list of required static device nodes ...current kernel.
         Starting Create static device nodes in /dev...
[  OK  ] Started Collect Read-Ahead Data.
[  OK  ] Started Device-mapper event daemon.
[  OK  ] Started udev Coldplug all Devices.
         Starting udev Wait for Complete Device Initialization...
[  OK  ] Started Replay Read-Ahead Data.
         Starting Load Kernel Modules...
         Starting Remount Root and Kernel File Systems...
[  OK  ] Started Create static devices
[*     ] (1 of 4) A start job is running for dev-disk-by\x2du...(7s / 1min 30s)
[*     ] (1 of 4) A start job is running for dev-disk-by\x2du...(7s / 1min 30s)

...

Timed out waiting for device dev-disk-by\x2duuid-c4a...cfef77d.device.
[DEPEND] Dependency failed for /opt.
[DEPEND] Dependency failed for Local File Systems.
[DEPEND] Dependency failed for Postfix Mail Transport Agent.
Welcome to emergency shell
Give root password for maintenance
(or press Control-D to continue):</pre></div><p>
    This issue occurs in the following situations:
   </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
       A non-multipath root file system is not blacklisted when multipath is
       enabled. See <a class="xref" href="#pro.multipath.trouble.root.blacklist" title="Emergency Shell: Blacklist File Systems">Procedure 17.1, “Emergency Shell: Blacklist File Systems”</a>
      </p></li><li class="listitem "><p>
       On a system with a multipath root file system, multipath has been
       enabled/disabled without rebuilding the <code class="filename">initrd</code>. See
       <a class="xref" href="#pro.multipath.trouble.root.initrd" title="Emergency Shell: Rebuild the initrd">Procedure 17.2, “Emergency Shell: Rebuild the <code class="filename">initrd</code>”</a>.
      </p></li><li class="listitem "><p>
       Network-storage drivers are missing in the <code class="filename">initrd</code>
       on a system with network-attached storage and multipath enabled.
      </p></li></ul></div><div class="procedure " id="pro.multipath.trouble.root.blacklist"><div class="procedure-title-wrap"><h6 class="procedure-title"><span class="number">Procedure 17.1: </span><span class="name">Emergency Shell: Blacklist File Systems </span><a title="Permalink" class="permalink" href="#pro.multipath.trouble.root.blacklist">#</a></h6></div><div class="procedure-contents"><p>
     This fix is required if the root file system is not on multipath but
     multipath is enabled. In such a setup, multipath tries to set its paths
     for all devices that are not blacklisted. Since the device with the root
     file system is already mounted, it is inaccessible for multipath and
     causes it to fail. Fix this issue by configuring multipath correctly by
     blacklisting the root device in <code class="filename">/etc/multipath.conf</code>:
    </p><ol class="procedure" type="1"><li class="step "><p>
      Run <code class="command">multipath -v2</code> in the emergency shell and identify
      the device for the root file system. It will result in an output similar
      to:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root">root # </code>multipath -v2
Dec 18 10:10:03 | 3600508b1001030343841423043300400: ignoring map</pre></div><p>
      The string between <code class="literal">| </code> and <code class="literal">:</code> is the
      WWID needed for blacklisting.
     </p></li><li class="step "><p>
      Open <code class="filename">/etc/multipath.conf</code> and add the following:
     </p><div class="verbatim-wrap"><pre class="screen">blacklist {
  wwid "<em class="replaceable ">WWWID</em>"
}</pre></div><p>
      Replace <em class="replaceable ">WWWID</em> with the ID you retrieved in the
      previous step. For more information see
      <a class="xref" href="#sec.multipath.blacklist" title="17.8. Blacklisting Non-Multipath Devices">Section 17.8, “Blacklisting Non-Multipath Devices”</a>.
     </p></li><li class="step "><p>
      Exit the emergency shell and reboot the server by pressing <span class="keycap">Ctrl</span><span class="key-connector">–</span><span class="keycap">D</span>.
     </p></li></ol></div></div><div class="procedure " id="pro.multipath.trouble.root.initrd"><div class="procedure-title-wrap"><h6 class="procedure-title"><span class="number">Procedure 17.2: </span><span class="name">Emergency Shell: Rebuild the <code class="filename">initrd</code> </span><a title="Permalink" class="permalink" href="#pro.multipath.trouble.root.initrd">#</a></h6></div><div class="procedure-contents"><p>
     This fix is required if the multipath status (enabled or disabled) differs
     between <code class="filename">initrd</code> and system. To fix this, rebuild the
     <code class="filename">initrd</code>:
    </p><ol class="procedure" type="1"><li class="step "><p>
      If multipath has been <span class="emphasis"><em>enabled</em></span> in the system,
      rebuild the initrd with multipath support with this command:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code>dracut --force --add multipath</pre></div><p>
      In case Multipath has been <span class="emphasis"><em>disabled</em></span> in the system,
      rebuild the initrd with Multipath support with this command:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code>dracut --force -o multipath</pre></div></li><li class="step "><p>
      Exit the emergency shell and reboot the server by pressing <span class="keycap">Ctrl</span><span class="key-connector">–</span><span class="keycap">D</span>.
     </p></li></ol></div></div><div class="procedure " id="pro.multipath.trouble.root.drivers"><div class="procedure-title-wrap"><h6 class="procedure-title"><span class="number">Procedure 17.3: </span><span class="name">Emergency Shell: Rebuild the <code class="filename">initrd</code> </span><a title="Permalink" class="permalink" href="#pro.multipath.trouble.root.drivers">#</a></h6></div><div class="procedure-contents"><p>
     This fix is required if the initrd does not contain drivers to access
     network attached storage. This may, for example, be the case when the
     system was installed without multipath or when the respective hardware was
     added or replaced.
    </p><ol class="procedure" type="1"><li class="step "><p>
      Add the required driver(s) to the variable <code class="envar">force_drivers</code>
      in the file <code class="filename">/etc/dracut.conf.d/01-dist.conf</code>. For
      example, if your system contains a RAID controller accessed by the
      <code class="filename">hpsa</code> driver and multipathed devices connected to a
      QLogic controller accessed by the driver qla23xx, this entry would look
      like:
     </p><div class="verbatim-wrap"><pre class="screen">force_drivers+="hpsa qla23xx"</pre></div></li><li class="step "><p>
      Rebuild the <code class="systemitem">initrd</code> using the following command:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code>dracut -f --add-multipath</pre></div></li><li class="step "><p>
      To prevent the system from booting into emergency mode if attaching the
      network storage fails, it is recommended to add the mount option
      <code class="literal">_netdev</code> to the respective entries in
      <code class="filename">/etc/fstab</code>.
     </p></li><li class="step "><p>
      Exit the emergency shell and reboot the server by pressing <span class="keycap">Ctrl</span><span class="key-connector">–</span><span class="keycap">D</span>.
     </p></li></ol></div></div></div><div class="sect2 " id="sec.multipath.trouble.prio_fail"><div class="titlepage"><div><div><h3 class="title" id="sec.multipath.trouble.prio_fail"><span class="number">17.15.3 </span><span class="name">PRIO Settings for Individual Devices Fail After Upgrading to Multipath 0.4.9 or Later</span> <a title="Permalink" class="permalink" href="#sec.multipath.trouble.prio_fail">#</a></h3></div></div></div><p>
    Multipath Tools from version 0.4.9 onward uses the <code class="literal">prio</code>
    setting in the <code class="literal">defaults{}</code> or
    <code class="literal">devices{}</code> section of the
    <code class="filename">/etc/multipath.conf</code> file. It silently ignores the
    keyword <code class="literal">prio</code> when it is specified for an individual
    <code class="literal">multipath</code> definition in the
    <code class="literal">multipaths{)</code> section.
   </p><p>
    Multipath Tools 0.4.8 allowed the prio setting in the individual
    <code class="literal">multipath</code> definition in the
    <code class="literal">multipaths{)</code> section to override the
    <code class="literal">prio</code> settings in the <code class="literal">defaults{}</code> or
    <code class="literal">devices{}</code> section.
   </p></div><div class="sect2 " id="sec.multipath.trouble.prio_argument_fail"><div class="titlepage"><div><div><h3 class="title" id="sec.multipath.trouble.prio_argument_fail"><span class="number">17.15.4 </span><span class="name">PRIO Settings with Arguments Fail After Upgrading to multipath-tools-0.4.9 or Later</span> <a title="Permalink" class="permalink" href="#sec.multipath.trouble.prio_argument_fail">#</a></h3></div></div></div><p>
    When you upgrade from <code class="filename">multipath-tools-0.4.8</code> to
    <code class="filename">multipath-tools-0.4.9</code>, the <code class="literal">prio</code>
    settings in the <code class="filename">/etc/multipath.conf</code> file are broken
    for prioritizers that require an argument. In multipath-tools-0.4.9, the
    <code class="literal">prio</code> keyword is used to specify the prioritizer, and the
    <code class="literal">prio_args</code> keyword is used to specify the argument for
    prioritizers that require an argument. Previously, both the prioritizer and
    its argument were specified on the same <code class="literal">prio</code> line.
   </p><p>
    For example, in multipath-tools-0.4.8, the following line was used to
    specify a prioritizer and its arguments on the same line.
   </p><div class="verbatim-wrap"><pre class="screen">prio "weightedpath hbtl [1,3]:.:.+:.+ 260 [0,2]:.:.+:.+ 20"</pre></div><p>
    After upgrading to multipath-tools-0.4.9 or later, the command causes an
    error. The message is similar to the following:
   </p><div class="verbatim-wrap"><pre class="screen">&lt;Month day hh:mm:ss&gt; | Prioritizer 'weightedpath hbtl [1,3]:.:.+:.+ 260
[0,2]:.:.+:.+ 20' not found in /lib64/multipath</pre></div><p>
    To resolve this problem, use a text editor to modify the
    <code class="literal">prio</code> line in the
    <code class="filename">/etc/multipath.conf</code> file. Create two lines with the
    prioritizer specified on the <code class="filename">prio</code> line, and the
    prioritizer argument specified on the <code class="filename">prio_args</code> line
    below it:
   </p><div class="verbatim-wrap"><pre class="screen">prio "weightedpath"
prio_args "hbtl [1,3]:.:.+:.+ 260 [0,2]:.:.+:.+ 20"</pre></div><p>
    Restart the <code class="systemitem">multipathd</code> daemon for
    the changes to become active by running <code class="command">sudo systemctl restart
    multipathd</code>.
   </p></div><div class="sect2 " id="sec.multipath.trouble.tids"><div class="titlepage"><div><div><h3 class="title" id="sec.multipath.trouble.tids"><span class="number">17.15.5 </span><span class="name">Technical Information Documents</span> <a title="Permalink" class="permalink" href="#sec.multipath.trouble.tids">#</a></h3></div></div></div><p>
    For information about troubleshooting multipath I/O issues on SUSE Linux
    Enterprise Server, see the following Technical Information Documents (TIDs)
    in the SUSE Knowledgebase:
   </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
      <a class="link" href="http://www.suse.com/support/kb/doc.php?id=3617600" target="_blank"><em class="citetitle ">Using
      LVM on local and SAN attached devices</em></a>
     </p></li><li class="listitem "><p>
      <a class="link" href="http://www.suse.com/support/kb/doc.php?id=7007498" target="_blank"><em class="citetitle ">Using
      LVM on Multipath (DM MPIO) Devices</em></a>
     </p></li><li class="listitem "><p>
      <a class="link" href="https://www.suse.com/support/kb/doc.php?id=7009660" target="_blank"><em class="citetitle ">HOWTO:
      Add, Resize and Remove LUN without restarting SLES</em></a>
     </p></li></ul></div></div></div></div><div xml:lang="en" class="chapter " id="cha.nfs4_acls" lang="en"><div class="titlepage"><div><div><h2 class="title"><span class="number">18 </span><span class="name">Managing Access Control Lists over NFSv4</span> <a title="Permalink" class="permalink" href="#cha.nfs4_acls">#</a></h2><div class="doc-status"><ul><li><span class="ds-label">Filename: </span>storage_nfs-acl.xml</li><li><span class="ds-label">ID: </span>cha.nfs4_acls</li></ul></div></div></div></div><div class="line"></div><p>
  There is no single standard for Access Control Lists (ACLs) in Linux beyond
  the simple read, write, and execute (<code class="literal">rwx</code>) flags for user,
  group, and others (<code class="literal">ugo</code>). One option for finer control is
  the <em class="citetitle ">Draft POSIX ACLs</em>, which were never formally
  standardized by POSIX. Another is the NFSv4 ACLs, which were designed to be
  part of the NFSv4 network file system with the goal of making something that
  provided reasonable compatibility between POSIX systems on Linux and WIN32
  systems on Microsoft Windows.
 </p><p>
  NFSv4 ACLs are not sufficient to correctly implement Draft POSIX ACLs so no
  attempt has been made to map ACL accesses on an NFSv4 client (such as using
  <code class="command">setfacl</code>).
 </p><p>
  When using NFSv4, Draft POSIX ACLs cannot be used even in emulation and NFSv4
  ACLs need to be used directly; that means while <code class="command">setfacl</code>
  can work on NFSv3, it cannot work on NFSv4. To allow NFSv4 ACLs to be used on
  an NFSv4 file system, SUSE Linux Enterprise Server provides the
  <code class="filename">nfs4-acl-tools</code> package, which contains the following:
 </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
    <code class="command">nfs4-getfacl</code>
   </p></li><li class="listitem "><p>
    <code class="command">nfs4-setfacl</code>
   </p></li><li class="listitem "><p>
    <code class="command">nfs4-editacl</code>
   </p></li></ul></div><p>
  These operate in a generally similar way to <code class="command">getfacl</code> and
  <code class="command">setfacl</code> for examining and modifying NFSv4 ACLs. These
  commands are effective only if the file system on the NFS server provides
  full support for NFSv4 ACLs. Any limitation imposed by the server will affect
  programs running on the client in that some particular combinations of Access
  Control Entries (ACEs) might not be possible.
 </p><p>
  It is not supported to mount NFS volumes locally on the exporting NFS server.
 </p><div class="sect1 bridgehead"><h2 class="title" id="idm139787666427504"><span class="name">Additional Information</span><a title="Permalink" class="permalink" href="#idm139787666427504">#</a></h2></div><p>
  For information, see <em class="citetitle ">Introduction to NFSv4 ACLs</em> at
  <a class="link" href="http://wiki.linux-nfs.org/wiki/index.php/ACLs#Introduction_to_NFSv4_ACLs" target="_blank">http://wiki.linux-nfs.org/wiki/index.php/ACLs#Introduction_to_NFSv4_ACLs</a>.
 </p></div></div><div class="legal-section"><div class="appendix " id="idm139787666424928"><div class="titlepage"><div><div><h1 class="title"><span class="number">A </span><span class="name">GNU Licenses</span> <a title="Permalink" class="permalink" href="#idm139787666424928">#</a></h1><div class="doc-status"><ul><li><span class="ds-label">Filename: </span>common_legal.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><div class="line"><div class="toc"><dl><dt><span class="sect1"><a href="#idm139787666420288"><span class="number">A.1 </span><span class="name">GNU Free Documentation License</span></a></span></dt></dl></div></div><p>
  This appendix contains the GNU Free Documentation License version 1.2.
 </p><div class="sect1 " id="idm139787666420288"><div class="titlepage"><div><div><h2 class="title legal" id="idm139787666420288"><span class="name">GNU Free Documentation License</span> <a title="Permalink" class="permalink" href="#idm139787666420288">#</a></h2><div class="doc-status"><ul><li><span class="ds-label">Filename: </span>common_gfdl1.2_i.xml</li><li><span class="ds-label">ID: </span><span class="ds-message">no ID found</span></li></ul></div></div></div></div><p>
  Copyright (C) 2000, 2001, 2002 Free Software Foundation, Inc. 51 Franklin St,
  Fifth Floor, Boston, MA 02110-1301 USA. Everyone is permitted to copy and
  distribute verbatim copies of this license document, but changing it is not
  allowed.
 </p><div class="sect4 bridgehead"><h5 class="title legal" id="idm139787666416768"><span class="name">
    0. PREAMBLE
  </span><a title="Permalink" class="permalink" href="#idm139787666416768">#</a></h5></div><p>
  The purpose of this License is to make a manual, textbook, or other
  functional and useful document "free" in the sense of freedom: to assure
  everyone the effective freedom to copy and redistribute it, with or without
  modifying it, either commercially or non-commercially. Secondarily, this
  License preserves for the author and publisher a way to get credit for their
  work, while not being considered responsible for modifications made by
  others.
 </p><p>
  This License is a kind of "copyleft", which means that derivative works of
  the document must themselves be free in the same sense. It complements the
  GNU General Public License, which is a copyleft license designed for free
  software.
 </p><p>
  We have designed this License to use it for manuals for free software,
  because free software needs free documentation: a free program should come
  with manuals providing the same freedoms that the software does. But this
  License is not limited to software manuals; it can be used for any textual
  work, regardless of subject matter or whether it is published as a printed
  book. We recommend this License principally for works whose purpose is
  instruction or reference.
 </p><div class="sect4 bridgehead"><h5 class="title legal" id="idm139787666413568"><span class="name">
    1. APPLICABILITY AND DEFINITIONS
  </span><a title="Permalink" class="permalink" href="#idm139787666413568">#</a></h5></div><p>
  This License applies to any manual or other work, in any medium, that
  contains a notice placed by the copyright holder saying it can be distributed
  under the terms of this License. Such a notice grants a world-wide,
  royalty-free license, unlimited in duration, to use that work under the
  conditions stated herein. The "Document", below, refers to any such manual or
  work. Any member of the public is a licensee, and is addressed as "you". You
  accept the license if you copy, modify or distribute the work in a way
  requiring permission under copyright law.
 </p><p>
  A "Modified Version" of the Document means any work containing the Document
  or a portion of it, either copied verbatim, or with modifications and/or
  translated into another language.
 </p><p>
  A "Secondary Section" is a named appendix or a front-matter section of the
  Document that deals exclusively with the relationship of the publishers or
  authors of the Document to the Document's overall subject (or to related
  matters) and contains nothing that could fall directly within that overall
  subject. (Thus, if the Document is in part a textbook of mathematics, a
  Secondary Section may not explain any mathematics.) The relationship could be
  a matter of historical connection with the subject or with related matters,
  or of legal, commercial, philosophical, ethical or political position
  regarding them.
 </p><p>
  The "Invariant Sections" are certain Secondary Sections whose titles are
  designated, as being those of Invariant Sections, in the notice that says
  that the Document is released under this License. If a section does not fit
  the above definition of Secondary then it is not allowed to be designated as
  Invariant. The Document may contain zero Invariant Sections. If the Document
  does not identify any Invariant Sections then there are none.
 </p><p>
  The "Cover Texts" are certain short passages of text that are listed, as
  Front-Cover Texts or Back-Cover Texts, in the notice that says that the
  Document is released under this License. A Front-Cover Text may be at most 5
  words, and a Back-Cover Text may be at most 25 words.
 </p><p>
  A "Transparent" copy of the Document means a machine-readable copy,
  represented in a format whose specification is available to the general
  public, that is suitable for revising the document straightforwardly with
  generic text editors or (for images composed of pixels) generic paint
  programs or (for drawings) some widely available drawing editor, and that is
  suitable for input to text formatters or for automatic translation to a
  variety of formats suitable for input to text formatters. A copy made in an
  otherwise Transparent file format whose markup, or absence of markup, has
  been arranged to thwart or discourage subsequent modification by readers is
  not Transparent. An image format is not Transparent if used for any
  substantial amount of text. A copy that is not "Transparent" is called
  "Opaque".
 </p><p>
  Examples of suitable formats for Transparent copies include plain ASCII
  without markup, Texinfo input format, LaTeX input format, SGML or XML using a
  publicly available DTD, and standard-conforming simple HTML, PostScript or
  PDF designed for human modification. Examples of transparent image formats
  include PNG, XCF and JPG. Opaque formats include proprietary formats that can
  be read and edited only by proprietary word processors, SGML or XML for which
  the DTD and/or processing tools are not generally available, and the
  machine-generated HTML, PostScript or PDF produced by some word processors
  for output purposes only.
 </p><p>
  The "Title Page" means, for a printed book, the title page itself, plus such
  following pages as are needed to hold, legibly, the material this License
  requires to appear in the title page. For works in formats which do not have
  any title page as such, "Title Page" means the text near the most prominent
  appearance of the work's title, preceding the beginning of the body of the
  text.
 </p><p>
  A section "Entitled XYZ" means a named subunit of the Document whose title
  either is precisely XYZ or contains XYZ in parentheses following text that
  translates XYZ in another language. (Here XYZ stands for a specific section
  name mentioned below, such as "Acknowledgements", "Dedications",
  "Endorsements", or "History".) To "Preserve the Title" of such a section when
  you modify the Document means that it remains a section "Entitled XYZ"
  according to this definition.
 </p><p>
  The Document may include Warranty Disclaimers next to the notice which states
  that this License applies to the Document. These Warranty Disclaimers are
  considered to be included by reference in this License, but only as regards
  disclaiming warranties: any other implication that these Warranty Disclaimers
  may have is void and has no effect on the meaning of this License.
 </p><div class="sect4 bridgehead"><h5 class="title legal" id="idm139787666403632"><span class="name">
    2. VERBATIM COPYING
  </span><a title="Permalink" class="permalink" href="#idm139787666403632">#</a></h5></div><p>
  You may copy and distribute the Document in any medium, either commercially
  or non-commercially, provided that this License, the copyright notices, and
  the license notice saying this License applies to the Document are reproduced
  in all copies, and that you add no other conditions whatsoever to those of
  this License. You may not use technical measures to obstruct or control the
  reading or further copying of the copies you make or distribute. However, you
  may accept compensation in exchange for copies. If you distribute a large
  enough number of copies you must also follow the conditions in section 3.
 </p><p>
  You may also lend copies, under the same conditions stated above, and you may
  publicly display copies.
 </p><div class="sect4 bridgehead"><h5 class="title legal" id="idm139787666401296"><span class="name">
    3. COPYING IN QUANTITY
  </span><a title="Permalink" class="permalink" href="#idm139787666401296">#</a></h5></div><p>
  If you publish printed copies (or copies in media that commonly have printed
  covers) of the Document, numbering more than 100, and the Document's license
  notice requires Cover Texts, you must enclose the copies in covers that
  carry, clearly and legibly, all these Cover Texts: Front-Cover Texts on the
  front cover, and Back-Cover Texts on the back cover. Both covers must also
  clearly and legibly identify you as the publisher of these copies. The front
  cover must present the full title with all words of the title equally
  prominent and visible. You may add other material on the covers in addition.
  Copying with changes limited to the covers, as long as they preserve the
  title of the Document and satisfy these conditions, can be treated as
  verbatim copying in other respects.
 </p><p>
  If the required texts for either cover are too voluminous to fit legibly, you
  should put the first ones listed (as many as fit reasonably) on the actual
  cover, and continue the rest onto adjacent pages.
 </p><p>
  If you publish or distribute Opaque copies of the Document numbering more
  than 100, you must either include a machine-readable Transparent copy along
  with each Opaque copy, or state in or with each Opaque copy a
  computer-network location from which the general network-using public has
  access to download using public-standard network protocols a complete
  Transparent copy of the Document, free of added material. If you use the
  latter option, you must take reasonably prudent steps, when you begin
  distribution of Opaque copies in quantity, to ensure that this Transparent
  copy will remain thus accessible at the stated location until at least one
  year after the last time you distribute an Opaque copy (directly or through
  your agents or retailers) of that edition to the public.
 </p><p>
  It is requested, but not required, that you contact the authors of the
  Document well before redistributing any large number of copies, to give them
  a chance to provide you with an updated version of the Document.
 </p><div class="sect4 bridgehead"><h5 class="title legal" id="idm139787666396800"><span class="name">
    4. MODIFICATIONS
  </span><a title="Permalink" class="permalink" href="#idm139787666396800">#</a></h5></div><p>
  You may copy and distribute a Modified Version of the Document under the
  conditions of sections 2 and 3 above, provided that you release the Modified
  Version under precisely this License, with the Modified Version filling the
  role of the Document, thus licensing distribution and modification of the
  Modified Version to whoever possesses a copy of it. In addition, you must do
  these things in the Modified Version:
 </p><div class="orderedlist "><ol class="orderedlist" type="A"><li class="listitem "><p>
    Use in the Title Page (and on the covers, if any) a title distinct from
    that of the Document, and from those of previous versions (which should, if
    there were any, be listed in the History section of the Document). You may
    use the same title as a previous version if the original publisher of that
    version gives permission.
   </p></li><li class="listitem "><p>
    List on the Title Page, as authors, one or more persons or entities
    responsible for authorship of the modifications in the Modified Version,
    together with at least five of the principal authors of the Document (all
    of its principal authors, if it has fewer than five), unless they release
    you from this requirement.
   </p></li><li class="listitem "><p>
    State on the Title page the name of the publisher of the Modified Version,
    as the publisher.
   </p></li><li class="listitem "><p>
    Preserve all the copyright notices of the Document.
   </p></li><li class="listitem "><p>
    Add an appropriate copyright notice for your modifications adjacent to the
    other copyright notices.
   </p></li><li class="listitem "><p>
    Include, immediately after the copyright notices, a license notice giving
    the public permission to use the Modified Version under the terms of this
    License, in the form shown in the Addendum below.
   </p></li><li class="listitem "><p>
    Preserve in that license notice the full lists of Invariant Sections and
    required Cover Texts given in the Document's license notice.
   </p></li><li class="listitem "><p>
    Include an unaltered copy of this License.
   </p></li><li class="listitem "><p>
    Preserve the section Entitled "History", Preserve its Title, and add to it
    an item stating at least the title, year, new authors, and publisher of the
    Modified Version as given on the Title Page. If there is no section
    Entitled "History" in the Document, create one stating the title, year,
    authors, and publisher of the Document as given on its Title Page, then add
    an item describing the Modified Version as stated in the previous sentence.
   </p></li><li class="listitem "><p>
    Preserve the network location, if any, given in the Document for public
    access to a Transparent copy of the Document, and likewise the network
    locations given in the Document for previous versions it was based on.
    These may be placed in the "History" section. You may omit a network
    location for a work that was published at least four years before the
    Document itself, or if the original publisher of the version it refers to
    gives permission.
   </p></li><li class="listitem "><p>
    For any section Entitled "Acknowledgements" or "Dedications", Preserve the
    Title of the section, and preserve in the section all the substance and
    tone of each of the contributor acknowledgements and/or dedications given
    therein.
   </p></li><li class="listitem "><p>
    Preserve all the Invariant Sections of the Document, unaltered in their
    text and in their titles. Section numbers or the equivalent are not
    considered part of the section titles.
   </p></li><li class="listitem "><p>
    Delete any section Entitled "Endorsements". Such a section may not be
    included in the Modified Version.
   </p></li><li class="listitem "><p>
    Do not retitle any existing section to be Entitled "Endorsements" or to
    conflict in title with any Invariant Section.
   </p></li><li class="listitem "><p>
    Preserve any Warranty Disclaimers.
   </p></li></ol></div><p>
  If the Modified Version includes new front-matter sections or appendices that
  qualify as Secondary Sections and contain no material copied from the
  Document, you may at your option designate some or all of these sections as
  invariant. To do this, add their titles to the list of Invariant Sections in
  the Modified Version's license notice. These titles must be distinct from any
  other section titles.
 </p><p>
  You may add a section Entitled "Endorsements", provided it contains nothing
  but endorsements of your Modified Version by various parties--for example,
  statements of peer review or that the text has been approved by an
  organization as the authoritative definition of a standard.
 </p><p>
  You may add a passage of up to five words as a Front-Cover Text, and a
  passage of up to 25 words as a Back-Cover Text, to the end of the list of
  Cover Texts in the Modified Version. Only one passage of Front-Cover Text and
  one of Back-Cover Text may be added by (or through arrangements made by) any
  one entity. If the Document already includes a cover text for the same cover,
  previously added by you or by arrangement made by the same entity you are
  acting on behalf of, you may not add another; but you may replace the old
  one, on explicit permission from the previous publisher that added the old
  one.
 </p><p>
  The author(s) and publisher(s) of the Document do not by this License give
  permission to use their names for publicity for or to assert or imply
  endorsement of any Modified Version.
 </p><div class="sect4 bridgehead"><h5 class="title legal" id="idm139787666374704"><span class="name">
    5. COMBINING DOCUMENTS
  </span><a title="Permalink" class="permalink" href="#idm139787666374704">#</a></h5></div><p>
  You may combine the Document with other documents released under this
  License, under the terms defined in section 4 above for modified versions,
  provided that you include in the combination all of the Invariant Sections of
  all of the original documents, unmodified, and list them all as Invariant
  Sections of your combined work in its license notice, and that you preserve
  all their Warranty Disclaimers.
 </p><p>
  The combined work need only contain one copy of this License, and multiple
  identical Invariant Sections may be replaced with a single copy. If there are
  multiple Invariant Sections with the same name but different contents, make
  the title of each such section unique by adding at the end of it, in
  parentheses, the name of the original author or publisher of that section if
  known, or else a unique number. Make the same adjustment to the section
  titles in the list of Invariant Sections in the license notice of the
  combined work.
 </p><p>
  In the combination, you must combine any sections Entitled "History" in the
  various original documents, forming one section Entitled "History"; likewise
  combine any sections Entitled "Acknowledgements", and any sections Entitled
  "Dedications". You must delete all sections Entitled "Endorsements".
 </p><div class="sect4 bridgehead"><h5 class="title legal" id="idm139787666371408"><span class="name">
    6. COLLECTIONS OF DOCUMENTS
  </span><a title="Permalink" class="permalink" href="#idm139787666371408">#</a></h5></div><p>
  You may make a collection consisting of the Document and other documents
  released under this License, and replace the individual copies of this
  License in the various documents with a single copy that is included in the
  collection, provided that you follow the rules of this License for verbatim
  copying of each of the documents in all other respects.
 </p><p>
  You may extract a single document from such a collection, and distribute it
  individually under this License, provided you insert a copy of this License
  into the extracted document, and follow this License in all other respects
  regarding verbatim copying of that document.
 </p><div class="sect4 bridgehead"><h5 class="title legal" id="idm139787666369152"><span class="name">
    7. AGGREGATION WITH INDEPENDENT WORKS
  </span><a title="Permalink" class="permalink" href="#idm139787666369152">#</a></h5></div><p>
  A compilation of the Document or its derivatives with other separate and
  independent documents or works, in or on a volume of a storage or
  distribution medium, is called an "aggregate" if the copyright resulting from
  the compilation is not used to limit the legal rights of the compilation's
  users beyond what the individual works permit. When the Document is included
  in an aggregate, this License does not apply to the other works in the
  aggregate which are not themselves derivative works of the Document.
 </p><p>
  If the Cover Text requirement of section 3 is applicable to these copies of
  the Document, then if the Document is less than one half of the entire
  aggregate, the Document's Cover Texts may be placed on covers that bracket
  the Document within the aggregate, or the electronic equivalent of covers if
  the Document is in electronic form. Otherwise they must appear on printed
  covers that bracket the whole aggregate.
 </p><div class="sect4 bridgehead"><h5 class="title legal" id="idm139787666366576"><span class="name">
    8. TRANSLATION
  </span><a title="Permalink" class="permalink" href="#idm139787666366576">#</a></h5></div><p>
  Translation is considered a kind of modification, so you may distribute
  translations of the Document under the terms of section 4. Replacing
  Invariant Sections with translations requires special permission from their
  copyright holders, but you may include translations of some or all Invariant
  Sections in addition to the original versions of these Invariant Sections.
  You may include a translation of this License, and all the license notices in
  the Document, and any Warranty Disclaimers, provided that you also include
  the original English version of this License and the original versions of
  those notices and disclaimers. In case of a disagreement between the
  translation and the original version of this License or a notice or
  disclaimer, the original version will prevail.
 </p><p>
  If a section in the Document is Entitled "Acknowledgements", "Dedications",
  or "History", the requirement (section 4) to Preserve its Title (section 1)
  will typically require changing the actual title.
 </p><div class="sect4 bridgehead"><h5 class="title legal" id="idm139787666363984"><span class="name">
    9. TERMINATION
  </span><a title="Permalink" class="permalink" href="#idm139787666363984">#</a></h5></div><p>
  You may not copy, modify, sublicense, or distribute the Document except as
  expressly provided for under this License. Any other attempt to copy, modify,
  sublicense or distribute the Document is void, and will automatically
  terminate your rights under this License. However, parties who have received
  copies, or rights, from you under this License will not have their licenses
  terminated so long as such parties remain in full compliance.
 </p><div class="sect4 bridgehead"><h5 class="title legal" id="idm139787666362384"><span class="name">
    10. FUTURE REVISIONS OF THIS LICENSE
  </span><a title="Permalink" class="permalink" href="#idm139787666362384">#</a></h5></div><p>
  The Free Software Foundation may publish new, revised versions of the GNU
  Free Documentation License from time to time. Such new versions will be
  similar in spirit to the present version, but may differ in detail to address
  new problems or concerns. See
  <a class="link" href="http://www.gnu.org/copyleft/" target="_blank">http://www.gnu.org/copyleft/</a>.
 </p><p>
  Each version of the License is given a distinguishing version number. If the
  Document specifies that a particular numbered version of this License "or any
  later version" applies to it, you have the option of following the terms and
  conditions either of that specified version or of any later version that has
  been published (not as a draft) by the Free Software Foundation. If the
  Document does not specify a version number of this License, you may choose
  any version ever published (not as a draft) by the Free Software Foundation.
 </p><div class="sect4 bridgehead"><h5 class="title legal" id="idm139787666359200"><span class="name">
    ADDENDUM: How to use this License for your documents
  </span><a title="Permalink" class="permalink" href="#idm139787666359200">#</a></h5></div><div class="verbatim-wrap"><pre class="screen">Copyright (c) YEAR YOUR NAME.
Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.2
or any later version published by the Free Software Foundation;
with no Invariant Sections, no Front-Cover Texts, and no Back-Cover Texts.
A copy of the license is included in the section entitled “GNU
Free Documentation License”.</pre></div><p>
  If you have Invariant Sections, Front-Cover Texts and Back-Cover Texts,
  replace the “with...Texts.” line with this:
 </p><div class="verbatim-wrap"><pre class="screen">with the Invariant Sections being LIST THEIR TITLES, with the
Front-Cover Texts being LIST, and with the Back-Cover Texts being LIST.</pre></div><p>
  If you have Invariant Sections without Cover Texts, or some other combination
  of the three, merge those two alternatives to suit the situation.
 </p><p>
  If your document contains nontrivial examples of program code, we recommend
  releasing these examples in parallel under your choice of free software
  license, such as the GNU General Public License, to permit their use in free
  software.
 </p></div></div></div></div></div><div class="page-bottom"><div id="_share-print"><div class="online-contents share"><strong>Share this page: </strong><span class="share-buttons"><span id="_share-fb" class="bottom-button">Facebook</span><span class="spacer"> • </span><span id="_share-gp" class="bottom-button">Google+</span><span class="spacer"> • </span><span id="_share-tw" class="bottom-button">Twitter</span><span class="spacer"> • </span><span id="_share-mail" class="bottom-button">E-Mail</span></span></div><div class="print"><span id="_print-button" class="bottom-button">Print this page</span></div><div class="clearme"></div></div></div></div><div id="_inward"></div></div><div id="_footer-wrap"><div id="_footer"><p>©
        2018 
        SUSE</p><ul><li><a href="http://www.suse.com/company/careers/" target="_top">Careers</a></li><li><a href="http://www.suse.com/company/legal/" target="_top">Legal</a></li><li><a href="http://www.suse.com/company/" target="_top">About</a></li><li><a href="http://www.suse.com/ContactsOffices/contacts_offices.jsp" target="_top">Contact Us</a></li></ul></div></div></body></html>