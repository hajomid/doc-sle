<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang=""><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Creating Software RAID 10 Devices | Storage Administration Guide | SUSE Linux Enterprise Server 15</title><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" /><link rel="stylesheet" type="text/css" href="static/css/style.css" /><link rel="stylesheet" type="text/css" href="static/css/highlight.css" /><meta name="generator" content="DAPS 2.4.0 using SUSE XSL Stylesheets 2.0.8 (based on DocBook XSL Stylesheets 1.78.1) - chunked" /><meta name="product-name" content="SUSE Linux Enterprise Server" /><meta name="product-number" content="15" /><meta name="book-title" content="Storage Administration Guide" /><meta name="chapter-title" content="Chapter 9. Creating Software RAID 10 Devices" /><meta name="tracker-url" content="https://bugzilla.suse.com/enter_bug.cgi" /><meta name="tracker-type" content="bsc" /><meta name="tracker-bsc-assignee" content="fs@suse.com" /><meta name="tracker-bsc-component" content="Documentation" /><meta name="tracker-bsc-product" content="Beta SUSE Linux Enterprise Server 15" /><link rel="home" href="index.html" title="SUSE Linux Enterprise Server Documentation" /><link rel="up" href="part.software_raid.html" title="Part III. Software RAID" /><link rel="prev" href="cha.raidroot.html" title="Chapter 8. Configuring Software RAID for the Root Partition" /><link rel="next" href="cha.raid_degraded.html" title="Chapter 10. Creating a Degraded RAID Array" /><script type="text/javascript">

var protocol = window.location.protocol.toLowerCase();
if ( protocol != 'file:' ) {
  var agent = navigator.userAgent.toLowerCase();
  var wanted = ( protocol == 'https:') ? 'https' : 'http';
  var file = 'fonts.css';
  document.write('<link rel="stylesheet" type="text/css" href="' + wanted + '://static.opensuse.org/fonts/'+ file +'"></link>');
}
else {
   document.write('<link rel="stylesheet" type="text/css" href="static/css/fonts-onlylocal.css"></link>');
}

</script><noscript><link rel="stylesheet" type="text/css" href="http://static.opensuse.org/fonts/fonts.css" /></noscript><script src="static/js/jquery-1.10.2.min.js" type="text/javascript"></script><script src="static/js/script.js" type="text/javascript"></script><script src="static/js/highlight.min.js" type="text/javascript"></script><script>

$(document).ready(function() {
  $('.verbatim-wrap.highlight').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});
hljs.configure({
  useBR: false
});

</script></head><body class="draft offline js-off"><div id="_outer-wrap"><div id="_white-bg"><div id="_header"><div id="_logo"><img src="static/images/logo.png" alt="Logo" /></div><div class="crumbs"><a class="book-link" href="index.html" title="SUSE Linux Enterprise Server Documentation"><span class="book-icon">SUSE Linux Enterprise Server Documentation</span></a><span> › </span><a class="crumb" href="stor_admin.html">Storage Administration Guide</a><span> › </span><a class="crumb" href="part.software_raid.html">Software RAID</a><span> › </span><a class="crumb" href="cha.raid10.html">Creating Software RAID 10 Devices</a></div><div class="clearme"></div></div></div><div id="_toolbar-wrap"><div id="_toolbar"><div id="_toc-area" class="inactive"><a id="_toc-area-button" class="tool" title="Contents" accesskey="c" href="index.html"><span class="tool-spacer"><span class="toc-icon">Contents</span><span class="clearme"></span></span><span class="tool-label">Contents</span></a><div class="active-contents bubble-corner"></div><div class="active-contents bubble"><div class="bubble-container"><h6>Storage Administration Guide</h6><div id="_bubble-toc"><ol><li class="inactive"><a href="storage.preface.html"><span class="number"> </span><span class="name">About This Guide</span></a></li><li class="inactive"><a href="part.filesystems.html"><span class="number">I </span><span class="name">File Systems and Mounting</span></a><ol><li class="inactive"><a href="cha.filesystems.html"><span class="number">1 </span><span class="name">Overview of File Systems in Linux</span></a></li><li class="inactive"><a href="cha.resize_fs.html"><span class="number">2 </span><span class="name">Resizing File Systems</span></a></li><li class="inactive"><a href="cha.uuid.html"><span class="number">3 </span><span class="name">Using UUIDs to Mount Devices</span></a></li><li class="inactive"><a href="cha.multitiercache.html"><span class="number">4 </span><span class="name">Multi-tier Caching for Block Device Operations</span></a></li></ol></li><li class="inactive"><a href="part.lvm.html"><span class="number">II </span><span class="name">Logical Volumes (LVM)</span></a><ol><li class="inactive"><a href="cha.lvm.html"><span class="number">5 </span><span class="name">LVM Configuration</span></a></li><li class="inactive"><a href="cha.lvm_snapshots.html"><span class="number">6 </span><span class="name">LVM Volume Snapshots</span></a></li></ol></li><li class="inactive"><a href="part.software_raid.html"><span class="number">III </span><span class="name">Software RAID</span></a><ol><li class="inactive"><a href="cha.raid.html"><span class="number">7 </span><span class="name">Software RAID Configuration</span></a></li><li class="inactive"><a href="cha.raidroot.html"><span class="number">8 </span><span class="name">Configuring Software RAID for the Root Partition</span></a></li><li class="inactive"><a href="cha.raid10.html"><span class="number">9 </span><span class="name">Creating Software RAID 10 Devices</span></a></li><li class="inactive"><a href="cha.raid_degraded.html"><span class="number">10 </span><span class="name">Creating a Degraded RAID Array</span></a></li><li class="inactive"><a href="cha.raid_resize.html"><span class="number">11 </span><span class="name">Resizing Software RAID Arrays with mdadm</span></a></li><li class="inactive"><a href="cha.raid_leds.html"><span class="number">12 </span><span class="name">Storage Enclosure LED Utilities for MD Software RAIDs</span></a></li></ol></li><li class="inactive"><a href="part.net_storage.html"><span class="number">IV </span><span class="name">Network Storage</span></a><ol><li class="inactive"><a href="cha.isns.html"><span class="number">13 </span><span class="name">iSNS for Linux</span></a></li><li class="inactive"><a href="cha.iscsi.html"><span class="number">14 </span><span class="name">Mass Storage over IP Networks: iSCSI</span></a></li><li class="inactive"><a href="cha.fcoe.html"><span class="number">15 </span><span class="name">Fibre Channel Storage over Ethernet Networks: FCoE</span></a></li><li class="inactive"><a href="cha.nvmeof.html"><span class="number">16 </span><span class="name">NVMe over Fabric</span></a></li><li class="inactive"><a href="cha.multipath.html"><span class="number">17 </span><span class="name">Managing Multipath I/O for Devices</span></a></li><li class="inactive"><a href="cha.nfs4_acls.html"><span class="number">18 </span><span class="name">Managing Access Control Lists over NFSv4</span></a></li></ol></li><li class="inactive"><a href="bk09apa.html"><span class="number">A </span><span class="name">GNU Licenses</span></a></li></ol></div><div class="clearme"></div></div></div></div><div id="_nav-area" class="inactive"><div class="tool"><span class="nav-inner"><span class="tool-label">Navigation</span><a accesskey="p" class="tool-spacer" title="Chapter 8. Configuring Software RAID for the Root Partition" href="cha.raidroot.html"><span class="prev-icon">←</span></a><a accesskey="n" class="tool-spacer" title="Chapter 10. Creating a Degraded RAID Array" href="cha.raid_degraded.html"><span class="next-icon">→</span></a></span></div></div></div></div><div id="_fixed-header-wrap" class="inactive"><div id="_fixed-header"><div class="crumbs"><a class="book-link" href="index.html" title="SUSE Linux Enterprise Server Documentation"><span class="book-icon">SUSE Linux Enterprise Server Documentation</span></a><span> › </span><a class="crumb" href="stor_admin.html">Storage Administration Guide</a><span> › </span><a class="crumb" href="part.software_raid.html">Software RAID</a><span> › </span><a class="crumb" href="cha.raid10.html">Creating Software RAID 10 Devices</a></div><div class="buttons"><a class="top-button button" href="#">Top</a><div class="button"><a accesskey="p" class="tool-spacer" title="Chapter 8. Configuring Software RAID for the Root Partition" href="cha.raidroot.html"><span class="prev-icon">←</span></a><a accesskey="n" class="tool-spacer" title="Chapter 10. Creating a Degraded RAID Array" href="cha.raid_degraded.html"><span class="next-icon">→</span></a></div><div class="clearme"></div></div><div class="clearme"></div></div></div><div id="_content" class="draft "><div class="documentation"><div xml:lang="en" class="chapter " id="cha.raid10" lang="en"><div class="titlepage"><div><div class="version-info">Applies to  <span class="productname"><span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span></span> <span class="productnumber"><span class="productnumber"><span class="phrase">15</span></span></span></div><div><h2 class="title"><span class="number">9 </span><span class="name">Creating Software RAID 10 Devices</span> </h2><div class="doc-status"><ul><li><span class="ds-label">Filename: </span>storage_raid10.xml</li><li><span class="ds-label">ID: </span>cha.raid10</li></ul></div></div></div></div><div class="line"><div class="toc"><dl><dt><span class="sect1"><a href="cha.raid10.html#sec.raid10.nest"><span class="number">9.1 </span><span class="name">Creating Nested RAID 10 Devices with <code class="command">mdadm</code></span></a></span></dt><dt><span class="sect1"><a href="cha.raid10.html#sec.raid10.complex"><span class="number">9.2 </span><span class="name">Creating a Complex RAID 10</span></a></span></dt></dl></div></div><p>
  This section describes how to set up nested and complex RAID 10 devices.
  A RAID 10 device consists of nested RAID 1 (mirroring) and RAID 0
  (striping) arrays. Nested RAIDs can either be set up as striped mirrors
  (RAID 1+0) or as mirrored stripes (RAID 0+1). A complex
  RAID 10 setup also combines mirrors and stripes and additional data
  security by supporting a higher data redundancy level.
 </p><div class="sect1 " id="sec.raid10.nest"><div class="titlepage"><div><div><h2 class="title" id="sec.raid10.nest"><span class="number">9.1 </span><span class="name">Creating Nested RAID 10 Devices with <code class="command">mdadm</code></span> <a title="Permalink" class="permalink" href="cha.raid10.html#sec.raid10.nest">#</a></h2></div></div></div><p>
   A nested RAID device consists of a RAID array that uses another RAID array
   as its basic element, instead of using physical disks. The goal of this
   configuration is to improve the performance and fault tolerance of the RAID.
   Setting up nested RAID levels is not supported by YaST, but can be done by
   using the <code class="command">mdadm</code> command line tool.
  </p><p>
   Based on the order of nesting, two different nested RAIDs can be set up.
   This document uses the following terminology:
  </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p><span class="formalpara-title">RAID 1+0: </span>
      RAID 1 (mirror) arrays are built first, then combined to form a RAID 0
      (stripe) array.
     </p></li><li class="listitem "><p><span class="formalpara-title">RAID 0+1: </span>
      RAID 0 (stripe) arrays are built first, then combined to form a RAID 1
      (mirror) array.
     </p></li></ul></div><p>
   The following table describes the advantages and disadvantages of RAID 10
   nesting as 1+0 versus 0+1. It assumes that the storage objects you use
   reside on different disks, each with a dedicated I/O capability.
  </p><div class="table" id="idm140202881114640"><div class="table-title-wrap"><h6 class="table-title"><span class="number">Table 9.1: </span><span class="name">Nested RAID Levels </span><a title="Permalink" class="permalink" href="cha.raid10.html#idm140202881114640">#</a></h6></div><div class="table-contents"><table summary="Nested RAID Levels" border="1"><colgroup><col class="1" /><col class="2" /><col class="3" /></colgroup><thead><tr><th>
       <p>
        RAID Level
       </p>
      </th><th>
       <p>
        Description
       </p>
      </th><th>
       <p>
        Performance and Fault Tolerance
       </p>
      </th></tr></thead><tbody><tr><td>
       <p>
        10 (1+0)
       </p>
      </td><td>
       <p>
        RAID 0 (stripe) built with RAID 1 (mirror) arrays
       </p>
      </td><td>
       <p>
        RAID 1+0 provides high levels of I/O performance, data redundancy, and
        disk fault tolerance. Because each member device in the RAID 0 is
        mirrored individually, multiple disk failures can be tolerated and data
        remains available as long as the disks that fail are in different
        mirrors.
       </p>
       <p>
        You can optionally configure a spare for each underlying mirrored
        array, or configure a spare to serve a spare group that serves all
        mirrors.
       </p>
      </td></tr><tr><td>
       <p>
        10 (0+1)
       </p>
      </td><td>
       <p>
        RAID 1 (mirror) built with RAID 0 (stripe) arrays
       </p>
      </td><td>
       <p>
        RAID 0+1 provides high levels of I/O performance and data redundancy,
        but slightly less fault tolerance than a 1+0. If multiple disks fail on
        one side of the mirror, then the other mirror is available. However, if
        disks are lost concurrently on both sides of the mirror, all data is
        lost.
       </p>
       <p>
        This solution offers less disk fault tolerance than a 1+0 solution, but
        if you need to perform maintenance or maintain the mirror on a
        different site, you can take an entire side of the mirror offline and
        still have a fully functional storage device. Also, if you lose the
        connection between the two sites, either site operates independently of
        the other. That is not true if you stripe the mirrored segments,
        because the mirrors are managed at a lower level.
       </p>
       <p>
        If a device fails, the mirror on that side fails because RAID 1 is not
        fault-tolerant. Create a new RAID 0 to replace the failed side, then
        resynchronize the mirrors.
       </p>
      </td></tr></tbody></table></div></div><div class="sect2 " id="sec.raid10.nest.10"><div class="titlepage"><div><div><h3 class="title" id="sec.raid10.nest.10"><span class="number">9.1.1 </span><span class="name">Creating Nested RAID 10 (1+0) with mdadm</span> <a title="Permalink" class="permalink" href="cha.raid10.html#sec.raid10.nest.10">#</a></h3></div></div></div><p>
    A nested RAID 1+0 is built by creating two or more RAID 1 (mirror) devices,
    then using them as component devices in a RAID 0.
   </p><div id="idm140202881094608" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.png" /><h6>Important: Multipathing</h6><p>
     If you need to manage multiple connections to the devices, you must
     configure multipath I/O before configuring the RAID devices. For
     information, see
     <a class="xref" href="cha.multipath.html" title="Chapter 17. Managing Multipath I/O for Devices">Chapter 17, <em>Managing Multipath I/O for Devices</em></a>.
    </p></div><p>
    The procedure in this section uses the device names shown in the following
    table. Ensure that you modify the device names with the names of your own
    devices.
   </p><div class="table" id="idm140202881091664"><div class="table-title-wrap"><h6 class="table-title"><span class="number">Table 9.2: </span><span class="name">Scenario for Creating a RAID 10 (1+0) by Nesting </span><a title="Permalink" class="permalink" href="cha.raid10.html#idm140202881091664">#</a></h6></div><div class="table-contents"><table summary="Scenario for Creating a RAID 10 (1+0) by Nesting" border="1"><colgroup><col class="1" /><col class="2" /><col class="3" /></colgroup><thead><tr><th>
        <p>
         Raw Devices
        </p>
       </th><th>
        <p>
         RAID 1 (mirror)
        </p>
       </th><th>
        <p>
         RAID 1+0 (striped mirrors)
        </p>
       </th></tr></thead><tbody><tr><td>
        <table border="0" summary="Simple list" class="simplelist "><tr><td><code class="filename">/dev/sdb1</code>
         </td></tr><tr><td><code class="filename">/dev/sdc1</code>
         </td></tr></table>
       </td><td>
        <p>
         <code class="filename">/dev/md0</code>
        </p>
       </td><td rowspan="2">
        
        <p>
         <code class="filename">/dev/md2</code>
        </p>
       </td></tr><tr><td>
        <table border="0" summary="Simple list" class="simplelist "><tr><td><code class="filename">/dev/sdd1</code>
         </td></tr><tr><td><code class="filename">/dev/sde1</code>
         </td></tr></table>
       </td><td>
        <p>
         <code class="filename">/dev/md1</code>
        </p>
       </td></tr></tbody></table></div></div><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
      Open a terminal console.
     </p></li><li class="step "><p>
      If necessary, create four 0xFD Linux RAID partitions of equal size using
      a disk partitioner such as parted.
     </p></li><li class="step "><p>
      Create two software RAID 1 devices, using two different devices for
      each device. At the command prompt, enter these two commands:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> mdadm --create /dev/md0 --run --level=1 --raid-devices=2 /dev/sdb1 /dev/sdc1
sudo mdadm --create /dev/md1 --run --level=1 --raid-devices=2 /dev/sdd1 /dev/sde1</pre></div></li><li class="step "><p>
      Create the nested RAID 1+0 device. At the command prompt, enter the
      following command using the software RAID 1 devices you created in the
      previous step:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> mdadm --create /dev/md2 --run --level=0 --chunk=64 \
--raid-devices=2 /dev/md0 /dev/md1</pre></div><p>
      The default chunk size is 64 KB.
     </p></li><li class="step "><p>
      Create a file system on the RAID 1+0 device
      <code class="filename">/dev/md2</code>, for example an XFS file system:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> mkfs.xfs /dev/md2</pre></div><p>
      Modify the command to use a different file system.
     </p></li><li class="step "><p>
      Edit the <code class="filename">/etc/mdadm.conf</code> file or create it, if it
      does not exist (for example by running <code class="command">sudo vi
      /etc/mdadm.conf</code>). Add the following lines (if the file already
      exists, the first line probably already exists).
     </p><div class="verbatim-wrap"><pre class="screen">DEVICE containers partitions
ARRAY /dev/md0 UUID=<em class="replaceable ">UUID</em>
ARRAY /dev/md1 UUID=<em class="replaceable ">UUID</em>
ARRAY /dev/md2 UUID=<em class="replaceable ">UUID</em></pre></div><p>
      The UUID of each device can be retrieved with the following command:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> mdadm -D /dev/<em class="replaceable ">DEVICE</em> | grep UUID</pre></div></li><li class="step "><p>
      Edit the <code class="filename">/etc/fstab</code> file to add an entry for the
      RAID 1+0 device <code class="filename">/dev/md2</code>. The following example
      shows an entry for a RAID device with the XFS file system and
      <code class="filename">/data</code> as a mount point.
     </p><div class="verbatim-wrap"><pre class="screen">/dev/md2 /data xfs defaults 1 2</pre></div></li><li class="step "><p>
      Mount the RAID device:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> mount /data</pre></div></li></ol></div></div></div><div class="sect2 " id="sec.raid10.nest.01"><div class="titlepage"><div><div><h3 class="title" id="sec.raid10.nest.01"><span class="number">9.1.2 </span><span class="name">Creating Nested RAID 10 (0+1) with mdadm</span> <a title="Permalink" class="permalink" href="cha.raid10.html#sec.raid10.nest.01">#</a></h3></div></div></div><p>
    A nested RAID 0+1 is built by creating two to four RAID 0 (striping)
    devices, then mirroring them as component devices in a RAID 1.
   </p><div id="idm140202881049952" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.png" /><h6>Important: Multipathing</h6><p>
     If you need to manage multiple connections to the devices, you must
     configure multipath I/O before configuring the RAID devices. For
     information, see
     <a class="xref" href="cha.multipath.html" title="Chapter 17. Managing Multipath I/O for Devices">Chapter 17, <em>Managing Multipath I/O for Devices</em></a>.
    </p></div><p>
    In this configuration, spare devices cannot be specified for the underlying
    RAID 0 devices because RAID 0 cannot tolerate a device loss. If a
    device fails on one side of the mirror, you must create a replacement
    RAID 0 device, than add it into the mirror.
   </p><p>
    The procedure in this section uses the device names shown in the following
    table. Ensure that you modify the device names with the names of your own
    devices.
   </p><div class="table" id="idm140202881046304"><div class="table-title-wrap"><h6 class="table-title"><span class="number">Table 9.3: </span><span class="name">Scenario for Creating a RAID 10 (0+1) by Nesting </span><a title="Permalink" class="permalink" href="cha.raid10.html#idm140202881046304">#</a></h6></div><div class="table-contents"><table summary="Scenario for Creating a RAID 10 (0+1) by Nesting" border="1"><colgroup><col class="1" /><col class="2" /><col class="3" /></colgroup><thead><tr><th>
        <p>
         Raw Devices
        </p>
       </th><th>
        <p>
         RAID 0 (stripe)
        </p>
       </th><th>
        <p>
         RAID 0+1 (mirrored stripes)
        </p>
       </th></tr></thead><tbody><tr><td>
        <table border="0" summary="Simple list" class="simplelist "><tr><td><code class="filename">/dev/sdb1</code>
         </td></tr><tr><td><code class="filename">/dev/sdc1</code>
         </td></tr></table>
       </td><td>
        <p>
         <code class="filename">/dev/md0</code>
        </p>
       </td><td rowspan="2">
        
        <p>
         <code class="filename">/dev/md2</code>
        </p>
       </td></tr><tr><td>
        <table border="0" summary="Simple list" class="simplelist "><tr><td><code class="filename">/dev/sdd1</code>
         </td></tr><tr><td><code class="filename">/dev/sde1</code>
         </td></tr></table>
       </td><td>
        <p>
         <code class="filename">/dev/md1</code>
        </p>
       </td></tr></tbody></table></div></div><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
      Open a terminal console.
     </p></li><li class="step "><p>
      If necessary, create four 0xFD Linux RAID partitions of equal size using
      a disk partitioner such as parted.
     </p></li><li class="step "><p>
      Create two software RAID 0 devices, using two different devices for
      each RAID 0 device. At the command prompt, enter these two commands:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> mdadm --create /dev/md0 --run --level=0 --chunk=64 \
--raid-devices=2 /dev/sdb1 /dev/sdc1
sudo mdadm --create /dev/md1 --run --level=0 --chunk=64 \
--raid-devices=2 /dev/sdd1 /dev/sde1</pre></div><p>
      The default chunk size is 64 KB.
     </p></li><li class="step "><p>
      Create the nested RAID 0+1 device. At the command prompt, enter the
      following command using the software RAID 0 devices you created in
      the previous step:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> mdadm --create /dev/md2 --run --level=1 --raid-devices=2 /dev/md0 /dev/md1</pre></div></li><li class="step "><p>
      Create a file system on the RAID 1+0 device
      <code class="filename">/dev/md2</code>, for example an XFS file system:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> mkfs.xfs /dev/md2</pre></div><p>
      Modify the command to use a different file system.
     </p></li><li class="step "><p>
      Edit the <code class="filename">/etc/mdadm.conf</code> file or create it, if it
      does not exist (for example by running <code class="command">sudo vi
      /etc/mdadm.conf</code>). Add the following lines (if the file exists,
      the first line probably already exists, too).
     </p><div class="verbatim-wrap"><pre class="screen">DEVICE containers partitions
ARRAY /dev/md0 UUID=<em class="replaceable ">UUID</em>
ARRAY /dev/md1 UUID=<em class="replaceable ">UUID</em>
ARRAY /dev/md2 UUID=<em class="replaceable ">UUID</em></pre></div><p>
      The UUID of each device can be retrieved with the following command:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> mdadm -D /dev/<em class="replaceable ">DEVICE</em> | grep UUID</pre></div></li><li class="step "><p>
      Edit the <code class="filename">/etc/fstab</code> file to add an entry for the
      RAID 1+0 device <code class="filename">/dev/md2</code>. The following example
      shows an entry for a RAID device with the XFS file system and
      <code class="filename">/data</code> as a mount point.
     </p><div class="verbatim-wrap"><pre class="screen">/dev/md2 /data xfs defaults 1 2</pre></div></li><li class="step "><p>
      Mount the RAID device:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> mount /data</pre></div></li></ol></div></div></div></div><div class="sect1 " id="sec.raid10.complex"><div class="titlepage"><div><div><h2 class="title" id="sec.raid10.complex"><span class="number">9.2 </span><span class="name">Creating a Complex RAID 10</span> <a title="Permalink" class="permalink" href="cha.raid10.html#sec.raid10.complex">#</a></h2></div></div></div><p>
   YaST (and <code class="command">mdadm</code> with the <code class="option">--level=10</code>
   option) creates a single complex software RAID 10 that combines
   features of both RAID 0 (striping) and RAID 1 (mirroring). Multiple copies
   of all data blocks are arranged on multiple drives following a striping
   discipline. Component devices should be the same size.
  </p><p>
   The complex RAID 10 is similar in purpose to a nested RAID 10
   (1+0), but differs in the following ways:
  </p><div class="table" id="idm140202881002832"><div class="table-title-wrap"><h6 class="table-title"><span class="number">Table 9.4: </span><span class="name">Complex RAID 10 compared to Nested RAID 10 </span><a title="Permalink" class="permalink" href="cha.raid10.html#idm140202881002832">#</a></h6></div><div class="table-contents"><table summary="Complex RAID 10 compared to Nested RAID 10" border="1"><colgroup><col class="1" /><col class="2" /><col class="3" /></colgroup><thead><tr><th>
       <p>
        Feature
       </p>
      </th><th>
       <p>
        Complex RAID 10
       </p>
      </th><th>
       <p>
        Nested RAID 10 (1+0)
       </p>
      </th></tr></thead><tbody><tr><td>
       <p>
        Number of devices
       </p>
      </td><td>
       <p>
        Allows an even or odd number of component devices
       </p>
      </td><td>
       <p>
        Requires an even number of component devices
       </p>
      </td></tr><tr><td>
       <p>
        Component devices
       </p>
      </td><td>
       <p>
        Managed as a single RAID device
       </p>
      </td><td>
       <p>
        Manage as a nested RAID device
       </p>
      </td></tr><tr><td>
       <p>
        Striping
       </p>
      </td><td>
       <p>
        Striping occurs in the near or far layout on component devices.
       </p>
       <p>
        The far layout provides sequential read throughput that scales by
        number of drives, rather than number of RAID 1 pairs.
       </p>
      </td><td>
       <p>
        Striping occurs consecutively across component devices
       </p>
      </td></tr><tr><td>
       <p>
        Multiple copies of data
       </p>
      </td><td>
       <p>
        Two or more copies, up to the number of devices in the array
       </p>
      </td><td>
       <p>
        Copies on each mirrored segment
       </p>
      </td></tr><tr><td>
       <p>
        Hot spare devices
       </p>
      </td><td>
       <p>
        A single spare can service all component devices
       </p>
      </td><td>
       <p>
        Configure a spare for each underlying mirrored array, or configure a
        spare to serve a spare group that serves all mirrors.
       </p>
      </td></tr></tbody></table></div></div><div class="sect2 " id="sec.raid10.complex.replicas"><div class="titlepage"><div><div><h3 class="title" id="sec.raid10.complex.replicas"><span class="number">9.2.1 </span><span class="name">Number of Devices and Replicas in the Complex RAID 10</span> <a title="Permalink" class="permalink" href="cha.raid10.html#sec.raid10.complex.replicas">#</a></h3></div></div></div><p>
    When configuring a complex RAID 10 array, you must specify the number
    of replicas of each data block that are required. The default number of
    replicas is two, but the value can be two to the number of devices in the
    array.
   </p><p>
    You must use at least as many component devices as the number of replicas
    you specify. However, the number of component devices in a RAID 10
    array does not need to be a multiple of the number of replicas of each data
    block. The effective storage size is the number of devices divided by the
    number of replicas.
   </p><p>
    For example, if you specify two replicas for an array created with five
    component devices, a copy of each block is stored on two different devices.
    The effective storage size for one copy of all data is 5/2 or 2.5 times the
    size of a component device.
   </p></div><div class="sect2 " id="sec.raid10.complex.layout"><div class="titlepage"><div><div><h3 class="title" id="sec.raid10.complex.layout"><span class="number">9.2.2 </span><span class="name">Layout</span> <a title="Permalink" class="permalink" href="cha.raid10.html#sec.raid10.complex.layout">#</a></h3></div></div></div><p>
    The complex RAID 10 setup supports three different layouts which
    define how the data blocks are arranged on the disks. The available layouts
    are near (default), far and offset. They have different performance
    characteristics, so it is important to choose the right layout for your
    workload.
   </p><div class="sect3 " id="sec.raid10.complex.layout.near"><div class="titlepage"><div><div><h4 class="title" id="sec.raid10.complex.layout.near"><span class="number">9.2.2.1 </span><span class="name">Near Layout</span> <a title="Permalink" class="permalink" href="cha.raid10.html#sec.raid10.complex.layout.near">#</a></h4></div></div></div><p>
     With the near layout, copies of a block of data are striped near each
     other on different component devices. That is, multiple copies of one data
     block are at similar offsets in different devices. Near is the default
     layout for RAID 10. For example, if you use an odd number of
     component devices and two copies of data, some copies are perhaps one
     chunk further into the device.
    </p><p>
     The near layout for the complex RAID 10 yields read and write
     performance similar to RAID 0 over half the number of drives.
    </p><p>
     Near layout with an even number of disks and two replicas:
    </p><div class="verbatim-wrap"><pre class="screen">sda1 sdb1 sdc1 sde1
  0    0    1    1
  2    2    3    3
  4    4    5    5
  6    6    7    7
  8    8    9    9</pre></div><p>
     Near layout with an odd number of disks and two replicas:
    </p><div class="verbatim-wrap"><pre class="screen">sda1 sdb1 sdc1 sde1 sdf1
  0    0    1    1    2
  2    3    3    4    4
  5    5    6    6    7
  7    8    8    9    9
  10   10   11   11   12</pre></div></div><div class="sect3 " id="sec.raid10.complex.layout.far"><div class="titlepage"><div><div><h4 class="title" id="sec.raid10.complex.layout.far"><span class="number">9.2.2.2 </span><span class="name">Far Layout</span> <a title="Permalink" class="permalink" href="cha.raid10.html#sec.raid10.complex.layout.far">#</a></h4></div></div></div><p>
     The far layout stripes data over the early part of all drives, then
     stripes a second copy of the data over the later part of all drives,
     making sure that all copies of a block are on different drives. The second
     set of values starts halfway through the component drives.
    </p><p>
     With a far layout, the read performance of the complex RAID 10 is
     similar to a RAID 0 over the full number of drives, but write
     performance is substantially slower than a RAID 0 because there is
     more seeking of the drive heads. It is best used for read-intensive
     operations such as for read-only file servers.
    </p><p>
     The speed of the RAID 10 for writing is similar to other mirrored
     RAID types, like RAID 1 and RAID 10 using near layout, as the
     elevator of the file system schedules the writes in a more optimal way
     than raw writing. Using RAID 10 in the far layout is well suited for
     mirrored writing applications.
    </p><p>
     Far layout with an even number of disks and two replicas:
    </p><div class="verbatim-wrap"><pre class="screen">sda1 sdb1 sdc1 sde1
  0    1    2    3
  4    5    6    7
  . . .
  3    0    1    2
  7    4    5    6</pre></div><p class="intro">
     Far layout with an odd number of disks and two replicas:
    </p><div class="verbatim-wrap"><pre class="screen">sda1 sdb1 sdc1 sde1 sdf1
  0    1    2    3    4
  5    6    7    8    9
  . . .
  4    0    1    2    3
  9    5    6    7    8</pre></div></div><div class="sect3 " id="sec.raid10.complex.layout.offset"><div class="titlepage"><div><div><h4 class="title" id="sec.raid10.complex.layout.offset"><span class="number">9.2.2.3 </span><span class="name">Offset Layout</span> <a title="Permalink" class="permalink" href="cha.raid10.html#sec.raid10.complex.layout.offset">#</a></h4></div></div></div><p>
     The offset layout duplicates stripes so that the multiple copies of a
     given chunk are laid out on consecutive drives and at consecutive offsets.
     Effectively, each stripe is duplicated and the copies are offset by one
     device. This should give similar read characteristics to a far layout if a
     suitably large chunk size is used, but without as much seeking for writes.
    </p><p>
     Offset layout with an even number of disks and two replicas:
    </p><div class="verbatim-wrap"><pre class="screen">sda1 sdb1 sdc1 sde1
  0    1    2    3
  3    0    1    2
  4    5    6    7
  7    4    5    6
  8    9   10   11
 11    8    9   10</pre></div><p>
     Offset layout with an odd number of disks and two replicas:
    </p><div class="verbatim-wrap"><pre class="screen">sda1 sdb1 sdc1 sde1 sdf1
  0    1    2    3    4
  4    0    1    2    3
  5    6    7    8    9
  9    5    6    7    8
 10   11   12   13   14
 14   10   11   12   13</pre></div></div><div class="sect3 " id="sec.raid10.complex.layout.parameter"><div class="titlepage"><div><div><h4 class="title" id="sec.raid10.complex.layout.parameter"><span class="number">9.2.2.4 </span><span class="name">Specifying the number of Replicas and the Layout with YaST and mdadm</span> <a title="Permalink" class="permalink" href="cha.raid10.html#sec.raid10.complex.layout.parameter">#</a></h4></div></div></div><p>
     The number of replicas and the layout is specified as <span class="guimenu">Parity
     Algorithm</span> in YaST or with the <code class="option">--layout</code>
     parameter for mdadm. The following values are accepted:
    </p><div class="variablelist "><dl class="variablelist"><dt id="idm140202880953152"><span class="term "><code class="literal">n<em class="replaceable ">N</em></code>
      </span></dt><dd><p>
        Specify <code class="literal">n</code> for near layout and replace
        <em class="replaceable ">N</em> with the number of replicas.
        <code class="literal">n2</code> is the default that is used when not configuring
        layout and the number of replicas.
       </p></dd><dt id="idm140202880949376"><span class="term "><code class="literal">f<em class="replaceable ">N</em></code>
      </span></dt><dd><p>
        Specify <code class="literal">f</code> for far layout and replace
        <em class="replaceable ">N</em> with the number of replicas.
       </p></dd><dt id="idm140202880946080"><span class="term "><code class="literal">o<em class="replaceable ">N</em></code>
      </span></dt><dd><p>
        Specify <code class="literal">o</code> for offset layout and replace
        <em class="replaceable ">N</em> with the number of replicas.
       </p></dd></dl></div><div id="idm140202880942624" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.png" /><h6>Note: Number of Replicas</h6><p>
      YaST automatically offers a selection of all possible values for the
      <span class="guimenu">Parity Algorithm</span> parameter.
     </p></div></div></div><div class="sect2 " id="sec.raid10.complex.yast"><div class="titlepage"><div><div><h3 class="title" id="sec.raid10.complex.yast"><span class="number">9.2.3 </span><span class="name">Creating a Complex RAID 10 with the YaST Partitioner</span> <a title="Permalink" class="permalink" href="cha.raid10.html#sec.raid10.complex.yast">#</a></h3></div></div></div><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
      Launch YaST and open the Partitioner.
     </p></li><li class="step "><p>
      If necessary, create partitions that should be used with your RAID
      configuration. Do not format them and set the partition type to
      <span class="guimenu">0xFD Linux RAID</span>. When using existing partitions it is
      not necessary to change their partition type—YaST will
      automatically do so. Refer to
      <span class="intraxref">Book “<em class="citetitle ">Deployment Guide</em>”, Chapter 9 “Expert Partitioner”, Section 9.1 “Using the Expert Partitioner”</span> for details.
     </p><p>
      For RAID 10 at least four partitions are needed. It is strongly
      recommended to use partitions stored on different hard disks to decrease
      the risk of losing data if one is defective. It is recommended to use
      only partitions of the same size because each segment can contribute only
      the same amount of space as the smallest sized partition.
     </p></li><li class="step "><p>
      In the left panel, select <span class="guimenu">RAID</span>.
     </p><p>
      A list of existing RAID configurations opens in the right panel.
     </p></li><li class="step "><p>
      At the lower left of the RAID page, click <span class="guimenu">Add RAID</span>.
     </p></li><li class="step "><p>
      Under <span class="guimenu">RAID Type</span>, select <span class="guimenu">RAID 10 (Mirroring
      and Striping)</span>.
     </p><p>
      You can optionally assign a <span class="guimenu">RAID Name</span> to your RAID. It
      will make it available as
      <code class="filename">/dev/md/<em class="replaceable ">NAME</em></code>. See
      <a class="xref" href="cha.raid.html#sec.raid.yast.names" title="7.2.1. RAID Names">Section 7.2.1, “RAID Names”</a> for more information.
     </p></li><li class="step "><p>
      In the <span class="guimenu">Available Devices</span> list, select the desired
      partitions, then click <span class="guimenu">Add</span> to move them to the
      <span class="guimenu">Selected Devices</span> list.
     </p><div class="informalfigure"><div class="mediaobject"><a xmlns="" href="images/raid10_a.png"><img src="images/raid10_a.png" width="" /></a></div></div></li><li class="step "><p>
      (Optional) Click <span class="guimenu">Classify</span> to specify the preferred
      order of the disks in the RAID array.
     </p><p>
      For RAID types such as RAID 10, where the order of added disks
      matters, you can specify the order in which the devices will be used.
      This will ensure that one half of the array resides on one disk subsystem
      and the other half of the array resides on a different disk subsystem.
      For example, if one disk subsystem fails, the system keeps running from
      the second disk subsystem.
     </p><ol type="a" class="substeps "><li class="step "><p>
        Select each disk in turn and click one of the <span class="guimenu">Class
        X</span> buttons, where X is the letter you want to assign to the
        disk. Available classes are A, B, C, D and E but for many cases fewer
        classes are needed (only A and B, for example). Assign all available
        RAID disks this way.
       </p><p>
        You can press the <span class="keycap">Ctrl</span> or
        <span class="keycap">Shift</span> key to select multiple devices. You
        can also right-click a selected device and choose the appropriate class
        from the context menu.
       </p></li><li class="step "><p>
        Specify the order of the devices by selecting one of the sorting
        options:
       </p><p><span class="formalpara-title"><span class="guimenu">Sorted</span>: </span>
         Sorts all devices of class A before all devices of class B and so on.
         For example: <code class="literal">AABBCC</code>.
        </p><p><span class="formalpara-title"><span class="guimenu">Interleaved</span>: </span>
         Sorts devices by the first device of class A, then first device of
         class B, then all the following classes with assigned devices. Then
         the second device of class A, the second device of class B, and so on
         follows. All devices without a class are sorted to the end of the
         devices list. For example: <code class="literal">ABCABC</code>.
        </p><p><span class="formalpara-title">Pattern File: </span>
         Select an existing file that contains multiple lines, where each is a
         regular expression and a class name (<code class="literal">"sda.* A"</code>).
         All devices that match the regular expression are assigned to the
         specified class for that line. The regular expression is matched
         against the kernel name (<code class="filename">/dev/sda1</code>), the udev
         path name
         (<code class="filename">/dev/disk/by-path/pci-0000:00:1f.2-scsi-0:0:0:0-part1</code>)
         and then the udev ID
         (<code class="filename">dev/disk/by-id/ata-ST3500418AS_9VMN8X8L-part1</code>).
         The first match made determines the class if a device’s name matches
         more than one regular expression.
        </p></li><li class="step "><p>
        At the bottom of the dialog, click <span class="guimenu">OK</span> to confirm the
        order.
       </p><div class="informalfigure"><div class="mediaobject"><a xmlns="" href="images/raid10_classify_a.png"><img src="images/raid10_classify_a.png" width="" /></a></div></div></li></ol></li><li class="step "><p>
      Click <span class="guimenu">Next</span>.
     </p></li><li class="step "><p>
      Under <span class="guimenu">RAID Options</span>, specify the <span class="guimenu">Chunk
      Size</span> and <span class="guimenu">Parity Algorithm</span>, then click
      <span class="guimenu">Next</span>.
     </p><p>
      For a RAID 10, the parity options are n (near), f (far), and o (offset).
      The number indicates the number of replicas of each data block that are
      required. Two is the default. For information, see
      <a class="xref" href="cha.raid10.html#sec.raid10.complex.layout" title="9.2.2. Layout">Section 9.2.2, “Layout”</a>.
     </p></li><li class="step "><p>
      Add a file system and mount options to the RAID device, then click
      <span class="guimenu">Finish</span>.
     </p></li><li class="step "><p>
      Click <span class="guimenu">Next</span>.
     </p></li><li class="step "><p>
      Verify the changes to be made, then click <span class="guimenu">Finish</span> to
      create the RAID.
     </p></li></ol></div></div></div><div class="sect2 " id="sec.raid10.complex.yast.mdadm"><div class="titlepage"><div><div><h3 class="title" id="sec.raid10.complex.yast.mdadm"><span class="number">9.2.4 </span><span class="name">Creating a Complex RAID 10 with mdadm</span> <a title="Permalink" class="permalink" href="cha.raid10.html#sec.raid10.complex.yast.mdadm">#</a></h3></div></div></div><p>
    The procedure in this section uses the device names shown in the following
    table. Ensure that you modify the device names with the names of your own
    devices.
   </p><div class="table" id="idm140202880887648"><div class="table-title-wrap"><h6 class="table-title"><span class="number">Table 9.5: </span><span class="name">Scenario for Creating a RAID 10 Using mdadm </span><a title="Permalink" class="permalink" href="cha.raid10.html#idm140202880887648">#</a></h6></div><div class="table-contents"><table summary="Scenario for Creating a RAID 10 Using mdadm" border="1"><colgroup><col class="1" /><col class="2" /></colgroup><thead><tr><th>
        <p>
         Raw Devices
        </p>
       </th><th>
        <p>
         RAID 10
        </p>
       </th></tr></thead><tbody><tr><td>
        <p>
         <code class="filename">/dev/sdf1</code>
        </p>
        <p>
         <code class="filename">/dev/sdg1</code>
        </p>
        <p>
         <code class="filename">/dev/sdh1</code>
        </p>
        <p>
         <code class="filename">/dev/sdi1</code>
        </p>
       </td><td>
        <p>
         <code class="filename">/dev/md3</code>
        </p>
       </td></tr></tbody></table></div></div><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
      Open a terminal console.
     </p></li><li class="step "><p>
      If necessary, create at least four 0xFD Linux RAID partitions of equal
      size using a disk partitioner such as parted.
     </p></li><li class="step "><p>
      Create a RAID 10 by entering the following command.
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> mdadm --create /dev/md3 --run --level=10 --chunk=32 --raid-devices=4 \
/dev/sdf1 /dev/sdg1 /dev/sdh1 /dev/sdi1</pre></div><p>
      Make sure to adjust the value for <code class="option">--raid-devices</code> and the
      list of partitions according to your setup.
     </p><p>
      The command creates an array with near layout and two replicas. To change
      any of the two values, use the <code class="option">--layout</code> as described in
      <a class="xref" href="cha.raid10.html#sec.raid10.complex.layout.parameter" title="9.2.2.4. Specifying the number of Replicas and the Layout with YaST and mdadm">Section 9.2.2.4, “Specifying the number of Replicas and the Layout with YaST and mdadm”</a>.
     </p></li><li class="step "><p>
      Create a file system on the RAID 10 device
      <code class="filename">/dev/md3</code>, for example an XFS file system:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> mkfs.xfs /dev/md3</pre></div><p>
      Modify the command to use a different file system.
     </p></li><li class="step "><p>
      Edit the <code class="filename">/etc/mdadm.conf</code> file or create it, if it
      does not exist (for example by running <code class="command">sudo vi
      /etc/mdadm.conf</code>). Add the following lines (if the file exists,
      the first line probably already exists, too) .
     </p><div class="verbatim-wrap"><pre class="screen">DEVICE containers partitions
ARRAY /dev/md3 UUID=<em class="replaceable ">UUID</em></pre></div><p>
      The UUID of the device can be retrieved with the following command:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> mdadm -D /dev/md3 | grep UUID</pre></div></li><li class="step "><p>
      Edit the <code class="filename">/etc/fstab</code> file to add an entry for the
      RAID 10 device <code class="filename">/dev/md3</code>. The following example
      shows an entry for a RAID device with the XFS file system and
      <code class="filename">/data</code> as a mount point.
     </p><div class="verbatim-wrap"><pre class="screen">/dev/md3 /data xfs defaults 1 2</pre></div></li><li class="step "><p>
      Mount the RAID device:
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> mount /data</pre></div></li></ol></div></div></div></div></div></div><div class="page-bottom"><div id="_bottom-navigation"><a class="nav-link" href="cha.raid_degraded.html"><span class="next-icon">→</span><span class="nav-label"><span class="number">Chapter 10 </span>Creating a Degraded RAID Array</span></a><a class="nav-link" href="cha.raidroot.html"><span class="prev-icon">←</span><span class="nav-label"><span class="number">Chapter 8 </span>Configuring Software RAID for the Root Partition</span></a></div><div id="_share-print"><div class="online-contents share"><strong>Share this page: </strong><span class="share-buttons"><span id="_share-fb" class="bottom-button">Facebook</span><span class="spacer"> • </span><span id="_share-gp" class="bottom-button">Google+</span><span class="spacer"> • </span><span id="_share-tw" class="bottom-button">Twitter</span><span class="spacer"> • </span><span id="_share-mail" class="bottom-button">E-Mail</span></span></div><div class="print"><span id="_print-button" class="bottom-button">Print this page</span></div><div class="clearme"></div></div></div></div><div id="_inward"></div></div><div id="_footer-wrap"><div id="_footer"><p>©
        2018 
        SUSE</p><ul><li><a href="http://www.suse.com/company/careers/" target="_top">Careers</a></li><li><a href="http://www.suse.com/company/legal/" target="_top">Legal</a></li><li><a href="http://www.suse.com/company/" target="_top">About</a></li><li><a href="http://www.suse.com/ContactsOffices/contacts_offices.jsp" target="_top">Contact Us</a></li></ul></div></div></body></html>