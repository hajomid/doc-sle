<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang=""><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Setting Up the Linux Audit Framework | Security Guide | SUSE Linux Enterprise Server 15</title><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" /><link rel="stylesheet" type="text/css" href="static/css/style.css" /><link rel="stylesheet" type="text/css" href="static/css/highlight.css" /><meta name="generator" content="DAPS 2.4.0 using SUSE XSL Stylesheets 2.0.8 (based on DocBook XSL Stylesheets 1.78.1) - chunked" /><meta name="product-name" content="SUSE Linux Enterprise Server" /><meta name="product-number" content="15" /><meta name="book-title" content="Security Guide" /><meta name="chapter-title" content="Chapter 32. Setting Up the Linux Audit Framework" /><meta name="tracker-url" content="https://bugzilla.suse.com/enter_bug.cgi" /><meta name="tracker-type" content="bsc" /><meta name="tracker-bsc-assignee" content="fs@suse.com" /><meta name="tracker-bsc-component" content="Documentation" /><meta name="tracker-bsc-product" content="Beta SUSE Linux Enterprise Server 15" /><link rel="home" href="index.html" title="SUSE Linux Enterprise Server Documentation" /><link rel="up" href="part.audit.html" title="Part VI. The Linux Audit Framework" /><link rel="prev" href="cha.audit.comp.html" title="Chapter 31. Understanding Linux Audit" /><link rel="next" href="cha.audit.scenarios.html" title="Chapter 33. Introducing an Audit Rule Set" /><script type="text/javascript">

var protocol = window.location.protocol.toLowerCase();
if ( protocol != 'file:' ) {
  var agent = navigator.userAgent.toLowerCase();
  var wanted = ( protocol == 'https:') ? 'https' : 'http';
  var file = 'fonts.css';
  document.write('<link rel="stylesheet" type="text/css" href="' + wanted + '://static.opensuse.org/fonts/'+ file +'"></link>');
}
else {
   document.write('<link rel="stylesheet" type="text/css" href="static/css/fonts-onlylocal.css"></link>');
}

</script><noscript><link rel="stylesheet" type="text/css" href="http://static.opensuse.org/fonts/fonts.css" /></noscript><script src="static/js/jquery-1.10.2.min.js" type="text/javascript"></script><script src="static/js/script.js" type="text/javascript"></script><script src="static/js/highlight.min.js" type="text/javascript"></script><script>

$(document).ready(function() {
  $('.verbatim-wrap.highlight').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});
hljs.configure({
  useBR: false
});

</script></head><body class="draft offline js-off"><div id="_outer-wrap"><div id="_white-bg"><div id="_header"><div id="_logo"><img src="static/images/logo.png" alt="Logo" /></div><div class="crumbs"><a class="book-link" href="index.html" title="SUSE Linux Enterprise Server Documentation"><span class="book-icon">SUSE Linux Enterprise Server Documentation</span></a><span> › </span><a class="crumb" href="book.security.html">Security Guide</a><span> › </span><a class="crumb" href="part.audit.html">The Linux Audit Framework</a><span> › </span><a class="crumb" href="cha.audit.setup.html">Setting Up the Linux Audit Framework</a></div><div class="clearme"></div></div></div><div id="_toolbar-wrap"><div id="_toolbar"><div id="_toc-area" class="inactive"><a id="_toc-area-button" class="tool" title="Contents" accesskey="c" href="index.html"><span class="tool-spacer"><span class="toc-icon">Contents</span><span class="clearme"></span></span><span class="tool-label">Contents</span></a><div class="active-contents bubble-corner"></div><div class="active-contents bubble"><div class="bubble-container"><h6>Security Guide</h6><div id="_bubble-toc"><ol><li class="inactive"><a href="preface.security.html"><span class="number"> </span><span class="name">About This Guide</span></a></li><li class="inactive"><a href="cha.security.html"><span class="number">1 </span><span class="name">Security and Confidentiality</span></a></li><li class="inactive"><a href="part.auth.html"><span class="number">I </span><span class="name">Authentication</span></a><ol><li class="inactive"><a href="cha.pam.html"><span class="number">2 </span><span class="name">Authentication with PAM</span></a></li><li class="inactive"><a href="cha.nis.html"><span class="number">3 </span><span class="name">Using NIS</span></a></li><li class="inactive"><a href="cha.security.auth.html"><span class="number">4 </span><span class="name">Setting Up Authentication Servers and Clients Using YaST</span></a></li><li class="inactive"><a href="cha.security.ldap.html"><span class="number">5 </span><span class="name">LDAP—A Directory Service</span></a></li><li class="inactive"><a href="cha.security.kerberos.html"><span class="number">6 </span><span class="name">Network Authentication with Kerberos</span></a></li><li class="inactive"><a href="cha.security.ad.html"><span class="number">7 </span><span class="name">Active Directory Support</span></a></li></ol></li><li class="inactive"><a href="part.local_security.html"><span class="number">II </span><span class="name">Local Security</span></a><ol><li class="inactive"><a href="cha.security.yast_security.html"><span class="number">8 </span><span class="name">Configuring Security Settings with YaST</span></a></li><li class="inactive"><a href="cha.security.policykit.html"><span class="number">9 </span><span class="name">Authorization with PolKit</span></a></li><li class="inactive"><a href="cha.security.acls.html"><span class="number">10 </span><span class="name">Access Control Lists in Linux</span></a></li><li class="inactive"><a href="cha.security.cryptofs.html"><span class="number">11 </span><span class="name">Encrypting Partitions and Files</span></a></li><li class="inactive"><a href="cha.certstore.html"><span class="number">12 </span><span class="name">Certificate Store</span></a></li><li class="inactive"><a href="cha.aide.html"><span class="number">13 </span><span class="name">Intrusion Detection with AIDE</span></a></li></ol></li><li class="inactive"><a href="part.network_security.html"><span class="number">III </span><span class="name">Network Security</span></a><ol><li class="inactive"><a href="cha.ssh.html"><span class="number">14 </span><span class="name">SSH: Secure Network Operations</span></a></li><li class="inactive"><a href="cha.security.firewall.html"><span class="number">15 </span><span class="name">Masquerading and Firewalls</span></a></li><li class="inactive"><a href="cha.security.vpnserver.html"><span class="number">16 </span><span class="name">Configuring a VPN Server</span></a></li><li class="inactive"><a href="cha.security.yast_ca.html"><span class="number">17 </span><span class="name">Managing X.509 Certification</span></a></li></ol></li><li class="inactive"><a href="part.apparmor.html"><span class="number">IV </span><span class="name">Confining Privileges with <span class="phrase">AppArmor</span></span></a><ol><li class="inactive"><a href="cha.apparmor.intro.html"><span class="number">18 </span><span class="name">Introducing <span class="phrase">AppArmor</span></span></a></li><li class="inactive"><a href="cha.apparmor.start.html"><span class="number">19 </span><span class="name">Getting Started</span></a></li><li class="inactive"><a href="cha.apparmor.concept.html"><span class="number">20 </span><span class="name">Immunizing Programs</span></a></li><li class="inactive"><a href="cha.apparmor.profiles.html"><span class="number">21 </span><span class="name">Profile Components and Syntax</span></a></li><li class="inactive"><a href="cha.apparmor.repos.html"><span class="number">22 </span><span class="name"><span class="phrase">AppArmor</span> Profile Repositories</span></a></li><li class="inactive"><a href="cha.apparmor.yast.html"><span class="number">23 </span><span class="name">Building and Managing Profiles with YaST</span></a></li><li class="inactive"><a href="cha.apparmor.commandline.html"><span class="number">24 </span><span class="name">Building Profiles from the Command Line</span></a></li><li class="inactive"><a href="cha.apparmor.hat.html"><span class="number">25 </span><span class="name">Profiling Your Web Applications Using ChangeHat</span></a></li><li class="inactive"><a href="cha.apparmor.pam.html"><span class="number">26 </span><span class="name">Confining Users with <code class="systemitem">pam_apparmor</code></span></a></li><li class="inactive"><a href="cha.apparmor.managing.html"><span class="number">27 </span><span class="name">Managing Profiled Applications</span></a></li><li class="inactive"><a href="cha.apparmor.support.html"><span class="number">28 </span><span class="name">Support</span></a></li><li class="inactive"><a href="cha.apparmor.glossary.html"><span class="number">29 </span><span class="name"><span class="phrase">AppArmor</span> Glossary</span></a></li></ol></li><li class="inactive"><a href="bk06pt05.html"><span class="number">V </span><span class="name">SELinux</span></a><ol><li class="inactive"><a href="cha.selinux.html"><span class="number">30 </span><span class="name">Configuring SELinux</span></a></li></ol></li><li class="inactive"><a href="part.audit.html"><span class="number">VI </span><span class="name"><em class="citetitle ">The Linux Audit Framework</em></span></a><ol><li class="inactive"><a href="cha.audit.comp.html"><span class="number">31 </span><span class="name">Understanding Linux Audit</span></a></li><li class="inactive"><a href="cha.audit.setup.html"><span class="number">32 </span><span class="name">Setting Up the Linux Audit Framework</span></a></li><li class="inactive"><a href="cha.audit.scenarios.html"><span class="number">33 </span><span class="name">Introducing an Audit Rule Set</span></a></li><li class="inactive"><a href="cha.audit.moreinfo.html"><span class="number">34 </span><span class="name">Useful Resources</span></a></li></ol></li><li class="inactive"><a href="app.pcidss.html"><span class="number">A </span><span class="name">Achieving PCI-DSS Compliance</span></a></li><li class="inactive"><a href="bk06apb.html"><span class="number">B </span><span class="name">GNU Licenses</span></a></li></ol></div><div class="clearme"></div></div></div></div><div id="_nav-area" class="inactive"><div class="tool"><span class="nav-inner"><span class="tool-label">Navigation</span><a accesskey="p" class="tool-spacer" title="Chapter 31. Understanding Linux Audit" href="cha.audit.comp.html"><span class="prev-icon">←</span></a><a accesskey="n" class="tool-spacer" title="Chapter 33. Introducing an Audit Rule Set" href="cha.audit.scenarios.html"><span class="next-icon">→</span></a></span></div></div></div></div><div id="_fixed-header-wrap" class="inactive"><div id="_fixed-header"><div class="crumbs"><a class="book-link" href="index.html" title="SUSE Linux Enterprise Server Documentation"><span class="book-icon">SUSE Linux Enterprise Server Documentation</span></a><span> › </span><a class="crumb" href="book.security.html">Security Guide</a><span> › </span><a class="crumb" href="part.audit.html">The Linux Audit Framework</a><span> › </span><a class="crumb" href="cha.audit.setup.html">Setting Up the Linux Audit Framework</a></div><div class="buttons"><a class="top-button button" href="#">Top</a><div class="button"><a accesskey="p" class="tool-spacer" title="Chapter 31. Understanding Linux Audit" href="cha.audit.comp.html"><span class="prev-icon">←</span></a><a accesskey="n" class="tool-spacer" title="Chapter 33. Introducing an Audit Rule Set" href="cha.audit.scenarios.html"><span class="next-icon">→</span></a></div><div class="clearme"></div></div><div class="clearme"></div></div></div><div id="_content" class="draft "><div class="documentation"><div class="chapter " id="cha.audit.setup"><div class="titlepage"><div><div class="version-info">Applies to  <span class="productname"><span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span></span> <span class="productnumber"><span class="productnumber"><span class="phrase">15</span></span></span></div><div><h2 class="title"><span class="number">32 </span><span class="name">Setting Up the Linux Audit Framework</span> </h2><div class="doc-status"><ul><li><span class="ds-label">Filename: </span>audit_setup.xml</li><li><span class="ds-label">ID: </span>cha.audit.setup</li></ul></div></div></div></div><div class="line"><div class="toc"><dl><dt><span class="sect1"><a href="cha.audit.setup.html#sec.audit.choose"><span class="number">32.1 </span><span class="name">Determining the Components to Audit</span></a></span></dt><dt><span class="sect1"><a href="cha.audit.setup.html#sec.audit.config"><span class="number">32.2 </span><span class="name">Configuring the Audit Daemon</span></a></span></dt><dt><span class="sect1"><a href="cha.audit.setup.html#sec.audit.syscall"><span class="number">32.3 </span><span class="name">Enabling Audit for System Calls</span></a></span></dt><dt><span class="sect1"><a href="cha.audit.setup.html#sec.audit.aurules"><span class="number">32.4 </span><span class="name">Setting Up Audit Rules</span></a></span></dt><dt><span class="sect1"><a href="cha.audit.setup.html#sec.audit.aurepo"><span class="number">32.5 </span><span class="name">Configuring Audit Reports</span></a></span></dt><dt><span class="sect1"><a href="cha.audit.setup.html#sec.audit.viz"><span class="number">32.6 </span><span class="name">Configuring Log Visualization</span></a></span></dt></dl></div></div><p>
  This chapter shows how to set up a simple audit scenario. Every step
  involved in configuring and enabling audit is explained in detail. After
  you have learned to set up audit, consider a real-world example scenario
  in <a class="xref" href="cha.audit.scenarios.html" title="Chapter 33. Introducing an Audit Rule Set">Chapter 33, <em>Introducing an Audit Rule Set</em></a>.
 </p><p>
  To set up audit on <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span>, you need to complete the following
  steps:
 </p><div class="procedure " id="idm140698456812464"><div class="procedure-title-wrap"><h6 class="procedure-title"><span class="number">Procedure 32.1: </span><span class="name">Setting Up the Linux Audit Framework </span><a title="Permalink" class="permalink" href="cha.audit.setup.html#idm140698456812464">#</a></h6></div><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
    Make sure that all required packages are installed:
    <code class="systemitem">audit</code>,
    <code class="systemitem">audit-libs</code>, and optionally
    <code class="systemitem">audit-libs-python</code>. To use the
    log visualization as described in <a class="xref" href="cha.audit.setup.html#sec.audit.viz" title="32.6. Configuring Log Visualization">Section 32.6, “Configuring Log Visualization”</a>,
    install <code class="systemitem">gnuplot</code> and
    <code class="systemitem">graphviz</code> from the
    <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> media.
   </p></li><li class="step "><p>
    Determine the components to audit. Refer to
    <a class="xref" href="cha.audit.setup.html#sec.audit.choose" title="32.1. Determining the Components to Audit">Section 32.1, “Determining the Components to Audit”</a> for details.
   </p></li><li class="step "><p>
    Check or modify the basic audit daemon configuration. Refer to
    <a class="xref" href="cha.audit.setup.html#sec.audit.config" title="32.2. Configuring the Audit Daemon">Section 32.2, “Configuring the Audit Daemon”</a> for details.
   </p></li><li class="step "><p>
    Enable auditing for system calls. Refer to
    <a class="xref" href="cha.audit.setup.html#sec.audit.syscall" title="32.3. Enabling Audit for System Calls">Section 32.3, “Enabling Audit for System Calls”</a> for details.
   </p></li><li class="step "><p>
    Compose audit rules to suit your scenario. Refer to
    <a class="xref" href="cha.audit.setup.html#sec.audit.aurules" title="32.4. Setting Up Audit Rules">Section 32.4, “Setting Up Audit Rules”</a> for details.
   </p></li><li class="step "><p>
    Generate logs and configure tailor-made reports. Refer to
    <a class="xref" href="cha.audit.setup.html#sec.audit.aurepo" title="32.5. Configuring Audit Reports">Section 32.5, “Configuring Audit Reports”</a> for details.
   </p></li><li class="step "><p>
    Configure optional log visualization. Refer to
    <a class="xref" href="cha.audit.setup.html#sec.audit.viz" title="32.6. Configuring Log Visualization">Section 32.6, “Configuring Log Visualization”</a> for details.
   </p></li></ol></div></div><div id="idm140698456796272" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.png" /><h6>Important: Controlling the Audit Daemon</h6><p>
   Before configuring any of the components of the audit system, make sure
   that the audit daemon is not running by entering <code class="command">systemctl
   status auditd</code> as <code class="systemitem">root</code>. On a default
   <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> system, audit is started on boot, so you need to turn it
   off by entering <code class="command">systemctl stop auditd</code>. Start
   the daemon after configuring it with <code class="command">systemctl start
   auditd</code>.
  </p></div><div class="sect1 " id="sec.audit.choose"><div class="titlepage"><div><div><h2 class="title" id="sec.audit.choose"><span class="number">32.1 </span><span class="name">Determining the Components to Audit</span> <a title="Permalink" class="permalink" href="cha.audit.setup.html#sec.audit.choose">#</a></h2></div></div></div><p>
   Before starting to create your own audit configuration, determine to
   which degree you want to use it. Check the following general rules to
   determine which use case best applies to you and your requirements:
  </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
     If you require a full security audit for CAPP/EAL certification, enable
     full audit for system calls and configure watches on various
     configuration files and directories, similar to the rule set featured
     in <a class="xref" href="cha.audit.scenarios.html" title="Chapter 33. Introducing an Audit Rule Set">Chapter 33, <em>Introducing an Audit Rule Set</em></a>.
    </p></li><li class="listitem "><p>
     If you need to trace a process based on the audit rules, use
     <code class="command">autrace</code>.
    </p></li><li class="listitem "><p>
     If you require file and directory watches to track access to important
     or security-sensitive data, create a rule set matching these
     requirements. Enable audit as described in
     <a class="xref" href="cha.audit.setup.html#sec.audit.syscall" title="32.3. Enabling Audit for System Calls">Section 32.3, “Enabling Audit for System Calls”</a> and proceed to
     <a class="xref" href="cha.audit.setup.html#sec.audit.aurules" title="32.4. Setting Up Audit Rules">Section 32.4, “Setting Up Audit Rules”</a>.
    </p></li></ul></div></div><div class="sect1 " id="sec.audit.config"><div class="titlepage"><div><div><h2 class="title" id="sec.audit.config"><span class="number">32.2 </span><span class="name">Configuring the Audit Daemon</span> <a title="Permalink" class="permalink" href="cha.audit.setup.html#sec.audit.config">#</a></h2></div></div></div><p>
   The basic setup of the audit daemon is done by editing
   <code class="filename">/etc/audit/auditd.conf</code>. You may also use YaST
   to configure the basic settings by calling <span class="guimenu">YaST</span> › <span class="guimenu">Security and Users</span> › <span class="guimenu">Linux Audit Framework (LAF)</span>. Use the
   tabs <span class="guimenu">Log File</span> and <span class="guimenu">Disk Space</span> for
   configuration.
  </p><div class="verbatim-wrap"><pre class="screen">log_file = /var/log/audit/audit.log
log_format = RAW
log_group = root
priority_boost = 4
flush = INCREMENTAL
freq = 20
num_logs = 5
disp_qos = lossy
dispatcher = /sbin/audispd
name_format = NONE
##name = mydomain
max_log_file = 6
max_log_file_action = ROTATE
space_left = 75
space_left_action = SYSLOG
action_mail_acct = root
admin_space_left = 50
admin_space_left_action = SUSPEND
disk_full_action = SUSPEND
disk_error_action = SUSPEND
##tcp_listen_port =
tcp_listen_queue = 5
tcp_max_per_addr = 1
##tcp_client_ports = 1024-65535
tcp_client_max_idle = 0
cp_client_max_idle = 0</pre></div><p>
   The default settings work reasonably well for many setups. Some values,
   such as <code class="literal">num_logs</code>, <code class="literal">max_log_file</code>,
   <code class="literal">space_left</code>, and <code class="literal">admin_space_left</code>
   depend on the size of your deployment. If disk space is limited, you
   should reduce the number of log files to keep if they are rotated
   and you should get an earlier warning if disk space is running out.
   For a CAPP-compliant setup, adjust the values for
   <code class="literal">log_file</code>, <code class="literal">flush</code>,
   <code class="literal">max_log_file</code>, <code class="literal">max_log_file_action</code>,
   <code class="literal">space_left</code>, <code class="literal">space_left_action</code>,
   <code class="literal">admin_space_left</code>,
   <code class="literal">admin_space_left_action</code>,
   <code class="literal">disk_full_action</code>, and
   <code class="literal">disk_error_action</code>, as described in
   <a class="xref" href="cha.audit.comp.html#sec.audit.auditd" title="31.2. Configuring the Audit Daemon">Section 31.2, “Configuring the Audit Daemon”</a>. An example CAPP-compliant
   configuration looks like this:
  </p><div class="verbatim-wrap"><pre class="screen">log_file = <em class="replaceable ">PATH_TO_SEPARATE_PARTITION</em>/audit.log
log_format = RAW
priority_boost = 4
flush = SYNC                       ### or DATA
freq = 20
num_logs = 4
dispatcher = /sbin/audispd
disp_qos = lossy
max_log_file = 5
max_log_file_action = KEEP_LOGS
space_left = 75
space_left_action = EMAIL
action_mail_acct = root
admin_space_left = 50
admin_space_left_action = SINGLE   ### or HALT
disk_full_action = SUSPEND         ### or HALT
disk_error_action = SUSPEND        ### or HALT</pre></div><p>
   The <code class="literal">###</code> precedes comments where you can choose from
   several options. Do not add the comments to your actual configuration
   files.
  </p><div id="idm140698456767328" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.png" /><h6>Tip: For More Information</h6><p>
    Refer to <a class="xref" href="cha.audit.comp.html#sec.audit.auditd" title="31.2. Configuring the Audit Daemon">Section 31.2, “Configuring the Audit Daemon”</a> for detailed background
    information about the <code class="filename">auditd.conf</code> configuration
    parameters.
   </p></div></div><div class="sect1 " id="sec.audit.syscall"><div class="titlepage"><div><div><h2 class="title" id="sec.audit.syscall"><span class="number">32.3 </span><span class="name">Enabling Audit for System Calls</span> <a title="Permalink" class="permalink" href="cha.audit.setup.html#sec.audit.syscall">#</a></h2></div></div></div><p>
   If the audit framework is not installed, install the
   <code class="systemitem">audit</code> package. A standard <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span>
   system does not have auditd running by default. Enable it with:
  </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> systemctl enable auditd</pre></div><p>
   There are different levels of auditing activity available:
  </p><div class="variablelist "><dl class="variablelist"><dt id="idm140698456759632"><span class="term ">Basic Logging</span></dt><dd><p>
      Out of the box (without any further configuration) auditd logs only
      events concerning its own configuration changes to
      <code class="filename">/var/log/audit/audit.log</code>. No events (file access,
      system call, etc.) are generated by the kernel audit component until
      requested by <code class="command">auditctl</code>. However, other kernel
      components and modules may log audit events outside of the control of
      <code class="command">auditctl</code> and these appear in the audit log. By
      default, the only module that generates audit events is <span class="phrase">AppArmor</span>.
     </p></dd><dt id="idm140698456755616"><span class="term ">Advanced Logging with System Call Auditing</span></dt><dd><p>
      To audit system calls and get meaningful file watches, you need to
      enable audit contexts for system calls.
     </p></dd></dl></div><p>
   As you need system call auditing capabilities even when you are
   configuring plain file or directory watches, you need to enable audit
   contexts for system calls. To enable audit contexts for the duration of
   the current session only, execute <code class="command">auditctl -e 1</code> as
   <code class="systemitem">root</code>. To disable this feature, execute <code class="command">auditctl -e
   0</code> as <code class="systemitem">root</code>.
  </p><p>
   The audit contexts are enabled by default. To turn this feature off
   temporarily, use <code class="command">auditctl -e 0</code>.
  </p></div><div class="sect1 " id="sec.audit.aurules"><div class="titlepage"><div><div><h2 class="title" id="sec.audit.aurules"><span class="number">32.4 </span><span class="name">Setting Up Audit Rules</span> <a title="Permalink" class="permalink" href="cha.audit.setup.html#sec.audit.aurules">#</a></h2></div></div></div><p>
   Using audit rules, determine which aspects of the system should be
   analyzed by audit. Normally this includes important databases and
   security-relevant configuration files. You may also analyze various
   system calls in detail if a broad analysis of your system is required. A
   very detailed example configuration that includes most of the rules that
   are needed in a CAPP compliant environment is available in
   <a class="xref" href="cha.audit.scenarios.html" title="Chapter 33. Introducing an Audit Rule Set">Chapter 33, <em>Introducing an Audit Rule Set</em></a>.
  </p><p>
   Audit rules can be passed to the audit daemon on the
   <code class="command">auditctl</code> command line and by composing a rule
   set in <code class="filename">/etc/audit/audit.rules</code> which is processed
   whenever the audit daemon is started. To customize
   <code class="filename">/etc/audit/audit.rules</code> either edit it directly, or
   use YaST: <span class="guimenu">Security and Users</span> › <span class="guimenu">Linux Audit Framework (LAF)</span> › <span class="guimenu">Rules for
   'auditctl'</span>. Rules passed on the command line are
   not persistent and need to be re-entered when the audit daemon is
   restarted.
  </p><p>
   A simple rule set for very basic auditing on a few important files and
   directories could look like this:
  </p><div class="verbatim-wrap"><pre class="screen"># basic audit system parameters
-D
-b 8192
-f 1
-e 1

# some file and directory watches with keys
-w /var/log/audit/ -k LOG_audit
-w /etc/audit/auditd.conf -k CFG_audit_conf -p rxwa
-w /etc/audit/audit.rules -k CFG_audit_rules -p rxwa

-w /etc/passwd -k CFG_passwd -p rwxa
-w /etc/sysconfig/ -k CFG_sysconfig

# an example system call rule
-a entry,always -S umask

### add your own rules</pre></div><p>
   When configuring the basic audit system parameters (such as the backlog
   parameter <code class="literal">-b</code>) test these settings with your intended
   audit rule set to determine whether the backlog size is appropriate for
   the level of logging activity caused by your audit rule set. If your
   chosen backlog size is too small, your system might not be able to handle
   the audit load and consult the failure flag (<code class="literal">-f</code>) when
   the backlog limit is exceeded.
  </p><div id="idm140698456739744" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.png" /><h6>Important: Choosing the Failure Flag</h6><p>
    When choosing the failure flag, note that <code class="option">-f 2</code> tells
    your system to perform an immediate shutdown without flushing any
    pending data to disk when the limits of your audit system are exceeded.
    Because this shutdown is not a clean shutdown, restrict the use of
    <code class="option">-f 2</code> to only the most security-conscious environments
    and use <code class="option">-f 1</code> (system continues to run, issues a warning
    and audit stops) for any other setup to avoid loss of data or data
    corruption.
   </p></div><p>
   Directory watches produce less verbose output than separate file watches
   for the files under these directories. To get detailed logging for your
   system configuration in <code class="filename">/etc/sysconfig</code>, for example,
   add watches for each file. Audit does not support globbing,
   which means you cannot create a rule that says <code class="literal">-w
   /etc/*</code> and watches all files and directories below
   <code class="filename">/etc</code>.
  </p><p>
   For better identification in the log file, a key has been added to each
   of the file and directory watches. Using the key, it is easier to comb
   the logs for events related to a certain rule. When creating keys,
   distinguish between mere log file watches and configuration file watches
   by using an appropriate prefix with the key, in this case
   <code class="literal">LOG</code> for a log file watch and <code class="literal">CFG</code>
   for a configuration file watch. Using the file name as part of the key
   also makes it easier for you to identify events of this type in the log
   file.
  </p><p>
   Another thing to keep in mind when creating file and directory watches is
   that audit cannot deal with files that do not exist when the rules are
   created. Any file that is added to your system while audit is already
   running is not watched unless you extend the rule set to watch this new
   file.
  </p><p>
   For more information about creating custom rules, refer to
   <a class="xref" href="cha.audit.comp.html#sec.audit.rules" title="31.4. Passing Parameters to the Audit System">Section 31.4, “Passing Parameters to the Audit System”</a>.
  </p><div id="idm140698456730368" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.png" /><h6>Important: Changing Audit Rules</h6><p>
    After you change audit rules, always restart the audit daemon with
    <code class="command">systemctl restart auditd</code> to reread the
    changed rules.
   </p></div></div><div class="sect1 " id="sec.audit.aurepo"><div class="titlepage"><div><div><h2 class="title" id="sec.audit.aurepo"><span class="number">32.5 </span><span class="name">Configuring Audit Reports</span> <a title="Permalink" class="permalink" href="cha.audit.setup.html#sec.audit.aurepo">#</a></h2></div></div></div><p>
   To avoid having to dig through the raw audit logs to get an impression of
   what your system is currently doing, run custom audit reports at certain
   intervals. Custom audit reports enable you to focus on areas of interest
   and get meaningful statistics on the nature and frequency of the events
   you are monitoring. To analyze individual events in detail, use the
   ausearch tool.
  </p><p>
   Before setting up audit reporting, consider the following:
  </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
     What types of events do you want to monitor by generating regular
     reports? Select the appropriate aureport command lines as described in
     <a class="xref" href="cha.audit.comp.html#sec.audit.aureport.gen" title="31.5.2. Generating Custom Audit Reports">Section 31.5.2, “Generating Custom Audit Reports”</a>.
    </p></li><li class="listitem "><p>
     What do you want to do with the audit reports? Decide whether to create
     graphical charts from the data accumulated or whether it should be
     transferred into any sort of spreadsheet or database. Set up the
     aureport command line and further processing similar to the examples
     shown in <a class="xref" href="cha.audit.setup.html#sec.audit.viz" title="32.6. Configuring Log Visualization">Section 32.6, “Configuring Log Visualization”</a> if you want to visualize your
     reports.
    </p></li><li class="listitem "><p>
     When and at which intervals should the reports run? Set up appropriate
     automated reporting using cron.
    </p></li></ul></div><p>
   For this example, assume that you are interested in finding out about any
   attempts to access your audit, PAM, and system configuration. Proceed as
   follows to find out about file events on your system:
  </p><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
     Generate a full summary report of all events and check for any
     anomalies in the summary report, for example, have a look at the
     <span class="quote">“<span class="quote">failed syscalls</span>”</span> record, because these might have failed
     because of insufficient permissions to access a file or a file not
     being there:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> <code class="command">aureport</code>

Summary Report
======================
Range of time in logs: 03/02/09 14:13:38.225 - 17/02/09 16:30:10.352
Selected time for report: 03/02/09 14:13:38 - 17/02/09 16:30:10.352
Number of changes in configuration: 24
Number of changes to accounts, groups, or roles: 0
Number of logins: 9
Number of failed logins: 15
Number of authentications: 19
Number of failed authentications: 578
Number of users: 3
Number of terminals: 15
Number of host names: 4
Number of executables: 20
Number of files: 279
Number of AVC's: 0
Number of MAC events: 0
Number of failed syscalls: 994
Number of anomaly events: 0
Number of responses to anomaly events: 0
Number of crypto events: 0
Number of keys: 2
Number of process IDs: 1238
Number of events: 5435</pre></div></li><li class="step "><p>
     Run a summary report for failed events and check the
     <span class="quote">“<span class="quote">files</span>”</span> record for the number of failed file access
     events:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> <code class="command">aureport</code> <code class="option">--failed</code>

Failed Summary Report
======================
Range of time in logs: 03/02/09 14:13:38.225 - 17/02/09 16:30:10.352
Selected time for report: 03/02/09 14:13:38 - 17/02/09 16:30:10.352
Number of changes in configuration: 0
Number of changes to accounts, groups, or roles: 0
Number of logins: 0
Number of failed logins: 15
Number of authentications: 0
Number of failed authentications: 578
Number of users: 1
Number of terminals: 7
Number of host names: 4
Number of executables: 12
Number of files: 77
Number of AVC's: 0
Number of MAC events: 0
Number of failed syscalls: 994
Number of anomaly events: 0
Number of responses to anomaly events: 0
Number of crypto events: 0
Number of keys: 2
Number of process IDs: 713
Number of events: 1589</pre></div></li><li class="step "><p>
     To list the files that could not be accessed, run a summary report of
     failed file events:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> <code class="command">aureport</code> <code class="option">-f -i --failed --summary</code>

Failed File Summary Report
===========================
total  file
===========================
80  /var
80  spool
80  cron
80  lastrun
46  /usr/lib/locale/en_GB.UTF-8/LC_CTYPE
45  /usr/lib/locale/locale-archive
38  /usr/lib/locale/en_GB.UTF-8/LC_IDENTIFICATION
38  /usr/lib/locale/en_GB.UTF-8/LC_MEASUREMENT
38  /usr/lib/locale/en_GB.UTF-8/LC_TELEPHONE
38  /usr/lib/locale/en_GB.UTF-8/LC_ADDRESS
38  /usr/lib/locale/en_GB.UTF-8/LC_NAME
38  /usr/lib/locale/en_GB.UTF-8/LC_PAPER
38  /usr/lib/locale/en_GB.UTF-8/LC_MESSAGES
38  /usr/lib/locale/en_GB.UTF-8/LC_MONETARY
38  /usr/lib/locale/en_GB.UTF-8/LC_COLLATE
38  /usr/lib/locale/en_GB.UTF-8/LC_TIME
38  /usr/lib/locale/en_GB.UTF-8/LC_NUMERIC
8  /etc/magic.mgc
...</pre></div><p>
     To focus this summary report on a few files or directories of interest
     only, such as <code class="filename">/etc/audit/auditd.conf</code>,
     <code class="filename">/etc/pam.d</code>, and
     <code class="filename">/etc/sysconfig</code>, use a command similar to the
     following:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> <code class="command">aureport -f -i --failed --summary |grep -e "/etc/audit/auditd.conf" -e "/etc/pam.d/" -e "/etc/sysconfig"</code>

1  /etc/sysconfig/displaymanager</pre></div></li><li class="step "><p>
     From the summary report, then proceed to isolate these items of
     interest from the log and find out their event IDs for further
     analysis:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> <code class="command">aureport -f -i --failed |grep -e "/etc/audit/auditd.conf" -e "/etc/pam.d/" -e "/etc/sysconfig"</code>

993. 17/02/09 16:47:34 /etc/sysconfig/displaymanager readlink no /bin/vim-normal root 7887
994. 17/02/09 16:48:23 /etc/sysconfig/displaymanager getxattr no /bin/vim-normal root 7889</pre></div></li><li class="step "><p>
     Use the event ID to get a detailed record for each item of interest:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> <code class="command">ausearch -a</code> <em class="replaceable ">7887</em> -i
----
time-&gt;Tue Feb 17 16:48:23 2009
type=PATH msg=audit(1234885703.090:7889): item=0 name="/etc/sysconfig/displaymanager" inode=369282 dev=08:06 mode=0100644 ouid=0 ogid=0 rdev=00:00
type=CWD msg=audit(1234885703.090:7889):  cwd="/root"
type=SYSCALL msg=audit(1234885703.090:7889): arch=c000003e syscall=191 success=no exit=-61 a0=7e1e20 a1=7f90e4cf9187 a2=7fffed5b57d0 a3=84 items=1 ppid=25548 pid=23045 auid=0 uid=0 gid=0 euid=0 suid=0 fsuid=0 egid=0 sgid=0 fsgid=0 tty=pts2 ses=1166 comm="vim" exe="/bin/vim-normal" key=(null)</pre></div></li></ol></div></div><div id="idm140698456698240" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.png" /><h6>Tip: Focusing on a Certain Time Frame</h6><p>
    If you are interested in events during a particular period of time, trim
    down the reports by using start and end dates and times with your
    <code class="command">aureport</code> commands (<code class="option">-ts</code> and
    <code class="option">-te</code>). For more information, refer to
    <a class="xref" href="cha.audit.comp.html#sec.audit.aureport.gen" title="31.5.2. Generating Custom Audit Reports">Section 31.5.2, “Generating Custom Audit Reports”</a>.
   </p></div><p>
   All steps (except for the last one) can be run automatically and would
   easily be scriptable and configured as cron jobs. Any of the
   <code class="literal">--failed --summary</code> reports could be transformed easily
   into a bar chart that plots files versus failed access attempts. For more
   information about visualizing audit report data, refer to
   <a class="xref" href="cha.audit.setup.html#sec.audit.viz" title="32.6. Configuring Log Visualization">Section 32.6, “Configuring Log Visualization”</a>.
  </p></div><div class="sect1 " id="sec.audit.viz"><div class="titlepage"><div><div><h2 class="title" id="sec.audit.viz"><span class="number">32.6 </span><span class="name">Configuring Log Visualization</span> <a title="Permalink" class="permalink" href="cha.audit.setup.html#sec.audit.viz">#</a></h2></div></div></div><p>
   Using the scripts <code class="command">mkbar</code> and <code class="command">mkgraph</code>
   you can illustrate your audit statistics with various graphs and charts.
   As with any other <code class="command">aureport</code> command, the plotting
   commands are scriptable and can easily be configured to run as cron jobs.
  </p><p>
   <code class="command">mkbar</code> and <code class="command">mkgraph</code> were created by
   Steve Grubb at Red Hat. They are available from
   <a class="link" href="http://people.redhat.com/sgrubb/audit/visualize/" target="_blank">http://people.redhat.com/sgrubb/audit/visualize/</a>.
   Because the current version of audit in <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span> does not ship
   with these scripts, proceed as follows to make them available on your
   system:
  </p><div id="idm140698456686544" class="admonition warning normal"><img class="symbol" alt="Warning" title="Warning" src="static/images/icon-warning.png" /><h6>Warning: Downloaded Content Is Dangerous</h6><p>
    Use <code class="command">mkbar</code> and <code class="command">mkgraph</code> at your own
    risk. Any content downloaded from the Web is potentially dangerous
    to your system, even more so when run with <code class="systemitem">root</code> privileges.
   </p></div><div class="procedure "><div class="procedure-contents"><ol class="procedure" type="1"><li class="step "><p>
     Download the scripts to <code class="systemitem">root</code>'s <code class="filename">~/bin</code>
     directory:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> wget http://people.redhat.com/sgrubb/audit/visualize/mkbar -O ~/bin/mkbar
<code class="prompt user">tux &gt; </code><code class="command">sudo</code> wget http://people.redhat.com/sgrubb/audit/visualize/mkgraph -O ~/bin/mkgraph</pre></div></li><li class="step "><p>
     Adjust the file permissions to read, write, and execute for
     <code class="systemitem">root</code>:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> chmod 744 ~/bin/mk{bar,graph}</pre></div></li></ol></div></div><p>
   To plot summary reports, such as the ones discussed in
   <a class="xref" href="cha.audit.setup.html#sec.audit.aurepo" title="32.5. Configuring Audit Reports">Section 32.5, “Configuring Audit Reports”</a>, use the script
   <code class="command">mkbar</code>. Some example commands could look like the
   following:
  </p><div class="variablelist "><dl class="variablelist"><dt id="idm140698456674496"><span class="term ">Create a Summary of Events</span></dt><dd><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> aureport -e -i --summary | mkbar events</pre></div></dd><dt id="idm140698456672080"><span class="term ">Create a Summary of File Events</span></dt><dd><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> aureport -f -i --summary | mkbar files</pre></div></dd><dt id="idm140698456669680"><span class="term ">Create a Summary of Login Events</span></dt><dd><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> aureport -l -i --summary | mkbar login</pre></div></dd><dt id="idm140698456667280"><span class="term ">Create a Summary of User Events</span></dt><dd><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> aureport -u -i --summary | mkbar users</pre></div></dd><dt id="idm140698456664880"><span class="term ">Create a Summary of System Call Events</span></dt><dd><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> aureport -s -i --summary | mkbar syscalls</pre></div></dd></dl></div><p>
   To create a summary chart of failed events of any of the above event
   types, add the <code class="option">--failed</code> option to the respective
   <code class="command">aureport</code> command. To cover a certain period of time
   only, use the <code class="option">-ts</code> and <code class="option">-te</code> options on
   aureport. Any of these commands can be tweaked further by narrowing down
   its scope using grep or egrep and regular expressions. See the comments
   in the <code class="command">mkbar</code> script for an example. Any of the above
   commands produces a PNG file containing a bar chart of the requested
   data.
  </p><p>
   To illustrate the relationship between different kinds of audit objects,
   such as users and system calls, use the script
   <code class="command">mkgraph</code>. Some example commands could look like the
   following:
  </p><div class="variablelist "><dl class="variablelist"><dt id="idm140698456657856"><span class="term ">Users versus Executables</span></dt><dd><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> LC_ALL=C aureport -u -i | awk '/^[0-9]/ { print $4" "$7 }' | sort | uniq | mkgraph users_vs_exec</pre></div></dd><dt id="idm140698456655392"><span class="term ">Users versus Files</span></dt><dd><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> LC_ALL=C aureport -f -i | awk '/^[0-9]/ { print $8" "$4 }' | sort | uniq | mkgraph users_vs_files</pre></div></dd><dt id="idm140698456652944"><span class="term ">System Calls versus Commands</span></dt><dd><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> LC_ALL=C aureport -s -i | awk '/^[0-9]/ { print $4" "$6 }' | sort | uniq | mkgraph syscall_vs_com</pre></div></dd><dt id="idm140698456650480"><span class="term ">System Calls versus Files</span></dt><dd><div class="verbatim-wrap"><pre class="screen"><code class="prompt user">tux &gt; </code><code class="command">sudo</code> LC_ALL=C aureport -s -i | awk '/^[0-9]/ { print $5" "$4 }' | sort | uniq | mkgraph | syscall_vs_file</pre></div></dd></dl></div><p>
   Graphs can also be combined to illustrate complex relationships. See the
   comments in the <code class="command">mkgraph</code> script for further information
   and an example. The graphs produced by this script are created in
   PostScript format by default, but you can change the output format by
   changing the <code class="envar">EXT</code> variable in the script from
   <code class="literal">ps</code> to <code class="literal">png</code> or
   <code class="literal">jpg</code>.
  </p></div></div></div><div class="page-bottom"><div id="_bottom-navigation"><a class="nav-link" href="cha.audit.scenarios.html"><span class="next-icon">→</span><span class="nav-label"><span class="number">Chapter 33 </span>Introducing an Audit Rule Set</span></a><a class="nav-link" href="cha.audit.comp.html"><span class="prev-icon">←</span><span class="nav-label"><span class="number">Chapter 31 </span>Understanding Linux Audit</span></a></div><div id="_share-print"><div class="online-contents share"><strong>Share this page: </strong><span class="share-buttons"><span id="_share-fb" class="bottom-button">Facebook</span><span class="spacer"> • </span><span id="_share-gp" class="bottom-button">Google+</span><span class="spacer"> • </span><span id="_share-tw" class="bottom-button">Twitter</span><span class="spacer"> • </span><span id="_share-mail" class="bottom-button">E-Mail</span></span></div><div class="print"><span id="_print-button" class="bottom-button">Print this page</span></div><div class="clearme"></div></div></div></div><div id="_inward"></div></div><div id="_footer-wrap"><div id="_footer"><p>©
        2018 
        SUSE</p><ul><li><a href="http://www.suse.com/company/careers/" target="_top">Careers</a></li><li><a href="http://www.suse.com/company/legal/" target="_top">Legal</a></li><li><a href="http://www.suse.com/company/" target="_top">About</a></li><li><a href="http://www.suse.com/ContactsOffices/contacts_offices.jsp" target="_top">Contact Us</a></li></ul></div></div></body></html>