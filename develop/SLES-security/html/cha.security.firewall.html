<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang=""><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Masquerading and Firewalls | Security Guide | SUSE Linux Enterprise Server 15</title><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" /><link rel="stylesheet" type="text/css" href="static/css/style.css" /><link rel="stylesheet" type="text/css" href="static/css/highlight.css" /><meta name="generator" content="DAPS 2.4.0 using SUSE XSL Stylesheets 2.0.8 (based on DocBook XSL Stylesheets 1.78.1) - chunked" /><meta name="product-name" content="SUSE Linux Enterprise Server" /><meta name="product-number" content="15" /><meta name="book-title" content="Security Guide" /><meta name="chapter-title" content="Chapter 15. Masquerading and Firewalls" /><meta name="tracker-url" content="https://bugzilla.suse.com/enter_bug.cgi" /><meta name="tracker-type" content="bsc" /><meta name="tracker-bsc-assignee" content="fs@suse.com" /><meta name="tracker-bsc-component" content="Documentation" /><meta name="tracker-bsc-product" content="Beta SUSE Linux Enterprise Server 15" /><link rel="home" href="index.html" title="SUSE Linux Enterprise Server Documentation" /><link rel="up" href="part.network_security.html" title="Part III. Network Security" /><link rel="prev" href="cha.ssh.html" title="Chapter 14. SSH: Secure Network Operations" /><link rel="next" href="cha.security.vpnserver.html" title="Chapter 16. Configuring a VPN Server" /><script type="text/javascript">

var protocol = window.location.protocol.toLowerCase();
if ( protocol != 'file:' ) {
  var agent = navigator.userAgent.toLowerCase();
  var wanted = ( protocol == 'https:') ? 'https' : 'http';
  var file = 'fonts.css';
  document.write('<link rel="stylesheet" type="text/css" href="' + wanted + '://static.opensuse.org/fonts/'+ file +'"></link>');
}
else {
   document.write('<link rel="stylesheet" type="text/css" href="static/css/fonts-onlylocal.css"></link>');
}

</script><noscript><link rel="stylesheet" type="text/css" href="http://static.opensuse.org/fonts/fonts.css" /></noscript><script src="static/js/jquery-1.10.2.min.js" type="text/javascript"></script><script src="static/js/script.js" type="text/javascript"></script><script src="static/js/highlight.min.js" type="text/javascript"></script><script>

$(document).ready(function() {
  $('.verbatim-wrap.highlight').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});
hljs.configure({
  useBR: false
});

</script></head><body class="draft offline js-off"><div id="_outer-wrap"><div id="_white-bg"><div id="_header"><div id="_logo"><img src="static/images/logo.png" alt="Logo" /></div><div class="crumbs"><a class="book-link" href="index.html" title="SUSE Linux Enterprise Server Documentation"><span class="book-icon">SUSE Linux Enterprise Server Documentation</span></a><span> › </span><a class="crumb" href="book.security.html">Security Guide</a><span> › </span><a class="crumb" href="part.network_security.html">Network Security</a><span> › </span><a class="crumb" href="cha.security.firewall.html">Masquerading and Firewalls</a></div><div class="clearme"></div></div></div><div id="_toolbar-wrap"><div id="_toolbar"><div id="_toc-area" class="inactive"><a id="_toc-area-button" class="tool" title="Contents" accesskey="c" href="index.html"><span class="tool-spacer"><span class="toc-icon">Contents</span><span class="clearme"></span></span><span class="tool-label">Contents</span></a><div class="active-contents bubble-corner"></div><div class="active-contents bubble"><div class="bubble-container"><h6>Security Guide</h6><div id="_bubble-toc"><ol><li class="inactive"><a href="preface.security.html"><span class="number"> </span><span class="name">About This Guide</span></a></li><li class="inactive"><a href="cha.security.html"><span class="number">1 </span><span class="name">Security and Confidentiality</span></a></li><li class="inactive"><a href="part.auth.html"><span class="number">I </span><span class="name">Authentication</span></a><ol><li class="inactive"><a href="cha.pam.html"><span class="number">2 </span><span class="name">Authentication with PAM</span></a></li><li class="inactive"><a href="cha.nis.html"><span class="number">3 </span><span class="name">Using NIS</span></a></li><li class="inactive"><a href="cha.security.auth.html"><span class="number">4 </span><span class="name">Setting Up Authentication Servers and Clients Using YaST</span></a></li><li class="inactive"><a href="cha.security.ldap.html"><span class="number">5 </span><span class="name">LDAP—A Directory Service</span></a></li><li class="inactive"><a href="cha.security.kerberos.html"><span class="number">6 </span><span class="name">Network Authentication with Kerberos</span></a></li><li class="inactive"><a href="cha.security.ad.html"><span class="number">7 </span><span class="name">Active Directory Support</span></a></li></ol></li><li class="inactive"><a href="part.local_security.html"><span class="number">II </span><span class="name">Local Security</span></a><ol><li class="inactive"><a href="cha.security.yast_security.html"><span class="number">8 </span><span class="name">Configuring Security Settings with YaST</span></a></li><li class="inactive"><a href="cha.security.policykit.html"><span class="number">9 </span><span class="name">Authorization with PolKit</span></a></li><li class="inactive"><a href="cha.security.acls.html"><span class="number">10 </span><span class="name">Access Control Lists in Linux</span></a></li><li class="inactive"><a href="cha.security.cryptofs.html"><span class="number">11 </span><span class="name">Encrypting Partitions and Files</span></a></li><li class="inactive"><a href="cha.certstore.html"><span class="number">12 </span><span class="name">Certificate Store</span></a></li><li class="inactive"><a href="cha.aide.html"><span class="number">13 </span><span class="name">Intrusion Detection with AIDE</span></a></li></ol></li><li class="inactive"><a href="part.network_security.html"><span class="number">III </span><span class="name">Network Security</span></a><ol><li class="inactive"><a href="cha.ssh.html"><span class="number">14 </span><span class="name">SSH: Secure Network Operations</span></a></li><li class="inactive"><a href="cha.security.firewall.html"><span class="number">15 </span><span class="name">Masquerading and Firewalls</span></a></li><li class="inactive"><a href="cha.security.vpnserver.html"><span class="number">16 </span><span class="name">Configuring a VPN Server</span></a></li><li class="inactive"><a href="cha.security.yast_ca.html"><span class="number">17 </span><span class="name">Managing X.509 Certification</span></a></li></ol></li><li class="inactive"><a href="part.apparmor.html"><span class="number">IV </span><span class="name">Confining Privileges with <span class="phrase">AppArmor</span></span></a><ol><li class="inactive"><a href="cha.apparmor.intro.html"><span class="number">18 </span><span class="name">Introducing <span class="phrase">AppArmor</span></span></a></li><li class="inactive"><a href="cha.apparmor.start.html"><span class="number">19 </span><span class="name">Getting Started</span></a></li><li class="inactive"><a href="cha.apparmor.concept.html"><span class="number">20 </span><span class="name">Immunizing Programs</span></a></li><li class="inactive"><a href="cha.apparmor.profiles.html"><span class="number">21 </span><span class="name">Profile Components and Syntax</span></a></li><li class="inactive"><a href="cha.apparmor.repos.html"><span class="number">22 </span><span class="name"><span class="phrase">AppArmor</span> Profile Repositories</span></a></li><li class="inactive"><a href="cha.apparmor.yast.html"><span class="number">23 </span><span class="name">Building and Managing Profiles with YaST</span></a></li><li class="inactive"><a href="cha.apparmor.commandline.html"><span class="number">24 </span><span class="name">Building Profiles from the Command Line</span></a></li><li class="inactive"><a href="cha.apparmor.hat.html"><span class="number">25 </span><span class="name">Profiling Your Web Applications Using ChangeHat</span></a></li><li class="inactive"><a href="cha.apparmor.pam.html"><span class="number">26 </span><span class="name">Confining Users with <code class="systemitem">pam_apparmor</code></span></a></li><li class="inactive"><a href="cha.apparmor.managing.html"><span class="number">27 </span><span class="name">Managing Profiled Applications</span></a></li><li class="inactive"><a href="cha.apparmor.support.html"><span class="number">28 </span><span class="name">Support</span></a></li><li class="inactive"><a href="cha.apparmor.glossary.html"><span class="number">29 </span><span class="name"><span class="phrase">AppArmor</span> Glossary</span></a></li></ol></li><li class="inactive"><a href="bk06pt05.html"><span class="number">V </span><span class="name">SELinux</span></a><ol><li class="inactive"><a href="cha.selinux.html"><span class="number">30 </span><span class="name">Configuring SELinux</span></a></li></ol></li><li class="inactive"><a href="part.audit.html"><span class="number">VI </span><span class="name"><em class="citetitle ">The Linux Audit Framework</em></span></a><ol><li class="inactive"><a href="cha.audit.comp.html"><span class="number">31 </span><span class="name">Understanding Linux Audit</span></a></li><li class="inactive"><a href="cha.audit.setup.html"><span class="number">32 </span><span class="name">Setting Up the Linux Audit Framework</span></a></li><li class="inactive"><a href="cha.audit.scenarios.html"><span class="number">33 </span><span class="name">Introducing an Audit Rule Set</span></a></li><li class="inactive"><a href="cha.audit.moreinfo.html"><span class="number">34 </span><span class="name">Useful Resources</span></a></li></ol></li><li class="inactive"><a href="app.pcidss.html"><span class="number">A </span><span class="name">Achieving PCI-DSS Compliance</span></a></li><li class="inactive"><a href="bk06apb.html"><span class="number">B </span><span class="name">GNU Licenses</span></a></li></ol></div><div class="clearme"></div></div></div></div><div id="_nav-area" class="inactive"><div class="tool"><span class="nav-inner"><span class="tool-label">Navigation</span><a accesskey="p" class="tool-spacer" title="Chapter 14. SSH: Secure Network Operations" href="cha.ssh.html"><span class="prev-icon">←</span></a><a accesskey="n" class="tool-spacer" title="Chapter 16. Configuring a VPN Server" href="cha.security.vpnserver.html"><span class="next-icon">→</span></a></span></div></div></div></div><div id="_fixed-header-wrap" class="inactive"><div id="_fixed-header"><div class="crumbs"><a class="book-link" href="index.html" title="SUSE Linux Enterprise Server Documentation"><span class="book-icon">SUSE Linux Enterprise Server Documentation</span></a><span> › </span><a class="crumb" href="book.security.html">Security Guide</a><span> › </span><a class="crumb" href="part.network_security.html">Network Security</a><span> › </span><a class="crumb" href="cha.security.firewall.html">Masquerading and Firewalls</a></div><div class="buttons"><a class="top-button button" href="#">Top</a><div class="button"><a accesskey="p" class="tool-spacer" title="Chapter 14. SSH: Secure Network Operations" href="cha.ssh.html"><span class="prev-icon">←</span></a><a accesskey="n" class="tool-spacer" title="Chapter 16. Configuring a VPN Server" href="cha.security.vpnserver.html"><span class="next-icon">→</span></a></div><div class="clearme"></div></div><div class="clearme"></div></div></div><div id="_content" class="draft "><div class="documentation"><div class="chapter " id="cha.security.firewall"><div class="titlepage"><div><div class="version-info">Applies to  <span class="productname"><span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span></span> <span class="productnumber"><span class="productnumber"><span class="phrase">15</span></span></span></div><div><h2 class="title"><span class="number">15 </span><span class="name">Masquerading and Firewalls</span> </h2><div class="doc-status"><ul><li><span class="ds-label">Filename: </span>security_firewall.xml</li><li><span class="ds-label">ID: </span>cha.security.firewall</li></ul></div></div></div></div><div class="line"><div class="toc"><dl><dt><span class="sect1"><a href="cha.security.firewall.html#sec.security.firewall.iptables"><span class="number">15.1 </span><span class="name">Packet Filtering with iptables</span></a></span></dt><dt><span class="sect1"><a href="cha.security.firewall.html#sec.security.firewall.masq"><span class="number">15.2 </span><span class="name">Masquerading Basics</span></a></span></dt><dt><span class="sect1"><a href="cha.security.firewall.html#sec.security.firewall.fw"><span class="number">15.3 </span><span class="name">Firewalling Basics</span></a></span></dt><dt><span class="sect1"><a href="cha.security.firewall.html#sec.security.firewall.firewalld"><span class="number">15.4 </span><span class="name"><code class="systemitem">firewalld</code></span></a></span></dt><dt><span class="sect1"><a href="cha.security.firewall.html#sec.security.firewall.info"><span class="number">15.5 </span><span class="name">For More Information</span></a></span></dt></dl></div></div><p>
  Whenever Linux is used in a network environment, you can use the
  kernel functions that allow the manipulation of network packets to
  maintain a separation between internal and external network areas. The
  Linux <code class="systemitem">netfilter</code> framework provides the means
  to establish an effective firewall that keeps different networks
  apart. Using iptables—a generic table structure for the
  definition of rule sets—precisely controls the packets allowed to
  pass a network interface. Such a packet filter can be set up using
  <code class="systemitem">firewalld</code> and its graphical interface <code class="command">firewall-config</code>.
 </p><div class="sect1 " id="sec.security.firewall.iptables"><div class="titlepage"><div><div><h2 class="title" id="sec.security.firewall.iptables"><span class="number">15.1 </span><span class="name">Packet Filtering with iptables</span> <a title="Permalink" class="permalink" href="cha.security.firewall.html#sec.security.firewall.iptables">#</a></h2></div></div></div><p>
   This section discusses the low-level details of packet filtering. The
   components <code class="systemitem">netfilter</code> and
   <code class="systemitem">iptables</code> are responsible for the filtering and
   manipulation of network packets and for network address translation (NAT).
   The filtering criteria and any actions associated with them are stored in
   chains, which must be matched one after another by individual network
   packets as they arrive. The chains to match are stored in tables. The
   <code class="command">iptables</code> command allows you to alter these tables and
   rule sets.
  </p><p>
   The Linux kernel maintains three tables, each for a particular category
   of functions of the packet filter:
  </p><div class="variablelist "><dl class="variablelist"><dt id="idm140396035844912"><span class="term ">filter</span></dt><dd><p>
      This table holds the bulk of the filter rules, because it implements
      the <span class="emphasis"><em>packet filtering</em></span> mechanism in the stricter
      sense, which determines whether packets are let through
      (<code class="literal">ACCEPT</code>) or discarded (<code class="literal">DROP</code>),
      for example.
     </p></dd><dt id="idm140396035841616"><span class="term ">nat</span></dt><dd><p>
      This table defines any changes to the source and target addresses of
      packets. Using these functions also allows you to implement
      <span class="emphasis"><em>masquerading</em></span>, which is a special case of NAT used
      to link a private network with the Internet.
     </p></dd><dt id="idm140396035839168"><span class="term ">mangle</span></dt><dd><p>
      The rules held in this table make it possible to manipulate values
      stored in IP headers (such as the type of service).
     </p></dd></dl></div><p>
   These tables contain several predefined chains to match packets:
  </p><div class="variablelist "><dl class="variablelist"><dt id="idm140396035836304"><span class="term ">PREROUTING</span></dt><dd><p>
      This chain is applied to all incoming packets.
     </p></dd><dt id="idm140396035834464"><span class="term ">INPUT</span></dt><dd><p>
      This chain is applied to packets destined for the system's internal
      processes.
     </p></dd><dt id="idm140396035832592"><span class="term ">FORWARD</span></dt><dd><p>
      This chain is applied to packets that are only routed through the
      system.
     </p></dd><dt id="idm140396035830720"><span class="term ">OUTPUT</span></dt><dd><p>
      This chain is applied to packets originating from the system itself.
     </p></dd><dt id="idm140396035828864"><span class="term ">POSTROUTING</span></dt><dd><p>
      This chain is applied to all outgoing packets.
     </p></dd></dl></div><p>
   <a class="xref" href="cha.security.firewall.html#fig.fire.table" title="iptables: A Packet's Possible Paths">Figure 15.1, “iptables: A Packet's Possible Paths”</a> illustrates the paths along which a
   network packet may travel on a given system. For the sake of simplicity,
   the figure lists tables as parts of chains, but in reality these chains
   are held within the tables themselves.
  </p><p>
   In the simplest case, an incoming packet destined for the system itself
   arrives at the <code class="literal">eth0</code> interface. The packet is first
   referred to the <code class="literal">PREROUTING</code> chain of the
   <code class="literal">mangle</code> table then to the <code class="literal">PREROUTING</code>
   chain of the <code class="literal">nat</code> table. The following step, concerning
   the routing of the packet, determines that the actual target of the
   packet is a process of the system itself. After passing the
   <code class="literal">INPUT</code> chains of the <code class="literal">mangle</code> and the
   <code class="literal">filter</code> table, the packet finally reaches its target,
   provided that the rules of the <code class="literal">filter</code> table allow this.
  </p><div class="figure" id="fig.fire.table"><div class="figure-contents"><div class="mediaobject"><a xmlns="" href="images/fire_tables.png"><img src="images/fire_tables.png" width="" alt="iptables: A Packet's Possible Paths" /></a></div></div><div class="figure-title-wrap"><h6 class="figure-title"><span class="number">Figure 15.1: </span><span class="name">iptables: A Packet's Possible Paths </span><a title="Permalink" class="permalink" href="cha.security.firewall.html#fig.fire.table">#</a></h6></div></div></div><div class="sect1 " id="sec.security.firewall.masq"><div class="titlepage"><div><div><h2 class="title" id="sec.security.firewall.masq"><span class="number">15.2 </span><span class="name">Masquerading Basics</span> <a title="Permalink" class="permalink" href="cha.security.firewall.html#sec.security.firewall.masq">#</a></h2></div></div></div><p>
   Masquerading is the Linux-specific form of NAT (network address
   translation) and can be used to connect a small LAN with the
   Internet.  LAN hosts use IP
   addresses from the private range (see
   <span class="intraxref">Book “<em class="citetitle ">Administration Guide</em>”, Chapter 17 “Basic Networking”, Section 17.1.2 “Netmasks and Routing”</span>) and on the Internet
   official IP addresses are used. To be able to connect
   to the Internet, a LAN host's private address is translated to an official
   one. This is done on the router, which acts as the gateway between the
   LAN and the Internet. The underlying principle is a simple one: The
   router has more than one network interface, typically a network card and
   a separate interface connecting with the Internet. While the latter links
   the router with the outside world, one or several others link it with the
   LAN hosts. With these hosts in the local network connected to the network
   card (such as <code class="literal">eth0</code>) of the router, they can send any
   packets not destined for the local network to their default gateway or
   router.
  </p><div id="idm140396035811696" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.png" /><h6>Important: Using the Correct Network Mask</h6><p>
    When configuring your network, make sure both the broadcast address and
    the netmask are the same for all local hosts. Failing to do so prevents
    packets from being routed properly.
   </p></div><p>
   As mentioned, whenever one of the LAN hosts sends a packet destined for
   an Internet address, it goes to the default router. However, the router
   must be configured before it can forward such packets. For security
   reasons, this is not enabled in a default installation. To enable it, add
   the line <code class="literal">net.ipv4.ip_forward = 1</code> in the file
   <code class="filename">/etc/sysctl.conf</code>. Alternatively do this via YaST,
   for example by calling <code class="command">yast routing ip-forwarding on</code>.
  </p><p>
   The target host of the connection can see your router, but knows nothing
   about the host in your internal network where the packets originated.
   This is why the technique is called masquerading. Because of the address
   translation, the router is the first destination of any reply packets.
   The router must identify these incoming packets and translate their
   target addresses, so packets can be forwarded to the correct host in the
   local network.
  </p><p>
   With the routing of inbound traffic depending on the masquerading table,
   there is no way to open a connection to an internal host from the
   outside. For such a connection, there would be no entry in the table. In
   addition, any connection already established has a status entry assigned
   to it in the table, so the entry cannot be used by another connection.
  </p><p>
   As a consequence of all this, you might experience some problems with
   several application protocols, such as ICQ, cucme, IRC (DCC, CTCP), and
   FTP (in PORT mode). Web browsers, the standard FTP program, and many
   other programs use the PASV mode. This passive mode is much less
   problematic as far as packet filtering and masquerading are concerned.
  </p></div><div class="sect1 " id="sec.security.firewall.fw"><div class="titlepage"><div><div><h2 class="title" id="sec.security.firewall.fw"><span class="number">15.3 </span><span class="name">Firewalling Basics</span> <a title="Permalink" class="permalink" href="cha.security.firewall.html#sec.security.firewall.fw">#</a></h2></div></div></div><p>
   <span class="emphasis"><em>Firewall</em></span> is probably the term most widely used to
   describe a mechanism that controls the data flow between networks.
   Strictly speaking, the mechanism described in this section is called a
   <span class="emphasis"><em>packet filter</em></span>. A packet filter regulates the data flow
   according to certain criteria, such as protocols, ports, and IP addresses.
   This allows you to block packets that, according to their addresses, are
   not supposed to reach your network. To allow public access to your Web
   server, for example, explicitly open the corresponding port. However, a
   packet filter does not scan the contents of packets with legitimate
   addresses, such as those directed to your Web server. For example, if
   incoming packets were intended to compromise a CGI program on your Web
   server, the packet filter would still let them through.
  </p><p>
   A more effective but more complex mechanism is the combination of several
   types of systems, such as a packet filter interacting with an application
   gateway or proxy. In this case, the packet filter rejects any packets
   destined for disabled ports. Only packets directed to the application
   gateway are accepted. This gateway or proxy pretends to be the actual
   client of the server. In a sense, such a proxy could be considered a
   masquerading host on the protocol level used by the application. One
   example for such a proxy is Squid, an HTTP and FTP proxy server. To use
   Squid, the browser must be configured to communicate via the proxy. Any
   HTTP pages or FTP files requested are served from the proxy cache and
   objects not found in the cache are fetched from the Internet by the
   proxy.
  </p><p>
   The following section focuses on the packet filter that comes with
   <span class="productname"><span class="phrase">SUSE Linux Enterprise Server</span></span>. For further information about packet filtering and
   firewalling, read the <a class="link" href="http://www.tldp.org/HOWTO/Firewall-HOWTO.html" target="_blank">Firewall
   HOWTO</a>.
  </p></div><div class="sect1 " id="sec.security.firewall.firewalld"><div class="titlepage"><div><div><h2 class="title" id="sec.security.firewall.firewalld"><span class="number">15.4 </span><span class="name"><code class="systemitem">firewalld</code></span> <a title="Permalink" class="permalink" href="cha.security.firewall.html#sec.security.firewall.firewalld">#</a></h2></div></div></div><p>
   <code class="systemitem">firewalld</code> is a daemon that maintains the system's
   <code class="command">iptables</code> rules and offers a D-Bus interface for
   operating on them. It comes with a command line utility
   <code class="command">firewall-cmd</code> and a graphical user interface
   <code class="command">firewall-config</code> for interacting with it. Since
   <code class="systemitem">firewalld</code> is running in the background and provides a well defined
   interface it allows other applications to request changes to the iptables
   rules, for example to setup virtual machine networking.
  </p><p>
   <code class="systemitem">firewalld</code> implements different security zones. A number of predefined
   zones like <code class="literal">internal</code> or <code class="literal">public</code> exist.
   The administrator can define additional custom zones if desired. Each
   zone contains its own set of iptables rules. Each network interface is
   member of exactly one zone. Individual connections can also be assigned to
   a zone based on the source addresses.
  </p><p>
   Each zone represents a certain level of trust. For example the
   <code class="literal">public</code> zone is not trusted, because other computers in
   this network are not under your control (suitable for Internet or wireless
   hotspot connections). On the other hand the <code class="literal">internal</code>
   zone is used for networks that are under your control like a home or
   company network. By utilizing zones this way a host can offer different
   kinds of services to trusted networks and untrusted networks in a defined
   way.
  </p><p>
   For more information about the predefined zones and their meaning in
   <code class="systemitem">firewalld</code> refer to its manual at
   <a class="link" href="http://www.firewalld.org/documentation/zone/predefined-zones.html" target="_blank">http://www.firewalld.org/documentation/zone/predefined-zones.html</a>.
  </p><div id="idm140396035786976" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.png" /><h6>Note: No Zone Assigned Behavior</h6><p>
     The initial state for network interfaces is to be assigned to no zone at
     all. In this case the network interface will be implicitly handled in the
     default zone which can be determined by calling <code class="command">firewall-cmd
      --get-default-zone</code>. If not configured otherwise, the default
     zone is the <code class="literal">public</code> zone.
    </p></div><p>
   The <code class="systemitem">firewalld</code> packet filtering model allows any outgoing connections to
   pass. Outgoing connections are connections that are actively established by
   the local host. Incoming connections that are established by remote hosts are
   blocked, if the respective service is not allowed in the zone in
   question. Therefore, each of the interfaces with incoming traffic must be
   placed into a suitable zone to allow for the desired services to be
   accessible. For each of the zones, define the services or protocols you
   need.
  </p><p>
   An important concept of <code class="systemitem">firewalld</code> is the distinction between two separate
   configurations, the <span class="emphasis"><em>runtime</em></span> and the
   <span class="emphasis"><em>permanent</em></span> configuration. The runtime configuration
   represents the currently active rules, while the permanent configuration
   represents the saved rules that will be applied when restarting
   <code class="systemitem">firewalld</code>. This allows to add temporary rules that will be discarded after
   restart of <code class="systemitem">firewalld</code>, or to experiment with new rules while being able to
   revert back to the original state. When you are changing the configuration
   you need to be aware of which configuration you're editing. How this is
   done is discussed in <a class="xref" href="cha.security.firewall.html#sec.security.firewall.firewalld.configurations" title="15.4.1.2. Runtime versus Permanent Configuration">Section 15.4.1.2, “Runtime versus Permanent Configuration”</a>.
  </p><p>
   If you want to perform the <code class="systemitem">firewalld</code> configuration using the graphical user
   interface <code class="command">firewall-config</code> then refer to its documentation
   in
   <a class="link" href="http://www.firewalld.org/documentation/utilities/firewall-config.html" target="_blank">http://www.firewalld.org/documentation/utilities/firewall-config.html</a>.
    In the following section we will be looking at how to perform typical
    <code class="systemitem">firewalld</code> configuration tasks using <code class="command">firewall-cmd</code> on the
    command line.
  </p><div class="sect2 " id="sec.security.firewall.firewalld.cmd"><div class="titlepage"><div><div><h3 class="title" id="sec.security.firewall.firewalld.cmd"><span class="number">15.4.1 </span><span class="name">Configuring the Firewall on the Command Line</span> <a title="Permalink" class="permalink" href="cha.security.firewall.html#sec.security.firewall.firewalld.cmd">#</a></h3></div></div></div><div class="sect3 " id="idm140396035773328"><div class="titlepage"><div><div><h4 class="title" id="idm140396035773328"><span class="number">15.4.1.1 </span><span class="name">Firewall Startup</span> <a title="Permalink" class="permalink" href="cha.security.firewall.html#idm140396035773328">#</a></h4></div></div></div><p>
     <code class="systemitem">firewalld</code> will be installed and enabled by default. It is a regular
     <code class="systemitem">systemd</code> service that can be configured via <code class="command">systemctl</code>
     or the YaST Services Manager.
    </p><div id="idm140396035770208" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.png" /><h6>Important: Automatic Firewall Configuration</h6><p> After the installation, YaST automatically starts
      <code class="systemitem">firewalld</code> and leaves all interfaces in the default
      <code class="literal">public</code> zone. If a server application is configured
      and activated on the system, YaST can adjust the firewall
      rules via the options <span class="guimenu">Open Ports on Selected Interface in
      Firewall</span> or <span class="guimenu">Open Ports on Firewall</span>
      in the server configuration modules. Some server module dialogs include a
      <span class="guimenu">Firewall Details</span> button for activating additional
      services and ports.
     </p></div></div><div class="sect3 " id="sec.security.firewall.firewalld.configurations"><div class="titlepage"><div><div><h4 class="title" id="sec.security.firewall.firewalld.configurations"><span class="number">15.4.1.2 </span><span class="name">Runtime versus Permanent Configuration</span> <a title="Permalink" class="permalink" href="cha.security.firewall.html#sec.security.firewall.firewalld.configurations">#</a></h4></div></div></div><p>
     By default all <code class="command">firewall-cmd</code> commands operate on the
     runtime configuration. You can apply most operations to the permanent
     configuration <span class="emphasis"><em>only</em></span> by adding the
     <code class="literal">--permanent</code> parameter. When doing so the change will
     only affect the permanent configuration but will not be effective
     immediatly in the runtime configuration. There is currently no way to add a
     rule to both runtime and permanent configuration in a single invocation.
     To achieve this you can apply all necessary changes to the runtime
     configuration and when all is working as expected issue the following
     command:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root">root # </code><code class="command">firewall-cmd --runtime-to-permanent</code></pre></div><p>
     This will write all current runtime rules into the permanent configuration.
     Any temporary modifications you or other programs may have made to the
     firewall in other contexts are made permanent this way. If you're unsure
     about this you can also take the opposite approach to be on the safe side:
     Add new rules to the permanent configuration and reload <code class="systemitem">firewalld</code> to
     make them active.
    </p><div id="idm140396035759504" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.png" /><h6>Note</h6><p>
      Some configuration items like the default zone are shared by both the
      runtime and permanent configuration. Changing them will reflect in both
      configurations at once.
     </p></div><p>
     To revert the runtime configuration to the permanent configuration and
     thereby discard any temporary changes there exist two
     possibilities, either via the <code class="systemitem">firewalld</code> command line interface or via
     <code class="systemitem">systemd</code>:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root">root # </code><code class="command">firewall-cmd --reload</code></pre></div><div class="verbatim-wrap"><pre class="screen"><code class="prompt root">root # </code><code class="command">systemctl reload firewalld</code></pre></div><p>
     For brevity the examples in the following sections will always operate on
     the runtime configuration, if applicable. Adjust them accordingly if you
     want to make them permanent.
    </p></div><div class="sect3 " id="idm140396035753296"><div class="titlepage"><div><div><h4 class="title" id="idm140396035753296"><span class="number">15.4.1.3 </span><span class="name">Assignment of Interfaces to Zones</span> <a title="Permalink" class="permalink" href="cha.security.firewall.html#idm140396035753296">#</a></h4></div></div></div><p>
     You can list all network interfaces currently assigned to a zone like this:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root">root # </code><code class="command">firewall-cmd --zone=public --list-interfaces</code>
eth0</pre></div><p>
     Similarly you can query which zone a specific interface is assigned to:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root">root # </code><code class="command">firewall-cmd --get-zone-of-interface=eth0</code>
public</pre></div><p>
     The following command lines assign an interface to a zone. The variant
     using <code class="literal">--add-interface</code> will only work if
     <code class="literal">eth0</code> is not already assigned to another zone. The
     variant using <code class="literal">--change-interface</code> will always work,
     removing <code class="literal">eth0</code> from its current zone if necessary:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root">root # </code><code class="command">firewall-cmd --zone=internal --add-interface=eth0</code>
<code class="prompt root">root # </code><code class="command">firewall-cmd --zone=internal --change-interface=eth0</code></pre></div><p>
      Any operations without an explicit <code class="literal">--zone</code> argument will
      impliticly operate on the default zone. This pair of commands can be used
      for getting and setting the default zone assignment:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root">root # </code><code class="command">firewall-cmd --get-default-zone</code>
dmz
<code class="prompt root">root # </code><code class="command">firewall-cmd --set-default-zone=public</code></pre></div><div id="idm140396035741040" class="admonition important normal"><img class="symbol" alt="Important" title="Important" src="static/images/icon-important.png" /><h6>Important</h6><p>
      Any network interfaces not explicitly assigned to a zone will be
      automatically part of the default zone. Changing the default zone will
      reassign all those network interfaces immediately for the permanent and
      runtime configurations. You should never use a trusted zone like
      <code class="literal">internal</code> as the default zone to avoid unexpected
      exposure to threats. For example hotplugged network interfaces like USB
      ethernet interfaces would automatically become part of the trusted zone in
      such cases.
     </p><p>
      Also note that interfaces that are not explicitly part of any zone will
      not appear in the zone interface list. There is currently no command to
      list unassigned interfaces. Due to this it is best to avoid unassigned
      network interfaces during regular operation.
     </p></div></div><div class="sect3 " id="sec.security.firewall.firewalld.cmd.ports"><div class="titlepage"><div><div><h4 class="title" id="sec.security.firewall.firewalld.cmd.ports"><span class="number">15.4.1.4 </span><span class="name">Making Network Services Accessible</span> <a title="Permalink" class="permalink" href="cha.security.firewall.html#sec.security.firewall.firewalld.cmd.ports">#</a></h4></div></div></div><p>
     <code class="systemitem">firewalld</code> has a concept of <span class="emphasis"><em>services</em></span>. A service
     consists of definitions of ports and protocols. These definitions
     logically belong together in the context of a given network service like
     a web or mail server protocol. The following commands can be used to get
     information about predefined services and their details:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root">root # </code><code class="command">firewall-cmd --get-services</code>
[...] dhcp dhcpv6 dhcpv6-client dns docker-registry [...]
<code class="prompt root">root # </code><code class="command">firewall-cmd --info-service dhcp</code>
dhcp
  ports: 67/udp
  protocols:
  source-ports:
  modules:
  destination:</pre></div><p>
     These service definitions can be used for easily making the associated
     network functionality accessible in a zone. This command line will open the
     http web server port in the internal zone, for example:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root">root # </code><code class="command">firewall-cmd --add-service=http --zone=internal</code></pre></div><p>
     The removal of a service from a zone is performed using the counterpart
     command <code class="literal">--remove-service</code>. You can also define custom
     services using the <code class="literal">--new-service</code> sub-command. Refer to
     <a class="link" href="http://www.firewalld.org/documentation/howto/add-a-service.html" target="_blank">http://www.firewalld.org/documentation/howto/add-a-service.html</a>
     for more details on how to do this.
    </p><p>
     If you just want to open a single port by number you can use the following
     approach. This will open TCP port 8000 in the internal zone:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root">root # </code><code class="command">firewall-cmd --add-port=8000/tcp --zone=internal</code></pre></div><p>
     For removal use the counterpart command <code class="literal">--remove-port</code>.
    </p><div id="idm140396035726112" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.png" /><h6>Tip: Temporarily Opening a Service or Port</h6><p>
      <code class="systemitem">firewalld</code> supports a <code class="literal">--timeout</code> parameter that allows
      to open a service or port for a limited time duration. This can be helpful
      for quick testing and makes sure that closing the service or port will not
      be forgotten. To allow the <code class="literal">imap</code> service in the
      <code class="literal">internal</code> zone for 5 minutes, you would call
     </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root">root # </code><code class="command">firewall-cmd --add-service=imap --zone=internal --timeout=5m</code></pre></div></div></div><div class="sect3 " id="idm140396035721104"><div class="titlepage"><div><div><h4 class="title" id="idm140396035721104"><span class="number">15.4.1.5 </span><span class="name">Lockdown Mode</span> <a title="Permalink" class="permalink" href="cha.security.firewall.html#idm140396035721104">#</a></h4></div></div></div><p>
     <code class="systemitem">firewalld</code> offers a <span class="emphasis"><em>lockdown mode</em></span> that prevents
     changes to the firewall rules while being active. Since applications can
     automatically change the firewall rules via the D-Bus interface and
     depending on the PolicyKit rules regular users may be able to do the same
     it can be helpful to prevent changes in some situations. You can find more
     information about this in
     <a class="link" href="https://fedoraproject.org/wiki/Features/FirewalldLockdown" target="_blank">https://fedoraproject.org/wiki/Features/FirewalldLockdown</a>.
    </p><p>
     It is important to understand that the lockdown mode feature
     provides no real security but merely protection against accidental or
     benign attempts to change the firewall. The way the lockdown mode is
     currently implemented in <code class="systemitem">firewalld</code> provides no security against malicious
     intent as is pointed out in
     <a class="link" href="http://seclists.org/oss-sec/2017/q3/139" target="_blank">http://seclists.org/oss-sec/2017/q3/139</a>.
    </p></div><div class="sect3 " id="idm140396035715600"><div class="titlepage"><div><div><h4 class="title" id="idm140396035715600"><span class="number">15.4.1.6 </span><span class="name">Adding Custom <code class="command">iptables</code> Rules</span> <a title="Permalink" class="permalink" href="cha.security.firewall.html#idm140396035715600">#</a></h4></div></div></div><p>
     <code class="systemitem">firewalld</code> claims exclusive control over the host's
     <code class="systemitem">netfilter</code> rules. You should never modify
     firewall rules using other tools like <code class="command">iptables</code>. Doing
     so could confuse <code class="systemitem">firewalld</code> and break security or functionality.
    </p><p>
     If you need to add custom firewall rules that aren't covered by
     <code class="systemitem">firewalld</code> features then there are two ways to do so. To directly pass
     raw <code class="command">iptables</code> syntax you can use the
     <code class="literal">--direct</code> option. It expects the table, chain and
     priority as initial arguments and the rest of the command line is passed
     as is to <code class="command">iptables</code>. The following example adds a
     connection tracking rule for the forwarding filter table:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root">root # </code><code class="command">firewall-cmd  --direct --add-rule ipv4 filter FORWARD 0 -i eth0 -o eth1 \
    -p tcp --dport 80 -m state --state NEW,RELATED,ESTABLISHED -j ACCEPT</code></pre></div><p>
     Additionally, <code class="systemitem">firewalld</code> implements so called <span class="emphasis"><em>rich
     rules</em></span>, an extended syntax for specifying
     <code class="command">iptables</code> rules in an easier way. You can find the
     syntax specification in
     <a class="link" href="http://www.firewalld.org/documentation/man-pages/firewalld.richlanguage.html" target="_blank">http://www.firewalld.org/documentation/man-pages/firewalld.richlanguage.html</a>.
     the following example drops all IPv4 packets originating from a certain
     source address:
    </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root">root # </code><code class="command">firewall-cmd --zone=public --add-rich-rule='rule family="ipv4" \
    source address="192.168.2.4" drop'</code></pre></div></div><div class="sect3 " id="idm140396035703136"><div class="titlepage"><div><div><h4 class="title" id="idm140396035703136"><span class="number">15.4.1.7 </span><span class="name">Routing, Forwarding and Masquerading</span> <a title="Permalink" class="permalink" href="cha.security.firewall.html#idm140396035703136">#</a></h4></div></div></div><p>
     <code class="systemitem">firewalld</code> is not designed to run as a fully fledged router. The
     basic functionality for typical home router setups is available. For a
     corporate production router you should not use <code class="systemitem">firewalld</code>, however, but
     use dedicated router and firewall devices instead. The following provides
     just a few pointers what to look for to utilize routing in <code class="systemitem">firewalld</code>:
    </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem "><p>
       First of all IP forwarding needs to be enabled as outlined in
       <a class="xref" href="cha.security.firewall.html#sec.security.firewall.masq" title="15.2. Masquerading Basics">Section 15.2, “Masquerading Basics”</a>.
      </p></li><li class="listitem "><p>
       To enable IPv4 masquerading, for example in the
       <code class="literal">internal</code> zone, issue the following command
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root">root # </code><code class="command">firewall-cmd --zone=internal --add-masquerade</code></pre></div></li><li class="listitem "><p>
       <code class="systemitem">firewalld</code> can also enable port forwarding. The following command will
       forward local TCP connections on port 80 to another host:
      </p><div class="verbatim-wrap"><pre class="screen"><code class="prompt root">root # </code><code class="command">firewall-cmd --zone=public \
    --add-forward-port=port=80:proto=tcp:toport=80:toaddr=192.168.1.10</code></pre></div></li></ul></div></div></div><div class="sect2 " id="sec.security.firewall.firewalld.rpcports"><div class="titlepage"><div><div><h3 class="title" id="sec.security.firewall.firewalld.rpcports"><span class="number">15.4.2 </span><span class="name">Accessing Services Listening on Dynamic Ports</span> <a title="Permalink" class="permalink" href="cha.security.firewall.html#sec.security.firewall.firewalld.rpcports">#</a></h3></div></div></div><p>
    Some network services do not listen on predefined port numbers. Instead
    they operate based on the <code class="literal">portmapper</code> or
    <code class="literal">rpcbind</code> protocol. We will use the term
    <code class="literal">rpcbind</code> from here on. When one of these services
    starts, it chooses a random local port and talks to
    <code class="literal">rpcbind</code> to make the port number known.
    <code class="literal">rpcbind</code> itself is listening on a well known port.
    Remote systems can then query <code class="literal">rpcbind</code> about the network
    services it knows about and on which ports they are listening. Not many
    programs use this approach any more today. Popular examples are
    Network Information Services (NIS; <code class="command">ypserv</code> and
    <code class="command">ypbind</code>) and the Network File System (NFS) version 3.
   </p><div id="idm140396035685296" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.png" /><h6>Note: About NFSv4</h6><p>
     The newer NFSv4 only requires the single well known
     TCP port 2049 any more. For protocol version 4.0 the kernel parameter
     <code class="literal">fs.nfs.nfs_callback_tcpport</code> may need to be set
     to a static port (see <a class="xref" href="cha.security.firewall.html#ex.security.firewall.nfscallback" title="callback port configuration for the nfs kernel module in /etc/modprobe.d/60-nfs.conf">Example 15.1, “callback port configuration for the <code class="literal">nfs</code> kernel module in <code class="filename">/etc/modprobe.d/60-nfs.conf</code>”</a>).
     Starting with protocol version 4.1 this setting has also become
     unnecessary.
    </p></div><p>
    The dynamic nature of the <code class="literal">rpcbind</code> protocol makes
    it difficult to make the affected services behind the firewall accessible.
    <code class="systemitem">firewalld</code> does not support these services by itself. In the following
    section an approach to handle this case is discussed.
   </p><div class="sect3 " id="sec.security.firewall.firewalld.rpcports.static"><div class="titlepage"><div><div><h4 class="title" id="sec.security.firewall.firewalld.rpcports.static"><span class="number">15.4.2.1 </span><span class="name">Configuring Static Ports</span> <a title="Permalink" class="permalink" href="cha.security.firewall.html#sec.security.firewall.firewalld.rpcports.static">#</a></h4></div></div></div><p>
     One possibility is to configure all involved network services to use
     fixed port numbers. Once this is done, the fixed ports can be opened in
     <code class="systemitem">firewalld</code> and everything should work. The actual port numbers used are
     at your discretion but should not clash with any well known port numbers
     assigned to other services. See <a class="xref" href="cha.security.firewall.html#tab.security.firewall.sysconfigports" title="Important Sysconfig Variables for Static Port Configuration">Table 15.1, “Important Sysconfig Variables for Static Port Configuration”</a>
     for a list of the available configuration items for NIS and NFSv3
     services. Note that depending on your actual NIS or NFS configuration
     not all of these ports may be required for your setup.
    </p><div class="table" id="tab.security.firewall.sysconfigports"><div class="table-title-wrap"><h6 class="table-title"><span class="number">Table 15.1: </span><span class="name">Important Sysconfig Variables for Static Port Configuration </span><a title="Permalink" class="permalink" href="cha.security.firewall.html#tab.security.firewall.sysconfigports">#</a></h6></div><div class="table-contents"><table summary="Important Sysconfig Variables for Static Port Configuration" border="1"><colgroup><col class="1" /><col class="2" /><col class="3" /></colgroup><thead><tr><th>
         <p>
          File Path
         </p>
        </th><th>
         <p>
          Variable Name
         </p>
        </th><th>
         <p>
          Example Value
         </p>
        </th></tr></thead><tbody><tr><td rowspan="5">
         <code class="filename">
          /etc/sysconfig/nfs
         </code>
        </td><td>
         MOUNTD_PORT
        </td><td>
         21001
        </td></tr><tr><td>
         STATD_PORT
        </td><td>
         21002
        </td></tr><tr><td>
         LOCKD_TCPPORT
        </td><td>
         21003
        </td></tr><tr><td>
         LOCKD_UDPPORT
        </td><td>
         21003
        </td></tr><tr><td>
         RQUOTAD_PORT
        </td><td>
         21004
        </td></tr><tr><td>
         <code class="filename">
          /etc/sysconfig/ypbind
         </code>
        </td><td>
         YPBIND_OPTIONS
        </td><td>
         -p 24500
        </td></tr><tr><td rowspan="3">
         <code class="filename">
          /etc/sysconfig/ypserv
         </code>
        </td><td>
         YPXFRD_ARGS
        </td><td>
         -p 24501
        </td></tr><tr><td>
         YPSERV_ARGS
        </td><td>
         -p 24502
        </td></tr><tr><td>
         YPPASSWDD_ARGS
        </td><td>
         --port 24503
        </td></tr></tbody></table></div></div><p>
     You will need to restart any related services that are affected by these
     static port configurations for the changes to take effect. You can see
     the currently assigned rpcbind ports by using the command
     <code class="command">rpcinfo -p</code>. On success only the statically configured
     ports should show up there any more.
    </p><p>
     Apart from the port configuration for network services running in
     userspace there are also ports that are used by the Linux kernel directly
     when it comes to NFS. One of these ports is the
     <code class="literal">nfs_callback_tcpport</code>. It is only required for the NFS
     protocol older than version 4.1. There is a sysctl named
     <code class="literal">fs.nfs.nfs_callback_tcpport</code> to configure this port.
     This sysctl node only appears dynamically when NFS mounts are active.
     Therefore it is best to configure the port via kernel module
     parameters. This can be achieved by creating a file like shown in
     <a class="xref" href="cha.security.firewall.html#ex.security.firewall.nfscallback" title="callback port configuration for the nfs kernel module in /etc/modprobe.d/60-nfs.conf">Example 15.1, “callback port configuration for the <code class="literal">nfs</code> kernel module in <code class="filename">/etc/modprobe.d/60-nfs.conf</code>”</a>.
    </p><div class="example" id="ex.security.firewall.nfscallback"><div class="example-title-wrap"><h6 class="example-title"><span class="number">Example 15.1: </span><span class="name">callback port configuration for the <code class="literal">nfs</code> kernel module in <code class="filename">/etc/modprobe.d/60-nfs.conf</code> </span><a title="Permalink" class="permalink" href="cha.security.firewall.html#ex.security.firewall.nfscallback">#</a></h6></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen">options nfs callback_tcpport=21005</pre></div></div></div><p>
     To make this change effective it is easiest to reboot the machine.
     Otherwise all NFS services need to be stopped and the
     <code class="literal">nfs</code> kernel module needs to be reloaded. To verify the
     active NFS callback port check the output of
     <code class="command">cat /sys/module/nfs/parameters/callback_tcpport</code>.
    </p><p>
     For easy handling of the now statically configured RPC ports it is useful
     to create a new <code class="systemitem">firewalld</code> service definition. This service definition
     will group all related ports and for example makes it easy to make them
     accessible in a specific zone. In
     <a class="xref" href="cha.security.firewall.html#ex.security.firewall.newrpcservice" title="Commands to Define a new firewalld RPC Service for NFS">Example 15.2, “Commands to Define a new <code class="systemitem">firewalld</code> RPC Service for NFS”</a> this is done for the
     NFS ports as they have been configured in the accompanying examples.
    </p><div class="example" id="ex.security.firewall.newrpcservice"><div class="example-title-wrap"><h6 class="example-title"><span class="number">Example 15.2: </span><span class="name">Commands to Define a new <code class="systemitem">firewalld</code> RPC Service for NFS </span><a title="Permalink" class="permalink" href="cha.security.firewall.html#ex.security.firewall.newrpcservice">#</a></h6></div><div class="example-contents"><div class="verbatim-wrap"><pre class="screen"><code class="prompt root">root # </code><code class="command">firewall-cmd --permanent --new-service=nfs-rpc</code>
<code class="prompt root">root # </code><code class="command">firewall-cmd --permanent --service=nfs-rpc --set-description="NFS related, statically configured RPC ports"</code>
# add UDP and TCP ports for the given sequence
<code class="prompt root">root # </code><code class="command">for port in 21001 21002 21003 21004; do
    firewall-cmd --permanent --service=nfs-rpc --add-port ${port}/udp --add-port ${port}/tcp
done</code>
# the callback port is TCP only
<code class="prompt root">root # </code><code class="command">firewall-cmd --permanent --service=nfs-rpc --add-port 21005/tcp</code>

# show the complete definition of the new custom service
<code class="prompt root">root # </code><code class="command">firewall-cmd --info-service=nfs-rpc --permanent -v</code>
nfs-rpc
  summary:
  description: NFS and related, statically configured RPC ports
  ports: 4711/tcp 21001/udp 21001/tcp 21002/udp 21002/tcp 21003/udp 21003/tcp 21004/udp 21004/tcp
  protocols:
  source-ports:
  modules:
  destination:

# reload firewalld to make the new service definition available
<code class="prompt root">root # </code><code class="command">firewall-cmd --reload</code>

# the new service definition can now be used to open the ports e.g. in the internal zone
<code class="prompt root">root # </code><code class="command">firewall-cmd --add-service=nfs-rpc --zone=internal</code></pre></div></div></div></div></div></div><div class="sect1 " id="sec.security.firewall.info"><div class="titlepage"><div><div><h2 class="title" id="sec.security.firewall.info"><span class="number">15.5 </span><span class="name">For More Information</span> <a title="Permalink" class="permalink" href="cha.security.firewall.html#sec.security.firewall.info">#</a></h2></div></div></div><p>
   The most up-to-date information and other documentation about <code class="systemitem">firewalld</code>
   package is found in <code class="filename">/usr/share/doc/packages/firewalld</code>.
   The home page of the netfilter and iptables project, <a class="link" href="http://www.netfilter.org" target="_blank">http://www.netfilter.org</a>, provides a large collection of
   documents about iptables in general in many languages.
  </p></div></div></div><div class="page-bottom"><div id="_bottom-navigation"><a class="nav-link" href="cha.security.vpnserver.html"><span class="next-icon">→</span><span class="nav-label"><span class="number">Chapter 16 </span>Configuring a VPN Server</span></a><a class="nav-link" href="cha.ssh.html"><span class="prev-icon">←</span><span class="nav-label"><span class="number">Chapter 14 </span>SSH: Secure Network Operations</span></a></div><div id="_share-print"><div class="online-contents share"><strong>Share this page: </strong><span class="share-buttons"><span id="_share-fb" class="bottom-button">Facebook</span><span class="spacer"> • </span><span id="_share-gp" class="bottom-button">Google+</span><span class="spacer"> • </span><span id="_share-tw" class="bottom-button">Twitter</span><span class="spacer"> • </span><span id="_share-mail" class="bottom-button">E-Mail</span></span></div><div class="print"><span id="_print-button" class="bottom-button">Print this page</span></div><div class="clearme"></div></div></div></div><div id="_inward"></div></div><div id="_footer-wrap"><div id="_footer"><p>©
        2018 
        SUSE</p><ul><li><a href="http://www.suse.com/company/careers/" target="_top">Careers</a></li><li><a href="http://www.suse.com/company/legal/" target="_top">Legal</a></li><li><a href="http://www.suse.com/company/" target="_top">About</a></li><li><a href="http://www.suse.com/ContactsOffices/contacts_offices.jsp" target="_top">Contact Us</a></li></ul></div></div></body></html>