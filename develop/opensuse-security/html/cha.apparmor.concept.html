<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang=""><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Immunizing Programs | Security Guide | openSUSE Leap 42.3</title><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" /><link rel="stylesheet" type="text/css" href="static/css/style.css" /><link rel="stylesheet" type="text/css" href="static/css/highlight.css" /><link rel="stylesheet" type="text/css" href="static/css/brand.css" /><meta name="generator" content="DAPS 2.4.0 using openSUSE XSL Stylesheets 2.0.8 (based on DocBook XSL Stylesheets 1.78.1) - chunked" /><meta name="product-name" content="openSUSE Leap" /><meta name="product-number" content="42.3" /><meta name="book-title" content="Security Guide" /><meta name="chapter-title" content="Chapter 20. Immunizing Programs" /><meta name="tracker-url" content="https://bugzilla.opensuse.org/enter_bug.cgi" /><meta name="tracker-type" content="bsc" /><meta name="tracker-bsc-assignee" content="fs@suse.com" /><meta name="tracker-bsc-component" content="Documentation" /><meta name="tracker-bsc-product" content="openSUSE Distribution" /><meta name="tracker-bsc-version" content="Leap 42.2" /><link rel="home" href="index.html" title="openSUSE Leap Documentation" /><link rel="up" href="part.apparmor.html" title="Part IV. Confining Privileges with AppArmor" /><link rel="prev" href="cha.apparmor.start.html" title="Chapter 19. Getting Started" /><link rel="next" href="cha.apparmor.profiles.html" title="Chapter 21. Profile Components and Syntax" /><script type="text/javascript">

var protocol = window.location.protocol.toLowerCase();
if ( protocol != 'file:' ) {
  var agent = navigator.userAgent.toLowerCase();
  var wanted = ( protocol == 'https:') ? 'https' : 'http';
  var file = 'fonts.css';
  document.write('<link rel="stylesheet" type="text/css" href="' + wanted + '://static.opensuse.org/fonts/'+ file +'"></link>');
}
else {
   document.write('<link rel="stylesheet" type="text/css" href="static/css/fonts-onlylocal.css"></link>');
}

</script><noscript><link rel="stylesheet" type="text/css" href="http://static.opensuse.org/fonts/fonts.css" /></noscript><script src="static/js/jquery-1.10.2.min.js" type="text/javascript"></script><script src="static/js/script.js" type="text/javascript"></script><script src="static/js/highlight.min.js" type="text/javascript"></script><script>

$(document).ready(function() {
  $('.verbatim-wrap.highlight').each(function(i, block) {
    hljs.highlightBlock(block);
  });
});
hljs.configure({
  useBR: false
});

</script></head><body class="draft offline js-off"><div id="_outer-wrap"><div id="_white-bg"><div id="_header"><div id="_logo"><img src="static/images/logo.png" alt="Logo" /></div><div class="crumbs"><a class="book-link" href="index.html" title="openSUSE Leap Documentation"><span class="book-icon">openSUSE Leap Documentation</span></a><span> › </span><a class="crumb" href="book.security.html">Security Guide</a><span> › </span><a class="crumb" href="part.apparmor.html">Confining Privileges with AppArmor</a><span> › </span><a class="crumb" href="cha.apparmor.concept.html">Immunizing Programs</a></div><div class="clearme"></div></div></div><div id="_toolbar-wrap"><div id="_toolbar"><div id="_toc-area" class="inactive"><a id="_toc-area-button" class="tool" title="Contents" accesskey="c" href="index.html"><span class="tool-spacer"><span class="toc-icon">Contents</span><span class="clearme"></span></span><span class="tool-label">Contents</span></a><div class="active-contents bubble-corner"></div><div class="active-contents bubble"><div class="bubble-container"><h6>Security Guide</h6><div id="_bubble-toc"><ol><li class="inactive"><a href="preface.security.html"><span class="number"> </span><span class="name">About This Guide</span></a></li><li class="inactive"><a href="cha.security.html"><span class="number">1 </span><span class="name">Security and Confidentiality</span></a></li><li class="inactive"><a href="part.auth.html"><span class="number">I </span><span class="name">Authentication</span></a><ol><li class="inactive"><a href="cha.pam.html"><span class="number">2 </span><span class="name">Authentication with PAM</span></a></li><li class="inactive"><a href="cha.nis.html"><span class="number">3 </span><span class="name">Using NIS</span></a></li><li class="inactive"><a href="cha.security.auth.html"><span class="number">4 </span><span class="name">Setting Up Authentication Servers and Clients Using YaST</span></a></li><li class="inactive"><a href="cha.security.ldap.html"><span class="number">5 </span><span class="name">LDAP—A Directory Service</span></a></li><li class="inactive"><a href="cha.security.kerberos.html"><span class="number">6 </span><span class="name">Network Authentication with Kerberos</span></a></li><li class="inactive"><a href="cha.security.ad.html"><span class="number">7 </span><span class="name">Active Directory Support</span></a></li></ol></li><li class="inactive"><a href="part.local_security.html"><span class="number">II </span><span class="name">Local Security</span></a><ol><li class="inactive"><a href="cha.security.yast_security.html"><span class="number">8 </span><span class="name">Configuring Security Settings with YaST</span></a></li><li class="inactive"><a href="cha.security.policykit.html"><span class="number">9 </span><span class="name">Authorization with PolKit</span></a></li><li class="inactive"><a href="cha.security.acls.html"><span class="number">10 </span><span class="name">Access Control Lists in Linux</span></a></li><li class="inactive"><a href="cha.security.cryptofs.html"><span class="number">11 </span><span class="name">Encrypting Partitions and Files</span></a></li><li class="inactive"><a href="cha.certstore.html"><span class="number">12 </span><span class="name">Certificate Store</span></a></li><li class="inactive"><a href="cha.aide.html"><span class="number">13 </span><span class="name">Intrusion Detection with AIDE</span></a></li></ol></li><li class="inactive"><a href="part.network_security.html"><span class="number">III </span><span class="name">Network Security</span></a><ol><li class="inactive"><a href="cha.ssh.html"><span class="number">14 </span><span class="name">SSH: Secure Network Operations</span></a></li><li class="inactive"><a href="cha.security.firewall.html"><span class="number">15 </span><span class="name">Masquerading and Firewalls</span></a></li><li class="inactive"><a href="cha.security.vpnserver.html"><span class="number">16 </span><span class="name">Configuring a VPN Server</span></a></li><li class="inactive"><a href="cha.security.yast_ca.html"><span class="number">17 </span><span class="name">Managing X.509 Certification</span></a></li></ol></li><li class="inactive"><a href="part.apparmor.html"><span class="number">IV </span><span class="name">Confining Privileges with <span class="phrase">AppArmor</span></span></a><ol><li class="inactive"><a href="cha.apparmor.intro.html"><span class="number">18 </span><span class="name">Introducing <span class="phrase">AppArmor</span></span></a></li><li class="inactive"><a href="cha.apparmor.start.html"><span class="number">19 </span><span class="name">Getting Started</span></a></li><li class="inactive"><a href="cha.apparmor.concept.html"><span class="number">20 </span><span class="name">Immunizing Programs</span></a></li><li class="inactive"><a href="cha.apparmor.profiles.html"><span class="number">21 </span><span class="name">Profile Components and Syntax</span></a></li><li class="inactive"><a href="cha.apparmor.repos.html"><span class="number">22 </span><span class="name"><span class="phrase">AppArmor</span> Profile Repositories</span></a></li><li class="inactive"><a href="cha.apparmor.yast.html"><span class="number">23 </span><span class="name">Building and Managing Profiles with YaST</span></a></li><li class="inactive"><a href="cha.apparmor.commandline.html"><span class="number">24 </span><span class="name">Building Profiles from the Command Line</span></a></li><li class="inactive"><a href="cha.apparmor.hat.html"><span class="number">25 </span><span class="name">Profiling Your Web Applications Using ChangeHat</span></a></li><li class="inactive"><a href="cha.apparmor.pam.html"><span class="number">26 </span><span class="name">Confining Users with <code class="systemitem">pam_apparmor</code></span></a></li><li class="inactive"><a href="cha.apparmor.managing.html"><span class="number">27 </span><span class="name">Managing Profiled Applications</span></a></li><li class="inactive"><a href="cha.apparmor.support.html"><span class="number">28 </span><span class="name">Support</span></a></li><li class="inactive"><a href="cha.apparmor.glossary.html"><span class="number">29 </span><span class="name"><span class="phrase">AppArmor</span> Glossary</span></a></li></ol></li><li class="inactive"><a href="bk04pt05.html"><span class="number">V </span><span class="name">SELinux</span></a><ol><li class="inactive"><a href="cha.selinux.html"><span class="number">30 </span><span class="name">Configuring SELinux</span></a></li></ol></li><li class="inactive"><a href="part.audit.html"><span class="number">VI </span><span class="name"><em class="citetitle ">The Linux Audit Framework</em></span></a><ol><li class="inactive"><a href="cha.audit.comp.html"><span class="number">31 </span><span class="name">Understanding Linux Audit</span></a></li><li class="inactive"><a href="cha.audit.setup.html"><span class="number">32 </span><span class="name">Setting Up the Linux Audit Framework</span></a></li><li class="inactive"><a href="cha.audit.scenarios.html"><span class="number">33 </span><span class="name">Introducing an Audit Rule Set</span></a></li><li class="inactive"><a href="cha.audit.moreinfo.html"><span class="number">34 </span><span class="name">Useful Resources</span></a></li></ol></li><li class="inactive"><a href="bk04apa.html"><span class="number">A </span><span class="name">GNU Licenses</span></a></li></ol></div><div class="clearme"></div></div></div></div><div id="_nav-area" class="inactive"><div class="tool"><span class="nav-inner"><span class="tool-label">Navigation</span><a accesskey="p" class="tool-spacer" title="Chapter 19. Getting Started" href="cha.apparmor.start.html"><span class="prev-icon">←</span></a><a accesskey="n" class="tool-spacer" title="Chapter 21. Profile Components and Syntax" href="cha.apparmor.profiles.html"><span class="next-icon">→</span></a></span></div></div></div></div><div id="_fixed-header-wrap" class="inactive"><div id="_fixed-header"><div class="crumbs"><a class="book-link" href="index.html" title="openSUSE Leap Documentation"><span class="book-icon">openSUSE Leap Documentation</span></a><span> › </span><a class="crumb" href="book.security.html">Security Guide</a><span> › </span><a class="crumb" href="part.apparmor.html">Confining Privileges with AppArmor</a><span> › </span><a class="crumb" href="cha.apparmor.concept.html">Immunizing Programs</a></div><div class="buttons"><a class="top-button button" href="#">Top</a><div class="button"><a accesskey="p" class="tool-spacer" title="Chapter 19. Getting Started" href="cha.apparmor.start.html"><span class="prev-icon">←</span></a><a accesskey="n" class="tool-spacer" title="Chapter 21. Profile Components and Syntax" href="cha.apparmor.profiles.html"><span class="next-icon">→</span></a></div><div class="clearme"></div></div><div class="clearme"></div></div></div><div id="_content" class="draft "><div class="documentation"><div class="chapter " id="cha.apparmor.concept"><div class="titlepage"><div><div class="version-info">Applies to  <span class="productname"><span class="productname"><span class="phrase">openSUSE Leap</span></span></span> <span class="productnumber"><span class="productnumber"><span class="phrase">42.3</span></span></span></div><div><h2 class="title"><span class="number">20 </span><span class="name">Immunizing Programs</span> </h2><div class="doc-status"><ul><li><span class="ds-label">Filename: </span>apparmor_whatimmunize.xml</li><li><span class="ds-label">ID: </span>cha.apparmor.concept</li></ul></div></div></div></div><div class="line"><div class="toc"><dl><dt><span class="sect1"><a href="cha.apparmor.concept.html#sec.apparmor.concept.tools"><span class="number">20.1 </span><span class="name">Introducing the <span class="phrase">AppArmor</span> Framework</span></a></span></dt><dt><span class="sect1"><a href="cha.apparmor.concept.html#sec.apparmor.concept.determine"><span class="number">20.2 </span><span class="name">Determining Programs to Immunize</span></a></span></dt><dt><span class="sect1"><a href="cha.apparmor.concept.html#sec.apparmor.concept.cron"><span class="number">20.3 </span><span class="name">Immunizing <code class="systemitem">cron</code> Jobs</span></a></span></dt><dt><span class="sect1"><a href="cha.apparmor.concept.html#sec.apparmor.concept.network"><span class="number">20.4 </span><span class="name">Immunizing Network Applications</span></a></span></dt></dl></div></div><p>
  Effective hardening of a computer system requires minimizing the number of
  programs that mediate privilege, then securing the programs as much as
  possible. With <span class="phrase">AppArmor</span>, you only need to profile the programs that are
  exposed to attack in your environment, which drastically reduces the
  amount of work required to harden your computer. <span class="phrase">AppArmor</span> profiles enforce
  policies to make sure that programs do what they are supposed to do, but
  nothing else.
 </p><p>
  <span class="phrase">AppArmor</span> provides immunization technologies that protect applications from
  the inherent vulnerabilities they possess. After installing <span class="phrase">AppArmor</span>,
  setting up <span class="phrase">AppArmor</span> profiles, and rebooting the computer, your system
  becomes immunized because it begins to enforce the <span class="phrase">AppArmor</span> security
  policies. Protecting programs with <span class="phrase">AppArmor</span> is called
  <span class="emphasis"><em>immunizing</em></span>.
 </p><p>
  Administrators need only concern themselves with the applications that are
  vulnerable to attacks, and generate profiles for these. Hardening a system
  thus comes down to building and maintaining the <span class="phrase">AppArmor</span> profile set and
  monitoring any policy violations or exceptions logged by <span class="phrase">AppArmor</span>'s
  reporting facility.
 </p><p>
  Users should not notice <span class="phrase">AppArmor</span>. It runs <span class="quote">“<span class="quote">behind the
  scenes</span>”</span> and does not require any user interaction. Performance is
  not noticeably affected by <span class="phrase">AppArmor</span>. If some activity of the application is
  not covered by an <span class="phrase">AppArmor</span> profile or if some activity of the application
  is prevented by <span class="phrase">AppArmor</span>, the administrator needs to adjust the profile of
  this application.
 </p><p>
  <span class="phrase">AppArmor</span> sets up a collection of default application profiles to protect
  standard Linux services. To protect other applications, use the <span class="phrase">AppArmor</span>
  tools to create profiles for the applications that you want protected.
  This chapter introduces the philosophy of immunizing programs. Proceed to
  <a class="xref" href="cha.apparmor.profiles.html" title="Chapter 21. Profile Components and Syntax">Chapter 21, <em>Profile Components and Syntax</em></a>,
  <a class="xref" href="cha.apparmor.yast.html" title="Chapter 23. Building and Managing Profiles with YaST">Chapter 23, <em>Building and Managing Profiles with YaST</em></a>, or
  <a class="xref" href="cha.apparmor.commandline.html" title="Chapter 24. Building Profiles from the Command Line">Chapter 24, <em>Building Profiles from the Command Line</em></a> if you are ready to build and
  manage <span class="phrase">AppArmor</span> profiles.
 </p><p>
  <span class="phrase">AppArmor</span> provides streamlined access control for network services by
  specifying which files each program is allowed to read, write, and
  execute, and which type of network it is allowed to access. This ensures
  that each program does what it is supposed to do, and nothing else.
  <span class="phrase">AppArmor</span> quarantines programs to protect the rest of the system from being
  damaged by a compromised process.
 </p><p>
  <span class="phrase">AppArmor</span> is a host intrusion prevention or mandatory access control scheme.
  Previously, access control schemes were centered around users because they
  were built for large timeshare systems. Alternatively, modern network
  servers largely do not permit users to log in, but instead provide a
  variety of network services for users (such as Web, mail, file, and print
  servers). <span class="phrase">AppArmor</span> controls the access given to network services and other
  programs to prevent weaknesses from being exploited.
 </p><div id="idm140096597958272" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.png" /><h6>Tip: Background Information for <span class="phrase">AppArmor</span></h6><p>
   To get a more in-depth overview of <span class="phrase">AppArmor</span> and the overall concept behind
   it, refer to <a class="xref" href="cha.apparmor.intro.html#sec.apparmor.intro.background" title="18.2. Background Information on AppArmor Profiling">Section 18.2, “Background Information on <span class="phrase">AppArmor</span> Profiling”</a>.
  </p></div><div class="sect1 " id="sec.apparmor.concept.tools"><div class="titlepage"><div><div><h2 class="title" id="sec.apparmor.concept.tools"><span class="number">20.1 </span><span class="name">Introducing the <span class="phrase">AppArmor</span> Framework</span> <a title="Permalink" class="permalink" href="cha.apparmor.concept.html#sec.apparmor.concept.tools">#</a></h2></div></div></div><p>
   This section provides a very basic understanding of what is happening
   <span class="quote">“<span class="quote">behind the scenes</span>”</span> (and under the hood of the YaST
   interface) when you run <span class="phrase">AppArmor</span>.
  </p><p>
   An <span class="phrase">AppArmor</span> profile is a plain text file containing path entries and
   access permissions. See <a class="xref" href="cha.apparmor.profiles.html#sec.apparmor.profiles.parts" title="21.1. Breaking an AppArmor Profile into Its Parts">Section 21.1, “Breaking an <span class="phrase">AppArmor</span> Profile into Its Parts”</a> for
   a detailed reference profile. The directives contained in this text file
   are then enforced by the <span class="phrase">AppArmor</span> routines to quarantine the process or
   program.
  </p><p>
   The following tools interact in the building and enforcement of <span class="phrase">AppArmor</span>
   profiles and policies:
  </p><div class="variablelist "><dl class="variablelist"><dt id="idm140096597949088"><span class="term "><code class="command">aa-status</code>
    </span></dt><dd><p>
      <code class="command">aa-status</code> reports various aspects of the current
      state of the running <span class="phrase">AppArmor</span> confinement.
     </p></dd><dt id="idm140096597946064"><span class="term "><code class="command">aa-unconfined</code>
    </span></dt><dd><p>
      <code class="command">aa-unconfined</code> detects any application running on
      your system that listens for network connections and is not protected
      by an <span class="phrase">AppArmor</span> profile. Refer to
      <a class="xref" href="cha.apparmor.commandline.html#sec.apparmor.commandline.profiling.summary.unconfined" title="24.7.3.12. aa-unconfined—Identifying Unprotected Processes">Section 24.7.3.12, “aa-unconfined—Identifying Unprotected Processes”</a>
      for detailed information about this tool.
     </p></dd><dt id="idm140096597942336"><span class="term "><code class="command">aa-autodep</code>
    </span></dt><dd><p>
      <code class="command">aa-autodep</code> creates a basic framework of a profile
      that needs to be fleshed out before it is put to use in production.
      The resulting profile is loaded and put into complain mode, reporting
      any behavior of the application that is not (yet) covered by <span class="phrase">AppArmor</span>
      rules. Refer to
      <a class="xref" href="cha.apparmor.commandline.html#sec.apparmor.commandline.profiling.summary.autodep" title="24.7.3.1. aa-autodep—Creating Approximate Profiles">Section 24.7.3.1, “aa-autodep—Creating Approximate Profiles”</a>
      for detailed information about this tool.
     </p></dd><dt id="idm140096597938480"><span class="term "><code class="command">aa-genprof</code>
    </span></dt><dd><p>
      <code class="command">aa-genprof</code> generates a basic profile and asks you
      to refine this profile by executing the application and generating log
      events that need to be taken care of by <span class="phrase">AppArmor</span> policies. You are
      guided through a series of questions to deal with the log events that
      have been triggered during the application's execution. After the
      profile has been generated, it is loaded and put into enforce mode.
      Refer to
      <a class="xref" href="cha.apparmor.commandline.html#sec.apparmor.commandline.profiling.summary.genprof" title="24.7.3.8. aa-genprof—Generating Profiles">Section 24.7.3.8, “aa-genprof—Generating Profiles”</a>
      for detailed information about this tool.
     </p></dd><dt id="idm140096597934496"><span class="term "><code class="command">aa-logprof</code>
    </span></dt><dd><p>
      <code class="command">aa-logprof</code> interactively scans and reviews the log
      entries generated by an application that is confined by an <span class="phrase">AppArmor</span>
      profile in both complain and enforced modes. It assists you in
      generating new entries in the profile concerned. Refer to
      <a class="xref" href="cha.apparmor.commandline.html#sec.apparmor.commandline.profiling.summary.logprof" title="24.7.3.9. aa-logprof—Scanning the System Log">Section 24.7.3.9, “aa-logprof—Scanning the System Log”</a>
      for detailed information about this tool.
     </p></dd><dt id="idm140096597930672"><span class="term "><code class="command">aa-easyprof</code>
    </span></dt><dd><p>
      <code class="command">aa-easyprof</code> provides an easy-to-use interface for
      <span class="phrase">AppArmor</span> profile generation. <code class="command">aa-easyprof</code> supports
      the use of templates and policy groups to quickly profile an
      application. Note that while this tool can help with policy
      generation, its utility is dependent on the quality of the templates,
      policy groups and abstractions used. <code class="command">aa-easyprof</code>
      may create a profile that is less restricted than creating the profile
      with <code class="command">aa-genprof</code> and <code class="command">aa-logprof</code>.
     </p></dd><dt id="idm140096597925552"><span class="term "><code class="command">aa-complain</code>
    </span></dt><dd><p>
      <code class="command">aa-complain</code> toggles the mode of an <span class="phrase">AppArmor</span> profile
      from enforce to complain. Violations to rules set in a profile are
      logged, but the profile is not enforced. Refer to
      <a class="xref" href="cha.apparmor.commandline.html#sec.apparmor.commandline.profiling.summary.complain" title="24.7.3.2. aa-complain—Entering Complain or Learning Mode">Section 24.7.3.2, “aa-complain—Entering Complain or Learning Mode”</a>
      for detailed information about this tool.
     </p></dd><dt id="idm140096597921808"><span class="term "><code class="command">aa-enforce</code>
    </span></dt><dd><p>
      <code class="command">aa-enforce</code> toggles the mode of an <span class="phrase">AppArmor</span> profile
      from complain to enforce. Violations to rules set in a profile are
      logged and not permitted—the profile is enforced. Refer to
      <a class="xref" href="cha.apparmor.commandline.html#sec.apparmor.commandline.profiling.summary.enforce" title="24.7.3.6. aa-enforce—Entering Enforce Mode">Section 24.7.3.6, “aa-enforce—Entering Enforce Mode”</a>
      for detailed information about this tool.
     </p></dd><dt id="idm140096597918048"><span class="term "><code class="command">aa-disable</code>
    </span></dt><dd><p>
      <code class="command">aa-disable</code> disables the enforcement mode for one or
      more <span class="phrase">AppArmor</span> profiles. This command will unload the profile from the
      kernel and prevent it from being loaded on <span class="phrase">AppArmor</span> start-up. The
      <code class="command">aa-enforce</code> and <code class="command">aa-complain</code>
      utilities may be used to change this behavior.
     </p></dd><dt id="idm140096597913552"><span class="term "><code class="command">aa-exec</code>
    </span></dt><dd><p>
      <code class="command">aa-exec</code> launches a program confined by the
      specified <span class="phrase">AppArmor</span> profile and/or namespace. If both a profile and
      namespace are specified, the command will be confined by the profile
      in the new policy namespace. If only a namespace is specified, the
      profile name of the current confinement will be used. If neither a
      profile or namespace is specified, the command will be run using
      standard profile attachment—as if run without
      <code class="command">aa-exec</code>.
     </p></dd><dt id="idm140096597909712"><span class="term "><code class="command">aa-notify</code>
    </span></dt><dd><p>
      <code class="command">aa-notify</code> is a handy utility that displays <span class="phrase">AppArmor</span>
      notifications in your desktop environment. You can also configure it
      to display a summary of notifications for the specified number of
      recent days. For more information, see
      <a class="xref" href="cha.apparmor.commandline.html#commandline.profiling.summary.aa-notify" title="24.7.3.13. aa-notify">Section 24.7.3.13, “aa-notify”</a>.
     </p></dd></dl></div></div><div class="sect1 " id="sec.apparmor.concept.determine"><div class="titlepage"><div><div><h2 class="title" id="sec.apparmor.concept.determine"><span class="number">20.2 </span><span class="name">Determining Programs to Immunize</span> <a title="Permalink" class="permalink" href="cha.apparmor.concept.html#sec.apparmor.concept.determine">#</a></h2></div></div></div><p>
   Now that you have familiarized yourself with <span class="phrase">AppArmor</span>, start selecting the
   applications for which to build profiles. Programs that need profiling
   are those that mediate privilege. The following programs have access to
   resources that the person using the program does not have, so they grant
   the privilege to the user when used:
  </p><div class="variablelist "><dl class="variablelist"><dt id="idm140096597903008"><span class="term "><code class="systemitem">cron</code> Jobs</span></dt><dd><p>
      Programs that are run periodically by
      <code class="systemitem">cron</code>. Such programs read input
      from a variety of sources and can run with special privileges,
      sometimes with as much as <code class="systemitem">root</code> privilege. For example,
      <code class="systemitem">cron</code> can run
      <code class="command">/usr/sbin/logrotate</code> daily to rotate, compress, or
      even mail system logs. For instructions for finding these types of
      programs, refer to
      <a class="xref" href="cha.apparmor.concept.html#sec.apparmor.concept.cron" title="20.3. Immunizing cron Jobs">Section 20.3, “Immunizing <code class="systemitem">cron</code> Jobs”</a>.
     </p></dd><dt id="idm140096597896928"><span class="term ">Web Applications</span></dt><dd><p>
      Programs that can be invoked through a Web browser, including CGI Perl
      scripts, PHP pages, and more complex Web applications. For
      instructions for finding these types of programs, refer to
      <a class="xref" href="cha.apparmor.concept.html#sec.apparmor.concept.network.web" title="20.4.1. Immunizing Web Applications">Section 20.4.1, “Immunizing Web Applications”</a>.
     </p></dd><dt id="idm140096597894096"><span class="term ">Network Agents</span></dt><dd><p>
      Programs (servers and clients) that have open network ports. User
      clients, such as mail clients and Web browsers mediate privilege.
      These programs run with the privilege to write to the user's home
      directory and they process input from potentially hostile remote
      sources, such as hostile Web sites and e-mailed malicious code. For
      instructions for finding these types of programs, refer to
      <a class="xref" href="cha.apparmor.concept.html#sec.apparmor.concept.network.agents" title="20.4.2. Immunizing Network Agents">Section 20.4.2, “Immunizing Network Agents”</a>.
     </p></dd></dl></div><p>
   Conversely, unprivileged programs do not need to be profiled. For
   example, a shell script might invoke the <code class="command">cp</code>
   program to copy a file. Because <code class="command">cp</code> does not by
   default have its own profile or subprofile, it inherits the profile
   of the parent shell script.  Thus <code class="command">cp</code> can copy any
   files that the parent shell script's profile can read and write.
  </p></div><div class="sect1 " id="sec.apparmor.concept.cron"><div class="titlepage"><div><div><h2 class="title" id="sec.apparmor.concept.cron"><span class="number">20.3 </span><span class="name">Immunizing <code class="systemitem">cron</code> Jobs</span> <a title="Permalink" class="permalink" href="cha.apparmor.concept.html#sec.apparmor.concept.cron">#</a></h2></div></div></div><p>
   To find programs that are run by
   <code class="systemitem">cron</code>, inspect your local
   <code class="systemitem">cron</code> configuration.
   Unfortunately, <code class="systemitem">cron</code> configuration
   is rather complex, so there are numerous files to inspect. Periodic
   <code class="systemitem">cron</code> jobs are run from these
   files:
  </p><div class="verbatim-wrap"><pre class="screen">/etc/crontab
/etc/cron.d/*
/etc/cron.daily/*
/etc/cron.hourly/*
/etc/cron.monthly/*
/etc/cron.weekly/*</pre></div><p>
   
   The <code class="command">crontab</code> command lists/edits the current user's
   crontab. To manipulate <code class="systemitem">root</code>'s
   <code class="systemitem">cron</code> jobs, first become
   <code class="systemitem">root</code>, and then edit the tasks with <code class="command">crontab -e</code>
   or list them with <code class="command">crontab -l</code>.
  </p></div><div class="sect1 " id="sec.apparmor.concept.network"><div class="titlepage"><div><div><h2 class="title" id="sec.apparmor.concept.network"><span class="number">20.4 </span><span class="name">Immunizing Network Applications</span> <a title="Permalink" class="permalink" href="cha.apparmor.concept.html#sec.apparmor.concept.network">#</a></h2></div></div></div><p>
   An automated method for finding network server daemons that should be
   profiled is to use the <code class="command">aa-unconfined</code> tool.

  </p><p>
   The <code class="command">aa-unconfined</code> tool uses the command
   <code class="command">netstat -nlp</code> to inspect open ports from inside your
   computer, detect the programs associated with those ports, and inspect
   the set of <span class="phrase">AppArmor</span> profiles that you have loaded.
   <code class="command">aa-unconfined</code> then reports these programs along with
   the <span class="phrase">AppArmor</span> profile associated with each program, or reports
   <span class="quote">“<span class="quote">none</span>”</span> (if the program is not confined).
  </p><div id="idm140096597872544" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.png" /><h6>Note</h6><p>
    If you create a new profile, you must restart the program that has been
    profiled to have it be effectively confined by <span class="phrase">AppArmor</span>.
   </p></div><p>
   Below is a sample <code class="command">aa-unconfined</code> output:
  </p><div class="verbatim-wrap"><pre class="screen">3702<span id="co.apparmor.concept.network.id"></span><span class="callout">1</span> /usr/sbin/sshd<span id="co.apparmor.concept.network.string"></span><span class="callout">2</span> confined
   by '/usr/sbin/sshd<span id="co.apparmor.concept.network.confine"></span><span class="callout">3</span> (enforce)'
4040 /usr/sbin/smbd confined by '/usr/sbin/smbd (enforce)'
4373 /usr/lib/postfix/master confined by '/usr/lib/postfix/master (enforce)'
4505 /usr/sbin/httpd2-prefork confined by '/usr/sbin/httpd2-prefork (enforce)'
646 /usr/lib/wicked/bin/wickedd-dhcp4 not confined
647 /usr/lib/wicked/bin/wickedd-dhcp6 not confined
5592 /usr/bin/ssh not confined
7146 /usr/sbin/cupsd confined by '/usr/sbin/cupsd (complain)'</pre></div><div class="calloutlist "><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#co.apparmor.concept.network.id"><span class="callout">1</span></a> </p></td><td valign="top" align="left"><p>
     The first portion is a number. This number is the process ID number
     (PID) of the listening program.
    </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co.apparmor.concept.network.string"><span class="callout">2</span></a> </p></td><td valign="top" align="left"><p>
     The second portion is a string that represents the absolute path of the
     listening program
    </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#co.apparmor.concept.network.confine"><span class="callout">3</span></a> </p></td><td valign="top" align="left"><p>
     The final portion indicates the profile confining the program, if any.
    </p></td></tr></table></div><div id="idm140096597862880" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.png" /><h6>Note</h6><p>
    <code class="command">aa-unconfined</code> requires <code class="systemitem">root</code> privileges and
    should not be run from a shell that is confined by an <span class="phrase">AppArmor</span> profile.
   </p></div><p>
   <code class="command">aa-unconfined</code> does not distinguish between one network
   interface and another, so it reports all unconfined processes, even those
   that might be listening to an internal LAN interface.
  </p><p>
   Finding user network client applications is dependent on your user
   preferences. The <code class="command">aa-unconfined</code> tool detects and
   reports network ports opened by client applications, but only those
   client applications that are running at the time the
   <code class="command">aa-unconfined</code> analysis is performed. This is a problem
   because network services tend to be running all the time, while network
   client applications tend only to be running when the user is interested
   in them.
  </p><p>
   Applying <span class="phrase">AppArmor</span> profiles to user network client applications is also
   dependent on user preferences. Therefore, we leave the profiling of user
   network client applications as an exercise for the user.
  </p><p>
   To aggressively confine desktop applications, the
   <code class="command">aa-unconfined</code> command supports a
   <code class="option">--paranoid</code> option, which reports all processes running
   and the corresponding <span class="phrase">AppArmor</span> profiles that might or might not be
   associated with each process. The user can then decide whether each of
   these programs needs an <span class="phrase">AppArmor</span> profile.
  </p><p>
   If you have new or modified profiles, you can submit them to the
   &lt;<a class="email" href="mailto:apparmor@lists.ubuntu.com">apparmor@lists.ubuntu.com</a>&gt; mailing list along with a use
   case for the application behavior that you exercised. The <span class="phrase">AppArmor</span> team
   reviews and may submit the work into <span class="productname"><span class="phrase">openSUSE Leap</span></span>. We cannot
   guarantee that every profile will be included, but we make a sincere
   effort to include as much as possible.
  </p><div class="sect2 " id="sec.apparmor.concept.network.web"><div class="titlepage"><div><div><h3 class="title" id="sec.apparmor.concept.network.web"><span class="number">20.4.1 </span><span class="name">Immunizing Web Applications</span> <a title="Permalink" class="permalink" href="cha.apparmor.concept.html#sec.apparmor.concept.network.web">#</a></h3></div></div></div><p>
    To find Web applications, investigate your Web server configuration. The
    Apache Web server is highly configurable and Web applications can be
    stored in many directories, depending on your local configuration.
    <span class="productname"><span class="phrase">openSUSE Leap</span></span>, by default, stores Web applications in
    <code class="filename">/srv/www/cgi-bin/</code>. To the maximum extent possible,
    each Web application should have an <span class="phrase">AppArmor</span> profile.
   </p><p>
    Once you find these programs, you can use the
    <code class="command">aa-genprof</code> and <code class="command">aa-logprof</code> tools to
    create or update their <span class="phrase">AppArmor</span> profiles.
   </p><p>
    Because CGI programs are executed by the Apache Web server, the profile
    for Apache itself, <code class="filename">usr.sbin.httpd2-prefork</code> for
    Apache2 on <span class="productname"><span class="phrase">openSUSE Leap</span></span>, must be modified to add execute permissions
    to each of these programs. For example, adding the line
    <code class="literal">/srv/www/cgi-bin/my_hit_counter.pl rPx</code> grants Apache
    permission to execute the Perl script
    <code class="filename">my_hit_counter.pl</code> and requires that there be a
    dedicated profile for <code class="filename">my_hit_counter.pl</code>. If
    <code class="filename">my_hit_counter.pl</code> does not have a dedicated profile
    associated with it, the rule should say
    <code class="literal">/srv/www/cgi-bin/my_hit_counter.pl rix</code> to cause
    <code class="filename">my_hit_counter.pl</code> to inherit the
    <code class="filename">usr.sbin.httpd2-prefork</code> profile.
   </p><p>
    Some users might find it inconvenient to specify execute permission for
    every CGI script that Apache might invoke. Instead, the administrator
    can grant controlled access to collections of CGI scripts. For example,
    adding the line <code class="literal">/srv/www/cgi-bin/*.{pl,py,pyc} rix</code>
    allows Apache to execute all files in
    <code class="literal">/srv/www/cgi-bin/</code> ending in <code class="filename">.pl</code>
    (Perl scripts) and <code class="filename">.py</code> or <code class="filename">.pyc</code>
    (Python scripts). As above, the <code class="literal">ix</code> part of the rule
    causes Python scripts to inherit the Apache profile, which is
    appropriate if you do not want to write individual profiles for each CGI
    script.
   </p><div id="idm140096597836320" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.png" /><h6>Note</h6><p>
     If you want the subprocess confinement module
     (<code class="filename">apache2-mod-apparmor</code>) functionality when Web
     applications handle Apache modules (<code class="filename">mod_perl</code> and
     <code class="filename">mod_php</code>), use the ChangeHat features when you add
     a profile in YaST or at the command line. To take advantage of the
     subprocess confinement, refer to
     <a class="xref" href="cha.apparmor.hat.html#sec.apparmor.hat.apache.managing" title="25.2. Managing ChangeHat-Aware Applications">Section 25.2, “Managing ChangeHat-Aware Applications”</a>.
    </p></div><p>
    Profiling Web applications that use <code class="filename">mod_perl</code> and
    <code class="filename">mod_php</code> requires slightly different handling. In
    this case, the <span class="quote">“<span class="quote">program</span>”</span> is a script interpreted directly
    by the module within the Apache process, so no exec happens. Instead,
    the <span class="phrase">AppArmor</span> version of Apache calls <code class="command">change_hat()</code>
    using a subprofile (a <span class="quote">“<span class="quote">hat</span>”</span>) corresponding to the name of
    the URI requested.
   </p><div id="idm140096597829600" class="admonition note normal"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.png" /><h6>Note</h6><p>
     The name presented for the script to execute might not be the URI,
     depending on how Apache has been configured for where to look for
     module scripts. If you have configured your Apache to place scripts in
     a different place, the different names appear in the log file when
     <span class="phrase">AppArmor</span> complains about access violations. See
     <a class="xref" href="cha.apparmor.managing.html" title="Chapter 27. Managing Profiled Applications">Chapter 27, <em>Managing Profiled Applications</em></a>.
    </p></div><p>
    For <code class="filename">mod_perl</code> and <code class="filename">mod_php</code>
    scripts, this is the name of the Perl script or the PHP page requested.
    For example, adding this subprofile allows the
    <code class="filename">localtime.php</code> page to execute and access to the
    local system time and locale files:
   </p><div class="verbatim-wrap"><pre class="screen">/usr/bin/httpd2-prefork {
  # ...
  ^/cgi-bin/localtime.php {
    /etc/localtime                  r,
    /srv/www/cgi-bin/localtime.php  r,
    /usr/lib/locale/**              r,
  }
}</pre></div><p>
    If no subprofile has been defined, the <span class="phrase">AppArmor</span> version of Apache applies
    the <code class="systemitem">DEFAULT_URI</code> hat. This subprofile is
    sufficient to display a Web page. The
    <code class="systemitem">DEFAULT_URI</code> hat that <span class="phrase">AppArmor</span> provides by
    default is the following:
   </p><div class="verbatim-wrap"><pre class="screen">^DEFAULT_URI {
    /usr/sbin/suexec2                  mixr,
    /var/log/apache2/**                rwl,
    @{HOME}/public_html                r,
    @{HOME}/public_html/**             r,
    /srv/www/htdocs                    r,
    /srv/www/htdocs/**                 r,
    /srv/www/icons/*.{gif,jpg,png}     r,
    /srv/www/vhosts                    r,
    /srv/www/vhosts/**                 r,
    /usr/share/apache2/**              r,
    /var/lib/php/sess_*                rwl
}</pre></div><p>
    To use a single <span class="phrase">AppArmor</span> profile for all Web pages and CGI scripts served
    by Apache, a good approach is to edit the
    <code class="systemitem">DEFAULT_URI</code> subprofile. For more information on
    confining Web applications with Apache, see
    <a class="xref" href="cha.apparmor.hat.html" title="Chapter 25. Profiling Your Web Applications Using ChangeHat">Chapter 25, <em>Profiling Your Web Applications Using ChangeHat</em></a>.
   </p></div><div class="sect2 " id="sec.apparmor.concept.network.agents"><div class="titlepage"><div><div><h3 class="title" id="sec.apparmor.concept.network.agents"><span class="number">20.4.2 </span><span class="name">Immunizing Network Agents</span> <a title="Permalink" class="permalink" href="cha.apparmor.concept.html#sec.apparmor.concept.network.agents">#</a></h3></div></div></div><p>
    To find network server daemons and network clients (such as
    <code class="command">fetchmail</code> or Firefox) that need to be profiled,
    you should inspect the open ports on your machine.  Also consider
    the programs that are answering on those ports, and provide profiles
    for as many of those programs as possible. If you provide profiles
    for all programs with open network ports, an attacker cannot get to
    the file system on your machine without passing through an <span class="phrase">AppArmor</span>
    profile policy.
   </p><p>
    Scan your server for open network ports manually from outside the
    machine using a scanner (such as nmap), or from inside the machine using
    the <code class="command">netstat --inet -n -p</code> command as <code class="systemitem">root</code>.
    Then, inspect the machine to determine which programs are answering on
    the discovered open ports.
   </p><div id="idm140096597814480" class="admonition tip normal"><img class="symbol" alt="Tip" title="Tip" src="static/images/icon-tip.png" /><h6>Tip</h6><p>
     Refer to the man page of the <code class="command">netstat</code> command for a
     detailed reference of all possible options.
    </p></div></div></div></div></div><div class="page-bottom"><div id="_bottom-navigation"><a class="nav-link" href="cha.apparmor.profiles.html"><span class="next-icon">→</span><span class="nav-label"><span class="number">Chapter 21 </span>Profile Components and Syntax</span></a><a class="nav-link" href="cha.apparmor.start.html"><span class="prev-icon">←</span><span class="nav-label"><span class="number">Chapter 19 </span>Getting Started</span></a></div><div id="_share-print"><div class="online-contents share"><strong>Share this page: </strong><span class="share-buttons"><span id="_share-fb" class="bottom-button">Facebook</span><span class="spacer"> • </span><span id="_share-gp" class="bottom-button">Google+</span><span class="spacer"> • </span><span id="_share-tw" class="bottom-button">Twitter</span></span></div><div class="print"><span id="_print-button" class="bottom-button">Print this page</span></div><div class="clearme"></div></div></div></div><div id="_inward"></div></div><div id="_footer-wrap"><div id="_footer"><p>©
        2018 
        SUSE</p></div></div></body></html>